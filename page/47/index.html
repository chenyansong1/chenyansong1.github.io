<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="一个技术渣的自说自话">
<meta property="og:type" content="website">
<meta property="og:title" content="Chen's Blog">
<meta property="og:url" content="http://yoursite.com/page/47/index.html">
<meta property="og:site_name" content="Chen's Blog">
<meta property="og:description" content="一个技术渣的自说自话">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chen's Blog">
<meta name="twitter:description" content="一个技术渣的自说自话">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"always","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/47/"/>





  <title> Chen's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Chen's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">一个技术渣的自说自话</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/bigdata/spark/wordcount的执行流程图解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/bigdata/spark/wordcount的执行流程图解/" itemprop="url">
                  spark的wordcount的执行流程图解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spark/" itemprop="url" rel="index">
                    <span itemprop="name">spark</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">package cn.itcast.spark.day1</div><div class="line"></div><div class="line">import org.apache.spark.&#123;SparkConf, SparkContext&#125;</div><div class="line"></div><div class="line">/**</div><div class="line">  * Created by root on 2016/5/14.</div><div class="line">  */</div><div class="line">object WordCount &#123;</div><div class="line">  def main(args: Array[String]) &#123;</div><div class="line">    //非常重要，是通向Spark集群的入口</div><div class="line">    val conf = new SparkConf().setAppName(&quot;WC&quot;)</div><div class="line">      .setJars(Array(&quot;C:\\HelloSpark\\target\\hello-spark-1.0.jar&quot;))</div><div class="line">      .setMaster(&quot;spark://node-1.itcast.cn:7077&quot;)</div><div class="line">    val sc = new SparkContext(conf)</div><div class="line"></div><div class="line">    //textFile会产生两个RDD：HadoopRDD  -&gt; MapPartitinsRDD</div><div class="line">    sc.textFile(args(0)).cache()</div><div class="line">      // 产生一个RDD ：MapPartitinsRDD</div><div class="line">      .flatMap(_.split(&quot; &quot;))</div><div class="line">      //产生一个RDD MapPartitionsRDD</div><div class="line">      .map((_, 1))</div><div class="line">      //产生一个RDD ShuffledRDD</div><div class="line">      .reduceByKey(_+_)</div><div class="line">      //产生一个RDD: mapPartitions</div><div class="line">      .saveAsTextFile(args(1))</div><div class="line">    sc.stop()</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h1><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/spark/wc_liucheng/1.png" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/bigdata/spark/spark集群安装/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/bigdata/spark/spark集群安装/" itemprop="url">
                  spark集群安装
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spark/" itemprop="url" rel="index">
                    <span itemprop="name">spark</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-安装"><a href="#1-安装" class="headerlink" title="1.安装"></a>1.安装</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">cd /export/servers/</div><div class="line"></div><div class="line">#上传安装文件,解压</div><div class="line">tar -zxvf spark-1.6.1-bin-hadoop2.6.tgz </div><div class="line">ln -s spark-1.6.1-bin-hadoop2.6/ spark        //创建软链接</div><div class="line">//删除源文件,节省空间</div><div class="line">rm -rf spark-1.6.1-bin-hadoop2.6.tgz </div><div class="line"></div><div class="line">#修改配置文件</div><div class="line">cd spark/conf/</div><div class="line">mv spark-env.sh.template spark-env.sh</div><div class="line">vim spark-env.sh  //添加</div><div class="line"></div><div class="line">export JAVA_HOME=/home/hadoop/app/jdk1.7.0_80</div><div class="line">export SPARK_MASTER_IP=hdp-node-01            //配置master的机器</div><div class="line">export SPARK_MASTER_PORT=7077</div><div class="line"></div><div class="line">#######################################################</div><div class="line"> </div><div class="line">mv slaves.template slaves  </div><div class="line">vim slaves      //添加worker的节点</div><div class="line"> </div><div class="line">hdp-node-01</div><div class="line">hdp-node-02</div><div class="line"></div><div class="line"> </div><div class="line">#######################################################</div><div class="line"></div><div class="line">#拷贝到其他节点</div><div class="line">scp -r /export/servers/spark/ hdp-node-02:/export/servers/</div><div class="line"></div><div class="line"></div><div class="line">#hdp-node-01 在启动</div><div class="line">/export/servers/spark/sbin/start-all.sh</div></pre></td></tr></table></figure>
<p> 注意:</p>
<ul>
<li>因为在mater所在的机器上要去启动其他的机器,所以在master所在的机器上要配置到其他机器的ssh , 这里省略了</li>
<li>需要关闭防火墙</li>
</ul>
<p>#2.测试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">#在mater上</div><div class="line">[root@hdp-node-01 conf]# jps</div><div class="line">1270 Jps</div><div class="line">1159 Worker</div><div class="line">1093 Master</div><div class="line"></div><div class="line"></div><div class="line">#在worker上</div><div class="line">[root@hdp-node-02 servers]# jps</div><div class="line">1073 Worker</div><div class="line">1107 Jps</div></pre></td></tr></table></figure></p>
<h1 id="3-浏览器访问"><a href="#3-浏览器访问" class="headerlink" title="3.浏览器访问"></a>3.浏览器访问</h1><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/spark/install/1.png" alt=""></p>
<h1 id="4-添加zk来解决master的单点问题"><a href="#4-添加zk来解决master的单点问题" class="headerlink" title="4.添加zk来解决master的单点问题"></a>4.添加zk来解决master的单点问题</h1><p>到此为止，Spark集群安装完毕，但是有一个很大的问题，那就是Master节点存在单点故障，要解决此问题，就要借助zookeeper，并且启动至少两个Master节点来实现高可靠，配置方式比较简单：<br>Spark集群规划：node1，node2是Master；node3，node4，node5是Worker  , 安装配置zk集群，并启动zk集群, 停止spark所有服务，修改配置文件spark-env.sh，在该配置文件中删掉SPARK_MASTER_IP并添加如下配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">export SPARK_DAEMON_JAVA_OPTS=&quot;-Dspark.deploy.recoveryMode=ZOOKEEPER -Dspark.deploy.zookeeper.url=zk1,zk2,zk3 -Dspark.deploy.zookeeper.dir=/spark&quot;</div></pre></td></tr></table></figure></p>
<ol>
<li>在node1节点上修改slaves配置文件内容指定worker节点</li>
<li>在node1上执行sbin/start-all.sh脚本，然后在node2上执行sbin/start-master.sh启动第二个Master</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/bigdata/spark/spark计算用户在小区停留时间最长的两个小区/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/bigdata/spark/spark计算用户在小区停留时间最长的两个小区/" itemprop="url">
                  spark计算用户在小区停留时间最长的两个小区
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spark/" itemprop="url" rel="index">
                    <span itemprop="name">spark</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>统计一个用户经常出现的2个位置</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/04/16/bigdata/spark/spark计算用户在小区停留时间最长的两个小区/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/bigdata/spark/spark的自定义排序/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/bigdata/spark/spark的自定义排序/" itemprop="url">
                  spark的自定义排序
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spark/" itemprop="url" rel="index">
                    <span itemprop="name">spark</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">package cn.itcast.spark.day3</div><div class="line"></div><div class="line">import org.apache.spark.&#123;SparkConf, SparkContext&#125;</div><div class="line"></div><div class="line"></div><div class="line">object OrderContext &#123;</div><div class="line">  implicit val girlOrdering  = new Ordering[Girl] &#123;</div><div class="line">    override def compare(x: Girl, y: Girl): Int = &#123;</div><div class="line">      if(x.faceValue &gt; y.faceValue) 1</div><div class="line">      else if (x.faceValue == y.faceValue) &#123;</div><div class="line">        if(x.age &gt; y.age) -1 else 1</div><div class="line">      &#125; else -1</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">/**</div><div class="line">  * Created by root on 2016/5/18.</div><div class="line">  */</div><div class="line">//sort =&gt;规则 先按faveValue，比较年龄</div><div class="line">//name,faveValue,age</div><div class="line"></div><div class="line"></div><div class="line">object CustomSort &#123;</div><div class="line"></div><div class="line">  def main(args: Array[String]) &#123;</div><div class="line">    val conf = new SparkConf().setAppName(&quot;CustomSort&quot;).setMaster(&quot;local[2]&quot;)</div><div class="line">    val sc = new SparkContext(conf)</div><div class="line">    val rdd1 = sc.parallelize(List((&quot;yuihatano&quot;, 90, 28, 1), (&quot;angelababy&quot;, 90, 27, 2),(&quot;JuJingYi&quot;, 95, 22, 3)))</div><div class="line">    import OrderContext._</div><div class="line">    val rdd2 = rdd1.sortBy(x =&gt; Girl(x._2, x._3), false)//false是降序</div><div class="line">    println(rdd2.collect().toBuffer)</div><div class="line">    sc.stop()</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line">  * 第一种方式</div><div class="line"></div><div class="line">case class Girl(val faceValue: Int, val age: Int) extends Ordered[Girl] with Serializable &#123;//Serializable 是因为要走网络,所以需要实现序列化</div><div class="line">  //比较规则</div><div class="line">  override def compare(that: Girl): Int = &#123;</div><div class="line">    if(this.faceValue == that.faceValue) &#123;</div><div class="line">      that.age - this.age</div><div class="line">    &#125; else &#123;</div><div class="line">      this.faceValue -that.faceValue</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">  */</div><div class="line"></div><div class="line">/**</div><div class="line">  * 第二种，通过隐式转换完成排序</div><div class="line">  */</div><div class="line">case class Girl(faceValue: Int, age: Int) extends Serializable</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/bigdata/spark/spark的自定义分区partition/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/bigdata/spark/spark的自定义分区partition/" itemprop="url">
                  spark的自定义分区partition
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spark/" itemprop="url" rel="index">
                    <span itemprop="name">spark</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">package cn.itcast.spark.day3</div><div class="line"></div><div class="line">import java.net.URL</div><div class="line"></div><div class="line">import org.apache.spark.&#123;HashPartitioner, Partitioner, SparkConf, SparkContext&#125;</div><div class="line"></div><div class="line">import scala.collection.mutable</div><div class="line"></div><div class="line">/**</div><div class="line">  * Created by root on 2016/5/18.</div><div class="line">  */</div><div class="line">object UrlCountPartition &#123;</div><div class="line"></div><div class="line">  def main(args: Array[String]) &#123;</div><div class="line"></div><div class="line">    val conf = new SparkConf().setAppName(&quot;UrlCountPartition&quot;).setMaster(&quot;local[2]&quot;)</div><div class="line">    val sc = new SparkContext(conf)</div><div class="line"></div><div class="line">    //rdd1将数据切分，元组中放的是（URL， 1）</div><div class="line">    val rdd1 = sc.textFile(&quot;c://itcast.log&quot;).map(line =&gt; &#123;</div><div class="line">      val f = line.split(&quot;\t&quot;)</div><div class="line">      (f(1), 1)</div><div class="line">    &#125;)</div><div class="line">    val rdd2 = rdd1.reduceByKey(_ + _)</div><div class="line"></div><div class="line">    val rdd3 = rdd2.map(t =&gt; &#123;</div><div class="line">      val url = t._1</div><div class="line">      val host = new URL(url).getHost</div><div class="line">      (host, (url, t._2))</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    val ints = rdd3.map(_._1).distinct().collect()</div><div class="line"></div><div class="line">    val hostParitioner = new HostParitioner(ints)</div><div class="line"></div><div class="line">//    val rdd4 = rdd3.partitionBy(new HashPartitioner(ints.length))</div><div class="line"></div><div class="line">    val rdd4 = rdd3.partitionBy(hostParitioner).mapPartitions(it =&gt; &#123;//partitionBy通过什么进行分区,mapPartitions遍历每一个分区</div><div class="line">      it.toList.sortBy(_._2._2).reverse.take(2).iterator //在每一个分区中进行排序,取top2</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    rdd4.saveAsTextFile(&quot;c://out4&quot;)</div><div class="line"></div><div class="line"></div><div class="line">    //println(rdd4.collect().toBuffer)</div><div class="line">    sc.stop()</div><div class="line"></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line">  * 决定了数据到哪个分区里面</div><div class="line">  * @param ins</div><div class="line">  */</div><div class="line">class HostParitioner(ins: Array[String]) extends Partitioner &#123;</div><div class="line"></div><div class="line">  val parMap = new mutable.HashMap[String, Int]()</div><div class="line">  var count = 0</div><div class="line">  for(i &lt;- ins)&#123;</div><div class="line">    parMap += (i -&gt; count)</div><div class="line">    count += 1</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  override def numPartitions: Int = ins.length</div><div class="line"></div><div class="line">  override def getPartition(key: Any): Int = &#123;</div><div class="line">    parMap.getOrElse(key.toString, 0)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/bigdata/spark/spark的算子/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/bigdata/spark/spark的算子/" itemprop="url">
                  spark的算子
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spark/" itemprop="url" rel="index">
                    <span itemprop="name">spark</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="1-什么是RDD"><a href="#1-什么是RDD" class="headerlink" title="1.什么是RDD"></a>1.什么是RDD</h1><p>&emsp;RDD（Resilient Distributed Dataset）叫做<font color=red>分布式数据集</font>，是Spark中最基本的数据抽象，它代表一个不可变、可分区、里面的元素可并行计算的集合。RDD具有数据流模型的特点：自动容错、位置感知性调度和可伸缩性。RDD允许用户在执行多个查询时显式地<font color=red>将工作集缓存在内存中</font>，后续的查询能够重用工作集，这极大地提升了查询速度。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/04/16/bigdata/spark/spark的算子/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/bigdata/spark/spark的rdd算子讲解2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/bigdata/spark/spark的rdd算子讲解2/" itemprop="url">
                  spark的rdd算子讲解2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spark/" itemprop="url" rel="index">
                    <span itemprop="name">spark</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="reduceByKey"><a href="#reduceByKey" class="headerlink" title="reduceByKey"></a>reduceByKey</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">#Example</div><div class="line">sc.textFile(args(0)).flatMap(_.split(&quot; &quot;)).map((_, 1)).reduceByKey(_+_).</div><div class="line"></div><div class="line">#源码</div><div class="line">  def reduceByKey(partitioner: Partitioner, func: (V, V) =&gt; V): RDD[(K, V)] = self.withScope &#123;</div><div class="line">    combineByKeyWithClassTag[V]((v: V) =&gt; v, func, func, partitioner)</div><div class="line">  &#125;</div><div class="line">/*</div><div class="line">在reduceByKey的内部是调用的combineByKeyWithClassTag, 由上面的源码知道combineByKeyWithClassTag的第一个参数是对value原样输出,第二个,第三个参数是调用reduceByKey中指定的函数</div><div class="line">第二个参数的功能:是在partition内进行操作</div><div class="line">第三个参数的功能是对各个partition的所有的结果进行操作</div><div class="line">*/</div></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/04/16/bigdata/spark/spark的rdd算子讲解2/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/bigdata/spark/spark源码编译/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/bigdata/spark/spark源码编译/" itemprop="url">
                  spark源码编译
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spark/" itemprop="url" rel="index">
                    <span itemprop="name">spark</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">#解压源码包</div><div class="line">tar -zxvf spark-1.6.1.tgz -C /usr/local/src/</div><div class="line">cd /usr/local/src/spark-1.6.1/</div><div class="line"> </div><div class="line">#设置内存2G</div><div class="line">export MAVEN_OPTS=&quot;-Xmx2g -XX:MaxPermSize=512M -XX:ReservedCodeCacheSize=512m&quot;</div><div class="line"> </div><div class="line">#编译前安装一些压缩解压缩工具</div><div class="line">yum install -y snappy snappy-devel bzip2 bzip2-devel lzo lzo-devel lzop openssl openssl-devel</div><div class="line"> </div><div class="line"> </div><div class="line">#需要使用maven,所以要安装maven</div><div class="line"> </div><div class="line">#仅仅是为了编译源码, 编译后可以导入idea中</div><div class="line">mvn clean package -Phadoop-2.6 -Dhadoop.version=2.6.4 -Phive -Phive-thriftserver -Pyarn -DskipTests</div><div class="line"> </div><div class="line">#编译后并打包, 打包后可以丢到生产环境了</div><div class="line">./make-distribution.sh --tgz -Phadoop-2.6 -Dhadoop.version=2.6.4 -Phive -Phive-thriftserver -Pyarn -DskipTests</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/bigdata/spark/sparkSQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/bigdata/spark/sparkSQL/" itemprop="url">
                  sparkSQL
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spark/" itemprop="url" rel="index">
                    <span itemprop="name">spark</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="1-什么是Spark-SQL"><a href="#1-什么是Spark-SQL" class="headerlink" title="1.什么是Spark SQL"></a>1.什么是Spark SQL</h1><p>&emsp;Spark SQL是Spark用来<font color=red>处理结构化数据的一个模块</font>，它提供了一个<font color=red>编程抽象叫做DataFrame并</font>且作为分布式SQL查询引擎的作用。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/04/16/bigdata/spark/sparkSQL/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/bigdata/spark/spark streaming整合kafka的两种方式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/bigdata/spark/spark streaming整合kafka的两种方式/" itemprop="url">
                  spark streaming整合kafka的两种方式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spark/" itemprop="url" rel="index">
                    <span itemprop="name">spark</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="方式一"><a href="#方式一" class="headerlink" title="方式一"></a>方式一</h1><p>有receiver,会记录log日志</p>
<p> 启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#首先启动zk</div><div class="line"></div><div class="line">#启动kafka</div><div class="line">bin/kafka-server-start.sh config/server.properties</div><div class="line"></div><div class="line">#创建topic</div><div class="line">bin/kafka-topics.sh --create --zookeeper 192.168.80.10:2181 --replication-factor 1 --partitions 1 --topic wordcount</div><div class="line"></div><div class="line">#查看主题</div><div class="line">bin/kafka-topics.sh --list --zookeeper 192.168.80.10:2181</div><div class="line"></div><div class="line"></div><div class="line">#启动spark-streaming应用程序:KafkaWordCount  如下</div><div class="line">bin/spark-submit --class cn.itcast.spark.streaming.KafkaWordCount /root/streaming-1.0.jar 192.168.80.10:2181 group1 wordcount 1</div><div class="line"> </div><div class="line"> </div><div class="line">bin/spark-submit --class cn.itcast.spark.UrlCount --master spark://node1.itcast.cn:7077 --executor-memory 1G --total-executor-cores 2 /root/SparkDemo-1.0.jar node1.itcast.cn:2181,node2.itcast.cn:2181,node3.itcast.cn:2181 group1 weblog 2</div></pre></td></tr></table></figure>
<p> KafkaWordCount 代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">package cn.itcast.spark.day5</div><div class="line"> </div><div class="line">import org.apache.spark.storage.StorageLevel</div><div class="line">import org.apache.spark.&#123;HashPartitioner, SparkConf&#125;</div><div class="line">import org.apache.spark.streaming.kafka.KafkaUtils</div><div class="line">import org.apache.spark.streaming.&#123;Seconds, StreamingContext&#125;</div><div class="line"> </div><div class="line">object KafkaWordCount &#123;</div><div class="line"> </div><div class="line">  val updateFunc = (iter: Iterator[(String, Seq[Int], Option[Int])]) =&gt; &#123;</div><div class="line">    //iter.flatMap(it=&gt;Some(it._2.sum + it._3.getOrElse(0)).map(x=&gt;(it._1,x)))</div><div class="line">    iter.flatMap &#123; case (x, y, z) =&gt; Some(y.sum + z.getOrElse(0)).map(i =&gt; (x, i)) &#125;</div><div class="line">  &#125;</div><div class="line"> </div><div class="line">  def main(args: Array[String]) &#123;</div><div class="line">    LoggerLevels.setStreamingLogLevels()</div><div class="line">    val Array(zkQuorum, group, topics, numThreads) = args</div><div class="line">    val sparkConf = new SparkConf().setAppName(&quot;KafkaWordCount&quot;).setMaster(&quot;local[2]&quot;)</div><div class="line">    val ssc = new StreamingContext(sparkConf, Seconds(5))</div><div class="line">    ssc.checkpoint(&quot;c://ck2&quot;)</div><div class="line">    //&quot;alog-2016-04-16,alog-2016-04-17,alog-2016-04-18&quot;</div><div class="line">    //&quot;Array((alog-2016-04-16, 2), (alog-2016-04-17, 2), (alog-2016-04-18, 2))&quot;</div><div class="line">    val topicMap = topics.split(&quot;,&quot;).map((_, numThreads.toInt)).toMap</div><div class="line">    val data = KafkaUtils.createStream(ssc, zkQuorum, group, topicMap, StorageLevel.MEMORY_AND_DISK_SER)</div><div class="line"></div><div class="line">    //kafka发送下来的是(key,value),我们只是需要的是value</div><div class="line">    val words = data.map(_._2).flatMap(_.split(&quot; &quot;))</div><div class="line">    val wordCounts = words.map((_, 1)).updateStateByKey(updateFunc, new HashPartitioner(ssc.sparkContext.defaultParallelism), true)</div><div class="line">    ssc.start()</div><div class="line">    ssc.awaitTermination()</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> 启动一个生产者发送消息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"> </div><div class="line">#启动一个生产者发送消息</div><div class="line">bin/kafka-console-producer.sh --broker-list 192.168.80.10:9092 --topic wordcount</div></pre></td></tr></table></figure></p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/spark/spark_streaming/4.jpg" alt=""></p>
<h1 id="方式二"><a href="#方式二" class="headerlink" title="方式二"></a>方式二</h1><p>直连方式,一个kafka的partition对应DStream里Rdd的一个分区,要自己来管理偏移量</p>
<p> 方式二的DirectKafkaWordCount </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line">package cn.itcast.spark.day5</div><div class="line"> </div><div class="line">import kafka.serializer.StringDecoder</div><div class="line">import org.apache.log4j.&#123;Level, Logger&#125;</div><div class="line">import org.apache.spark.SparkConf</div><div class="line">import org.apache.spark.rdd.RDD</div><div class="line">import org.apache.spark.streaming.kafka.&#123;KafkaManager, KafkaUtils&#125;</div><div class="line">import org.apache.spark.streaming.&#123;Seconds, StreamingContext&#125;</div><div class="line"> </div><div class="line"> </div><div class="line">object DirectKafkaWordCount &#123;</div><div class="line"> </div><div class="line">  /*  def dealLine(line: String): String = &#123;</div><div class="line">      val list = line.split(&apos;,&apos;).toList</div><div class="line">  //    val list = AnalysisUtil.dealString(line, &apos;,&apos;, &apos;&quot;&apos;)// 把dealString函数当做split即可</div><div class="line">      list.get(0).substring(0, 10) + &quot;-&quot; + list.get(26)</div><div class="line">    &#125;*/</div><div class="line"> </div><div class="line">  def processRdd(rdd: RDD[(String, String)]): Unit = &#123;</div><div class="line">    val lines = rdd.map(_._2)</div><div class="line">    val words = lines.map(_.split(&quot; &quot;))</div><div class="line">    val wordCounts = words.map(x =&gt; (x, 1L)).reduceByKey(_ + _)</div><div class="line">    wordCounts.foreach(println)</div><div class="line">  &#125;</div><div class="line"> </div><div class="line">  def main(args: Array[String]) &#123;</div><div class="line">    if (args.length &lt; 3) &#123;</div><div class="line">      System.err.println(</div><div class="line">        s&quot;&quot;&quot;</div><div class="line">           |Usage: DirectKafkaWordCount &lt;brokers&gt; &lt;topics&gt; &lt;groupid&gt;</div><div class="line">           |  &lt;brokers&gt; is a list of one or more Kafka brokers</div><div class="line">           |  &lt;topics&gt; is a list of one or more kafka topics to consume from</div><div class="line">           |  &lt;groupid&gt; is a consume group</div><div class="line">           |</div><div class="line">        &quot;&quot;&quot;.stripMargin)</div><div class="line">      System.exit(1)</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    Logger.getLogger(&quot;org&quot;).setLevel(Level.WARN)</div><div class="line"> </div><div class="line">    val Array(brokers, topics, groupId) = args</div><div class="line"> </div><div class="line">    // Create context with 2 second batch interval</div><div class="line">    val sparkConf = new SparkConf().setAppName(&quot;DirectKafkaWordCount&quot;)</div><div class="line">    sparkConf.setMaster(&quot;local[*]&quot;)</div><div class="line">    sparkConf.set(&quot;spark.streaming.kafka.maxRatePerPartition&quot;, &quot;5&quot;)</div><div class="line">    sparkConf.set(&quot;spark.serializer&quot;, &quot;org.apache.spark.serializer.KryoSerializer&quot;)</div><div class="line"> </div><div class="line">    val ssc = new StreamingContext(sparkConf, Seconds(2))</div><div class="line"> </div><div class="line">    // Create direct kafka stream with brokers and topics</div><div class="line">    val topicsSet = topics.split(&quot;,&quot;).toSet</div><div class="line">    val kafkaParams = Map[String, String](</div><div class="line">      &quot;metadata.broker.list&quot; -&gt; brokers,//直接连broker</div><div class="line">      &quot;group.id&quot; -&gt; groupId,</div><div class="line">      &quot;auto.offset.reset&quot; -&gt; &quot;smallest&quot;</div><div class="line">    )</div><div class="line"> </div><div class="line">    val km = new KafkaManager(kafkaParams)</div><div class="line"> </div><div class="line">    val messages = km.createDirectStream[String, String, StringDecoder, StringDecoder](</div><div class="line">      ssc, kafkaParams, topicsSet)</div><div class="line"> </div><div class="line">    messages.foreachRDD(rdd =&gt; &#123;</div><div class="line">      if (!rdd.isEmpty()) &#123;</div><div class="line">        // 先处理消息</div><div class="line">        processRdd(rdd)</div><div class="line">        // 再更新offsets</div><div class="line">        km.updateZKOffsets(rdd)</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line"> </div><div class="line">    ssc.start()</div><div class="line">    ssc.awaitTermination()</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> org.apache.spark.streaming.kafka.KafkaManager 类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div></pre></td><td class="code"><pre><div class="line">package org.apache.spark.streaming.kafka</div><div class="line"> </div><div class="line">import kafka.common.TopicAndPartition</div><div class="line">import kafka.message.MessageAndMetadata</div><div class="line">import kafka.serializer.Decoder</div><div class="line">import org.apache.spark.SparkException</div><div class="line">import org.apache.spark.rdd.RDD</div><div class="line">import org.apache.spark.streaming.StreamingContext</div><div class="line">import org.apache.spark.streaming.dstream.InputDStream</div><div class="line">import org.apache.spark.streaming.kafka.KafkaCluster.LeaderOffset</div><div class="line"> </div><div class="line">import scala.reflect.ClassTag</div><div class="line"> </div><div class="line">/**</div><div class="line">  * 自己管理offset</div><div class="line">  */</div><div class="line">class KafkaManager(val kafkaParams: Map[String, String]) extends Serializable &#123;</div><div class="line">  //因为new KafkaCluster 是 private[spark] 所以取包名为:org.apache.spark.streaming.kafka</div><div class="line">  private val kc = new KafkaCluster(kafkaParams)</div><div class="line"> </div><div class="line">  /**</div><div class="line">    * 创建数据流</div><div class="line">    */</div><div class="line">  def createDirectStream[K: ClassTag, V: ClassTag, KD &lt;: Decoder[K]: ClassTag, VD &lt;: Decoder[V]: ClassTag](</div><div class="line">                                                                                                            ssc: StreamingContext, kafkaParams: Map[String, String], topics: Set[String]): InputDStream[(K, V)] =  &#123;</div><div class="line">    val groupId = kafkaParams.get(&quot;group.id&quot;).get</div><div class="line">    // 在zookeeper上读取offsets前先根据实际情况更新offsets</div><div class="line">    setOrUpdateOffsets(topics, groupId)</div><div class="line"> </div><div class="line">    //从zookeeper上读取offset开始消费message</div><div class="line">    val messages = &#123;</div><div class="line">      val partitionsE = kc.getPartitions(topics)</div><div class="line">      if (partitionsE.isLeft)</div><div class="line">        throw new SparkException(s&quot;get kafka partition failed: $&#123;partitionsE.left.get&#125;&quot;)</div><div class="line">      val partitions = partitionsE.right.get</div><div class="line">      val consumerOffsetsE = kc.getConsumerOffsets(groupId, partitions)</div><div class="line">      if (consumerOffsetsE.isLeft)</div><div class="line">        throw new SparkException(s&quot;get kafka consumer offsets failed: $&#123;consumerOffsetsE.left.get&#125;&quot;)</div><div class="line">      val consumerOffsets = consumerOffsetsE.right.get</div><div class="line">      KafkaUtils.createDirectStream[K, V, KD, VD, (K, V)](</div><div class="line">        ssc, kafkaParams, consumerOffsets, (mmd: MessageAndMetadata[K, V]) =&gt; (mmd.key, mmd.message))</div><div class="line">    &#125;</div><div class="line">    messages</div><div class="line">  &#125;</div><div class="line"> </div><div class="line">  /**</div><div class="line">    * 创建数据流前，根据实际消费情况更新消费offsets</div><div class="line">    * @param topics</div><div class="line">    * @param groupId</div><div class="line">    */</div><div class="line">  private def setOrUpdateOffsets(topics: Set[String], groupId: String): Unit = &#123;</div><div class="line">    topics.foreach(topic =&gt; &#123;</div><div class="line">      var hasConsumed = true</div><div class="line">      val partitionsE = kc.getPartitions(Set(topic))</div><div class="line">      if (partitionsE.isLeft)</div><div class="line">        throw new SparkException(s&quot;get kafka partition failed: $&#123;partitionsE.left.get&#125;&quot;)</div><div class="line">      val partitions = partitionsE.right.get</div><div class="line">      val consumerOffsetsE = kc.getConsumerOffsets(groupId, partitions)</div><div class="line">      if (consumerOffsetsE.isLeft) hasConsumed = false</div><div class="line">      if (hasConsumed) &#123;// 消费过</div><div class="line">        /**</div><div class="line">          * 如果streaming程序执行的时候出现kafka.common.OffsetOutOfRangeException，</div><div class="line">          * 说明zk上保存的offsets已经过时了，即kafka的定时清理策略已经将包含该offsets的文件删除。</div><div class="line">          * 针对这种情况，只要判断一下zk上的consumerOffsets和earliestLeaderOffsets的大小，</div><div class="line">          * 如果consumerOffsets比earliestLeaderOffsets还小的话，说明consumerOffsets已过时,</div><div class="line">          * 这时把consumerOffsets更新为earliestLeaderOffsets</div><div class="line">          */</div><div class="line">        val earliestLeaderOffsetsE = kc.getEarliestLeaderOffsets(partitions)</div><div class="line">        if (earliestLeaderOffsetsE.isLeft)</div><div class="line">          throw new SparkException(s&quot;get earliest leader offsets failed: $&#123;earliestLeaderOffsetsE.left.get&#125;&quot;)</div><div class="line">        val earliestLeaderOffsets = earliestLeaderOffsetsE.right.get</div><div class="line">        val consumerOffsets = consumerOffsetsE.right.get</div><div class="line"> </div><div class="line">        // 可能只是存在部分分区consumerOffsets过时，所以只更新过时分区的consumerOffsets为earliestLeaderOffsets</div><div class="line">        var offsets: Map[TopicAndPartition, Long] = Map()</div><div class="line">        consumerOffsets.foreach(&#123; case(tp, n) =&gt;</div><div class="line">          val earliestLeaderOffset = earliestLeaderOffsets(tp).offset</div><div class="line">          if (n &lt; earliestLeaderOffset) &#123;</div><div class="line">            println(&quot;consumer group:&quot; + groupId + &quot;,topic:&quot; + tp.topic + &quot;,partition:&quot; + tp.partition +</div><div class="line">              &quot; offsets已经过时，更新为&quot; + earliestLeaderOffset)</div><div class="line">            offsets += (tp -&gt; earliestLeaderOffset)</div><div class="line">          &#125;</div><div class="line">        &#125;)</div><div class="line">        if (!offsets.isEmpty) &#123;</div><div class="line">          kc.setConsumerOffsets(groupId, offsets)//针对某一个topic的组来设置offset</div><div class="line">        &#125;</div><div class="line">      &#125; else &#123;// 没有消费过</div><div class="line">      val reset = kafkaParams.get(&quot;auto.offset.reset&quot;).map(_.toLowerCase)</div><div class="line">        var leaderOffsets: Map[TopicAndPartition, LeaderOffset] = null</div><div class="line">        if (reset == Some(&quot;smallest&quot;)) &#123;</div><div class="line">          val leaderOffsetsE = kc.getEarliestLeaderOffsets(partitions)</div><div class="line">          if (leaderOffsetsE.isLeft)</div><div class="line">            throw new SparkException(s&quot;get earliest leader offsets failed: $&#123;leaderOffsetsE.left.get&#125;&quot;)</div><div class="line">          leaderOffsets = leaderOffsetsE.right.get</div><div class="line">        &#125; else &#123;</div><div class="line">          val leaderOffsetsE = kc.getLatestLeaderOffsets(partitions)</div><div class="line">          if (leaderOffsetsE.isLeft)</div><div class="line">            throw new SparkException(s&quot;get latest leader offsets failed: $&#123;leaderOffsetsE.left.get&#125;&quot;)</div><div class="line">          leaderOffsets = leaderOffsetsE.right.get</div><div class="line">        &#125;</div><div class="line">        val offsets = leaderOffsets.map &#123;</div><div class="line">          case (tp, offset) =&gt; (tp, offset.offset)</div><div class="line">        &#125;</div><div class="line">        kc.setConsumerOffsets(groupId, offsets)</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line"> </div><div class="line">  /**</div><div class="line">    * 更新zookeeper上的消费offsets</div><div class="line">    * @param rdd</div><div class="line">    */</div><div class="line">  def updateZKOffsets(rdd: RDD[(String, String)]) : Unit = &#123;</div><div class="line">    val groupId = kafkaParams.get(&quot;group.id&quot;).get</div><div class="line">    val offsetsList = rdd.asInstanceOf[HasOffsetRanges].offsetRanges</div><div class="line"> </div><div class="line">    for (offsets &lt;- offsetsList) &#123;</div><div class="line">      val topicAndPartition = TopicAndPartition(offsets.topic, offsets.partition)</div><div class="line">      val o = kc.setConsumerOffsets(groupId, Map((topicAndPartition, offsets.untilOffset)))</div><div class="line">      if (o.isLeft) &#123;</div><div class="line">        println(s&quot;Error updating the offset to Kafka cluster: $&#123;o.left.get&#125;&quot;)</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>参考: <a href="http://blog.csdn.net/ligt0610/article/details/47311771" target="_blank" rel="external">http://blog.csdn.net/ligt0610/article/details/47311771</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/46/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/46/">46</a><span class="page-number current">47</span><a class="page-number" href="/page/48/">48</a><span class="space">&hellip;</span><a class="page-number" href="/page/56/">56</a><a class="extend next" rel="next" href="/page/48/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/header.jpg"
               alt="Mr. Chen" />
          <p class="site-author-name" itemprop="name">Mr. Chen</p>
           
              <p class="site-description motion-element" itemprop="description">一个技术渣的自说自话</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">555</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">36</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mr. Chen</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  

  

  

  

</body>
</html>
