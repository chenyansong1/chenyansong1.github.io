<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Chen&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="一个技术渣的自说自话">
<meta property="og:type" content="website">
<meta property="og:title" content="Chen's Blog">
<meta property="og:url" content="http://yoursite.com/page/12/index.html">
<meta property="og:site_name" content="Chen's Blog">
<meta property="og:description" content="一个技术渣的自说自话">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chen's Blog">
<meta name="twitter:description" content="一个技术渣的自说自话">
  
    <link rel="alternate" href="/atom.xml" title="Chen&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Chen&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">一个技术渣的自说自话</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-python/python网络编程之多路复用服务器模型" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/python/python网络编程之多路复用服务器模型/" class="article-date">
  <time datetime="2017-04-16T04:47:25.858Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/python/python网络编程之多路复用服务器模型/">python网络编程之多路复用服务器模型</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-select-模块的作用"><a href="#1-select-模块的作用" class="headerlink" title="1.select 模块的作用"></a>1.select 模块的作用</h1><p>&emsp;select系统调用用来检测多个文件描述符状态变化，程序会一直在select中等待直到超时或者被监视文件描述符中的一个或者多个状态发生变化</p>
<h1 id="2-select函数"><a href="#2-select函数" class="headerlink" title="2.select函数"></a>2.select函数</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">select(rlist, wlist, xlist[,timeout])                      #返回值：（rlist, wlist, xlist）</div><div class="line">#rlist：读取socket列表，判断是否有可以读的socket</div><div class="line">#wlist：写入socket列表，判断是否有可以写的socket</div><div class="line">#xlist：异常socket列表，判断是否有异常的socket</div><div class="line">#如果socket可以读，可以写，或者异常，select返回相应的socket列表</div></pre></td></tr></table></figure>
<h1 id="3-select工作模型"><a href="#3-select工作模型" class="headerlink" title="3.select工作模型"></a>3.select工作模型</h1><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/python/select/1.png" alt=""></p>
<h1 id="4-select如何判断可读、可写、异常"><a href="#4-select如何判断可读、可写、异常" class="headerlink" title="4.select如何判断可读、可写、异常"></a>4.select如何判断可读、可写、异常</h1><ul>
<li>select如何判断可读<ol>
<li>将监测的socket加入到rlist中，然后调用select等待数据</li>
<li>如果有客户端连接或者对方数据，那么select就会立刻返回</li>
<li>如果是新的连接调用accept接受新的socket，并将该socket计入到rlist或者wlist中</li>
<li>如果有数据，那么就接受数据</li>
</ol>
</li>
<li><p>select如何判断可以写</p>
<ol>
<li>将检测到的socket加入到wlist，调用select等待</li>
<li>如果socket可以写，返回可以写的socket列表</li>
<li>调用send方法，发送数据</li>
</ol>
</li>
<li><p>select如何判断异常</p>
<ol>
<li>将监测到的socket加入到xlist，调用select等待</li>
<li>如果socket有异常，返回异常的xlist列表</li>
<li>处理异常的socket</li>
</ol>
</li>
</ul>
<h1 id="5-select编程模型"><a href="#5-select编程模型" class="headerlink" title="5.select编程模型"></a>5.select编程模型</h1><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/python/select/2.png" alt=""></p>
<ul>
<li>read操作：需要将可读的socket全部读出</li>
<li>write操作：将可以写的socket根据自己需要发送相关消息和数据<ol>
<li>socket一般都是可写的，所以要根据自己需求决定是否每次写完之后是否将wlist中的socket移除</li>
<li>因为网络问题，socket并不是一致处于可写状态，如果使用UDP，不去判断socket是否可写，可能会写失败</li>
</ol>
</li>
</ul>
<h1 id="6-程序实现"><a href="#6-程序实现" class="headerlink" title="6.程序实现"></a>6.程序实现</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">#服务端</div><div class="line">[root@backup python]# cat select.py</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line">import os</div><div class="line">import sys</div><div class="line">import threading</div><div class="line">import select</div><div class="line">import Queue</div><div class="line"> </div><div class="line"> </div><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">        tcp_server = socket(AF_INET, SOCK_STREAM)</div><div class="line">        tcp_server.bind((&apos;localhost&apos;,5002))</div><div class="line">        tcp_server.listen(5)</div><div class="line"> </div><div class="line">        msg_list = &#123;&#125; #client queue</div><div class="line">        in_list = [] #socket readline</div><div class="line">        out_list = [] #socket writelist</div><div class="line">        in_list.append(tcp_server)</div><div class="line"> </div><div class="line">        while True:</div><div class="line">                ilist,olist,elist = select.select(in_list,out_list,in_list,1)</div><div class="line"> </div><div class="line">                if not (ilist or olist or elist):</div><div class="line">                        print(&quot;Wait Timeout : in_list = &quot;+len(in_list))</div><div class="line">                        continue</div><div class="line"> </div><div class="line">                for c in ilist:                            #读处理</div><div class="line">                        if c == tcp_server:</div><div class="line">                                client,client_info = c.accept()</div><div class="line">                                in_list.append(client)</div><div class="line">                                msg_list[client]=Queue.Queue()</div><div class="line">                        else:</div><div class="line">                                recv_data = c.recv(1024)</div><div class="line">                                if recv_data:</div><div class="line">                                        print(&quot;recv= &quot;+recv_data)</div><div class="line">                                        msg_list[c].put(recv_data)                #将数据放入消息队列中</div><div class="line">                                        if c not in out_list:</div><div class="line">                                                out_list.append(c)</div><div class="line">                                else:                                        #如果接受的数据为空的话（可能client异常了），那么从ilist、outlist中删除</div><div class="line">                                        if c in out_list:</div><div class="line">                                                out_list.remove(c)</div><div class="line">                                        in_list.remove(c)</div><div class="line">                                        c.close()</div><div class="line">                                        del msg_list[c]</div><div class="line">                                        print(&quot;a client exit&quot;)</div><div class="line"> </div><div class="line">                for c in elist:                        #异常处理</div><div class="line">                        if c in in_list:</div><div class="line">                                in_list.remove(c)</div><div class="line">                        if c in out_list:</div><div class="line">                                out_list.remove(c)</div><div class="line">                        c.close()</div><div class="line">                        del msg_list[c]</div><div class="line"> </div><div class="line">                for c in olist:                        #写处理</div><div class="line">                        if c in msg_list:</div><div class="line">                                try:</div><div class="line">                                        msg = msg_list.get_nowait()        #从队列中取出数据</div><div class="line">                                except Queue.Empty:</div><div class="line">                                        out_list.remove(c)</div><div class="line">                                else:</div><div class="line">                                        print(&quot;send msg= &quot;+msg)</div><div class="line">                                        c.send(msg)                #发送数据</div><div class="line"> </div><div class="line">        tcp_server.close()</div></pre></td></tr></table></figure>
<h1 id="7-select多路服务器优点和缺点"><a href="#7-select多路服务器优点和缺点" class="headerlink" title="7.select多路服务器优点和缺点"></a>7.select多路服务器优点和缺点</h1><ul>
<li>优点<ol>
<li>不需要频繁的创建和销毁线程和进程，节省了系统的开销和负担</li>
<li>select采用轮询方式处理收发数据，处理效率高于多进程和多线程模型</li>
</ol>
</li>
<li>缺点<ol>
<li>单个进程监控的最多文件描述符是有限的（系统默认1024个）</li>
<li>需要维护一个文件描述符列表</li>
<li>对于文件描述符扫描是线性的，当每次对这个结构进行扫描时时间会增加</li>
<li>内核把文件描述符消息通知给用户空间，空间需要拷贝</li>
</ol>
</li>
</ul>
<h1 id="8-select和多线程模型"><a href="#8-select和多线程模型" class="headerlink" title="8.select和多线程模型"></a>8.select和多线程模型</h1><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/python/select/3.png" alt=""></p>
<h1 id="9-epoll模型"><a href="#9-epoll模型" class="headerlink" title="9.epoll模型"></a>9.epoll模型</h1><ol>
<li>是Linux下多路复用IO接口select、poll的增强版本</li>
<li>它所支持的文件描述符的上限是最大可以打开文件的数目</li>
<li>epoll只会对“活跃”的socket进行操作，不会因为文件描述符的增加导致效率线性的下降</li>
<li>epoll是通过内核于用户空间mmap同一块内存实现，使用mmap加速内核于用户空间的消息传递</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/python/python网络编程之多路复用服务器模型/" data-id="cj290sb7q0052ssqqncv3z7sl" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-python/python网络编程之多线程多进程服务端模型" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/python/python网络编程之多线程多进程服务端模型/" class="article-date">
  <time datetime="2017-04-16T04:47:25.856Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/python/python网络编程之多线程多进程服务端模型/">python网络编程之多线程多进程服务端模型</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-基本服务器模型"><a href="#1-基本服务器模型" class="headerlink" title="1.基本服务器模型"></a>1.基本服务器模型</h1><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/python/process_thread/1.png" alt=""></p>
<ol>
<li>只能同时支持一路</li>
<li>因为创建的socket文件描述符是阻塞的，所以如果该socket一直没有消息，那么我们程序一直处于等待中</li>
</ol>
<h1 id="2-多进程服务器模型"><a href="#2-多进程服务器模型" class="headerlink" title="2.多进程服务器模型"></a>2.多进程服务器模型</h1><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/python/process_thread/2.png" alt=""></p>
<ul>
<li>多进程模型对系统的开销比较大</li>
<li>该模型需要注意：<ol>
<li>子进程的回收</li>
<li>子进程的创建数量</li>
</ol>
</li>
</ul>
<h1 id="3-多进程服务器模型程序实现"><a href="#3-多进程服务器模型程序实现" class="headerlink" title="3.多进程服务器模型程序实现"></a>3.多进程服务器模型程序实现</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">import time</div><div class="line">import os</div><div class="line">import sys</div><div class="line">from socket import *</div><div class="line"> </div><div class="line">def client_deal(client,client_info):                                #</div><div class="line">        while True:</div><div class="line">                msg = client.recv(1024)</div><div class="line">                if msg == &apos;&apos;:</div><div class="line">                        client.close()</div><div class="line">                        break</div><div class="line">                print(&quot;recv=&quot;+msg+&quot; from :&quot;,client_info)</div><div class="line">                if msg == &apos;q&apos; or msg == &apos;Q&apos;:</div><div class="line">                        client.close()</div><div class="line">                        break</div><div class="line"> </div><div class="line"> </div><div class="line">def client_process(client,client_info):</div><div class="line">        pid = os.fork()</div><div class="line">        if pid == 0:                                    #子进程</div><div class="line">                ppid = os.fork()                    #子进程中又开启了一个子进程</div><div class="line">                if ppid == 0:</div><div class="line">                        client_deal(client,client_info)    #用该进程去处理对应的客户端请求</div><div class="line">                else:</div><div class="line">                        print(&quot;child exit&quot;)</div><div class="line">                        sys.exit()</div><div class="line">        else:</div><div class="line">                client.close()</div><div class="line">                os.wait()</div><div class="line">                print(&quot;wait child exit&quot;)</div><div class="line"> </div><div class="line"> </div><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">        tcp_server = socket(AF_INET, SOCK_STREAM)</div><div class="line">        tcp_server.bind((&apos;localhost&apos;,5001))</div><div class="line">        tcp_server.listen(5)</div><div class="line"> </div><div class="line">        while True:</div><div class="line">                print(&quot;wait client......&quot;)</div><div class="line">                client,client_info = tcp_server.accept()</div><div class="line">                print(client_info)</div><div class="line">                client_process(client,client_info)</div><div class="line">        tcp_server.close()</div></pre></td></tr></table></figure>
<hr>
<h1 id="4-多线程服务器模型"><a href="#4-多线程服务器模型" class="headerlink" title="4.多线程服务器模型"></a>4.多线程服务器模型</h1><ol>
<li>接收到一个请求，创建一个相应的线程</li>
<li>如果该请求结束，关闭该请求，退出执行线程</li>
</ol>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/python/process_thread/3.png" alt=""></p>
<h1 id="5-多线程服务器模型程序实现"><a href="#5-多线程服务器模型程序实现" class="headerlink" title="5.多线程服务器模型程序实现"></a>5.多线程服务器模型程序实现</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line">import os</div><div class="line">import sys</div><div class="line">import threading</div><div class="line"> </div><div class="line"> </div><div class="line"> </div><div class="line"> </div><div class="line">def client_deal(client,client_info):</div><div class="line">        while True:</div><div class="line">                msg = client.recv(1024)</div><div class="line">                if msg == &apos;&apos;:</div><div class="line">                        client.close()</div><div class="line">                        break</div><div class="line">                print(&quot;recv=&quot;+msg+&quot; from :&quot;,client_info)</div><div class="line">                if msg == &apos;q&apos; or msg == &apos;Q&apos;:</div><div class="line">                        client.close()</div><div class="line">                        break</div><div class="line"> </div><div class="line"> </div><div class="line"> </div><div class="line">def thread_process(client,client_info):</div><div class="line">        p_thread = threading.Thread(target=client_deal,args=(client,client_info))</div><div class="line">        p_thread.setDaemon(True)</div><div class="line">        p_thread.start()</div><div class="line">        print(&quot;start on thread&quot;)</div><div class="line"> </div><div class="line"> </div><div class="line"> </div><div class="line">if __name__ == &quot;__main__&quot;:</div><div class="line">        tcp_server = socket(AF_INET,SOCK_STREAM)</div><div class="line">        tcp_server.bind((&quot;localhost&quot;,5001))</div><div class="line">        tcp_server.listen(5)</div><div class="line">        while True:</div><div class="line">                print(&quot;pid=&quot;+str(os.getpid())+&quot; wait client&quot;)</div><div class="line">                client,client_info = tcp_server.accept()                    #每接受到一个客户端的时候，就去开启一个线程</div><div class="line">                print(client_info)</div><div class="line">                thread_process(client,client_info)                #开启一个线程</div><div class="line"> </div><div class="line">        tcp_server.close()</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/python/python网络编程之多线程多进程服务端模型/" data-id="cj290sb7o004zssqqckru8hwf" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-python/python网络编程之UDP客户端和服务端实现" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/python/python网络编程之UDP客户端和服务端实现/" class="article-date">
  <time datetime="2017-04-16T04:47:25.855Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/python/python网络编程之UDP客户端和服务端实现/">python网络编程之UDP客户端和服务端实现</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-UDP服务端和客户端模型："><a href="#1-UDP服务端和客户端模型：" class="headerlink" title="1.UDP服务端和客户端模型："></a>1.UDP服务端和客户端模型：</h1><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/python/net_udp/1.png" alt=""></p>
<h1 id="2-UDP服务器"><a href="#2-UDP服务器" class="headerlink" title="2.UDP服务器"></a>2.UDP服务器</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">from socket import *</div><div class="line">udp_server = socket(AF_INET, SOCK_DGRAW) #创建udp socket</div><div class="line"> </div><div class="line">udp_server.bind((&apos;localhost&apos;, 5002)) #绑定本地IP与端口</div><div class="line"> </div><div class="line">recv_data, addr = udp_server.recvfrom(1024) #接收数据和client地址信息</div><div class="line">udp_server.close()</div></pre></td></tr></table></figure>
<h1 id="3-UDP客户端"><a href="#3-UDP客户端" class="headerlink" title="3.UDP客户端"></a>3.UDP客户端</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">from socket import *</div><div class="line">udp_client = socket(AF_INET, SOCK_DGRAW) #创建udp socket</div><div class="line"> </div><div class="line">udp_client.sendto(&quot;hello python&quot;, (&apos;localhost&apos;, 5002)) #向指定的地址发送数据</div><div class="line"> </div><div class="line">udp_client.close() #关闭连接</div></pre></td></tr></table></figure>
<h1 id="4-实例"><a href="#4-实例" class="headerlink" title="4.实例"></a>4.实例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">#服务端</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">udp_server = socket(AF_INET, SOCK_DGRAM)</div><div class="line">udp_server.bind((&quot;localhost&quot;,5002))</div><div class="line"> </div><div class="line">while True:</div><div class="line">        recv_data,addr = udp_server.recvfrom(1024)</div><div class="line">        print(recv_data,addr)</div><div class="line"> </div><div class="line">        if recv_data == &apos;q&apos;:</div><div class="line">                break</div><div class="line">        udp_server.sendto(&quot;server send data:&quot;+recv_data, addr)</div><div class="line"> </div><div class="line">udp_server.close()</div><div class="line"></div><div class="line"></div><div class="line">-----------------------------------------------------------------</div><div class="line"></div><div class="line">#客户端</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">udp_client = socket(AF_INET, SOCK_DGRAM)</div><div class="line"> </div><div class="line">while True:</div><div class="line">        msg = raw_input(&quot;&gt;&quot;)</div><div class="line">        udp_client.sendto(msg, (&apos;localhost&apos;,5002))</div><div class="line">        if msg == &apos;q&apos;:</div><div class="line">                break</div><div class="line">        server_data,addr = udp_client.recvfrom(1024)</div><div class="line">        print(server_data,addr)</div><div class="line"> </div><div class="line">udp_client.close()</div></pre></td></tr></table></figure>
<h1 id="5-UDP传输的问题"><a href="#5-UDP传输的问题" class="headerlink" title="5.UDP传输的问题"></a>5.UDP传输的问题</h1><ol>
<li>丢包问题</li>
<li>包到达顺序的问题</li>
<li>不能知道对方是否关闭的问题</li>
</ol>
<h1 id="6-udp客户端中的connect"><a href="#6-udp客户端中的connect" class="headerlink" title="6.udp客户端中的connect()"></a>6.udp客户端中的connect()</h1><p>如果在执行的过程中服务端关闭，然后客户端还在发送数据，但是客户端并不知道服务端关闭了，他还是会不停的发送数据，只不过此时的发送的数据将全部丢包而已。通过connect知道数据是否发送成功<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">udp_client = socket(AF_INET, SOCK_DGRAM)</div><div class="line">udp_client.connect((&apos;localhost&apos;,5002))                                    #在客户端中使用connect</div><div class="line"> </div><div class="line">while True:</div><div class="line">        msg = raw_input(&quot;&gt;&quot;)</div><div class="line">        udp_client.sendto(msg, (&apos;localhost&apos;,5002))</div><div class="line">        if msg == &apos;q&apos;:</div><div class="line">                break</div><div class="line">        server_data,addr = udp_client.recvfrom(1024)</div><div class="line">        print(server_data,addr)</div><div class="line"> </div><div class="line"> </div><div class="line">udp_client.close()</div><div class="line"></div><div class="line"></div><div class="line">#如果服务端关闭，客户端会抛出异常</div><div class="line">Traceback (most recent call last):</div><div class="line">  File &quot;udp_client.py&quot;, line 14, in &lt;module&gt;</div><div class="line">    server_data,addr = udp_client.recvfrom(1024)</div><div class="line">socket.error: [Errno 111] Connection refused</div></pre></td></tr></table></figure></p>
<h1 id="7-通过tcpdump查看发送记录"><a href="#7-通过tcpdump查看发送记录" class="headerlink" title="7.通过tcpdump查看发送记录"></a>7.通过tcpdump查看发送记录</h1><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/python/net_udp/2.png" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/python/python网络编程之UDP客户端和服务端实现/" data-id="cj290sb7m004wssqq65frsx06" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-python/python网络编程之TCP客户端和服务端实现" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/python/python网络编程之TCP客户端和服务端实现/" class="article-date">
  <time datetime="2017-04-16T04:47:25.854Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/python/python网络编程之TCP客户端和服务端实现/">python网络编程之TCP客户端和服务端实现</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-socket模块"><a href="#1-socket模块" class="headerlink" title="1.socket模块"></a>1.socket模块</h1><ul>
<li>创建socket： int socket(int domain, int type int protocol)</li>
<li>domain：协议域，决定了socket的地址类型，在通信中必须采用对应的地址<br>AF_INET:ipv4协议，ipv4地址与端口号组合(AF:address family)<br>AF_LOCAL：使用一个绝对路径名作为地址（进程间通信）<br>AF_PACKET：来处理以太网包，他能修改以太网包头</li>
<li>type：socket类型：<br>SOCK_STREAM：TCP套接字<br>SOCK_DGRAM：UDP套接字<br>SOCK_RAW：原始套接字</li>
<li>protocol：指定协议，常用协议有IPPROTO_TCP/IPPROTO_UDP、分别对应tcp传输协议、udp传输协议</li>
<li>type和protocol不能随意组合，第三个参数不设置的时候，默认为何第二个参数对应的协议一致</li>
</ul>
<h1 id="2-socket中常用方法"><a href="#2-socket中常用方法" class="headerlink" title="2.socket中常用方法"></a>2.socket中常用方法</h1><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>ss = socket(family,type[,proto])</td>
<td>创建一个套接字，返回一个socket对象</td>
</tr>
<tr>
<td>ss.binds((ip, port))</td>
<td>绑定ip地址和端口</td>
</tr>
<tr>
<td>ss.listen(n)</td>
<td>最大接受连接数</td>
</tr>
<tr>
<td>ss.accept()</td>
<td>接受TCP客户端连接，返回一个连接和客户单信息的元组</td>
</tr>
<tr>
<td>ss.connect((ip,port))</td>
<td>主动初始化TCP连接服务器</td>
</tr>
<tr>
<td>ss.recv(buffers[,flags])</td>
<td>返回接受数据（tcp）</td>
</tr>
<tr>
<td>ss.send(data[,flags])</td>
<td>发送数据（tcp）</td>
</tr>
<tr>
<td>recvfrom(buffersize[,flags])</td>
<td>返回接受数据和发送端的地址信息（udp)</td>
</tr>
<tr>
<td>sendto(data[,flags],address)</td>
<td>向指定的ip和端口发送数据（udp）</td>
</tr>
<tr>
<td>ss.close()</td>
<td>关闭套接字</td>
</tr>
</tbody>
</table>
<h1 id="3-Tcp客户端和服务器端模型"><a href="#3-Tcp客户端和服务器端模型" class="headerlink" title="3.Tcp客户端和服务器端模型"></a>3.Tcp客户端和服务器端模型</h1><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/python/net_tcp/1.png" alt=""></p>
<h1 id="4-TCP客户端和服务端实现"><a href="#4-TCP客户端和服务端实现" class="headerlink" title="4.TCP客户端和服务端实现"></a>4.TCP客户端和服务端实现</h1><ul>
<li>tcp服务端编写：监听一个端口，建立请求后接受数据并回复bye,然后关闭连接，继续等待其他客户端的连接</li>
<li>最简单的服务端程序：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">from socket import *</div><div class="line"> </div><div class="line">tcp_server = socket(AF_INET, SOCK_STREAM) #创建socket</div><div class="line">tcp_server.bind((&quot;&quot;, 5001)) #绑定本地IP与端口</div><div class="line">tcp_server.listen(5) #设置监听的最大连接数</div><div class="line"></div><div class="line">client, client_info = tcp_server.accept() #等待连接</div><div class="line">recv_data = client.recv(1024) #接收数据</div><div class="line"></div><div class="line">client.close()</div><div class="line">tcp_server.close() #关闭连接</div></pre></td></tr></table></figure>
<ul>
<li>最简单的客户端程序：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">from socket import *</div><div class="line">tcp_client = socket(AF_INET, SOCK_STREAM) #创建socket</div><div class="line"> </div><div class="line">tcp_client.connect((&apos;localhost&apos;,5001)) #连接服务器</div><div class="line">tcp_client.send(&quot;hello python&quot;)  #发送数据</div><div class="line">tcp_client.close()  #关闭连接</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="4-1-最简单的实现"><a href="#4-1-最简单的实现" class="headerlink" title="4.1.最简单的实现"></a>4.1.最简单的实现</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">#客户端代码</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">tcp_server = socket(AF_INET, SOCK_STREAM)                    #建立一个tcp连接</div><div class="line">tcp_server.bind((&quot;localhost&quot;,5001))                                #绑定一个端口，注意是元组</div><div class="line">tcp_server.listen(3)</div><div class="line"> </div><div class="line">print(&quot;wait client connect.........&quot;)</div><div class="line">client,client_info = tcp_server.accept()                            #服务端等待接受（阻塞再次）</div><div class="line">recv_data = client.recv(1024)            </div><div class="line"> </div><div class="line">print(recv_data)</div><div class="line"> </div><div class="line">client.close()</div><div class="line">tcp_server.close()</div><div class="line"></div><div class="line">-----------------------------------------------------------</div><div class="line"></div><div class="line">#服务端代码</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">tcp_client = socket(AF_INET, SOCK_STREAM)</div><div class="line">tcp_client.connect((&quot;localhost&quot;,5001))                    #指定连接的地址和端口</div><div class="line"> </div><div class="line">tcp_client.send(&quot;hello chenyansong&quot;)                     #发送数据</div><div class="line"> </div><div class="line">tcp_client.close()</div></pre></td></tr></table></figure>
<h2 id="4-2-客户端输入、服务端连续读取"><a href="#4-2-客户端输入、服务端连续读取" class="headerlink" title="4.2.客户端输入、服务端连续读取"></a>4.2.客户端输入、服务端连续读取</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">#服务端</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">tcp_server = socket(AF_INET, SOCK_STREAM)</div><div class="line">tcp_server.bind((&quot;localhost&quot;,5001))</div><div class="line">tcp_server.listen(1)</div><div class="line"> </div><div class="line">while True:</div><div class="line">        print(&quot;wait client connect.........&quot;)</div><div class="line"> </div><div class="line">        client,client_info = tcp_server.accept()                    #读取客户端的一个连接</div><div class="line">        print(client_info)                                    #打印客户端连接信息的元组：(&apos;127.0.0.1&apos;, 35890)</div><div class="line"> </div><div class="line">        while True:</div><div class="line">                recv_data = client.recv(1024)                        #获取一个连接数据</div><div class="line">                print(&quot;recv=&quot; + recv_data)</div><div class="line">                if recv_data == &apos;q&apos;:</div><div class="line">                        client.close()                            #关闭一个连接</div><div class="line">                        break</div><div class="line"> </div><div class="line">tcp_server.close()</div><div class="line"></div><div class="line"></div><div class="line">---------------------------------------------------------</div><div class="line"></div><div class="line">#客户端</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">tcp_client = socket(AF_INET, SOCK_STREAM)</div><div class="line">tcp_client.connect((&quot;localhost&quot;,5001))</div><div class="line"> </div><div class="line">while True:</div><div class="line">        msg = raw_input(&quot;&gt;&quot;)                        #输入内容</div><div class="line">        tcp_client.send(msg)</div><div class="line">        if msg == &apos;q&apos;:                                 #退出</div><div class="line">                break</div><div class="line"> </div><div class="line">tcp_client.close()</div></pre></td></tr></table></figure>
<h2 id="4-3-客户端抛出异常，服务端的处理方式"><a href="#4-3-客户端抛出异常，服务端的处理方式" class="headerlink" title="4.3.客户端抛出异常，服务端的处理方式"></a>4.3.客户端抛出异常，服务端的处理方式</h2><p>如果客户端程序异常终止，然后就会想服务器端发送“”（空），所以在服务器端要进行判断<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">#服务端</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">tcp_server = socket(AF_INET, SOCK_STREAM)</div><div class="line">tcp_server.bind((&quot;localhost&quot;,5001))</div><div class="line">tcp_server.listen(3)</div><div class="line"> </div><div class="line">while True:</div><div class="line">        print(&quot;wait client connect.........&quot;)</div><div class="line"> </div><div class="line">        client,client_info = tcp_server.accept()</div><div class="line">        print(client_info)</div><div class="line"> </div><div class="line">        while True:</div><div class="line">                recv_data = client.recv(1024)</div><div class="line">                if recv_data == &apos;&apos;:                                #添加判断，服务端接受的数据，是否是空，如果是，则关闭连接的客户端</div><div class="line">                        client.close()</div><div class="line">                        break</div><div class="line"> </div><div class="line">                print(&quot;recv=&quot; + recv_data)</div><div class="line">                if recv_data == &apos;q&apos;:</div><div class="line">                        client.close()</div><div class="line">                        break</div><div class="line"> </div><div class="line">tcp_server.close()</div><div class="line"></div><div class="line"></div><div class="line">----------------------------------------------------------------</div><div class="line"> </div><div class="line">#客户端，同上</div></pre></td></tr></table></figure></p>
<h2 id="4-4-客户端会发送空数据"><a href="#4-4-客户端会发送空数据" class="headerlink" title="4.4.客户端会发送空数据"></a>4.4.客户端会发送空数据</h2><p>如果发送的数据是空，那么客户端将不会将数据发送，因为在客户端抛出异常的时候，会请求断开链接，那么此时客户端会发送空数据（此时会发送），所以为了防止误判，客户端正常的发送空数据，将不会发送的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">#客户端</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">tcp_client = socket(AF_INET, SOCK_STREAM)</div><div class="line">tcp_client.connect((&quot;localhost&quot;,5001))</div><div class="line"> </div><div class="line">while True:</div><div class="line">        msg = raw_input(&quot;&gt;&quot;)</div><div class="line">        if msg == &apos;o&apos;:</div><div class="line">                tcp_client.send(&apos;&apos;)                            #将不会发送</div><div class="line">        else:</div><div class="line">                tcp_client.send(msg)</div><div class="line"> </div><div class="line">        if msg == &apos;q&apos;:</div><div class="line">                break</div><div class="line"> </div><div class="line">tcp_client.close()</div></pre></td></tr></table></figure></p>
<h2 id="4-5-服务端发送数据到客户端"><a href="#4-5-服务端发送数据到客户端" class="headerlink" title="4.5.服务端发送数据到客户端"></a>4.5.服务端发送数据到客户端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">#服务端</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">tcp_server = socket(AF_INET, SOCK_STREAM)</div><div class="line">tcp_server.bind((&quot;localhost&quot;,5001))</div><div class="line">tcp_server.listen(3)</div><div class="line"> </div><div class="line">while True:</div><div class="line">        print(&quot;wait client connect.........&quot;)</div><div class="line"> </div><div class="line">        client,client_info = tcp_server.accept()</div><div class="line">        print(client_info)</div><div class="line"> </div><div class="line">        while True:</div><div class="line">                recv_data = client.recv(1024)</div><div class="line">                if recv_data == &apos;&apos;:</div><div class="line">                        client.close()</div><div class="line">                        break</div><div class="line"> </div><div class="line">                print(&quot;recv=&quot; + recv_data)</div><div class="line"> </div><div class="line">                client.send(&quot;server send :&quot;+recv_data)                    #向客户端发送数据</div><div class="line"> </div><div class="line">                if recv_data == &apos;q&apos;:</div><div class="line">                        client.close()</div><div class="line">                        break</div><div class="line"> </div><div class="line">tcp_server.close()</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">-----------------------------------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line">#客户端</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">tcp_client = socket(AF_INET, SOCK_STREAM)</div><div class="line">tcp_client.connect((&quot;localhost&quot;,5001))</div><div class="line"> </div><div class="line">while True:</div><div class="line">        msg = raw_input(&quot;&gt;&quot;)</div><div class="line">        if msg == &apos;o&apos;:</div><div class="line">                tcp_client.send(&apos;&apos;)</div><div class="line">        else:</div><div class="line">                tcp_client.send(msg)</div><div class="line"> </div><div class="line">        if msg == &apos;q&apos;:</div><div class="line">                break</div><div class="line"> </div><div class="line">        server_data = tcp_client.recv(1024)                        #接收来自服务端的数据</div><div class="line">        print(server_data)</div><div class="line"> </div><div class="line">tcp_client.close()</div></pre></td></tr></table></figure>
<h2 id="4-6-服务端断开，客户端的处理情况"><a href="#4-6-服务端断开，客户端的处理情况" class="headerlink" title="4.6.服务端断开，客户端的处理情况"></a>4.6.服务端断开，客户端的处理情况</h2><p>当服务端断开与客户端的连接的时候（客户端输入Q），服务端会发送一个空数据，然后客户端检测，断开链接<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div></pre></td><td class="code"><pre><div class="line">#服务端</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">tcp_server = socket(AF_INET, SOCK_STREAM)</div><div class="line">tcp_server.bind((&quot;localhost&quot;,5001))</div><div class="line">tcp_server.listen(3)</div><div class="line"> </div><div class="line">while True:</div><div class="line">        print(&quot;wait client connect.........&quot;)</div><div class="line"> </div><div class="line">        client,client_info = tcp_server.accept()</div><div class="line">        print(client_info)</div><div class="line"> </div><div class="line">        while True:</div><div class="line">                recv_data = client.recv(1024)</div><div class="line">                if recv_data == &apos;&apos;:</div><div class="line">                        client.close()</div><div class="line">                        break</div><div class="line"> </div><div class="line">                print(&quot;recv=&quot; + recv_data)</div><div class="line"> </div><div class="line">                client.send(&quot;server send :&quot;+recv_data)</div><div class="line"> </div><div class="line">                if recv_data == &apos;q&apos; or recv_data ==&apos;Q&apos;:                #当接收到客户端的数据为“Q&quot;的时候，服务端断开与客户端的连接</div><div class="line">                        client.close()</div><div class="line">                        break</div><div class="line"> </div><div class="line">tcp_server.close()</div><div class="line"></div><div class="line"></div><div class="line">---------------------------------------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line">#客户端1</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">tcp_client = socket(AF_INET, SOCK_STREAM)</div><div class="line">tcp_client.connect((&quot;localhost&quot;,5001))</div><div class="line"> </div><div class="line">while True:</div><div class="line">        msg = raw_input(&quot;&gt;&quot;)</div><div class="line">        if msg == &apos;o&apos;:</div><div class="line">                tcp_client.send(&apos;&apos;)</div><div class="line">        else:</div><div class="line">                tcp_client.send(msg)</div><div class="line"> </div><div class="line">        if msg == &apos;q&apos;:</div><div class="line">                break</div><div class="line"> </div><div class="line">        server_data = tcp_client.recv(1024)</div><div class="line">        print(server_data)</div><div class="line"> </div><div class="line">        if server_data == &apos;&apos;:                                    #当接收到服务端的空数据的时候，就说明服务端断开了连接，所以此时break</div><div class="line">                print(&quot;socket close.....&quot;)</div><div class="line">                break</div><div class="line"> </div><div class="line">tcp_client.close()</div><div class="line"></div><div class="line"></div><div class="line">----------------------------------------------------------------------------</div><div class="line"> </div><div class="line">#客户端2： 当客户端没有接受数据时，使用异常判断来解决</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">tcp_client = socket(AF_INET, SOCK_STREAM)</div><div class="line">tcp_client.connect((&quot;localhost&quot;,5001))</div><div class="line"> </div><div class="line">while True:</div><div class="line">        msg = raw_input(&quot;&gt;&quot;)</div><div class="line">        try:</div><div class="line">                if msg == &apos;o&apos;:</div><div class="line">                        tcp_client.send(&apos;&apos;)</div><div class="line">                else:</div><div class="line">                        tcp_client.send(msg)</div><div class="line"> </div><div class="line">                if msg == &apos;q&apos;:</div><div class="line">                        break</div><div class="line">        except error, emsg:                                #使用异常检测的方式去处理服务端断开的连接</div><div class="line">                print(emsg)</div><div class="line">                break</div><div class="line"> </div><div class="line">tcp_client.close()</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/python/python网络编程之TCP客户端和服务端实现/" data-id="cj290sb7k004tssqqm86j31o6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-python/python线程之线程池" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/python/python线程之线程池/" class="article-date">
  <time datetime="2017-04-16T04:47:25.853Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/python/python线程之线程池/">python线程之线程池</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h1><ul>
<li>线程池：用来解决线程生命周期开销问题和资源不足问题，通过对多个任务重用线程，线程创建的开销就被分摊到了多个任务上了，线程池中的所有线程主动从工作队列中寻找需要执行的工作。</li>
<li>如何实现线程池</li>
</ul>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/python/thread_pool/1.png" alt=""></p>
<h1 id="2-原理图"><a href="#2-原理图" class="headerlink" title="2.原理图"></a>2.原理图</h1><ol>
<li>在线程池中创建了5个线程</li>
<li>创建了N个任务列表</li>
<li>让线程池中的每个线程循环去取任务列表中的任务</li>
</ol>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/python/thread_pool/2.png" alt=""><br><img src="http://ols7leonh.bkt.clouddn.com//assert/img/python/thread_pool/3.png" alt=""></p>
<h1 id="3-代码实现"><a href="#3-代码实现" class="headerlink" title="3. 代码实现"></a>3. 代码实现</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line">[root@backup python]# cat pool.py</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">import sys,Queue,threading</div><div class="line"> </div><div class="line">import time</div><div class="line"> </div><div class="line"> #创建具体的线程</div><div class="line">class _Thread(threading.Thread):</div><div class="line">        def __init__(self,workQueue,resultQueue,timeout=1,**kwargs):</div><div class="line">                threading.Thread.__init__(self,kwargs=kwargs)</div><div class="line">                self.timeout = timeout</div><div class="line">                self.setDaemon(True)</div><div class="line">                self.workQueue = workQueue</div><div class="line">                self.resultQueue = resultQueue</div><div class="line"> </div><div class="line">        def run(self):</div><div class="line">                while True:</div><div class="line">                        try:</div><div class="line">                                callable,args,kwargs = self.workQueue.get(timeout=self.timeout)</div><div class="line">                                #print(self.workQueue.get(timeout=self.timeout))</div><div class="line"> </div><div class="line">                                res = callable(args,kwargs)</div><div class="line">                                print(res+&quot; | &quot;+self.getName())</div><div class="line">                                self.resultQueue.put(res+&quot; | &quot;+self.getName())</div><div class="line"> </div><div class="line">                        except Queue.Empty:                    #任务队列中的值为空，则结束循环</div><div class="line">                                break</div><div class="line">                        except:</div><div class="line">                                print(sys.exc_info())</div><div class="line">                                raise</div><div class="line"> </div><div class="line"> #线程池</div><div class="line">class ThreadPool:</div><div class="line">        def __init__(self,num_of_threads=2):</div><div class="line">                self.workQueue = Queue.Queue()                            #工作任务队列</div><div class="line">                self.resultQueue = Queue.Queue()                        #结果队列</div><div class="line">                self.threads = []                                                    #线程池</div><div class="line">                self.__createThreadPool(num_of_threads)</div><div class="line"> </div><div class="line">        def __createThreadPool(self,num_of_threads):</div><div class="line">                for i in range(num_of_threads):</div><div class="line">                        thread = _Thread(self.workQueue,self.resultQueue)</div><div class="line">                        self.threads.append(thread)                            #创建的线程加入线程池</div><div class="line"> </div><div class="line"> </div><div class="line">        def wait_for_complete(self):</div><div class="line">                while len(self.threads):</div><div class="line">                        thread = self.threads.pop()</div><div class="line">                        if thread.isAlive():</div><div class="line">                                thread.join()</div><div class="line"> </div><div class="line">        def start(self):</div><div class="line">                for th in self.threads:</div><div class="line">                        th.start()</div><div class="line"> </div><div class="line">        def add_job(self,callable,*args,**kwargs):                                        #向任务队列中添加任务</div><div class="line">                self.workQueue.put((callable,args,kwargs))                        #任务由函数来描述，args,kwargs是向函数传递的参数</div><div class="line"> </div><div class="line"> #具体的任务</div><div class="line">def test_job(id,sleep=0.001):</div><div class="line">        time.sleep(0.1)</div><div class="line">        return str(id)</div><div class="line"> </div><div class="line"> </div><div class="line"> </div><div class="line">#测试函数</div><div class="line">def test():</div><div class="line">        print(&quot;start testing.........&quot;)</div><div class="line">        tp = ThreadPool(5)                                #在线程池中创建了5个线程</div><div class="line"> </div><div class="line">        for i in range(50):</div><div class="line">                tp.add_job(test_job,i,i)</div><div class="line">        tp.start()</div><div class="line">        tp.wait_for_complete()</div><div class="line"> </div><div class="line">        while tp.resultQueue.qsize():</div><div class="line">                print(tp.resultQueue.get())</div><div class="line"> </div><div class="line">        print(&quot;end testing.........&quot;)</div><div class="line"> </div><div class="line"> </div><div class="line">if __name__ == &quot;__main__&quot;:</div><div class="line">        test()</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/python/python线程之线程池/" data-id="cj290sb7g004qssqqmad3dhl3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-python/python线程之线程同步之互斥锁" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/python/python线程之线程同步之互斥锁/" class="article-date">
  <time datetime="2017-04-16T04:47:25.851Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/python/python线程之线程同步之互斥锁/">python线程之线程同步之互斥锁</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-概念介绍"><a href="#1-概念介绍" class="headerlink" title="1.概念介绍"></a>1.概念介绍</h1><ul>
<li>线程互斥：是指某一个资源同时只允许一个访问者对其进行修改，具有唯一性和排他性</li>
<li>线程死锁：死锁就是系统进入到一种阻塞的，无法移动的状态</li>
<li>死锁出现的情况：一个线程占有锁之后又去占有锁<ol>
<li>占有锁后，忘记释放</li>
<li>占有锁，然后调用其他函数又去占有锁</li>
</ol>
</li>
<li>线程死锁避免：代码书写小心，保证占有和释放成对出现</li>
<li>线程饿死：一个线程长时间的得不到需要的资源而不能执行的现象</li>
<li>线程饿死避免：线程队列，或者结合其他同步方式</li>
</ul>
<h1 id="2-互斥锁程序实现"><a href="#2-互斥锁程序实现" class="headerlink" title="2.互斥锁程序实现"></a>2.互斥锁程序实现</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"></div><div class="line">import threading</div><div class="line">import time</div><div class="line"></div><div class="line">tmp = 0</div><div class="line"></div><div class="line">g_lock = threading.Lock()</div><div class="line"></div><div class="line">def func():</div><div class="line">        global tmp</div><div class="line">        global g_lock</div><div class="line"></div><div class="line">        for i in range(20,25):</div><div class="line">                g_lock.acquire()                        #加锁</div><div class="line">                tmp -= 1</div><div class="line">                print(threading.currentThread().getName()+&quot;:tmp=&#123;0&#125;&quot;.format(str(tmp)))</div><div class="line">                g_lock.release()                        #释放锁</div><div class="line">                time.sleep(1)</div><div class="line"></div><div class="line">if __name__==&quot;__main__&quot;:</div><div class="line">        p = threading.Thread(target=func,args=())</div><div class="line">        p.setDaemon(True)</div><div class="line">        p.start()</div><div class="line"></div><div class="line">        for i in range(0,5):</div><div class="line">                g_lock.acquire()                    #加锁</div><div class="line">                tmp += 1</div><div class="line">                print(threading.currentThread().getName()+&quot;:tmp=&#123;0&#125;&quot;.format(str(tmp)))</div><div class="line">                g_lock.release()                    #释放锁</div><div class="line">                time.sleep(1)</div><div class="line"></div><div class="line">        p.join()</div></pre></td></tr></table></figure>
<p>打印结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Thread-1:tmp=-1</div><div class="line">MainThread:tmp=0</div><div class="line">MainThread:tmp=1</div><div class="line">Thread-1:tmp=0</div><div class="line">MainThread:tmp=1</div><div class="line">Thread-1:tmp=0</div><div class="line">MainThread:tmp=1</div><div class="line">Thread-1:tmp=0</div><div class="line">MainThread:tmp=1</div><div class="line">Thread-1:tmp=0</div><div class="line">[Finished in 5.3s]</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/python/python线程之线程同步之互斥锁/" data-id="cj290sb7e004nssqqltu030q4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-python/python线程之多线程练习" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/python/python线程之多线程练习/" class="article-date">
  <time datetime="2017-04-16T04:47:25.850Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/python/python线程之多线程练习/">python线程之多线程练习</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h1><ul>
<li>使用多线程统计每门课程的平均分</li>
<li>前提条件：学生成绩保存在TXT文件中：chinese.txt maths.txt</li>
<li><p>思路：</p>
<ol>
<li>将文件中你的每门课程的成绩解析出来</li>
<li>统计每门课程分数总和及学生数量，并计算平均值</li>
</ol>
</li>
<li><p>应用知识点：</p>
<ol>
<li>文件读写</li>
<li>正则表达式得到学生成绩</li>
<li>将统计过程抽象成类</li>
<li>实现多线程统计<br>以下是多线程和单线程统计过程的区别：</li>
</ol>
</li>
</ul>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/python/thread_practice/1.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#创建分数文件</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">import sys</div><div class="line">import random</div><div class="line"> </div><div class="line">&apos;&apos;&apos;</div><div class="line">#文件模板</div><div class="line">open file</div><div class="line">40 database</div><div class="line">name_1:90</div><div class="line">name_2:92</div><div class="line">.....</div><div class="line">&apos;&apos;&apos;</div><div class="line">def construct_data(filename):</div><div class="line">        f = open(filename,&apos;w&apos;)</div><div class="line">        for i in range(40):</div><div class="line">                data = &apos;name_&apos;+str(i)+&apos;:&apos;+str(random.randint(50,100))+&apos;\n&apos;                    #格式为：name_i:99</div><div class="line">                f.write(data)</div><div class="line">        f.close()</div><div class="line"> </div><div class="line"> </div><div class="line">def create_file(filenames):</div><div class="line">        for filen in filenames:                                    #循环创建多个数据文件</div><div class="line">                construct_data(filen)</div><div class="line"> </div><div class="line"> </div><div class="line">if __name__==&quot;__main__&quot;:</div><div class="line">        print(sys.argv[1:])</div><div class="line">        create_file(sys.argv[1:])                    #指定要创建哪些文件</div><div class="line"></div><div class="line">-------------------------------------------------------------</div><div class="line">#测试</div><div class="line">[root@backup python]# python create_data.py chinese.txt math.txt</div><div class="line">[&apos;chinese.txt&apos;, &apos;math.txt&apos;]</div><div class="line">[root@backup python]# cat math.txt</div><div class="line">name_0:65</div><div class="line">name_1:70</div><div class="line">name_2:95</div><div class="line">name_3:54</div><div class="line">name_4:72</div><div class="line">name_5:67</div><div class="line">name_6:74</div><div class="line">name_7:93</div><div class="line">name_8:98</div><div class="line">。。。。。。。。。。。。</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#下面的代码是统计每一个文件中的分数平均值</div><div class="line">[root@backup python]# cat thread_count.py</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">import threading</div><div class="line">import re</div><div class="line">import sys</div><div class="line"> </div><div class="line"> </div><div class="line">class my_thread(threading.Thread):                                #继承Thread线程</div><div class="line">        def __init__(self,filepath):</div><div class="line">                threading.Thread.__init__(self)</div><div class="line">                self.filepath = filepath</div><div class="line">                self.result = 0</div><div class="line">                self.sumscore = 0</div><div class="line"> </div><div class="line">        def run(self):</div><div class="line">                f = open(self.filepath)</div><div class="line">                iter_f = iter(f)</div><div class="line">                num = 0</div><div class="line">                for line in iter_f:</div><div class="line">                        score = int(re.split(&quot;:&quot;,line)[1])                                        #用正则取出分数列</div><div class="line">                        self.sumscore += score</div><div class="line">                        num += 1</div><div class="line">                f.close()</div><div class="line">                self.result = self.sumscore / num                                    #求平均值</div><div class="line">                print(&quot;file=&#123;0&#125;,sum=&#123;1&#125;,num=&#123;2&#125;,avg=&#123;3&#125;&quot;.format(self.filepath,self.sumscore,num,self.result))                    #打印统计结果</div><div class="line"> </div><div class="line">def count_score(file_list):</div><div class="line">        thread_list = []</div><div class="line">        for filel in file_list:                                #对每个文件都创建一个线程，在线程中对该文件中的分数做统计</div><div class="line">                p = my_thread(filel)</div><div class="line">                p.start()</div><div class="line">                thread_list.append(p)</div><div class="line"> </div><div class="line">        for p in thread_list:</div><div class="line">                p.join()                                    #等待所有的线程结束</div><div class="line"> </div><div class="line"> </div><div class="line">if __name__ == &quot;__main__&quot;:</div><div class="line">        print(sys.argv[1:])</div><div class="line">        count_score(sys.argv[1:])                #调用统计分数的函数，传过去的是参数list</div><div class="line"></div><div class="line"></div><div class="line">-----------------------------------------------------</div><div class="line">#测试</div><div class="line">[root@backup python]# python thread_count.py chinese.txt math.txt</div><div class="line">[&apos;chinese.txt&apos;, &apos;math.txt&apos;]</div><div class="line">file=chinese.txt,sum=2892,num=40,avg=72</div><div class="line">file=math.txt,sum=2996,num=40,avg=74</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/python/python线程之多线程练习/" data-id="cj290sb7b004kssqqqq2343ah" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-python/python线程之同步之条件变量" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/python/python线程之同步之条件变量/" class="article-date">
  <time datetime="2017-04-16T04:47:25.849Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/python/python线程之同步之条件变量/">python线程之同步之条件变量</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-生产和消费的平衡"><a href="#1-生产和消费的平衡" class="headerlink" title="1.生产和消费的平衡"></a>1.生产和消费的平衡</h1><ul>
<li>线程1负责产生数据，线程2负责分发数据，线程1和线程2同时需要对公共数据进行管理，理想的状态：1产生数据后，2能分发，1和2合理调度，保证公共数据不为0，同时也不会堆积过多</li>
</ul>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/python/condition/1.png" alt=""></p>
<ul>
<li>如果使用lock机制，因为调度的关系，造成下面两种情况：<ol>
<li>线程1可能一直被调度，导致线程2无法调度，这样造成数据堆积</li>
<li>线程2可能一直被调度，导致线程1无法调度，这样造成数据不足<br>如何来解决？</li>
</ol>
</li>
</ul>
<h1 id="2-条件变量"><a href="#2-条件变量" class="headerlink" title="2.条件变量"></a>2.条件变量</h1><p>允许线程阻塞等待另一个线程发送信号唤醒，条件变量被用来阻塞一个线程，当条件不满足时，线程解开相应的互斥锁并等待条件发生变化，如果其他线程改变了条件变量，并且使用条件变量唤醒一个或多个正被此条件变量阻塞的线程，这些线程将重新锁定互斥锁并重新测试条件是否满足，条件变量被用来进行线程间的同步</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">#thread1</div><div class="line">con = threading.Condition()</div><div class="line">while true:</div><div class="line">    do_something</div><div class="line">    con.acquire()    #获取锁</div><div class="line">    con.notify()    #唤醒等待线程</div><div class="line">    con.release()    #释放锁</div><div class="line"></div><div class="line">#thread2</div><div class="line">con.acquire():</div><div class="line">while true:</div><div class="line">    con.wait()        #等待唤醒,释放锁</div><div class="line">    do_something</div><div class="line">con.release()        #释放锁</div></pre></td></tr></table></figure>
<ul>
<li>条件变量实质：某一时刻只有一个线程访问公共资源，其他线程做其他任务或者休眠</li>
<li>使用条件变量实现生产者和消费者</li>
</ul>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/python/condition/2.png" alt=""></p>
<h1 id="3-程序实现"><a href="#3-程序实现" class="headerlink" title="3.程序实现"></a>3.程序实现</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">import threading</div><div class="line">import time</div><div class="line"> </div><div class="line">tmp = 0</div><div class="line"> </div><div class="line">g_cond = threading.Condition()</div><div class="line"> </div><div class="line">def thread_func():</div><div class="line">        global g_cond</div><div class="line">        global tmp</div><div class="line"> </div><div class="line">        while True:</div><div class="line">                g_cond.acquire()</div><div class="line">                if tmp &gt;= 10:                    #当tmp&gt;=10的时候，去消费</div><div class="line">                        tmp -= 1</div><div class="line">                        print(&quot;sub tmp=&#123;0&#125;&quot;.format(str(tmp)))</div><div class="line">                else:</div><div class="line">                        g_cond.wait()</div><div class="line">                        print(&quot;wake up by another thread&quot;)</div><div class="line">                g_cond.release()</div><div class="line"> </div><div class="line"> </div><div class="line">if __name__ == &quot;__main__&quot;:</div><div class="line">        p = threading.Thread(target=thread_func,args=())</div><div class="line">        p.setDaemon(True)</div><div class="line">        p.start()</div><div class="line"> </div><div class="line">        while True:</div><div class="line">                g_cond.acquire()</div><div class="line">                if tmp &gt;= 15:                      #当tmp&gt;=15的时候，停止生产，同时通知sub thread 去消费</div><div class="line">                        print(&quot;notify sub thread.....&quot;)</div><div class="line">                        g_cond.notify()                    #唤醒wait的线程</div><div class="line">                else:</div><div class="line">                        tmp += 1</div><div class="line">                        print(&quot;main tmp=&#123;0&#125;&quot;.format(str(tmp)))</div><div class="line">                g_cond.release()</div><div class="line">                time.sleep(1)</div><div class="line"> </div><div class="line">        p.join()</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/python/python线程之同步之条件变量/" data-id="cj290sb7a004hssqqvwrl31mq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-python/python线程之同步之信号量" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/python/python线程之同步之信号量/" class="article-date">
  <time datetime="2017-04-16T04:47:25.848Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/python/python线程之同步之信号量/">python线程之同步之信号量</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h1><p>&emsp;信号量semaphore：管理一个内置的计数器，每当调用acquire()时-1, 调用release()时+1，计数器不能小于0；当计数器为0时，acquire()将阻塞线程至锁定状态，知道其他线程调用release()使计数器大于0，信号量同步机制适用于访问像服务器这样的有限资源（<font color="red">即只能够让有限个(N)资源访问</font>）</p>
<ul>
<li>创建信号量：sem = threading.Semaphore(n) ;同时允许N个线程对公共资源进行访问</li>
</ul>
<h1 id="2-举例1-只让一个资源访问"><a href="#2-举例1-只让一个资源访问" class="headerlink" title="2.举例1(只让一个资源访问)"></a>2.举例1(只让一个资源访问)</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">import threading</div><div class="line">import time</div><div class="line"> </div><div class="line">tmp = 0</div><div class="line"> </div><div class="line">g_sem = threading.Semaphore(1)</div><div class="line"> </div><div class="line">def func():</div><div class="line">        global tmp</div><div class="line">        global g_sem</div><div class="line">        print(&quot;&#123;0&#125; before get sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        g_sem.acquire()</div><div class="line">        print(&quot;&#123;0&#125; geted sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        time.sleep(3)</div><div class="line">        print(&quot;&#123;0&#125; release sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        g_sem.release()</div><div class="line"> </div><div class="line"> </div><div class="line">if __name__ == &quot;__main__&quot;:</div><div class="line">        p = threading.Thread(target=func,args=())</div><div class="line">        p.setDaemon(True)</div><div class="line">        p.start()</div><div class="line">        print(&quot;&#123;0&#125; before get sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        g_sem.acquire()                                                                                    </div><div class="line">        print(&quot;&#123;0&#125; geted sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        time.sleep(5)</div><div class="line">        print(&quot;&#123;0&#125; release sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        g_sem.release()                                                                #主线程释放资源</div><div class="line"> </div><div class="line">        p.join()</div><div class="line"></div><div class="line">-----------------------------------------------------------------------</div><div class="line">#结果</div><div class="line">[root@backup python]# python se.py  </div><div class="line">MainThread before get sem</div><div class="line">MainThread geted sem</div><div class="line">Thread-1 before get sem                                    #主线程拿到了资源，然后子线程会等待主线程释放资源（即同一个时刻只有一个线程访问资源）</div><div class="line">MainThread release sem</div><div class="line">Thread-1 geted sem</div><div class="line">Thread-1 release sem</div><div class="line">[root@backup python]#</div></pre></td></tr></table></figure>
<h1 id="3-举例2-只让两个资源访问"><a href="#3-举例2-只让两个资源访问" class="headerlink" title="3.举例2(只让两个资源访问)"></a>3.举例2(只让两个资源访问)</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">import threading</div><div class="line">import time</div><div class="line"> </div><div class="line">tmp = 0</div><div class="line"> </div><div class="line">g_sem = threading.Semaphore(2)                                    #初始化了两个信号量</div><div class="line"> </div><div class="line">def func():</div><div class="line">        global tmp</div><div class="line">        global g_sem</div><div class="line">        print(&quot;&#123;0&#125; before get sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        g_sem.acquire()</div><div class="line">        print(&quot;&#123;0&#125; geted sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        time.sleep(3)</div><div class="line">        print(&quot;&#123;0&#125; release sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        g_sem.release()</div><div class="line"> </div><div class="line"> </div><div class="line">if __name__ == &quot;__main__&quot;:</div><div class="line">        p = threading.Thread(target=func,args=())</div><div class="line">        p.setDaemon(True)</div><div class="line">        p.start()</div><div class="line">        print(&quot;&#123;0&#125; before get sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        g_sem.acquire()</div><div class="line">        print(&quot;&#123;0&#125; geted sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        time.sleep(5)</div><div class="line">        print(&quot;&#123;0&#125; release sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        g_sem.release()</div><div class="line"> </div><div class="line">        p.join()</div><div class="line">-----------------------------------------------------</div><div class="line">#结果</div><div class="line">[root@backup python]# python se2.py</div><div class="line">MainThread before get sem</div><div class="line">MainThread geted sem                                          #主线程可以获取资源</div><div class="line">Thread-1 before get sem</div><div class="line">Thread-1 geted sem                                            #子线程也是可以获取资源的</div><div class="line">Thread-1 release sem</div><div class="line">MainThread release sem</div><div class="line">[root@backup python]#</div></pre></td></tr></table></figure>
<h1 id="4-release-使信号量加1"><a href="#4-release-使信号量加1" class="headerlink" title="4.release()使信号量加1"></a>4.release()使信号量加1</h1><p>当调用release函数的时候，信号量就会加1，那么此时就会有N+1个线程可以去访问资源，即：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">threading.Semaphore(2)    </div><div class="line">#等价于：</div><div class="line">g_sem = threading.Semaphore(1)</div><div class="line">g_sem.release()</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/python/python线程之同步之信号量/" data-id="cj290sb78004essqqwqlv4y1n" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-python/python线程之同步之Queue队列" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/python/python线程之同步之Queue队列/" class="article-date">
  <time datetime="2017-04-16T04:47:25.846Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/python/python线程之同步之Queue队列/">python线程之同步之Queue队列</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h1><p>&emsp;Queue模块中提供了同步的、线程安全的队列类，包括FIFO（先进先出）队列Queue，LIFO（后入先出）队列LifoQueue，和优先级队列PriorityQueue，这些队列都实现了原子操作，能够在多线程中直接使用，可以使用队列来实现线程间的同步，内部实现使用了mutex和condition<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#创建队列： </div><div class="line">number_queue = Queue.Queue()</div><div class="line"></div><div class="line">#访问： </div><div class="line">number_queue.put(N)        </div><div class="line">n = number_queue.get()</div></pre></td></tr></table></figure></p>
<h1 id="2-帮助文档"><a href="#2-帮助文档" class="headerlink" title="2.帮助文档"></a>2.帮助文档</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">In [8]: import Queue                                            #导入模块</div><div class="line"> </div><div class="line">In [9]: qu = Queue.                                    #模块下的所有的函数（各种队列类型）</div><div class="line">Queue.Empty          Queue.LifoQueue      Queue.Queue          Queue.heapq         </div><div class="line">Queue.Full           Queue.PriorityQueue  Queue.deque         </div><div class="line"> </div><div class="line">In [9]: qu = Queue.Queue()                            #返回一个先进先出队列</div><div class="line"> </div><div class="line">In [10]: qu.                                       #先进先出队列的方法</div><div class="line">qu.all_tasks_done    qu.get               qu.maxsize           qu.not_full          qu.qsize             qu.unfinished_tasks</div><div class="line">qu.empty             qu.get_nowait        qu.mutex             qu.put               qu.queue            </div><div class="line">qu.full              qu.join              qu.not_empty         qu.put_nowait        qu.task_done</div></pre></td></tr></table></figure>
<h1 id="3-举例"><a href="#3-举例" class="headerlink" title="3.举例"></a>3.举例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line"> </div><div class="line">import threading, Queue</div><div class="line">import time</div><div class="line"> </div><div class="line"> </div><div class="line">g_que = Queue.Queue()                                #创建先进先出队列</div><div class="line"> </div><div class="line">def thread_func():</div><div class="line">        global g_que                                    #声明使用全局变量</div><div class="line">        while True:</div><div class="line">                msg = g_que.get()                            #子线程取出数据，然后打印</div><div class="line">                print(msg)</div><div class="line"> </div><div class="line"> </div><div class="line">if __name__ == &quot;__main__&quot;:</div><div class="line">        p = threading.Thread(target=thread_func,args=())</div><div class="line">        p.setDaemon(True)</div><div class="line">        p.start()</div><div class="line">        tmp = 0</div><div class="line"> </div><div class="line">        while True:</div><div class="line">                tmp+=1</div><div class="line">                g_que.put(tmp)                        #主线程向队列中放入数据</div><div class="line">                time.sleep(1)</div><div class="line">        p.join()</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/python/python线程之同步之Queue队列/" data-id="cj290sb76004bssqqiweob33q" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/11/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><a class="page-number" href="/page/14/">14</a><span class="space">&hellip;</span><a class="page-number" href="/page/58/">58</a><a class="extend next" rel="next" href="/page/13/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/IDEA/">IDEA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/NFS/">NFS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tachyon/">Tachyon</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/azkaban/">azkaban</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/echarts/">echarts</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/flume/">flume</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/">hadoop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hbase/">hbase</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hive/">hive</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/inotify/">inotify</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/kafka/">kafka</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/logstash/">logstash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/markdown/">markdown</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/memcached/">memcached</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/project/">project</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/rsync/">rsync</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/scala/">scala</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/shell/">shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/socket/">socket</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/spark/">spark</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/sqoop/">sqoop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/storm/">storm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据仓库/">数据仓库</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDEA/">IDEA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux基础命令/">Linux基础命令</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux重要配置文件/">Linux重要配置文件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NFS/">NFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NIO/">NIO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azkaban/">azkaban</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/echarts/">echarts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flume/">flume</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hadoop/">hadoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hbase/">hbase</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hive/">hive</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/inotify/">inotify</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/">kafka</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logstash/">logstash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mapreduce/">mapreduce</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/memcached/">memcached</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/netty/">netty</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/project/">project</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rpc/">rpc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rsync/">rsync</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala/">scala</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala函数式编程/">scala函数式编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala编程/">scala编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socket/">socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spark/">spark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqoop/">sqoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/storm/">storm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zookeeper/">zookeeper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据仓库/">数据仓库</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/IDEA/" style="font-size: 10px;">IDEA</a> <a href="/tags/Linux基础命令/" style="font-size: 19.52px;">Linux基础命令</a> <a href="/tags/Linux重要配置文件/" style="font-size: 14.76px;">Linux重要配置文件</a> <a href="/tags/NFS/" style="font-size: 10px;">NFS</a> <a href="/tags/NIO/" style="font-size: 11.43px;">NIO</a> <a href="/tags/azkaban/" style="font-size: 10.48px;">azkaban</a> <a href="/tags/echarts/" style="font-size: 10.95px;">echarts</a> <a href="/tags/flume/" style="font-size: 10.95px;">flume</a> <a href="/tags/hadoop/" style="font-size: 18.57px;">hadoop</a> <a href="/tags/hbase/" style="font-size: 13.33px;">hbase</a> <a href="/tags/hive/" style="font-size: 18.1px;">hive</a> <a href="/tags/inotify/" style="font-size: 10px;">inotify</a> <a href="/tags/java/" style="font-size: 12.38px;">java</a> <a href="/tags/kafka/" style="font-size: 12.86px;">kafka</a> <a href="/tags/linux/" style="font-size: 13.33px;">linux</a> <a href="/tags/logstash/" style="font-size: 10.48px;">logstash</a> <a href="/tags/mapreduce/" style="font-size: 16.67px;">mapreduce</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/memcached/" style="font-size: 13.81px;">memcached</a> <a href="/tags/mongodb/" style="font-size: 14.76px;">mongodb</a> <a href="/tags/mysql/" style="font-size: 17.14px;">mysql</a> <a href="/tags/netty/" style="font-size: 10.95px;">netty</a> <a href="/tags/nginx/" style="font-size: 14.29px;">nginx</a> <a href="/tags/project/" style="font-size: 10.48px;">project</a> <a href="/tags/python/" style="font-size: 19.05px;">python</a> <a href="/tags/redis/" style="font-size: 17.14px;">redis</a> <a href="/tags/rpc/" style="font-size: 10.48px;">rpc</a> <a href="/tags/rsync/" style="font-size: 10px;">rsync</a> <a href="/tags/scala/" style="font-size: 17.62px;">scala</a> <a href="/tags/scala函数式编程/" style="font-size: 11.9px;">scala函数式编程</a> <a href="/tags/scala编程/" style="font-size: 15.71px;">scala编程</a> <a href="/tags/shell/" style="font-size: 17.62px;">shell</a> <a href="/tags/socket/" style="font-size: 11.9px;">socket</a> <a href="/tags/spark/" style="font-size: 20px;">spark</a> <a href="/tags/sqoop/" style="font-size: 10.95px;">sqoop</a> <a href="/tags/storm/" style="font-size: 15.24px;">storm</a> <a href="/tags/zookeeper/" style="font-size: 16.19px;">zookeeper</a> <a href="/tags/数据仓库/" style="font-size: 11.43px;">数据仓库</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/05/02/bigdata/spark从入门到精通_笔记/Tachyon/">Tachyon</a>
          </li>
        
          <li>
            <a href="/2017/04/30/数据仓库/数据仓库2/">数据仓库</a>
          </li>
        
          <li>
            <a href="/2017/04/29/IDEA/IDEA/">IDEA</a>
          </li>
        
          <li>
            <a href="/2017/04/29/数据仓库/ETL/">ETL</a>
          </li>
        
          <li>
            <a href="/2017/04/28/数据仓库/PowderDesigner/">PowderDesigner的使用</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Mr. Chen<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>




  </div>
</body>
</html>