<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Chen&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="一个技术渣的自说自话">
<meta property="og:type" content="website">
<meta property="og:title" content="Chen's Blog">
<meta property="og:url" content="http://yoursite.com/page/26/index.html">
<meta property="og:site_name" content="Chen's Blog">
<meta property="og:description" content="一个技术渣的自说自话">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chen's Blog">
<meta name="twitter:description" content="一个技术渣的自说自话">
  
    <link rel="alternate" href="/atom.xml" title="Chen&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Chen&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">一个技术渣的自说自话</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Linux/shell/shell中各种括号的作用()、(())、[]、[[]]、{} " class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/Linux/shell/shell中各种括号的作用()、(())、[]、[[]]、{} /" class="article-date">
  <time datetime="2017-04-16T04:47:25.594Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/shell/">shell</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/Linux/shell/shell中各种括号的作用()、(())、[]、[[]]、{} /">shell中各种括号的作用()、(())、[]、[[]]、{}</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1"><a href="#1" class="headerlink" title="1.()"></a>1.()</h1><h2 id="1-1-命令组"><a href="#1-1-命令组" class="headerlink" title="1.1.命令组"></a>1.1.命令组</h2><p>&emsp;括号中的命令将会新开一个子shell顺序执行，所以括号中的变量不能够被脚本余下的部分使用。括号中多个命令之间用分号隔开，最后一个命令可以没有分号，各命令和括号之间不必有空格。</p>
<h2 id="1-2-用于初始化数组"><a href="#1-2-用于初始化数组" class="headerlink" title="1.2.用于初始化数组"></a>1.2.用于初始化数组</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">array=(a b c d)</div></pre></td></tr></table></figure>
<h1 id="2"><a href="#2" class="headerlink" title="2.(())"></a>2.(())</h1><h2 id="2-1-四则运算"><a href="#2-1-四则运算" class="headerlink" title="2.1.四则运算"></a>2.1.四则运算</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a=5; ((a++)) 可将 $a 重定义为6</div></pre></td></tr></table></figure>
<h2 id="2-2-逻辑运算"><a href="#2-2-逻辑运算" class="headerlink" title="2.2.逻辑运算"></a>2.2.逻辑运算</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">直接使用for((i=0;i&lt;5;i++))</div></pre></td></tr></table></figure>
<h1 id="3"><a href="#3" class="headerlink" title="3.[]"></a>3.[]</h1><h2 id="3-1-test测试"><a href="#3-1-test测试" class="headerlink" title="3.1.test测试"></a>3.1.test测试</h2><p>详见：条件测试及控制流.docx</p>
<h2 id="3-2-数组下标"><a href="#3-2-数组下标" class="headerlink" title="3.2.数组下标"></a>3.2.数组下标</h2><p>在一个array 结构的上下文中，中括号用来引用数组中每个元素的编号</p>
<h1 id="4"><a href="#4" class="headerlink" title="4[[]]"></a>4[[]]</h1><p>使用[[ … ]]条件判断结构</p>
<p>直接使用if [[ \$a != 1 &amp;&amp; \$a != 2 ]], 如果不适用双括号, 则为if [ \$a -ne 1] &amp;&amp; [ \$a != 2 ]或者if [ \$a -ne 1 -a \$a != 2 ]。</p>
<h1 id="5"><a href="#5" class="headerlink" title="5.{}"></a>5.{}</h1><h2 id="5-1对大括号中的以逗号分割的文件列表进行拓展"><a href="#5-1对大括号中的以逗号分割的文件列表进行拓展" class="headerlink" title="5.1对大括号中的以逗号分割的文件列表进行拓展"></a>5.1对大括号中的以逗号分割的文件列表进行拓展</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">touch &#123;a,b&#125;.txt</div><div class="line">结果为：a.txt     b.txt</div></pre></td></tr></table></figure>
<h2 id="5-2对大括号中以点点（-）分割的顺序文件列表起拓展作用"><a href="#5-2对大括号中以点点（-）分割的顺序文件列表起拓展作用" class="headerlink" title="5.2对大括号中以点点（..）分割的顺序文件列表起拓展作用"></a>5.2对大括号中以点点（..）分割的顺序文件列表起拓展作用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">如：touch &#123;a..d&#125;.txt</div><div class="line">结果为a.txt b.txt c.txt d.txt</div></pre></td></tr></table></figure>
<h2 id="5-3-代码块"><a href="#5-3-代码块" class="headerlink" title="5.3.代码块"></a>5.3.代码块</h2><p>&emsp;又被称为内部组，这个结构事实上创建了一个匿名函数 。与小括号中的命令不同，大括号内的命令不会新开一个子shell运行，即脚本余下部分仍可使用括号内变量。括号内的命令间用分号隔开，最后一个也必须有分号。{}的第一个命令和左括号之间必须要有一个空格</p>
<h2 id="5-4其他"><a href="#5-4其他" class="headerlink" title="5.4其他"></a>5.4其他</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">类似于下面的结构，对字符串进行操作，详细见：shell.docx 中“字符串处理函数”</div><div class="line">$&#123;var:-DEFAULT&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/Linux/shell/shell中各种括号的作用()、(())、[]、[[]]、{} /" data-id="cj290sbsr00jxssqq47lgq9h4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/">shell</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Linux/shell/function函数" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/Linux/shell/function函数/" class="article-date">
  <time datetime="2017-04-16T04:47:25.592Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/shell/">shell</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/Linux/shell/function函数/">function函数</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-语法"><a href="#1-语法" class="headerlink" title="1.语法"></a>1.语法</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">#简单语法格式:</div><div class="line">函数名()&#123;</div><div class="line">    //指令...</div><div class="line">    return n</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">#规范语法格式:</div><div class="line">function 函数名()&#123;</div><div class="line">    //指令...</div><div class="line">    return n</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="2-函数的调用"><a href="#2-函数的调用" class="headerlink" title="2.函数的调用"></a>2.函数的调用</h1><ul>
<li>直接执行函数名即可(不带括号),函数定义及函数体必须在要执行的函数名的前面定义(即:先定义后使用)</li>
<li>带参数的函数执行方法<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">函数名    参数1    参数2 ..</div><div class="line"></div><div class="line">/*</div><div class="line">shell的位置参数( $1,$2,...$&#123;10&#125;...) , $10 不能获取第十个参数，获取第十个参数需要$&#123;10&#125;。当n&gt;=10时，需要使用$&#123;n&#125;来获取参数</div><div class="line">$0   比较特殊,他仍然是父脚本的名称</div><div class="line">$#    传递到脚本的参数个数</div><div class="line">$*    以一个单字符串显示所有向脚本传递的参数</div><div class="line">$!    后台运行的最后一个进程的ID号</div><div class="line">$$    脚本运行的当前进程ID号</div><div class="line">$@ 与$*相同，但是使用时加引号，并在引号中返回每个参数</div><div class="line">$? 显示最后命令的退出状态。0表示没有错误，其他任何值表明有错误</div><div class="line"></div><div class="line">在shell函数里面,return命令功能与shell里面的exit类似,但是shell函数体里使用exit会退出整个shell脚本,而不是shell脚本,return语句会返回一个退出值(返回值)给函数的调用者</div><div class="line">*/</div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="3-获取函数返回值"><a href="#3-获取函数返回值" class="headerlink" title="3.获取函数返回值"></a>3.获取函数返回值</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash -  </div><div class="line">function mytest()  </div><div class="line">&#123;  </div><div class="line">    echo &quot;arg1 = $1&quot;  </div><div class="line">    if [ $1 = &quot;1&quot; ] ;then  </div><div class="line">        return 1  </div><div class="line">    else  </div><div class="line">        return 0  </div><div class="line">    fi  </div><div class="line">&#125;  </div><div class="line"> </div><div class="line">mytest 1  </div><div class="line">echo $?         # print return result</div></pre></td></tr></table></figure>
<h1 id="4-书写规范"><a href="#4-书写规范" class="headerlink" title="4.书写规范"></a>4.书写规范</h1><p>&emsp;一般在一个shell脚本中将代码写在一个模块中，即写在函数中，这样可以根据函数的名称来确定该代码块在进行何种操作，然后就是在所有函数定义的下方调用函数，我们一般将这个总体的调用函数写在main函数中，这是在c中的写法，这里可以参考</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/Linux/shell/function函数/" data-id="cj290sbsp00jussqq32tu0hc8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/">shell</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Linux/rsync/rsync" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/Linux/rsync/rsync/" class="article-date">
  <time datetime="2017-04-16T04:47:25.588Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/rsync/">rsync</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/Linux/rsync/rsync/">rsync</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-什么是rsync"><a href="#1-什么是rsync" class="headerlink" title="1.什么是rsync"></a>1.什么是rsync</h1><p>&emsp;Rsync是一款开源的、快速的额、多功能的、可实现全量及增量的本地货远程数据同步备份的优秀工具<br>&emsp;Rsync全称为（Remote synchronization）,Rsync具有可使本地和远程两台主机之间的数据块快速复制同步镜像、远程备份的功能，这个功能类似于ssh的scp命令，但又优于scp命令的功能，scp每次都是全量拷贝，而rsync可以增量拷贝。利用Rsync还可以实现删除文件和目录的功能，这又相当于rm命令<br>&emsp;在同步备份数据时，默认情况下，Rsync通过其独特的“quick check”算法，他仅同步大小或者最后修改时间发生变化的文件或目录，当然也可以根据权限、属组等属性的变化同步，但需要指定相应的参数，甚至可以实现只同步一个文件里有变化的内容部分，所以，可以实现快速的同步备份数据</p>
<h2 id="1-1官方文档"><a href="#1-1官方文档" class="headerlink" title="1.1官方文档"></a>1.1官方文档</h2><p><a href="https://www.samba.org/ftp/rsync/rsync.html" target="_blank" rel="external">https://www.samba.org/ftp/rsync/rsync.html</a></p>
<h1 id="2-rsync工作场景说明"><a href="#2-rsync工作场景说明" class="headerlink" title="2. rsync工作场景说明"></a>2. rsync工作场景说明</h1><ul>
<li>定时同步：cron + rsync</li>
<li>实时数据同步：rsync + inotify 或sersync</li>
</ul>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/1.png" alt=""></p>
<h1 id="3-rsync工作方式"><a href="#3-rsync工作方式" class="headerlink" title="3. rsync工作方式"></a>3. rsync工作方式</h1><p>Rsync大致使用三种主要的传输数据的方式，man rsync看：</p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/2.png" alt=""></p>
<h2 id="3-1-单个主机本地传输数据（此时类似于cp命令的功能）"><a href="#3-1-单个主机本地传输数据（此时类似于cp命令的功能）" class="headerlink" title="3.1.单个主机本地传输数据（此时类似于cp命令的功能）"></a>3.1.单个主机本地传输数据（此时类似于cp命令的功能）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">rsync -avz /etc/hosts /tmp/ </div><div class="line">#等价于cp</div><div class="line"></div><div class="line"></div><div class="line">mkdir /null</div><div class="line">rsync -avz --delete /null/ /tmp/</div><div class="line">#等价于:</div><div class="line">rm -rf /tmp/</div></pre></td></tr></table></figure>
<h2 id="3-2-借助rcp，ssh等通道来传输数据（此时类似于scp命令的功能）"><a href="#3-2-借助rcp，ssh等通道来传输数据（此时类似于scp命令的功能）" class="headerlink" title="3.2.借助rcp，ssh等通道来传输数据（此时类似于scp命令的功能）"></a>3.2.借助rcp，ssh等通道来传输数据（此时类似于scp命令的功能）</h2><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/3.png" alt=""></p>
<h2 id="3-3以守护进程（socket）的方式传输数据（这个是Rsync自身的重要的功能）"><a href="#3-3以守护进程（socket）的方式传输数据（这个是Rsync自身的重要的功能）" class="headerlink" title="3.3以守护进程（socket）的方式传输数据（这个是Rsync自身的重要的功能）"></a>3.3以守护进程（socket）的方式传输数据（这个是Rsync自身的重要的功能）</h2><p>见7.2节详细的例子<br>/tmp/ 表示tmp下内容，如果是/tmp则表示是tmp目录以及tmp下的所有内容</p>
<h1 id="4-创建配置文件"><a href="#4-创建配置文件" class="headerlink" title="4.创建配置文件"></a>4.创建配置文件</h1><p> man rsyncd.conf 可以看配置的详细说明<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">#Rsync server</div><div class="line">uid = rsync</div><div class="line">gid = rsync</div><div class="line">use chroot = no</div><div class="line">max connections = 2000</div><div class="line">timeout = 600</div><div class="line">pid file = /var/run/rsyncd.pid</div><div class="line">lock file = /var/run/rsyncd.lock</div><div class="line">log file = /var/log/rsyncd.log</div><div class="line">ignore errors</div><div class="line">read only = false</div><div class="line">list = false</div><div class="line">hosts allow = 192.0.0.0/24</div><div class="line">hosts deny = 0.0.0.0/32</div><div class="line">auth users = rsync_backup</div><div class="line">secrets file = /etc/rsync.passwd</div><div class="line"> </div><div class="line">#####################</div><div class="line">[backup]</div><div class="line">comment = backup server</div><div class="line">path = /backup</div></pre></td></tr></table></figure></p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/4.png" alt=""></p>
<h1 id="5-服务端配置步骤"><a href="#5-服务端配置步骤" class="headerlink" title="5.服务端配置步骤"></a>5.服务端配置步骤</h1><h2 id="5-1-vim-etc-rsyncd-conf-加入一堆配置文件"><a href="#5-1-vim-etc-rsyncd-conf-加入一堆配置文件" class="headerlink" title="5.1.vim /etc/rsyncd.conf 加入一堆配置文件"></a>5.1.vim /etc/rsyncd.conf 加入一堆配置文件</h2><h2 id="5-2-创建rsync用户，及共享的目录-backup"><a href="#5-2-创建rsync用户，及共享的目录-backup" class="headerlink" title="5.2.创建rsync用户，及共享的目录/backup"></a>5.2.创建rsync用户，及共享的目录/backup</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">a)useradd rsync -s /sbin/nologin -M</div><div class="line">b)id rsync</div><div class="line">c)mkdir /backup</div><div class="line">d)chown -R rsync /backup</div><div class="line"></div><div class="line">#注意：这个用户（rsync）要和/etc/rsyncd.conf中的uid和gid对应，rsync服务账户要有对被同步目录(/backup)的写入更新权限。</div></pre></td></tr></table></figure>
<h2 id="5-3-创建密码文件"><a href="#5-3-创建密码文件" class="headerlink" title="5.3.创建密码文件"></a>5.3.创建密码文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">a)echo “rsync_backup:oldboy”&gt;/etc/rsync.password</div><div class="line">b)chmod 600 /etc/rsync.password</div></pre></td></tr></table></figure>
<h2 id="5-4rsync-–daemon"><a href="#5-4rsync-–daemon" class="headerlink" title="5.4rsync –daemon"></a>5.4rsync –daemon</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">a)netstat -lntup|grep rsync</div><div class="line">b)ps -ef|grep rsync|grep -v grep</div></pre></td></tr></table></figure>
<h2 id="5-5加入开机自启动"><a href="#5-5加入开机自启动" class="headerlink" title="5.5加入开机自启动"></a>5.5加入开机自启动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">a)echo “rsync --daemon” &gt;&gt;etc/rc.local</div><div class="line">b)cat /etc/rc.local</div></pre></td></tr></table></figure>
<h1 id="6-客户端配置"><a href="#6-客户端配置" class="headerlink" title="6.客户端配置"></a>6.客户端配置</h1><h2 id="6-1创建密码文件"><a href="#6-1创建密码文件" class="headerlink" title="6.1创建密码文件"></a>6.1创建密码文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">echo “oldboy”&gt;/etc/rsync.password</div><div class="line">chmod 600 /etc/rsync.password</div></pre></td></tr></table></figure>
<h2 id="6-2-rsync"><a href="#6-2-rsync" class="headerlink" title="6.2 rsync"></a>6.2 rsync</h2><h3 id="6-2-1-push-推"><a href="#6-2-1-push-推" class="headerlink" title="6.2.1 push(推)"></a>6.2.1 push(推)</h3><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/5.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rsync -avz /tmp/ rsync_backup@192.168.0.103::backup --password-file=/etc/rsync.password</div></pre></td></tr></table></figure>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/6.png" alt=""></p>
<h3 id="6-2-2-pull（拉）"><a href="#6-2-2-pull（拉）" class="headerlink" title="6.2.2 pull（拉）"></a>6.2.2 pull（拉）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rsync -avz rsync_backup@192.168.0.103::backup  /tmp/  --password-file=/etc/rsync.password</div></pre></td></tr></table></figure>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/7.png" alt=""></p>
<h3 id="6-2-3注意推拉都是客户端的操作"><a href="#6-2-3注意推拉都是客户端的操作" class="headerlink" title="6.2.3注意推拉都是客户端的操作"></a>6.2.3注意推拉都是客户端的操作</h3><h1 id="7-rsync常用参数"><a href="#7-rsync常用参数" class="headerlink" title="7. rsync常用参数"></a>7. rsync常用参数</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">-v --verbose 详细模式输出，传输时的进度等信息</div><div class="line">-z --compress 传输时进行压缩以提高传输效率，--compress-level=NUM可按级别压缩</div><div class="line">-a --archive 归档模式，表示以递归的方式传输文件，并保持所有文件属性。</div><div class="line">-r --recursive  对子目录以递归模式，及目录下的所有目录都同样传输，注意是小写r</div><div class="line">-t --time 保持文件时间属性</div><div class="line">-o --owner 保持文件属主信息</div><div class="line">-p --perms 保持文件权限</div><div class="line">-g --group 保持文件属组信息</div><div class="line">-P --progress 显示同步过程及传输时的进度等信息</div><div class="line">-D --device  保持设备文件信息</div><div class="line">-l --links  保持软链接</div><div class="line">-e --rsh=COMMAND 使用的信道协议，指定替代rsh的shell程序，例如：ssh</div><div class="line">-exclude=PATTERN 指定排除不需要传输的文件模式</div><div class="line">-exclude-from=file （文件名所在的目录文件）</div></pre></td></tr></table></figure>
<h2 id="7-1无差异同步（–delete）"><a href="#7-1无差异同步（–delete）" class="headerlink" title="7.1无差异同步（–delete）"></a>7.1无差异同步（–delete）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">rsync -avz  --delete  /tm/  rsync:rsync_backup@192.168.0.104/back  --password-file=/etc/rsync.password</div><div class="line">#本地有，远端就有，本地没有，就删除远端的</div><div class="line"></div><div class="line">/*</div><div class="line">使用--delete参数，一定要备份覆盖端的数据（备份服务端或者是客户端），这样避免将数据删除</div><div class="line">使用--delete很危险，慎用！</div><div class="line">*/</div></pre></td></tr></table></figure>
<h2 id="7-2-–exclude"><a href="#7-2-–exclude" class="headerlink" title="7.2 –exclude"></a>7.2 –exclude</h2><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/8.png" alt=""></p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/9.png" alt=""></p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/10.png" alt=""></p>
<p> 跨地域数据同步：1.使用一条专线连接两地或者2.使用VPN形成局域网，然后同步</p>
<h1 id="8-定时备份（cron-rsync）"><a href="#8-定时备份（cron-rsync）" class="headerlink" title="8.定时备份（cron + rsync）"></a>8.定时备份（cron + rsync）</h1><h2 id="8-1准备要同步的目录（ip-date-命名）"><a href="#8-1准备要同步的目录（ip-date-命名）" class="headerlink" title="8.1准备要同步的目录（ip+date 命名）"></a>8.1准备要同步的目录（ip+date 命名）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@nfs-server /]# mkdir /backup</div><div class="line">[root@nfs-server /]# mkdir /backup/`ifconfig eth0|awk -F &apos;[ :]+&apos; &apos;NR==2 &#123;print $4&#125;&apos;`_$(date +%F) -p</div></pre></td></tr></table></figure>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/11.png" alt=""></p>
<p>然后将ip+date的目录推到服务端即可</p>
<h2 id="8-2准备要同步的文件（目录下的文件）"><a href="#8-2准备要同步的文件（目录下的文件）" class="headerlink" title="8.2准备要同步的文件（目录下的文件）"></a>8.2准备要同步的文件（目录下的文件）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@nfs-server backup]# cp /var/spool/cron/root /backup/192.168.0.104_2016-07-29/cron_root_$(date +%F)</div></pre></td></tr></table></figure>
<h2 id="8-3通过脚本方式实现"><a href="#8-3通过脚本方式实现" class="headerlink" title="8.3通过脚本方式实现"></a>8.3通过脚本方式实现</h2><p>&emsp;将所有的脚本文件放在一个特定的目录下（这里是/server/scripts），这是一个好的习惯</p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/12.png" alt=""></p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/13.png" alt=""></p>
<h2 id="8-4测试脚本"><a href="#8-4测试脚本" class="headerlink" title="8.4测试脚本"></a>8.4测试脚本</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">/bin/sh /server/scripts/bak.sh</div></pre></td></tr></table></figure>
<h2 id="8-5写进定时任务"><a href="#8-5写进定时任务" class="headerlink" title="8.5写进定时任务"></a>8.5写进定时任务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">crontab -e</div><div class="line">00 01 * * * /bin/sh /server/scripts/bak.sh &gt;/dev/null 2&gt;&amp;1</div></pre></td></tr></table></figure>
<h1 id="9-排错"><a href="#9-排错" class="headerlink" title="9.排错"></a>9.排错</h1><h2 id="9-1rsync服务端排错思路"><a href="#9-1rsync服务端排错思路" class="headerlink" title="9.1rsync服务端排错思路"></a>9.1rsync服务端排错思路</h2><ol>
<li>查看rsync服务配置文件路径是否正确，正确的配置路径为：/etc/rsyncd.conf</li>
<li>查看配置文件里host alow ,host deny 允许的ip网段是否是允许客户端访问的ip网段</li>
<li>查看配置文件中path参数里的路径是否存在，权限是否正确（正常应为配置文件中的UID参数对应的属主和组）</li>
<li>查看rsync服务是否启动：ps -ef|grep rsync 端口是否存在：netstat -lntup|grep 873</li>
<li>查看iptables 防火墙和selinux是否开启允许rsync服务通过，也可考虑关闭</li>
<li>查看服务端rsync配置的密码文件是否为600的权限，密码文件格式是否正确，正确格式为：用户名：密码 ，文件路径和配置   文件里的secrect files 参数对应</li>
<li>如果是推送数据，要查看配置rsyncd.conf文件中用户是否对模块下的目录有可读的权限（chown -R rsync /backup）</li>
</ol>
<h2 id="9-2rsync客户端排错思路"><a href="#9-2rsync客户端排错思路" class="headerlink" title="9.2rsync客户端排错思路"></a>9.2rsync客户端排错思路</h2><ol>
<li>查看客户端rsync配置的密码文件是否为600的权限，密码文件的格式是否正确，注意：需要密码，并且和服务端的密码一致</li>
<li>使用Telnet连接rsync服务器的ip 地址 873端口：telnet 192.168.0.104 873</li>
<li>客户端执行命令是：rsync -avzP rsync_backup@192.168.0.104::backup/test/  /test/ –password-file=/etc/rsync.password</li>
</ol>
<h2 id="9-3常见的错误FAQ"><a href="#9-3常见的错误FAQ" class="headerlink" title="9.3常见的错误FAQ"></a>9.3常见的错误FAQ</h2><h3 id="9-3-1-auth-failed-on-module-xxxx"><a href="#9-3-1-auth-failed-on-module-xxxx" class="headerlink" title="9.3.1 auth failed on module xxxx"></a>9.3.1 auth failed on module xxxx</h3><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/14.png" alt=""></p>
<h3 id="9-3-2服务端没有指定共享目录（如：backup目录）"><a href="#9-3-2服务端没有指定共享目录（如：backup目录）" class="headerlink" title="9.3.2服务端没有指定共享目录（如：backup目录）"></a>9.3.2服务端没有指定共享目录（如：backup目录）</h3><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/15.png" alt=""></p>
<h3 id="9-3-3-password-file-must-not-be-other-accessible"><a href="#9-3-3-password-file-must-not-be-other-accessible" class="headerlink" title="9.3.3 password file must not be other-accessible"></a>9.3.3 password file must not be other-accessible</h3><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/16.png" alt=""></p>
<h3 id="9-3-4chroot-failed"><a href="#9-3-4chroot-failed" class="headerlink" title="9.3.4chroot failed"></a>9.3.4chroot failed</h3><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/17.png" alt=""></p>
<p>chown -R rsync /backup/</p>
<h3 id="9-3-5-从客户端推送报错"><a href="#9-3-5-从客户端推送报错" class="headerlink" title="9.3.5 从客户端推送报错"></a>9.3.5 从客户端推送报错</h3><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/18.png" alt=""></p>
<h3 id="9-3-6-客户端-ERROR：chdir-failed"><a href="#9-3-6-客户端-ERROR：chdir-failed" class="headerlink" title="9.3.6 客户端@ERROR：chdir failed"></a>9.3.6 客户端@ERROR：chdir failed</h3><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/19.png" alt=""></p>
<h3 id="9-3-7查看log"><a href="#9-3-7查看log" class="headerlink" title="9.3.7查看log"></a>9.3.7查看log</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat /var/log/rsyncd.log</div></pre></td></tr></table></figure>
<h1 id="10-优缺点"><a href="#10-优缺点" class="headerlink" title="10.优缺点"></a>10.优缺点</h1><blockquote>
<p>优点:</p>
</blockquote>
<ul>
<li>增量备份同步,支持socket(daeme),集中备份</li>
</ul>
<blockquote>
<p>缺点:</p>
</blockquote>
<ul>
<li>大量小文件同步的时候,比对时间较长,有的时候,rsync进程停止,解决:<br>a.打包同步,<br>b.drbd(文件系统复制block块)</li>
<li>同步大文件,10G这样的大文件有时也会有问题,中断,未完成同步前视隐藏文件,同步完成改为正常文件</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/Linux/rsync/rsync/" data-id="cj290sbsf00jpssqqby8hdtjc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rsync/">rsync</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Linux/rsync/inotify+rsync" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/Linux/rsync/inotify+rsync/" class="article-date">
  <time datetime="2017-04-16T04:47:25.587Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/inotify/">inotify</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/Linux/rsync/inotify+rsync/">inotify+rsync</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-应用场景：实现nfs数据的热备份"><a href="#1-应用场景：实现nfs数据的热备份" class="headerlink" title="1.应用场景：实现nfs数据的热备份"></a>1.应用场景：实现nfs数据的热备份</h1><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/inotify/1.png" alt=""></p>
<h1 id="2-原理"><a href="#2-原理" class="headerlink" title="2.原理"></a>2.原理</h1><p>inotify（sersync）工具会实时监控/data的增删改查，然后使用rsync进行同步，如下：</p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/inotify/2.png" alt=""></p>
<h1 id="3-在nfs上做一个rsync的客户端"><a href="#3-在nfs上做一个rsync的客户端" class="headerlink" title="3.在nfs上做一个rsync的客户端"></a>3.在nfs上做一个rsync的客户端</h1><h2 id="3-1创建-etc-rsync-password"><a href="#3-1创建-etc-rsync-password" class="headerlink" title="3.1创建/etc/rsync.password"></a>3.1创建/etc/rsync.password</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">echo chenyansong&gt;/etc/rsync.password</div><div class="line">  cat /etc/rsync.password</div><div class="line"> </div><div class="line">chmod 600 /etc/rsync.password</div><div class="line">  ll /etc/rsync.password</div></pre></td></tr></table></figure>
<h2 id="3-2推送-data数据"><a href="#3-2推送-data数据" class="headerlink" title="3.2推送/data数据"></a>3.2推送/data数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rsync -avz /data  rsync_backup@192.168.0.103::backup --password-file=/etc/rsync.password</div></pre></td></tr></table></figure>
<h1 id="4-安装inotify工具"><a href="#4-安装inotify工具" class="headerlink" title="4.安装inotify工具"></a>4.安装inotify工具</h1><p>&emsp;Inotify是一种强大的、细粒度的、异步的文件系统事件监控机制，Linux内核从2.6.13起，加入了Inotify的支持，通过Inotify可以监控文件系统中的添加、删除、修改等各种事件，利用这个内核接口，第三方软件就可以架空文件系统下文件的各种变化情况，而Inotify-tools真实实施这样监控的软件，类似的还有国人在金山公司开发的sersync</p>
<h2 id="4-1查看当前系统是否支持Inotify"><a href="#4-1查看当前系统是否支持Inotify" class="headerlink" title="4.1查看当前系统是否支持Inotify"></a>4.1查看当前系统是否支持Inotify</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">a. uname -r</div><div class="line"></div><div class="line">b. ls -l /proc/sys/fs/inotify/</div><div class="line"></div><div class="line">[root@lamp01 chenyansong]# ls -l /proc/sys/fs/inotify/</div><div class="line">总用量 0</div><div class="line">-rw-r--r-- 1 root root 0 2月  14 17:14 max_queued_events</div><div class="line">-rw-r--r-- 1 root root 0 2月  14 17:14 max_user_instances</div><div class="line">-rw-r--r-- 1 root root 0 2月  14 17:14 max_user_watches</div><div class="line"></div><div class="line">#显示上面三个文件则表示支持</div></pre></td></tr></table></figure>
<h2 id="4-2下载源码包"><a href="#4-2下载源码包" class="headerlink" title="4.2下载源码包"></a>4.2下载源码包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">wget https://github.com/downloads/rvoicilas/inotify-tools/inotify-tools-3.14.tar.gz</div><div class="line">#如果不行就直接将后面的地址放到浏览器中下载，然后通过win scp 上传即可</div></pre></td></tr></table></figure>
<h2 id="4-3解压安装"><a href="#4-3解压安装" class="headerlink" title="4.3解压安装"></a>4.3解压安装</h2><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/inotify/3.png" alt=""><br><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/inotify/4.png" alt=""><br><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/inotify/5.png" alt=""></p>
<h1 id="5-Inotify各个目录文件的含义"><a href="#5-Inotify各个目录文件的含义" class="headerlink" title="5.Inotify各个目录文件的含义"></a>5.Inotify各个目录文件的含义</h1><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/inotify/6.png" alt=""></p>
<h1 id="6-软件工具"><a href="#6-软件工具" class="headerlink" title="6.软件工具"></a>6.软件工具</h1><p>&emsp;一共安装了2个工具（命令），即inotifywait和inotifywatch<br>&emsp;inotifywait：在被监控的文件或目录上等待特定的文件系统事件（open,close,delete等）发生，执行后处于阻塞状态，适合在shell脚本中使用。<br>&emsp;inotifywatch：收集被监视的文件系统使用度统计数据，指文件系统事件发生的次数统计。</p>
<h2 id="6-1-inotifywait"><a href="#6-1-inotifywait" class="headerlink" title="6.1 inotifywait"></a>6.1 inotifywait</h2><h3 id="6-1-1查看帮助文档"><a href="#6-1-1查看帮助文档" class="headerlink" title="6.1.1查看帮助文档"></a>6.1.1查看帮助文档</h3><p>在/usr/local/inotify-tools 目录下 bin/inotifywait –help</p>
<h3 id="6-1-2inotifywait命令常用参数详解"><a href="#6-1-2inotifywait命令常用参数详解" class="headerlink" title="6.1.2inotifywait命令常用参数详解"></a>6.1.2inotifywait命令常用参数详解</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">-r --recursive #监视一个目录下的所有子目录</div><div class="line">-q --quiet  #打印很少的信息，仅仅打印监控事件的信息</div><div class="line">-m --monitor #始终保持事件的监听状态(接收到一个事情而不退出，无限期地执行。默认的行为是接收到一个事情后立即退出)</div><div class="line">-excludei  #排除文件或目录时不区分大小写</div><div class="line">-exclude   #排除文件或者目录,大小写敏感</div><div class="line">--timefmt  #指定时间的输出格式,用于–format选项中的%T格式</div><div class="line"> </div><div class="line">--format   #</div><div class="line">%w 表示发生事件的目录</div><div class="line">%f 表示发生事件的文件</div><div class="line">%e 表示发生的事件</div><div class="line">%Xe 事件以“X”分隔</div><div class="line">%T 使用由–timefmt定义的时间格式</div><div class="line"> </div><div class="line">-e    #指定监控事件，如果省略，所有的事件将被监控</div></pre></td></tr></table></figure>
<h3 id="6-1-3可以监听的事件：inotify-tools-bin-inotifywait-–help-中的-e-表示事件"><a href="#6-1-3可以监听的事件：inotify-tools-bin-inotifywait-–help-中的-e-表示事件" class="headerlink" title="6.1.3可以监听的事件：inotify-tools/bin/inotifywait –help  中的 -e 表示事件"></a>6.1.3可以监听的事件：inotify-tools/bin/inotifywait –help  中的 -e 表示事件</h3><table>
<thead>
<tr>
<th>access</th>
<th>文件读取</th>
</tr>
</thead>
<tbody>
<tr>
<td>modify</td>
<td>文件更改</td>
</tr>
<tr>
<td>attrib</td>
<td>文件属性更改，如权限，时间戳等</td>
</tr>
<tr>
<td>close_write</td>
<td>以可写模式打开的文件被关闭，不代表此文件一定已经写入数据</td>
</tr>
<tr>
<td>close_nowrite</td>
<td>以只读模式打开的文件被关闭</td>
</tr>
<tr>
<td>close</td>
<td>文件被关闭，不管它是如何打开的</td>
</tr>
<tr>
<td>open</td>
<td>文件打开</td>
</tr>
<tr>
<td>moved_to</td>
<td>一个文件或目录移动到监听的目录，即使是在同一目录内移动，此事件也触发</td>
</tr>
<tr>
<td>moved_from</td>
<td>一个文件或目录移出监听的目录，即使是在同一目录内移动，此事件也触发</td>
</tr>
<tr>
<td>move</td>
<td>包括moved_to和 moved_from</td>
</tr>
<tr>
<td>move_self</td>
<td>文件或目录被移除，之后不再监听此文件或目录。</td>
</tr>
<tr>
<td>create</td>
<td>文件或目录创建</td>
</tr>
<tr>
<td>delete</td>
<td>文件或目录删除</td>
</tr>
<tr>
<td>delete_self</td>
<td>文件或目录移除，之后不再监听此文件或目录</td>
</tr>
<tr>
<td>unmount</td>
<td>文件系统取消挂载，之后不再监听此文件系统。</td>
</tr>
</tbody>
</table>
<h3 id="6-1-4-写一个测试案例"><a href="#6-1-4-写一个测试案例" class="headerlink" title="6.1.4 写一个测试案例"></a>6.1.4 写一个测试案例</h3><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/inotify/7.png" alt=""></p>
<p>然后重新开启一个窗口：</p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/inotify/8.png" alt=""></p>
<p>打印结果如下：</p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/inotify/9.png" alt=""></p>
<h3 id="6-1-5-监控多个事件（-e）"><a href="#6-1-5-监控多个事件（-e）" class="headerlink" title="6.1.5 监控多个事件（-e）"></a>6.1.5 监控多个事件（-e）</h3><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/inotify/10.png" alt=""></p>
<h3 id="6-1-6写成shell-脚本"><a href="#6-1-6写成shell-脚本" class="headerlink" title="6.1.6写成shell 脚本"></a>6.1.6写成shell 脚本</h3><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/inotify/11.png" alt=""></p>
<p>放入后台(&amp;表示放入后台，这样就不会出现阻塞)</p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/inotify/12.png" alt=""></p>
<p>写入rc.local中去：</p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/inotify/13.png" alt=""></p>
<h2 id="6-2inotifywatch"><a href="#6-2inotifywatch" class="headerlink" title="6.2inotifywatch"></a>6.2inotifywatch</h2><p>自行Google</p>
<h1 id="7-优化"><a href="#7-优化" class="headerlink" title="7.优化"></a>7.优化</h1><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/inotify/14.png" alt=""><br><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/inotify/15.png" alt=""><br><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/rsync/inotify/16.png" alt=""></p>
<h1 id="8-优缺点"><a href="#8-优缺点" class="headerlink" title="8.优缺点"></a>8.优缺点</h1><blockquote>
<p>优点:</p>
</blockquote>
<ul>
<li>配合rsync实现实时数据同步</li>
</ul>
<blockquote>
<p>缺点:</p>
</blockquote>
<ul>
<li>如果并发大于200个文件(10-100K),同步就会有延迟</li>
<li>我们前面写的脚本,每次都是全部全部推送一次,但确实是增量的</li>
<li>监控到事件后,调用rsync同步是单进程的(加&amp;并发),sersync是多进程同步,既然有了inotify-tools,为什么还要开发sersync?<br>sersync功能多:1.配置文件,2.真正的守护进程socket,3.可以对失败文件定时重传,4,第三方的HTTP接口,5.默认多线程同步</li>
</ul>
<h1 id="9-数据实时同步方案"><a href="#9-数据实时同步方案" class="headerlink" title="9.数据实时同步方案"></a>9.数据实时同步方案</h1><p>drbd 是基于数据块的同步</p>
<p>高并发数据实时同步方案小结:</p>
<ul>
<li>inotify(sersync)+rsync 文件级别</li>
<li>drbd 文件系统级别</li>
<li>第三方软件的同步功能:mysql ,oracle,mongodb</li>
<li>程序双写</li>
<li>业务逻辑解决</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/Linux/rsync/inotify+rsync/" data-id="cj290sbsd00jmssqq567dekmo" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/inotify/">inotify</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Linux/nginx/配置虚拟主机" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/Linux/nginx/配置虚拟主机/" class="article-date">
  <time datetime="2017-04-16T04:47:25.583Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/nginx/">nginx</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/Linux/nginx/配置虚拟主机/">配置虚拟主机</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-配置文件的格式"><a href="#1-配置文件的格式" class="headerlink" title="1.配置文件的格式"></a>1.配置文件的格式</h1><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/nginx/virtual-host/1.png" alt=""></p>
<h1 id="2-搭建基于域名的多虚拟主机"><a href="#2-搭建基于域名的多虚拟主机" class="headerlink" title="2.搭建基于域名的多虚拟主机"></a>2.搭建基于域名的多虚拟主机</h1><h2 id="2-1-修改配置文件"><a href="#2-1-修改配置文件" class="headerlink" title="2.1.修改配置文件"></a>2.1.修改配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 nginx]# egrep  -v &quot;#|^$&quot; /application/nginx/conf/nginx.conf.default &gt;/application/nginx/conf/nginx.conf</div><div class="line"></div><div class="line"></div><div class="line">[root@lamp01 nginx]# cat ./conf/nginx.conf</div><div class="line">worker_processes  1;</div><div class="line">events &#123;</div><div class="line">    worker_connections  1024;</div><div class="line">&#125;</div><div class="line">http &#123;</div><div class="line">    include       mime.types;</div><div class="line">    default_type  application/octet-stream;</div><div class="line">    sendfile        on;</div><div class="line">    keepalive_timeout  65;</div><div class="line">    server &#123;</div><div class="line">        listen       80;</div><div class="line">        server_name  www.etiantian.org;        #域名</div><div class="line">        location / &#123;</div><div class="line">            root   html/www;        #www是服务的站点</div><div class="line">            index  index.html index.htm;</div><div class="line">        &#125;</div><div class="line">        error_page   500 502 503 504  /50x.html;</div><div class="line">        location = /50x.html &#123;</div><div class="line">            root   html;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    server &#123;</div><div class="line">        listen       80;</div><div class="line">        server_name  bbs.etiantian.org;         #域名</div><div class="line">        location / &#123;</div><div class="line">            root   html/bbs;        #服务站点</div><div class="line">            index  index.html index.htm;</div><div class="line">        &#125;</div><div class="line">        error_page   500 502 503 504  /50x.html;</div><div class="line">        location = /50x.html &#123;</div><div class="line">            root   html;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="2-2-创建站点目录"><a href="#2-2-创建站点目录" class="headerlink" title="2.2.创建站点目录"></a>2.2.创建站点目录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 nginx]# mkdir ./html/&#123;www,bbs&#125; -p</div></pre></td></tr></table></figure>
<h2 id="2-3-向站点目录中加入首页文件"><a href="#2-3-向站点目录中加入首页文件" class="headerlink" title="2.3.向站点目录中加入首页文件"></a>2.3.向站点目录中加入首页文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 nginx]# echo &quot;www.etiantian.org&quot;&gt; ./html/www/index.html</div><div class="line">[root@lamp01 nginx]# echo &quot;bbs.etiantian.org&quot;&gt; ./html/bbs/index.html  </div><div class="line"></div><div class="line">[root@lamp01 nginx]# cat ./html/&#123;www,bbs&#125;/index.html</div><div class="line">www.etiantian.org</div><div class="line">bbs.etiantian.org</div></pre></td></tr></table></figure>
<h2 id="2-4-检查语法"><a href="#2-4-检查语法" class="headerlink" title="2.4.检查语法"></a>2.4.检查语法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 nginx]# ./sbin/nginx -t</div><div class="line">nginx: the configuration file /application/nginx-1.6.3/conf/nginx.conf syntax is ok</div><div class="line">nginx: configuration file /application/nginx-1.6.3/conf/nginx.conf test is successful</div><div class="line">[root@lamp01 nginx]#</div></pre></td></tr></table></figure>
<h2 id="2-5-使配置文件生效"><a href="#2-5-使配置文件生效" class="headerlink" title="2.5.使配置文件生效"></a>2.5.使配置文件生效</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">#如果nginx没有启动,则:</div><div class="line">[root@lamp01 nginx]# /application/nginx/sbin/nginx</div><div class="line"></div><div class="line">#如果nginx已经启动,则</div><div class="line">[root@lamp01 nginx]# /application/nginx/sbin/nginx -s reload</div><div class="line"></div><div class="line">#检查</div><div class="line">[root@lamp01 nginx]# lsof -i:80</div><div class="line">COMMAND  PID  USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</div><div class="line">nginx   2016  root    6u  IPv4  14340      0t0  TCP *:http (LISTEN)</div><div class="line">nginx   2017 nginx    6u  IPv4  14340      0t0  TCP *:http (LISTEN)</div></pre></td></tr></table></figure>
<h2 id="2-6-加入-etc-hosts域名解析-使Linux本地也能访问"><a href="#2-6-加入-etc-hosts域名解析-使Linux本地也能访问" class="headerlink" title="2.6.加入/etc/hosts域名解析,使Linux本地也能访问"></a>2.6.加入/etc/hosts域名解析,使Linux本地也能访问</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 nginx]# cat /etc/hosts       </div><div class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4 www.etiantian.org</div><div class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</div><div class="line">127.0.0.1 www.etiantian.org bbs.etiantian.org    #添加</div><div class="line"></div><div class="line">#工作中只需要将域名解析成对应的公网IP即可使用</div><div class="line"></div><div class="line">#linux访问</div><div class="line">[root@lamp01 nginx]# curl www.etiantian.org</div><div class="line">www.etiantian.org</div><div class="line">[root@lamp01 nginx]# curl bbs.etiantian.org</div><div class="line">bbs.etiantian.org</div></pre></td></tr></table></figure>
<h2 id="2-7-在Windows的hosts文件修改-然后浏览器访问"><a href="#2-7-在Windows的hosts文件修改-然后浏览器访问" class="headerlink" title="2.7.在Windows的hosts文件修改,然后浏览器访问"></a>2.7.在Windows的hosts文件修改,然后浏览器访问</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hosts中添加上图中的：192.168.0.3 www.etiantian.org bbs.etiantian.org</div></pre></td></tr></table></figure>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/nginx/virtual-host/2.png" alt=""></p>
<p>如果我们直接输入ip地址，那么将直接显示第一个server<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 nginx]# curl 192.168.0.3</div><div class="line">www.etiantian.org</div></pre></td></tr></table></figure></p>
<h1 id="3-基于端口的多虚拟主机"><a href="#3-基于端口的多虚拟主机" class="headerlink" title="3.基于端口的多虚拟主机"></a>3.基于端口的多虚拟主机</h1><h2 id="3-1-修改配置文件"><a href="#3-1-修改配置文件" class="headerlink" title="3.1.修改配置文件"></a>3.1.修改配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 conf]# cat nginx.conf</div><div class="line">worker_processes  1;</div><div class="line">events &#123;</div><div class="line">    worker_connections  1024;</div><div class="line">&#125;</div><div class="line">http &#123;</div><div class="line">    include       mime.types;</div><div class="line">    default_type  application/octet-stream;</div><div class="line">    sendfile        on;</div><div class="line">    keepalive_timeout  65;</div><div class="line">    server &#123;</div><div class="line">        listen       8001;    #改成指定的端口</div><div class="line">        server_name  www.etiantian.org;</div><div class="line">        location / &#123;</div><div class="line">            root   html/www;</div><div class="line">            index  index.html index.htm;</div><div class="line">        &#125;</div><div class="line">        error_page   500 502 503 504  /50x.html;</div><div class="line">        location = /50x.html &#123;</div><div class="line">            root   html;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    server &#123;</div><div class="line">        listen       8002;     #改成指定的端口</div><div class="line">        server_name  bbs.etiantian.org;</div><div class="line">        location / &#123;</div><div class="line">            root   html/bbs;</div><div class="line">            index  index.html index.htm;</div><div class="line">        &#125;</div><div class="line">        error_page   500 502 503 504  /50x.html;</div><div class="line">        location = /50x.html &#123;</div><div class="line">            root   html;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">#就是将上面监听的端口修改成为我们指定的端口：如 listen   8001</div></pre></td></tr></table></figure>
<h2 id="3-2-检查语法"><a href="#3-2-检查语法" class="headerlink" title="3.2.检查语法"></a>3.2.检查语法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 conf]# ../sbin/nginx -t</div><div class="line">nginx: the configuration file /application/nginx-1.6.3/conf/nginx.conf syntax is ok</div><div class="line">nginx: configuration file /application/nginx-1.6.3/conf/nginx.conf test is successful</div></pre></td></tr></table></figure>
<h2 id="3-3-重启生效"><a href="#3-3-重启生效" class="headerlink" title="3.3.重启生效"></a>3.3.重启生效</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 conf]# ../sbin/nginx -s reload</div></pre></td></tr></table></figure>
<h2 id="3-4-使用netstat查看端口是否生效"><a href="#3-4-使用netstat查看端口是否生效" class="headerlink" title="3.4.使用netstat查看端口是否生效"></a>3.4.使用netstat查看端口是否生效</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 conf]# netstat -lntup|grep nginx</div><div class="line">tcp        0      0 0.0.0.0:8001                0.0.0.0:*                   LISTEN      2111/nginx         </div><div class="line">tcp        0      0 0.0.0.0:8002                0.0.0.0:*                   LISTEN      2111/nginx</div></pre></td></tr></table></figure>
<h2 id="3-5-测试"><a href="#3-5-测试" class="headerlink" title="3.5.测试"></a>3.5.测试</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 conf]# curl www.etiantian.org:8001</div><div class="line">www.etiantian.org</div><div class="line">[root@lamp01 conf]# curl bbs.etiantian.org:8002</div><div class="line">bbs.etiantian.org</div></pre></td></tr></table></figure>
<h1 id="4-基于IP的虚拟主机"><a href="#4-基于IP的虚拟主机" class="headerlink" title="4.基于IP的虚拟主机"></a>4.基于IP的虚拟主机</h1><h1 id="ip-addr-的使用"><a href="#ip-addr-的使用" class="headerlink" title="ip addr 的使用"></a>ip addr 的使用</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">man    ip</div><div class="line">ip addr &#123; add | del &#125; IFADDR dev STRING</div></pre></td></tr></table></figure>
<h2 id="4-1-添加一个ip地址"><a href="#4-1-添加一个ip地址" class="headerlink" title="4.1.添加一个ip地址"></a>4.1.添加一个ip地址</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 conf]# ip addr add 192.168.0.110/24 dev eth0</div><div class="line"></div><div class="line">[root@lamp01 conf]# ip addr</div><div class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN</div><div class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</div><div class="line">    inet 127.0.0.1/8 scope host lo</div><div class="line">    inet6 ::1/128 scope host</div><div class="line">       valid_lft forever preferred_lft forever</div><div class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</div><div class="line">    link/ether 00:0c:29:38:6a:b1 brd ff:ff:ff:ff:ff:ff</div><div class="line">    inet 192.168.0.3/24 brd 192.168.0.255 scope global eth0</div><div class="line">    inet 192.168.0.110/24 scope global secondary eth0</div><div class="line">    inet6 fe80::20c:29ff:fe38:6ab1/64 scope link</div><div class="line">       valid_lft forever preferred_lft forever</div></pre></td></tr></table></figure>
<h2 id="4-2-修改配置文件"><a href="#4-2-修改配置文件" class="headerlink" title="4.2.修改配置文件"></a>4.2.修改配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 conf]# cat nginx.conf</div><div class="line">worker_processes  1;</div><div class="line">events &#123;</div><div class="line">    worker_connections  1024;</div><div class="line">&#125;</div><div class="line">http &#123;</div><div class="line">    include       mime.types;</div><div class="line">    default_type  application/octet-stream;</div><div class="line">    sendfile        on;</div><div class="line">    keepalive_timeout  65;</div><div class="line">    server &#123;</div><div class="line">        listen       192.168.0.3:80;    #换成指定的ip</div><div class="line">        server_name  www.etiantian.org;</div><div class="line">        location / &#123;</div><div class="line">            root   html/www;</div><div class="line">            index  index.html index.htm;</div><div class="line">        &#125;</div><div class="line">        error_page   500 502 503 504  /50x.html;</div><div class="line">        location = /50x.html &#123;</div><div class="line">            root   html;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    server &#123;</div><div class="line">        listen      192.168.0.110:80;    #换成指定的ip</div><div class="line">        server_name  bbs.etiantian.org;</div><div class="line">        location / &#123;</div><div class="line">            root   html/bbs;</div><div class="line">            index  index.html index.htm;</div><div class="line">        &#125;</div><div class="line">        error_page   500 502 503 504  /50x.html;</div><div class="line">        location = /50x.html &#123;</div><div class="line">            root   html;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="4-3-检查语法"><a href="#4-3-检查语法" class="headerlink" title="4.3.检查语法"></a>4.3.检查语法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 conf]# ../sbin/nginx -t</div><div class="line">nginx: the configuration file /application/nginx-1.6.3/conf/nginx.conf syntax is ok</div><div class="line">nginx: configuration file /application/nginx-1.6.3/conf/nginx.conf test is successful</div></pre></td></tr></table></figure>
<h2 id="4-4-使配置文件生效"><a href="#4-4-使配置文件生效" class="headerlink" title="4.4.使配置文件生效"></a>4.4.使配置文件生效</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@lnmp02 conf]# ../sbin/nginx -s reload</div></pre></td></tr></table></figure>
<h2 id="4-5-修改-etc-hosts"><a href="#4-5-修改-etc-hosts" class="headerlink" title="4.5.修改/etc/hosts"></a>4.5.修改/etc/hosts</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#add</div><div class="line">192.168.0.3 www.etiantian.org</div><div class="line">192.168.0.110 bbs.etiantian.org</div></pre></td></tr></table></figure>
<h2 id="4-6-测试"><a href="#4-6-测试" class="headerlink" title="4.6.测试"></a>4.6.测试</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">[root@lamp01 conf]# netstat -lntup|grep nginx</div><div class="line">tcp        0      0 192.168.0.110:80            0.0.0.0:*                   LISTEN      2111/nginx         </div><div class="line">tcp        0      0 192.168.0.3:80              0.0.0.0:*                   LISTEN      2111/nginx         </div><div class="line"></div><div class="line">[root@lamp01 conf]# curl bbs.etiantian.org  </div><div class="line">bbs.etiantian.org</div><div class="line"></div><div class="line">[root@lamp01 conf]# curl www.etiantian.org  </div><div class="line">www.etiantian.org</div></pre></td></tr></table></figure>
<h1 id="5-为虚拟主机配置单独的配置文件"><a href="#5-为虚拟主机配置单独的配置文件" class="headerlink" title="5.为虚拟主机配置单独的配置文件"></a>5.为虚拟主机配置单独的配置文件</h1><h2 id="5-1-在主文件nginx-conf中添加include"><a href="#5-1-在主文件nginx-conf中添加include" class="headerlink" title="5.1.在主文件nginx.conf中添加include"></a>5.1.在主文件nginx.conf中添加include</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 conf]# cat nginx.conf</div><div class="line">worker_processes  1;</div><div class="line">events &#123;</div><div class="line">    worker_connections  1024;</div><div class="line">&#125;</div><div class="line">http &#123;</div><div class="line">    include       mime.types;</div><div class="line">    default_type  application/octet-stream;</div><div class="line">    sendfile        on;</div><div class="line">    keepalive_timeout  65;</div><div class="line">    #add include</div><div class="line">    include extra/www.conf</div><div class="line">    include extra/bbs.conf</div><div class="line">    include extra/blog.conf</div><div class="line"> </div><div class="line">&#125;</div><div class="line"></div><div class="line">/*</div><div class="line">    include extra/www.conf 是包含单个文件</div><div class="line">    include extra/*.conf 是包含extra下的所有以conf结尾的文件</div><div class="line">*/</div></pre></td></tr></table></figure>
<h2 id="5-2-添加目录extra"><a href="#5-2-添加目录extra" class="headerlink" title="5.2.添加目录extra"></a>5.2.添加目录extra</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#在conf目录下：</div><div class="line">mkdir extra</div></pre></td></tr></table></figure>
<h2 id="5-3-在每个配置文件中（如：extra-bbs-conf）添加如下"><a href="#5-3-在每个配置文件中（如：extra-bbs-conf）添加如下" class="headerlink" title="5.3.在每个配置文件中（如：extra/bbs.conf）添加如下"></a>5.3.在每个配置文件中（如：extra/bbs.conf）添加如下</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 extra]# cat bbs.conf</div><div class="line">    server &#123;</div><div class="line">        listen       80;</div><div class="line">        server_name  bbs.etiantian.org;</div><div class="line"> </div><div class="line">        location / &#123;</div><div class="line">            root   html/bbs;</div><div class="line">            index  index.html index.php index.htm;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h2 id="5-4-检查语法"><a href="#5-4-检查语法" class="headerlink" title="5.4.检查语法"></a>5.4.检查语法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@lnmp02 conf]# ../sbin/nginx -t</div></pre></td></tr></table></figure>
<h2 id="5-5-使配置生效"><a href="#5-5-使配置生效" class="headerlink" title="5.5.使配置生效"></a>5.5.使配置生效</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@lnmp02 conf]# ../sbin/nginx -s reload</div></pre></td></tr></table></figure>
<pre><code>server {
    listen       192.168.0.3:80;
    server_name  www.etiantian.org;
    location / {
        root   html/www;
        index  index.html index.htm;
    }
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   html;
    }
}
</code></pre><h1 id="6-为一个虚拟主机配置别名"><a href="#6-为一个虚拟主机配置别名" class="headerlink" title="6.为一个虚拟主机配置别名"></a>6.为一个虚拟主机配置别名</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">#别名就是：为一个虚拟主机配置多个访问的入口，如：www.baidu.com , baidu.com 都会跳转到百度的首页</div><div class="line"></div><div class="line">    server &#123;</div><div class="line">        listen       80;</div><div class="line">        server_name  www.etiantian.org etiantian.org ; </div><div class="line">        location / &#123;</div><div class="line">            root   html/www;</div><div class="line">            index  index.html index.htm;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">#应用场景：在别名可用用来区分多个不同的主机</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/Linux/nginx/配置虚拟主机/" data-id="cj290sbsb00jjssqqvfuulltc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Linux/nginx/nginx负载均衡" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/Linux/nginx/nginx负载均衡/" class="article-date">
  <time datetime="2017-04-16T04:47:25.581Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/nginx/">nginx</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/Linux/nginx/nginx负载均衡/">nginx负载均衡</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-官网中的模块"><a href="#1-官网中的模块" class="headerlink" title="1.官网中的模块"></a>1.官网中的模块</h1><p><a href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html" target="_blank" rel="external">http://nginx.org/en/docs/http/ngx_http_upstream_module.html</a></p>
<h1 id="2-环境准备"><a href="#2-环境准备" class="headerlink" title="2.环境准备"></a>2.环境准备</h1><p>2台lamp（都安装好nginx）<br>1台负载均衡（安装好nginx）</p>
<h1 id="3-配置一个简单的负载均衡配置文件"><a href="#3-配置一个简单的负载均衡配置文件" class="headerlink" title="3.配置一个简单的负载均衡配置文件"></a>3.配置一个简单的负载均衡配置文件</h1><p>创建一个最简的配置文件(去掉注释的部分)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">egrep -v &quot;#|^$&quot; /application/nginx/conf/nginx.conf.default &gt; /application/nginx/conf/nginx.conf</div></pre></td></tr></table></figure></p>
<p>在负载均衡服务器上的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[root@lb01 nginx]# cat /application/nginx/conf/nginx.conf</div><div class="line">worker_processes  1;</div><div class="line">events &#123;</div><div class="line">    worker_connections  1024;</div><div class="line">&#125;</div><div class="line">http &#123;</div><div class="line">    include       mime.types;</div><div class="line">    upstream www_server_pools &#123;</div><div class="line">        server 192.168.0.4:80;</div><div class="line">        server 192.168.0.3:80;</div><div class="line">    &#125;</div><div class="line">    server &#123;</div><div class="line">        listen  80;</div><div class="line">        server_name     www.etiantian.org;</div><div class="line">        location / &#123;</div><div class="line">                proxy_pass      http://www_server_pools;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="4-upstream中server后的参数"><a href="#4-upstream中server后的参数" class="headerlink" title="4.upstream中server后的参数"></a>4.upstream中server后的参数</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">    upstream www_server_pools &#123;</div><div class="line">        server 192.168.0.4:80 weight=1 max_fails=3;</div><div class="line">        server 192.168.0.3:80 backup;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">/*</div><div class="line">可用的参数说明:</div><div class="line">server 10.0.10.8:80      可以是ip或域名，端口不写，默认是80 ，高并发场景IP可换成域名，通过DNS做负载均衡</div><div class="line">weight=1                代表服务器的权重，默认是1，权重数字越大代表接受的请求越多</div><div class="line">max_fails=1         Nginx尝试连接后端主机失败的此时，这个值配合：proxy_next_upstream,fastcgi_netx_upstream  and    memcached_next_upstream 这三个参数使用，当Nginx接收到后端服务器返回这三个参数定义的状态码时，会将这个请求转发给正常工作的后端服务器，例如：404,502,503。默认值1，企业场景：建议2-3次，根据业务去配置</div><div class="line">backup            就是在所有的server都不可用时，才使用backup服务器，就相当于备胎, 当算法为ip_hash的时候，后端算法不能是weight和backup，因为他直接根据ip就决定访问哪台服务器了，就不用weight和backup来决定访问</div><div class="line">fail_timeout=10s      在max_fails定义的失败次数后,距离下次检查的间隔时间,默认是10s,如果max_fails是5,他就检查5次,如果5次都是502,那么,他就会根据fail_timeout的值,等待10s再去检查,还是只检查一次,如果持续502,在不重新加载nginx配置的情况下,每隔10s都只检测一次,常规业务2-3秒比较合理,比如京东3秒,蓝汛3秒,可根据业务需求去配置</div><div class="line">down      这标志着服务器永远不可用,这个参数可配合ip_hash使用</div><div class="line">max_conns=number      单个RS最大并发连接数限制,防止请求过载,保护节点服务器</div><div class="line">route      设置server路由的名字</div><div class="line">slow_start=time      宕机的服务器从恢复开始,多长时间内被认为是健康的</div><div class="line"></div><div class="line"></div><div class="line">*/</div></pre></td></tr></table></figure>
<h1 id="5-upstream调度算法"><a href="#5-upstream调度算法" class="headerlink" title="5.upstream调度算法"></a>5.upstream调度算法</h1><p>&emsp;调度算法一般分为两类:第一类为静态调度算法,即负载均衡器更具自身设定的规则进行分配,不需要考虑后端节点服务器的情况,例如:rr, wrr, ip_hash等都属于静态调度算法<br>&emsp;第二类为动态调度算法,即:负载均衡器会根据后端节点的当前状态来决定是否分发请求,例如:连接数少的优先获得请求,相应时间短的获得请求,例如:least_conn,    fair等都属于动态调度算法</p>
<h2 id="5-1-rr轮询-默认调度算法-静态调度算法"><a href="#5-1-rr轮询-默认调度算法-静态调度算法" class="headerlink" title="5.1.rr轮询(默认调度算法,静态调度算法)"></a>5.1.rr轮询(默认调度算法,静态调度算法)</h2><p>&emsp;rr ；你一个，我一个，你一个，我一个<br>&emsp;按客户端请求顺序把客户端的请求逐一分配到不同的后端节点服务器,这相当于LVS中的rr算法,如果侯丹节点服务器宕机(默认情况下nginx只检测80端口),宕机的服务器会被自动从节点服务器池中剔除,以使客户端用户访问不受影响,新的请求会分配给正常的服务器</p>
<h2 id="5-2-wrr-权重轮询-静态调度算法"><a href="#5-2-wrr-权重轮询-静态调度算法" class="headerlink" title="5.2.wrr(权重轮询,静态调度算法)"></a>5.2.wrr(权重轮询,静态调度算法)</h2><p>&emsp;在rr轮询的基础上加上权重,即为权重轮询算法,当使用该算法时,权重和用户访问成正比,权重值越大,被访问的请求也就越多,可以根据服务器的配置和性能指定权重值大小,可以有效解决新旧服务器性能不均带来的请求分配问题<br>&emsp;举个例子:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">后端服务器:192.168.1.2的配置为: E5520*2CPU, 8GB内存</div><div class="line">后端服务器:192.168.1.3的配置为: Xeon(TM)2.80GHz*2, 4GB内存</div><div class="line">假设希望在有30个请求到达前端时,其中20个请求交给192.168.1.3处理,剩余10个交给192.168.1.2</div></pre></td></tr></table></figure></p>
<h2 id="5-3-ip-hash-静态调度算法"><a href="#5-3-ip-hash-静态调度算法" class="headerlink" title="5.3.ip_hash(静态调度算法)"></a>5.3.ip_hash(静态调度算法)</h2><p>&emsp;每个请求按客户端IP的hash结果分配,当新的请求到达时,先将其客户端ip通过哈希算法哈希出一个值,在随后的客户端请求中,客户IP的哈希值只要相同,机会被分配至同一台服务器,该调度算法可以解决动态网页的session共享问题,但有时会导致请求分配不均,即无法保证1:1的负载均衡,因为在国内大多数公司都是NAT上网模式,多个客户端会对应一个外部IP,所以这些客户端都会被分配到同一节点服务器,从而导致请求分配不均</p>
<h2 id="5-4-fair-动态调度算法"><a href="#5-4-fair-动态调度算法" class="headerlink" title="5.4.fair(动态调度算法)"></a>5.4.fair(动态调度算法)</h2><p>fair：谁响应快就给谁发<br>&emsp;此算法会根据后端节点服务器的相应时间来分配请求,响应时间短的优先分配<br>&emsp;这是更加智能的调度算法,此种算法可以依据页面大小和加载时间长短智能的进行负载均衡,也就是根据后端服务器的响应时间来分配请求,响应时间短的优先分配,Nginx本身不支持fair调度算法,如果需要使用这种调度算法,必须下载Nginx的相关模块upstream_fair </p>
<h2 id="5-5-least-conn"><a href="#5-5-least-conn" class="headerlink" title="5.5.least_conn"></a>5.5.least_conn</h2><p>least_conn ：谁最少连接数，就给谁发<br>&emsp;least_conn算法会根据后端节点的连接数来决定分配情况,哪个机器连接数少就分发,此外还有一些第三方的调度算法,例如:url_hash, 一致性HASH算法等</p>
<h2 id="5-6-url-hash算法"><a href="#5-6-url-hash算法" class="headerlink" title="5.6.url_hash算法"></a>5.6.url_hash算法</h2><p>&emsp;和ip_hash类似,这里是根据访问url的hash结果来分配请求的,让每个url定向到同一个后端服务器,后端服务器为缓存服务器时效果显著,在upstream中加入hash语句,server语句中不能写入weight等其他的参数,hash_methodshiyo使用的是hash算法<br>&emsp;url_hash按访问url的hash结果来分配请求,使每个url定向到同一个后端服务器,可以进一步提高后端缓存服务器的效率命中率,Nginx本身不支持url_hash的,如果需要使用这种调度算法,必须安装Nginx的hash软件包</p>
<p>url_hash的问题<br>&emsp;当新增服务器或者是一个缓存服务器挂了，那么url_hash将重新排列，此时原先的缓存服务器中的缓存的数据就无效了，因为可能重新排过的url，将不会找原来的服务器了，因为根据服务器的数据来取模，然后找对应的服务器，如果数量变了，那么取模之后找的服务器就会变，所以原来的缓存将会失效</p>
<h2 id="5-7-一致性HASH算法"><a href="#5-7-一致性HASH算法" class="headerlink" title="5.7.一致性HASH算法"></a>5.7.一致性HASH算法</h2><p>&emsp;一致性HASH算法一般用于代理后端业务为缓存服务的场景,通过将用户请求的URI或者指定字符串进行计算,然后调度到后端的服务器上,此后任何用户查找同一个URI都会被调度到这一台服务器上,因此后端的每个节点缓存的内容都是不同的,一致性HASH算法可以让后端某个或几个节点宕机后,缓存的数据动荡的最小</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/Linux/nginx/nginx负载均衡/" data-id="cj290sbs800jgssqq8ld1buek" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Linux/nginx/nginx缓存" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/Linux/nginx/nginx缓存/" class="article-date">
  <time datetime="2017-04-16T04:47:25.580Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/nginx/">nginx</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/Linux/nginx/nginx缓存/">nginx缓存</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>参见:</p>
<p><a href="https://linux.cn/article-7726-1.html" target="_blank" rel="external">https://linux.cn/article-7726-1.html</a></p>
<p><a href="http://seanlook.com/2015/06/02/nginx-cache-check/" target="_blank" rel="external">http://seanlook.com/2015/06/02/nginx-cache-check/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/Linux/nginx/nginx缓存/" data-id="cj290sbs500jdssqqc02qqdqa" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Linux/nginx/Nginx状态码" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/Linux/nginx/Nginx状态码/" class="article-date">
  <time datetime="2017-04-16T04:47:25.575Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/nginx/">nginx</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/Linux/nginx/Nginx状态码/">Nginx状态码</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>nginx 403 forbidden</p>
<p>引起nginx 403 forbidden有二种原因，一是缺少索引文件，二权限问题。</p>
<blockquote>
<p>缺少index.html或者index.php文件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">server &#123; </div><div class="line"> listen       80; </div><div class="line"> server_name  localhost; </div><div class="line"> index  index.php index.html; </div><div class="line"> root  /home/zhangy/www; </div><div class="line"></div><div class="line">#如果在/home/zhang/www下面没有index.php,index.html的时候，直接访问域名，找不到文件，会报403 forbidden。例如：你访问www.test.com而这个域名，对应的root指定的索引文件不存在。</div></pre></td></tr></table></figure>
<blockquote>
<p>权限问题</p>
</blockquote>
<p>因为权限问题引起的403，个人觉得比较难查找，因为一时想不起<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">server &#123; </div><div class="line"> listen       80; </div><div class="line"> server_name  localhost; </div><div class="line"> index  index.php index.html; </div><div class="line"> root  /home/zhangy/www; </div><div class="line"></div><div class="line">#我把web目录放在用户的所属目录下面，nginx的启动用户默认是nginx的，所以对目录根本没有读的权限，这样就会报403错误了。这个时候，把web目录的权限改大，或者是把nginx的启动用户改成目录的所属用户，重起一下就能解决。</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/Linux/nginx/Nginx状态码/" data-id="cj290sbrk00inssqq5gky2epb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Linux/nginx/Nginx日志" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/Linux/nginx/Nginx日志/" class="article-date">
  <time datetime="2017-04-16T04:47:25.574Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/nginx/">nginx</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/Linux/nginx/Nginx日志/">Nginx日志</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-错误日志"><a href="#1-错误日志" class="headerlink" title="1.错误日志"></a>1.错误日志</h1><h2 id="1-1-语法"><a href="#1-1-语法" class="headerlink" title="1.1.语法"></a>1.1.语法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">error_log  file   level;</div><div class="line">#关键字   日志文件 错误日志级别</div></pre></td></tr></table></figure>
<h2 id="1-2-常见的错误日遏制级别"><a href="#1-2-常见的错误日遏制级别" class="headerlink" title="1.2.常见的错误日遏制级别"></a>1.2.常见的错误日遏制级别</h2><p>&emsp;有【debug|info|notice|warn|error|crit|alert|emerg】从左到右，级别越高，记录的信息越少，一般情况下是warn|error| crit这三个级别之一，注意在生产环境中不要配置info等低级别，会带来大的磁盘I/O消耗</p>
<h2 id="1-3-默认值"><a href="#1-3-默认值" class="headerlink" title="1.3.默认值"></a>1.3.默认值</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#default：error_log logs/error.log error;</div></pre></td></tr></table></figure>
<h2 id="1-4-可以放置的标签段为"><a href="#1-4-可以放置的标签段为" class="headerlink" title="1.4.可以放置的标签段为"></a>1.4.可以放置的标签段为</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#context：main , http, server,  location</div></pre></td></tr></table></figure>
<h1 id="2-访问日志"><a href="#2-访问日志" class="headerlink" title="2.访问日志"></a>2.访问日志</h1><h2 id="2-1-日志格式log-format"><a href="#2-1-日志格式log-format" class="headerlink" title="2.1.日志格式log_format"></a>2.1.日志格式log_format</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#他属于http_log_module模块</div><div class="line">http://nginx.org/en/docs/http/ngx_http_log_module.html</div></pre></td></tr></table></figure>
<h3 id="2-1-1-格式及各个字段的含义"><a href="#2-1-1-格式及各个字段的含义" class="headerlink" title="2.1.1.格式及各个字段的含义"></a>2.1.1.格式及各个字段的含义</h3><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/nginx/log/1.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line">$remote_addr   与$http_x_forwarded_for 用以记录客户端的ip地址；</div><div class="line">$remote_user   ：用来记录客户端用户名称；</div><div class="line">$time_local  ： 用来记录访问时间与时区； </div><div class="line">$request  ：  用来记录请求的url与http协议；</div><div class="line">$status     ：  用来记录请求状态；成功是200，</div><div class="line">$body_bytes_s ent  ：记录发送给客户端文件主体内容大小；</div><div class="line">$http_referer  ：用来记录从那个页面链接访问过来的；</div><div class="line">$http_user_agent  ：记录客户毒啊浏览器的相关信息；</div><div class="line"> </div><div class="line">-：空白，用一个“-”占位符替代，历史原因导致还存在。</div><div class="line"> </div><div class="line">$http_x_forwarded_for  当前端有代理服务器时，设置Web节点记录客户端地址的配置，此参数生效的前提是代理服务器上也要有进行相关的x_forwarded_for设置。</div><div class="line"></div><div class="line">*/</div></pre></td></tr></table></figure>
<h3 id="2-1-2-一条日志的例子"><a href="#2-1-2-一条日志的例子" class="headerlink" title="2.1.2.一条日志的例子"></a>2.1.2.一条日志的例子</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">192.168.1.102 - scq2099yt [18/Mar/2013:23:30:42 +0800] &quot;GET /stats/awstats.pl?config=scq2099yt HTTP/1.1&quot; 200 899 &quot;http://192.168.1.1/pv/&quot; &quot;Mozilla/4.0 (compatible; MSIE 6.0; Windows XXX; Maxthon)&quot;</div></pre></td></tr></table></figure>
<h3 id="2-1-3-注意事项"><a href="#2-1-3-注意事项" class="headerlink" title="2.1.3.注意事项"></a>2.1.3.注意事项</h3><p>需要注意的是：log_format配置必须放在http内，否则会出现如下警告信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nginx: [warn] the &quot;log_format&quot; directive may be used only on &quot;http&quot; level in /etc/nginx/nginx.conf:97</div></pre></td></tr></table></figure></p>
<h2 id="2-2-access-log"><a href="#2-2-access-log" class="headerlink" title="2.2.access_log"></a>2.2.access_log</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Syntax: access_log path [format [buffer=size] [gzip[=level]] [flush=time] [if=condition]];</div><div class="line">access_log off;     #表示不记录访问日志</div><div class="line"></div><div class="line">#默认配置:  access_log logs/access.log combined;</div><div class="line"></div><div class="line">#可以放置的位置: http, server, location, if in location, limit_except</div><div class="line">#参数说明：buffer=size 为存放访问日志的缓冲区大小，flush=time为将缓冲区的日志刷到磁盘的时间，gzip[=level]表示压缩的级别，</div><div class="line">#一般将访问日志放在对应的虚拟主机下，这样不同的站点有不同的访问日志，我们可以更好的统计</div></pre></td></tr></table></figure>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/nginx/log/2.png" alt=""><br><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/nginx/log/3.png" alt=""></p>
<h1 id="3-日志轮询shell脚本"><a href="#3-日志轮询shell脚本" class="headerlink" title="3.日志轮询shell脚本"></a>3.日志轮询shell脚本</h1><p>&emsp;思想：就是写一个shell脚本，然后将对应虚拟主机的访问日志，改名，改成带时间戳的文件名，然后重启Nginx，这样就又会生成一个对应虚拟主机的访问日志文件</p>
<h2 id="3-1-写shell脚本"><a href="#3-1-写shell脚本" class="headerlink" title="3.1.写shell脚本"></a>3.1.写shell脚本</h2><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/nginx/log/4.png" alt=""><br><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/nginx/log/5.png" alt=""></p>
<h2 id="3-2-测试"><a href="#3-2-测试" class="headerlink" title="3.2.测试"></a>3.2.测试</h2><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/nginx/log/6.png" alt=""><br><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/nginx/log/7.png" alt=""><br><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/nginx/log/8.png" alt=""></p>
<h2 id="3-3-定时任务"><a href="#3-3-定时任务" class="headerlink" title="3.3.定时任务"></a>3.3.定时任务</h2><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/nginx/log/9.png" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/Linux/nginx/Nginx日志/" data-id="cj290sbrf00iissqqhltc7wl9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Linux/nginx/nginx实现动静分离" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/Linux/nginx/nginx实现动静分离/" class="article-date">
  <time datetime="2017-04-16T04:47:25.572Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/nginx/">nginx</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/Linux/nginx/nginx实现动静分离/">nginx实现动静分离</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-应用场景"><a href="#1-应用场景" class="headerlink" title="1.应用场景"></a>1.应用场景</h1><p>&emsp;在企业中，有事希望只用一个域名对外提供服务，不希望使用多个域名对应同一个产品业务，此时就需要在代理服务器上通过配置规则，使得匹配不同规则的请求会交给不同的服务器池处理，这类业务有：</p>
<ol>
<li>业务的域名没有拆分或者不希望拆分，但是希望实现动静分离，多业务分离。</li>
<li>不同的客户端设备（例如：手机和PC端）使用同一个域名访问同一个业务网站，就需要根据规则将不同设备的用户请求交给后端不同的服务器处理，以便得到最佳的用户体验。</li>
</ol>
<h1 id="2-拆分"><a href="#2-拆分" class="headerlink" title="2.拆分"></a>2.拆分</h1><p>&emsp;将文件上传程序、动态web程序和静态数据请求程序分别放在不同的服务器中，这样实现业务拆分上传服务器：将上传文件的地址放到数据库中，将文件存储到NFS中</p>
<ul>
<li>动态web服务器：直接和数据库打交道</li>
<li>静态数据请求服务器：直接请求NFS数据</li>
</ul>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/nginx/static-dam/1.png" alt="图片来自老男孩"></p>
<h1 id="3-程序没有拆分"><a href="#3-程序没有拆分" class="headerlink" title="3.程序没有拆分"></a>3.程序没有拆分</h1><p>&emsp;如果：文件上传程序、动态web程序和静态数据请求程序没有拆分，那么将所有的程序在下面三种服务器中都存放一份，然后，对于负载均衡器中的请求，要根据条件过滤是找静态数据请求服务器，还是找动态程序服务器（此时上传程序和动态web程序一起了）</p>
<h1 id="4-实战1"><a href="#4-实战1" class="headerlink" title="4.实战1"></a>4.实战1</h1><h2 id="4-1-先进行企业案例需求梳理"><a href="#4-1-先进行企业案例需求梳理" class="headerlink" title="4.1.先进行企业案例需求梳理"></a>4.1.先进行企业案例需求梳理</h2><ol>
<li>当用户请求www.etiantian.org/upload/xx地址时实现由upload上传服务器池处理请求</li>
<li>当用户请求www.etiantian.org/static/xx地址时实现由静态服务器池处理请求</li>
<li>除此之外，对于其他访问请求，全都由默认的动态服务器池处理请求</li>
</ol>
<h2 id="4-2配置说明"><a href="#4-2配置说明" class="headerlink" title="4.2配置说明"></a>4.2配置说明</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">#static_pools 为静态服务器池，有一个服务器，地址为10.0.0.9，端口为80</div><div class="line">upload static_pools &#123;</div><div class="line">    server 10.0.0.9:80 weight=1</div><div class="line">&#125;</div><div class="line"></div><div class="line">#upload_pools为上传服务器池，有一个服务器，地址为10.0.0.10，端口为80</div><div class="line">upload upload_pools &#123;</div><div class="line">    server 10.0.0.10:80 weight=1</div><div class="line">&#125;</div><div class="line"></div><div class="line">#default_pools为动态服务器池，有一个服务器，地址为10.0.0.9，端口为8000</div><div class="line">upload default_pools &#123;</div><div class="line">    server 10.0.0.9:8000 weight=1</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/nginx/static-dam/2.png" alt=""></p>
<h2 id="4-3-location正则匹配"><a href="#4-3-location正则匹配" class="headerlink" title="4.3.location正则匹配"></a>4.3.location正则匹配</h2><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/nginx/static-dam/3.png" alt=""></p>
<h2 id="4-4-if判断"><a href="#4-4-if判断" class="headerlink" title="4.4.if判断"></a>4.4.if判断</h2><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/nginx/static-dam/4.png" alt=""></p>
<h1 id="5-实战2"><a href="#5-实战2" class="headerlink" title="5.实战2"></a>5.实战2</h1><h2 id="5-1根据PC端浏览器的不同设置对应的匹配规则"><a href="#5-1根据PC端浏览器的不同设置对应的匹配规则" class="headerlink" title="5.1根据PC端浏览器的不同设置对应的匹配规则"></a>5.1根据PC端浏览器的不同设置对应的匹配规则</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">location / &#123;</div><div class="line">   if ($http_user_agent ~* “MSIE”)&#123;   #如果请求的浏览器为IE（MSIE），请求有static_pools池处理</div><div class="line">         proxy_pass http://static_pools;</div><div class="line">      &#125;</div><div class="line">   if ($http_user_agent ~* “Chrome”)&#123;    #如果请求的浏览器为谷歌，请求有upload_pools池处理</div><div class="line">         proxy_pass http://upload_pools;</div><div class="line">      &#125;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">#$http_user_agent  是客户端代理，即客户端是使用的什么来访问的</div></pre></td></tr></table></figure>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/nginx/static-dam/5.png" alt=""></p>
<h2 id="5-2根据移动端设备拆分"><a href="#5-2根据移动端设备拆分" class="headerlink" title="5.2根据移动端设备拆分"></a>5.2根据移动端设备拆分</h2><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/nginx/static-dam/6.png" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/Linux/nginx/nginx实现动静分离/" data-id="cj290sbs200j9ssqq5elif4k7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/25/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><a class="page-number" href="/page/25/">25</a><span class="page-number current">26</span><a class="page-number" href="/page/27/">27</a><a class="page-number" href="/page/28/">28</a><span class="space">&hellip;</span><a class="page-number" href="/page/58/">58</a><a class="extend next" rel="next" href="/page/27/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/IDEA/">IDEA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/NFS/">NFS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tachyon/">Tachyon</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/azkaban/">azkaban</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/echarts/">echarts</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/flume/">flume</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/">hadoop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hbase/">hbase</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hive/">hive</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/inotify/">inotify</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/kafka/">kafka</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/logstash/">logstash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/markdown/">markdown</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/memcached/">memcached</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/project/">project</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/rsync/">rsync</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/scala/">scala</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/shell/">shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/socket/">socket</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/spark/">spark</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/sqoop/">sqoop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/storm/">storm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据仓库/">数据仓库</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDEA/">IDEA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux基础命令/">Linux基础命令</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux重要配置文件/">Linux重要配置文件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NFS/">NFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NIO/">NIO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azkaban/">azkaban</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/echarts/">echarts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flume/">flume</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hadoop/">hadoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hbase/">hbase</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hive/">hive</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/inotify/">inotify</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/">kafka</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logstash/">logstash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mapreduce/">mapreduce</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/memcached/">memcached</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/netty/">netty</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/project/">project</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rpc/">rpc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rsync/">rsync</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala/">scala</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala函数式编程/">scala函数式编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala编程/">scala编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socket/">socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spark/">spark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqoop/">sqoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/storm/">storm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zookeeper/">zookeeper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据仓库/">数据仓库</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/IDEA/" style="font-size: 10px;">IDEA</a> <a href="/tags/Linux基础命令/" style="font-size: 19.52px;">Linux基础命令</a> <a href="/tags/Linux重要配置文件/" style="font-size: 14.76px;">Linux重要配置文件</a> <a href="/tags/NFS/" style="font-size: 10px;">NFS</a> <a href="/tags/NIO/" style="font-size: 11.43px;">NIO</a> <a href="/tags/azkaban/" style="font-size: 10.48px;">azkaban</a> <a href="/tags/echarts/" style="font-size: 10.95px;">echarts</a> <a href="/tags/flume/" style="font-size: 10.95px;">flume</a> <a href="/tags/hadoop/" style="font-size: 18.57px;">hadoop</a> <a href="/tags/hbase/" style="font-size: 13.33px;">hbase</a> <a href="/tags/hive/" style="font-size: 18.1px;">hive</a> <a href="/tags/inotify/" style="font-size: 10px;">inotify</a> <a href="/tags/java/" style="font-size: 12.38px;">java</a> <a href="/tags/kafka/" style="font-size: 12.86px;">kafka</a> <a href="/tags/linux/" style="font-size: 13.33px;">linux</a> <a href="/tags/logstash/" style="font-size: 10.48px;">logstash</a> <a href="/tags/mapreduce/" style="font-size: 16.67px;">mapreduce</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/memcached/" style="font-size: 13.81px;">memcached</a> <a href="/tags/mongodb/" style="font-size: 14.76px;">mongodb</a> <a href="/tags/mysql/" style="font-size: 17.14px;">mysql</a> <a href="/tags/netty/" style="font-size: 10.95px;">netty</a> <a href="/tags/nginx/" style="font-size: 14.29px;">nginx</a> <a href="/tags/project/" style="font-size: 10.48px;">project</a> <a href="/tags/python/" style="font-size: 19.05px;">python</a> <a href="/tags/redis/" style="font-size: 17.14px;">redis</a> <a href="/tags/rpc/" style="font-size: 10.48px;">rpc</a> <a href="/tags/rsync/" style="font-size: 10px;">rsync</a> <a href="/tags/scala/" style="font-size: 17.62px;">scala</a> <a href="/tags/scala函数式编程/" style="font-size: 11.9px;">scala函数式编程</a> <a href="/tags/scala编程/" style="font-size: 15.71px;">scala编程</a> <a href="/tags/shell/" style="font-size: 17.62px;">shell</a> <a href="/tags/socket/" style="font-size: 11.9px;">socket</a> <a href="/tags/spark/" style="font-size: 20px;">spark</a> <a href="/tags/sqoop/" style="font-size: 10.95px;">sqoop</a> <a href="/tags/storm/" style="font-size: 15.24px;">storm</a> <a href="/tags/zookeeper/" style="font-size: 16.19px;">zookeeper</a> <a href="/tags/数据仓库/" style="font-size: 11.43px;">数据仓库</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/05/02/bigdata/spark从入门到精通_笔记/Tachyon/">Tachyon</a>
          </li>
        
          <li>
            <a href="/2017/04/30/数据仓库/数据仓库2/">数据仓库</a>
          </li>
        
          <li>
            <a href="/2017/04/29/IDEA/IDEA/">IDEA</a>
          </li>
        
          <li>
            <a href="/2017/04/29/数据仓库/ETL/">ETL</a>
          </li>
        
          <li>
            <a href="/2017/04/28/数据仓库/PowderDesigner/">PowderDesigner的使用</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Mr. Chen<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>




  </div>
</body>
</html>