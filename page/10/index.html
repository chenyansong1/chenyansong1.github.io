<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="一个技术渣的自说自话">
<meta property="og:type" content="website">
<meta property="og:title" content="Chen's Blog">
<meta property="og:url" content="http://yoursite.com/page/10/index.html">
<meta property="og:site_name" content="Chen's Blog">
<meta property="og:description" content="一个技术渣的自说自话">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chen's Blog">
<meta name="twitter:description" content="一个技术渣的自说自话">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"always","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/10/"/>





  <title> Chen's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Chen's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">一个技术渣的自说自话</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/python/python网络编程之TCP客户端和服务端实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/python/python网络编程之TCP客户端和服务端实现/" itemprop="url">
                  python网络编程之TCP客户端和服务端实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-socket模块"><a href="#1-socket模块" class="headerlink" title="1.socket模块"></a>1.socket模块</h1><ul>
<li>创建socket： int socket(int domain, int type int protocol)</li>
<li>domain：协议域，决定了socket的地址类型，在通信中必须采用对应的地址<br>AF_INET:ipv4协议，ipv4地址与端口号组合(AF:address family)<br>AF_LOCAL：使用一个绝对路径名作为地址（进程间通信）<br>AF_PACKET：来处理以太网包，他能修改以太网包头</li>
<li>type：socket类型：<br>SOCK_STREAM：TCP套接字<br>SOCK_DGRAM：UDP套接字<br>SOCK_RAW：原始套接字</li>
<li>protocol：指定协议，常用协议有IPPROTO_TCP/IPPROTO_UDP、分别对应tcp传输协议、udp传输协议</li>
<li>type和protocol不能随意组合，第三个参数不设置的时候，默认为何第二个参数对应的协议一致</li>
</ul>
<h1 id="2-socket中常用方法"><a href="#2-socket中常用方法" class="headerlink" title="2.socket中常用方法"></a>2.socket中常用方法</h1><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>ss = socket(family,type[,proto])</td>
<td>创建一个套接字，返回一个socket对象</td>
</tr>
<tr>
<td>ss.binds((ip, port))</td>
<td>绑定ip地址和端口</td>
</tr>
<tr>
<td>ss.listen(n)</td>
<td>最大接受连接数</td>
</tr>
<tr>
<td>ss.accept()</td>
<td>接受TCP客户端连接，返回一个连接和客户单信息的元组</td>
</tr>
<tr>
<td>ss.connect((ip,port))</td>
<td>主动初始化TCP连接服务器</td>
</tr>
<tr>
<td>ss.recv(buffers[,flags])</td>
<td>返回接受数据（tcp）</td>
</tr>
<tr>
<td>ss.send(data[,flags])</td>
<td>发送数据（tcp）</td>
</tr>
<tr>
<td>recvfrom(buffersize[,flags])</td>
<td>返回接受数据和发送端的地址信息（udp)</td>
</tr>
<tr>
<td>sendto(data[,flags],address)</td>
<td>向指定的ip和端口发送数据（udp）</td>
</tr>
<tr>
<td>ss.close()</td>
<td>关闭套接字</td>
</tr>
</tbody>
</table>
<h1 id="3-Tcp客户端和服务器端模型"><a href="#3-Tcp客户端和服务器端模型" class="headerlink" title="3.Tcp客户端和服务器端模型"></a>3.Tcp客户端和服务器端模型</h1><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/python/net_tcp/1.png" alt=""></p>
<h1 id="4-TCP客户端和服务端实现"><a href="#4-TCP客户端和服务端实现" class="headerlink" title="4.TCP客户端和服务端实现"></a>4.TCP客户端和服务端实现</h1><ul>
<li>tcp服务端编写：监听一个端口，建立请求后接受数据并回复bye,然后关闭连接，继续等待其他客户端的连接</li>
<li>最简单的服务端程序：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">from socket import *</div><div class="line"> </div><div class="line">tcp_server = socket(AF_INET, SOCK_STREAM) #创建socket</div><div class="line">tcp_server.bind((&quot;&quot;, 5001)) #绑定本地IP与端口</div><div class="line">tcp_server.listen(5) #设置监听的最大连接数</div><div class="line"></div><div class="line">client, client_info = tcp_server.accept() #等待连接</div><div class="line">recv_data = client.recv(1024) #接收数据</div><div class="line"></div><div class="line">client.close()</div><div class="line">tcp_server.close() #关闭连接</div></pre></td></tr></table></figure>
<ul>
<li>最简单的客户端程序：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">from socket import *</div><div class="line">tcp_client = socket(AF_INET, SOCK_STREAM) #创建socket</div><div class="line"> </div><div class="line">tcp_client.connect((&apos;localhost&apos;,5001)) #连接服务器</div><div class="line">tcp_client.send(&quot;hello python&quot;)  #发送数据</div><div class="line">tcp_client.close()  #关闭连接</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="4-1-最简单的实现"><a href="#4-1-最简单的实现" class="headerlink" title="4.1.最简单的实现"></a>4.1.最简单的实现</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">#客户端代码</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">tcp_server = socket(AF_INET, SOCK_STREAM)                    #建立一个tcp连接</div><div class="line">tcp_server.bind((&quot;localhost&quot;,5001))                                #绑定一个端口，注意是元组</div><div class="line">tcp_server.listen(3)</div><div class="line"> </div><div class="line">print(&quot;wait client connect.........&quot;)</div><div class="line">client,client_info = tcp_server.accept()                            #服务端等待接受（阻塞再次）</div><div class="line">recv_data = client.recv(1024)            </div><div class="line"> </div><div class="line">print(recv_data)</div><div class="line"> </div><div class="line">client.close()</div><div class="line">tcp_server.close()</div><div class="line"></div><div class="line">-----------------------------------------------------------</div><div class="line"></div><div class="line">#服务端代码</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">tcp_client = socket(AF_INET, SOCK_STREAM)</div><div class="line">tcp_client.connect((&quot;localhost&quot;,5001))                    #指定连接的地址和端口</div><div class="line"> </div><div class="line">tcp_client.send(&quot;hello chenyansong&quot;)                     #发送数据</div><div class="line"> </div><div class="line">tcp_client.close()</div></pre></td></tr></table></figure>
<h2 id="4-2-客户端输入、服务端连续读取"><a href="#4-2-客户端输入、服务端连续读取" class="headerlink" title="4.2.客户端输入、服务端连续读取"></a>4.2.客户端输入、服务端连续读取</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">#服务端</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">tcp_server = socket(AF_INET, SOCK_STREAM)</div><div class="line">tcp_server.bind((&quot;localhost&quot;,5001))</div><div class="line">tcp_server.listen(1)</div><div class="line"> </div><div class="line">while True:</div><div class="line">        print(&quot;wait client connect.........&quot;)</div><div class="line"> </div><div class="line">        client,client_info = tcp_server.accept()                    #读取客户端的一个连接</div><div class="line">        print(client_info)                                    #打印客户端连接信息的元组：(&apos;127.0.0.1&apos;, 35890)</div><div class="line"> </div><div class="line">        while True:</div><div class="line">                recv_data = client.recv(1024)                        #获取一个连接数据</div><div class="line">                print(&quot;recv=&quot; + recv_data)</div><div class="line">                if recv_data == &apos;q&apos;:</div><div class="line">                        client.close()                            #关闭一个连接</div><div class="line">                        break</div><div class="line"> </div><div class="line">tcp_server.close()</div><div class="line"></div><div class="line"></div><div class="line">---------------------------------------------------------</div><div class="line"></div><div class="line">#客户端</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">tcp_client = socket(AF_INET, SOCK_STREAM)</div><div class="line">tcp_client.connect((&quot;localhost&quot;,5001))</div><div class="line"> </div><div class="line">while True:</div><div class="line">        msg = raw_input(&quot;&gt;&quot;)                        #输入内容</div><div class="line">        tcp_client.send(msg)</div><div class="line">        if msg == &apos;q&apos;:                                 #退出</div><div class="line">                break</div><div class="line"> </div><div class="line">tcp_client.close()</div></pre></td></tr></table></figure>
<h2 id="4-3-客户端抛出异常，服务端的处理方式"><a href="#4-3-客户端抛出异常，服务端的处理方式" class="headerlink" title="4.3.客户端抛出异常，服务端的处理方式"></a>4.3.客户端抛出异常，服务端的处理方式</h2><p>如果客户端程序异常终止，然后就会想服务器端发送“”（空），所以在服务器端要进行判断<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">#服务端</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">tcp_server = socket(AF_INET, SOCK_STREAM)</div><div class="line">tcp_server.bind((&quot;localhost&quot;,5001))</div><div class="line">tcp_server.listen(3)</div><div class="line"> </div><div class="line">while True:</div><div class="line">        print(&quot;wait client connect.........&quot;)</div><div class="line"> </div><div class="line">        client,client_info = tcp_server.accept()</div><div class="line">        print(client_info)</div><div class="line"> </div><div class="line">        while True:</div><div class="line">                recv_data = client.recv(1024)</div><div class="line">                if recv_data == &apos;&apos;:                                #添加判断，服务端接受的数据，是否是空，如果是，则关闭连接的客户端</div><div class="line">                        client.close()</div><div class="line">                        break</div><div class="line"> </div><div class="line">                print(&quot;recv=&quot; + recv_data)</div><div class="line">                if recv_data == &apos;q&apos;:</div><div class="line">                        client.close()</div><div class="line">                        break</div><div class="line"> </div><div class="line">tcp_server.close()</div><div class="line"></div><div class="line"></div><div class="line">----------------------------------------------------------------</div><div class="line"> </div><div class="line">#客户端，同上</div></pre></td></tr></table></figure></p>
<h2 id="4-4-客户端会发送空数据"><a href="#4-4-客户端会发送空数据" class="headerlink" title="4.4.客户端会发送空数据"></a>4.4.客户端会发送空数据</h2><p>如果发送的数据是空，那么客户端将不会将数据发送，因为在客户端抛出异常的时候，会请求断开链接，那么此时客户端会发送空数据（此时会发送），所以为了防止误判，客户端正常的发送空数据，将不会发送的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">#客户端</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">tcp_client = socket(AF_INET, SOCK_STREAM)</div><div class="line">tcp_client.connect((&quot;localhost&quot;,5001))</div><div class="line"> </div><div class="line">while True:</div><div class="line">        msg = raw_input(&quot;&gt;&quot;)</div><div class="line">        if msg == &apos;o&apos;:</div><div class="line">                tcp_client.send(&apos;&apos;)                            #将不会发送</div><div class="line">        else:</div><div class="line">                tcp_client.send(msg)</div><div class="line"> </div><div class="line">        if msg == &apos;q&apos;:</div><div class="line">                break</div><div class="line"> </div><div class="line">tcp_client.close()</div></pre></td></tr></table></figure></p>
<h2 id="4-5-服务端发送数据到客户端"><a href="#4-5-服务端发送数据到客户端" class="headerlink" title="4.5.服务端发送数据到客户端"></a>4.5.服务端发送数据到客户端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">#服务端</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">tcp_server = socket(AF_INET, SOCK_STREAM)</div><div class="line">tcp_server.bind((&quot;localhost&quot;,5001))</div><div class="line">tcp_server.listen(3)</div><div class="line"> </div><div class="line">while True:</div><div class="line">        print(&quot;wait client connect.........&quot;)</div><div class="line"> </div><div class="line">        client,client_info = tcp_server.accept()</div><div class="line">        print(client_info)</div><div class="line"> </div><div class="line">        while True:</div><div class="line">                recv_data = client.recv(1024)</div><div class="line">                if recv_data == &apos;&apos;:</div><div class="line">                        client.close()</div><div class="line">                        break</div><div class="line"> </div><div class="line">                print(&quot;recv=&quot; + recv_data)</div><div class="line"> </div><div class="line">                client.send(&quot;server send :&quot;+recv_data)                    #向客户端发送数据</div><div class="line"> </div><div class="line">                if recv_data == &apos;q&apos;:</div><div class="line">                        client.close()</div><div class="line">                        break</div><div class="line"> </div><div class="line">tcp_server.close()</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">-----------------------------------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line">#客户端</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">tcp_client = socket(AF_INET, SOCK_STREAM)</div><div class="line">tcp_client.connect((&quot;localhost&quot;,5001))</div><div class="line"> </div><div class="line">while True:</div><div class="line">        msg = raw_input(&quot;&gt;&quot;)</div><div class="line">        if msg == &apos;o&apos;:</div><div class="line">                tcp_client.send(&apos;&apos;)</div><div class="line">        else:</div><div class="line">                tcp_client.send(msg)</div><div class="line"> </div><div class="line">        if msg == &apos;q&apos;:</div><div class="line">                break</div><div class="line"> </div><div class="line">        server_data = tcp_client.recv(1024)                        #接收来自服务端的数据</div><div class="line">        print(server_data)</div><div class="line"> </div><div class="line">tcp_client.close()</div></pre></td></tr></table></figure>
<h2 id="4-6-服务端断开，客户端的处理情况"><a href="#4-6-服务端断开，客户端的处理情况" class="headerlink" title="4.6.服务端断开，客户端的处理情况"></a>4.6.服务端断开，客户端的处理情况</h2><p>当服务端断开与客户端的连接的时候（客户端输入Q），服务端会发送一个空数据，然后客户端检测，断开链接<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div></pre></td><td class="code"><pre><div class="line">#服务端</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">tcp_server = socket(AF_INET, SOCK_STREAM)</div><div class="line">tcp_server.bind((&quot;localhost&quot;,5001))</div><div class="line">tcp_server.listen(3)</div><div class="line"> </div><div class="line">while True:</div><div class="line">        print(&quot;wait client connect.........&quot;)</div><div class="line"> </div><div class="line">        client,client_info = tcp_server.accept()</div><div class="line">        print(client_info)</div><div class="line"> </div><div class="line">        while True:</div><div class="line">                recv_data = client.recv(1024)</div><div class="line">                if recv_data == &apos;&apos;:</div><div class="line">                        client.close()</div><div class="line">                        break</div><div class="line"> </div><div class="line">                print(&quot;recv=&quot; + recv_data)</div><div class="line"> </div><div class="line">                client.send(&quot;server send :&quot;+recv_data)</div><div class="line"> </div><div class="line">                if recv_data == &apos;q&apos; or recv_data ==&apos;Q&apos;:                #当接收到客户端的数据为“Q&quot;的时候，服务端断开与客户端的连接</div><div class="line">                        client.close()</div><div class="line">                        break</div><div class="line"> </div><div class="line">tcp_server.close()</div><div class="line"></div><div class="line"></div><div class="line">---------------------------------------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line">#客户端1</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">tcp_client = socket(AF_INET, SOCK_STREAM)</div><div class="line">tcp_client.connect((&quot;localhost&quot;,5001))</div><div class="line"> </div><div class="line">while True:</div><div class="line">        msg = raw_input(&quot;&gt;&quot;)</div><div class="line">        if msg == &apos;o&apos;:</div><div class="line">                tcp_client.send(&apos;&apos;)</div><div class="line">        else:</div><div class="line">                tcp_client.send(msg)</div><div class="line"> </div><div class="line">        if msg == &apos;q&apos;:</div><div class="line">                break</div><div class="line"> </div><div class="line">        server_data = tcp_client.recv(1024)</div><div class="line">        print(server_data)</div><div class="line"> </div><div class="line">        if server_data == &apos;&apos;:                                    #当接收到服务端的空数据的时候，就说明服务端断开了连接，所以此时break</div><div class="line">                print(&quot;socket close.....&quot;)</div><div class="line">                break</div><div class="line"> </div><div class="line">tcp_client.close()</div><div class="line"></div><div class="line"></div><div class="line">----------------------------------------------------------------------------</div><div class="line"> </div><div class="line">#客户端2： 当客户端没有接受数据时，使用异常判断来解决</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">from socket import *</div><div class="line">import time</div><div class="line"> </div><div class="line">tcp_client = socket(AF_INET, SOCK_STREAM)</div><div class="line">tcp_client.connect((&quot;localhost&quot;,5001))</div><div class="line"> </div><div class="line">while True:</div><div class="line">        msg = raw_input(&quot;&gt;&quot;)</div><div class="line">        try:</div><div class="line">                if msg == &apos;o&apos;:</div><div class="line">                        tcp_client.send(&apos;&apos;)</div><div class="line">                else:</div><div class="line">                        tcp_client.send(msg)</div><div class="line"> </div><div class="line">                if msg == &apos;q&apos;:</div><div class="line">                        break</div><div class="line">        except error, emsg:                                #使用异常检测的方式去处理服务端断开的连接</div><div class="line">                print(emsg)</div><div class="line">                break</div><div class="line"> </div><div class="line">tcp_client.close()</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/python/python线程之线程池/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/python/python线程之线程池/" itemprop="url">
                  python线程之线程池
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h1><ul>
<li>线程池：用来解决线程生命周期开销问题和资源不足问题，通过对多个任务重用线程，线程创建的开销就被分摊到了多个任务上了，线程池中的所有线程主动从工作队列中寻找需要执行的工作。</li>
<li>如何实现线程池</li>
</ul>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/python/thread_pool/1.png" alt=""></p>
<h1 id="2-原理图"><a href="#2-原理图" class="headerlink" title="2.原理图"></a>2.原理图</h1><ol>
<li>在线程池中创建了5个线程</li>
<li>创建了N个任务列表</li>
<li>让线程池中的每个线程循环去取任务列表中的任务</li>
</ol>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/python/thread_pool/2.png" alt=""><br><img src="http://ols7leonh.bkt.clouddn.com//assert/img/python/thread_pool/3.png" alt=""></p>
<h1 id="3-代码实现"><a href="#3-代码实现" class="headerlink" title="3. 代码实现"></a>3. 代码实现</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line">[root@backup python]# cat pool.py</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">import sys,Queue,threading</div><div class="line"> </div><div class="line">import time</div><div class="line"> </div><div class="line"> #创建具体的线程</div><div class="line">class _Thread(threading.Thread):</div><div class="line">        def __init__(self,workQueue,resultQueue,timeout=1,**kwargs):</div><div class="line">                threading.Thread.__init__(self,kwargs=kwargs)</div><div class="line">                self.timeout = timeout</div><div class="line">                self.setDaemon(True)</div><div class="line">                self.workQueue = workQueue</div><div class="line">                self.resultQueue = resultQueue</div><div class="line"> </div><div class="line">        def run(self):</div><div class="line">                while True:</div><div class="line">                        try:</div><div class="line">                                callable,args,kwargs = self.workQueue.get(timeout=self.timeout)</div><div class="line">                                #print(self.workQueue.get(timeout=self.timeout))</div><div class="line"> </div><div class="line">                                res = callable(args,kwargs)</div><div class="line">                                print(res+&quot; | &quot;+self.getName())</div><div class="line">                                self.resultQueue.put(res+&quot; | &quot;+self.getName())</div><div class="line"> </div><div class="line">                        except Queue.Empty:                    #任务队列中的值为空，则结束循环</div><div class="line">                                break</div><div class="line">                        except:</div><div class="line">                                print(sys.exc_info())</div><div class="line">                                raise</div><div class="line"> </div><div class="line"> #线程池</div><div class="line">class ThreadPool:</div><div class="line">        def __init__(self,num_of_threads=2):</div><div class="line">                self.workQueue = Queue.Queue()                            #工作任务队列</div><div class="line">                self.resultQueue = Queue.Queue()                        #结果队列</div><div class="line">                self.threads = []                                                    #线程池</div><div class="line">                self.__createThreadPool(num_of_threads)</div><div class="line"> </div><div class="line">        def __createThreadPool(self,num_of_threads):</div><div class="line">                for i in range(num_of_threads):</div><div class="line">                        thread = _Thread(self.workQueue,self.resultQueue)</div><div class="line">                        self.threads.append(thread)                            #创建的线程加入线程池</div><div class="line"> </div><div class="line"> </div><div class="line">        def wait_for_complete(self):</div><div class="line">                while len(self.threads):</div><div class="line">                        thread = self.threads.pop()</div><div class="line">                        if thread.isAlive():</div><div class="line">                                thread.join()</div><div class="line"> </div><div class="line">        def start(self):</div><div class="line">                for th in self.threads:</div><div class="line">                        th.start()</div><div class="line"> </div><div class="line">        def add_job(self,callable,*args,**kwargs):                                        #向任务队列中添加任务</div><div class="line">                self.workQueue.put((callable,args,kwargs))                        #任务由函数来描述，args,kwargs是向函数传递的参数</div><div class="line"> </div><div class="line"> #具体的任务</div><div class="line">def test_job(id,sleep=0.001):</div><div class="line">        time.sleep(0.1)</div><div class="line">        return str(id)</div><div class="line"> </div><div class="line"> </div><div class="line"> </div><div class="line">#测试函数</div><div class="line">def test():</div><div class="line">        print(&quot;start testing.........&quot;)</div><div class="line">        tp = ThreadPool(5)                                #在线程池中创建了5个线程</div><div class="line"> </div><div class="line">        for i in range(50):</div><div class="line">                tp.add_job(test_job,i,i)</div><div class="line">        tp.start()</div><div class="line">        tp.wait_for_complete()</div><div class="line"> </div><div class="line">        while tp.resultQueue.qsize():</div><div class="line">                print(tp.resultQueue.get())</div><div class="line"> </div><div class="line">        print(&quot;end testing.........&quot;)</div><div class="line"> </div><div class="line"> </div><div class="line">if __name__ == &quot;__main__&quot;:</div><div class="line">        test()</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/python/python线程之线程同步之互斥锁/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/python/python线程之线程同步之互斥锁/" itemprop="url">
                  python线程之线程同步之互斥锁
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-概念介绍"><a href="#1-概念介绍" class="headerlink" title="1.概念介绍"></a>1.概念介绍</h1><ul>
<li>线程互斥：是指某一个资源同时只允许一个访问者对其进行修改，具有唯一性和排他性</li>
<li>线程死锁：死锁就是系统进入到一种阻塞的，无法移动的状态</li>
<li>死锁出现的情况：一个线程占有锁之后又去占有锁<ol>
<li>占有锁后，忘记释放</li>
<li>占有锁，然后调用其他函数又去占有锁</li>
</ol>
</li>
<li>线程死锁避免：代码书写小心，保证占有和释放成对出现</li>
<li>线程饿死：一个线程长时间的得不到需要的资源而不能执行的现象</li>
<li>线程饿死避免：线程队列，或者结合其他同步方式</li>
</ul>
<h1 id="2-互斥锁程序实现"><a href="#2-互斥锁程序实现" class="headerlink" title="2.互斥锁程序实现"></a>2.互斥锁程序实现</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"></div><div class="line">import threading</div><div class="line">import time</div><div class="line"></div><div class="line">tmp = 0</div><div class="line"></div><div class="line">g_lock = threading.Lock()</div><div class="line"></div><div class="line">def func():</div><div class="line">        global tmp</div><div class="line">        global g_lock</div><div class="line"></div><div class="line">        for i in range(20,25):</div><div class="line">                g_lock.acquire()                        #加锁</div><div class="line">                tmp -= 1</div><div class="line">                print(threading.currentThread().getName()+&quot;:tmp=&#123;0&#125;&quot;.format(str(tmp)))</div><div class="line">                g_lock.release()                        #释放锁</div><div class="line">                time.sleep(1)</div><div class="line"></div><div class="line">if __name__==&quot;__main__&quot;:</div><div class="line">        p = threading.Thread(target=func,args=())</div><div class="line">        p.setDaemon(True)</div><div class="line">        p.start()</div><div class="line"></div><div class="line">        for i in range(0,5):</div><div class="line">                g_lock.acquire()                    #加锁</div><div class="line">                tmp += 1</div><div class="line">                print(threading.currentThread().getName()+&quot;:tmp=&#123;0&#125;&quot;.format(str(tmp)))</div><div class="line">                g_lock.release()                    #释放锁</div><div class="line">                time.sleep(1)</div><div class="line"></div><div class="line">        p.join()</div></pre></td></tr></table></figure>
<p>打印结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Thread-1:tmp=-1</div><div class="line">MainThread:tmp=0</div><div class="line">MainThread:tmp=1</div><div class="line">Thread-1:tmp=0</div><div class="line">MainThread:tmp=1</div><div class="line">Thread-1:tmp=0</div><div class="line">MainThread:tmp=1</div><div class="line">Thread-1:tmp=0</div><div class="line">MainThread:tmp=1</div><div class="line">Thread-1:tmp=0</div><div class="line">[Finished in 5.3s]</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/python/python线程之多线程练习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/python/python线程之多线程练习/" itemprop="url">
                  python线程之多线程练习
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h1><ul>
<li>使用多线程统计每门课程的平均分</li>
<li>前提条件：学生成绩保存在TXT文件中：chinese.txt maths.txt</li>
<li><p>思路：</p>
<ol>
<li>将文件中你的每门课程的成绩解析出来</li>
<li>统计每门课程分数总和及学生数量，并计算平均值</li>
</ol>
</li>
<li><p>应用知识点：</p>
<ol>
<li>文件读写</li>
<li>正则表达式得到学生成绩</li>
<li>将统计过程抽象成类</li>
<li>实现多线程统计<br>以下是多线程和单线程统计过程的区别：</li>
</ol>
</li>
</ul>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/python/thread_practice/1.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#创建分数文件</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">import sys</div><div class="line">import random</div><div class="line"> </div><div class="line">&apos;&apos;&apos;</div><div class="line">#文件模板</div><div class="line">open file</div><div class="line">40 database</div><div class="line">name_1:90</div><div class="line">name_2:92</div><div class="line">.....</div><div class="line">&apos;&apos;&apos;</div><div class="line">def construct_data(filename):</div><div class="line">        f = open(filename,&apos;w&apos;)</div><div class="line">        for i in range(40):</div><div class="line">                data = &apos;name_&apos;+str(i)+&apos;:&apos;+str(random.randint(50,100))+&apos;\n&apos;                    #格式为：name_i:99</div><div class="line">                f.write(data)</div><div class="line">        f.close()</div><div class="line"> </div><div class="line"> </div><div class="line">def create_file(filenames):</div><div class="line">        for filen in filenames:                                    #循环创建多个数据文件</div><div class="line">                construct_data(filen)</div><div class="line"> </div><div class="line"> </div><div class="line">if __name__==&quot;__main__&quot;:</div><div class="line">        print(sys.argv[1:])</div><div class="line">        create_file(sys.argv[1:])                    #指定要创建哪些文件</div><div class="line"></div><div class="line">-------------------------------------------------------------</div><div class="line">#测试</div><div class="line">[root@backup python]# python create_data.py chinese.txt math.txt</div><div class="line">[&apos;chinese.txt&apos;, &apos;math.txt&apos;]</div><div class="line">[root@backup python]# cat math.txt</div><div class="line">name_0:65</div><div class="line">name_1:70</div><div class="line">name_2:95</div><div class="line">name_3:54</div><div class="line">name_4:72</div><div class="line">name_5:67</div><div class="line">name_6:74</div><div class="line">name_7:93</div><div class="line">name_8:98</div><div class="line">。。。。。。。。。。。。</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#下面的代码是统计每一个文件中的分数平均值</div><div class="line">[root@backup python]# cat thread_count.py</div><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">import threading</div><div class="line">import re</div><div class="line">import sys</div><div class="line"> </div><div class="line"> </div><div class="line">class my_thread(threading.Thread):                                #继承Thread线程</div><div class="line">        def __init__(self,filepath):</div><div class="line">                threading.Thread.__init__(self)</div><div class="line">                self.filepath = filepath</div><div class="line">                self.result = 0</div><div class="line">                self.sumscore = 0</div><div class="line"> </div><div class="line">        def run(self):</div><div class="line">                f = open(self.filepath)</div><div class="line">                iter_f = iter(f)</div><div class="line">                num = 0</div><div class="line">                for line in iter_f:</div><div class="line">                        score = int(re.split(&quot;:&quot;,line)[1])                                        #用正则取出分数列</div><div class="line">                        self.sumscore += score</div><div class="line">                        num += 1</div><div class="line">                f.close()</div><div class="line">                self.result = self.sumscore / num                                    #求平均值</div><div class="line">                print(&quot;file=&#123;0&#125;,sum=&#123;1&#125;,num=&#123;2&#125;,avg=&#123;3&#125;&quot;.format(self.filepath,self.sumscore,num,self.result))                    #打印统计结果</div><div class="line"> </div><div class="line">def count_score(file_list):</div><div class="line">        thread_list = []</div><div class="line">        for filel in file_list:                                #对每个文件都创建一个线程，在线程中对该文件中的分数做统计</div><div class="line">                p = my_thread(filel)</div><div class="line">                p.start()</div><div class="line">                thread_list.append(p)</div><div class="line"> </div><div class="line">        for p in thread_list:</div><div class="line">                p.join()                                    #等待所有的线程结束</div><div class="line"> </div><div class="line"> </div><div class="line">if __name__ == &quot;__main__&quot;:</div><div class="line">        print(sys.argv[1:])</div><div class="line">        count_score(sys.argv[1:])                #调用统计分数的函数，传过去的是参数list</div><div class="line"></div><div class="line"></div><div class="line">-----------------------------------------------------</div><div class="line">#测试</div><div class="line">[root@backup python]# python thread_count.py chinese.txt math.txt</div><div class="line">[&apos;chinese.txt&apos;, &apos;math.txt&apos;]</div><div class="line">file=chinese.txt,sum=2892,num=40,avg=72</div><div class="line">file=math.txt,sum=2996,num=40,avg=74</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/python/python线程之同步之条件变量/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/python/python线程之同步之条件变量/" itemprop="url">
                  python线程之同步之条件变量
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-生产和消费的平衡"><a href="#1-生产和消费的平衡" class="headerlink" title="1.生产和消费的平衡"></a>1.生产和消费的平衡</h1><ul>
<li>线程1负责产生数据，线程2负责分发数据，线程1和线程2同时需要对公共数据进行管理，理想的状态：1产生数据后，2能分发，1和2合理调度，保证公共数据不为0，同时也不会堆积过多</li>
</ul>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/python/condition/1.png" alt=""></p>
<ul>
<li>如果使用lock机制，因为调度的关系，造成下面两种情况：<ol>
<li>线程1可能一直被调度，导致线程2无法调度，这样造成数据堆积</li>
<li>线程2可能一直被调度，导致线程1无法调度，这样造成数据不足<br>如何来解决？</li>
</ol>
</li>
</ul>
<h1 id="2-条件变量"><a href="#2-条件变量" class="headerlink" title="2.条件变量"></a>2.条件变量</h1><p>允许线程阻塞等待另一个线程发送信号唤醒，条件变量被用来阻塞一个线程，当条件不满足时，线程解开相应的互斥锁并等待条件发生变化，如果其他线程改变了条件变量，并且使用条件变量唤醒一个或多个正被此条件变量阻塞的线程，这些线程将重新锁定互斥锁并重新测试条件是否满足，条件变量被用来进行线程间的同步</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">#thread1</div><div class="line">con = threading.Condition()</div><div class="line">while true:</div><div class="line">    do_something</div><div class="line">    con.acquire()    #获取锁</div><div class="line">    con.notify()    #唤醒等待线程</div><div class="line">    con.release()    #释放锁</div><div class="line"></div><div class="line">#thread2</div><div class="line">con.acquire():</div><div class="line">while true:</div><div class="line">    con.wait()        #等待唤醒,释放锁</div><div class="line">    do_something</div><div class="line">con.release()        #释放锁</div></pre></td></tr></table></figure>
<ul>
<li>条件变量实质：某一时刻只有一个线程访问公共资源，其他线程做其他任务或者休眠</li>
<li>使用条件变量实现生产者和消费者</li>
</ul>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/python/condition/2.png" alt=""></p>
<h1 id="3-程序实现"><a href="#3-程序实现" class="headerlink" title="3.程序实现"></a>3.程序实现</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">import threading</div><div class="line">import time</div><div class="line"> </div><div class="line">tmp = 0</div><div class="line"> </div><div class="line">g_cond = threading.Condition()</div><div class="line"> </div><div class="line">def thread_func():</div><div class="line">        global g_cond</div><div class="line">        global tmp</div><div class="line"> </div><div class="line">        while True:</div><div class="line">                g_cond.acquire()</div><div class="line">                if tmp &gt;= 10:                    #当tmp&gt;=10的时候，去消费</div><div class="line">                        tmp -= 1</div><div class="line">                        print(&quot;sub tmp=&#123;0&#125;&quot;.format(str(tmp)))</div><div class="line">                else:</div><div class="line">                        g_cond.wait()</div><div class="line">                        print(&quot;wake up by another thread&quot;)</div><div class="line">                g_cond.release()</div><div class="line"> </div><div class="line"> </div><div class="line">if __name__ == &quot;__main__&quot;:</div><div class="line">        p = threading.Thread(target=thread_func,args=())</div><div class="line">        p.setDaemon(True)</div><div class="line">        p.start()</div><div class="line"> </div><div class="line">        while True:</div><div class="line">                g_cond.acquire()</div><div class="line">                if tmp &gt;= 15:                      #当tmp&gt;=15的时候，停止生产，同时通知sub thread 去消费</div><div class="line">                        print(&quot;notify sub thread.....&quot;)</div><div class="line">                        g_cond.notify()                    #唤醒wait的线程</div><div class="line">                else:</div><div class="line">                        tmp += 1</div><div class="line">                        print(&quot;main tmp=&#123;0&#125;&quot;.format(str(tmp)))</div><div class="line">                g_cond.release()</div><div class="line">                time.sleep(1)</div><div class="line"> </div><div class="line">        p.join()</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/python/python线程之同步之信号量/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/python/python线程之同步之信号量/" itemprop="url">
                  python线程之同步之信号量
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h1><p>&emsp;信号量semaphore：管理一个内置的计数器，每当调用acquire()时-1, 调用release()时+1，计数器不能小于0；当计数器为0时，acquire()将阻塞线程至锁定状态，知道其他线程调用release()使计数器大于0，信号量同步机制适用于访问像服务器这样的有限资源（<font color="red">即只能够让有限个(N)资源访问</font>）</p>
<ul>
<li>创建信号量：sem = threading.Semaphore(n) ;同时允许N个线程对公共资源进行访问</li>
</ul>
<h1 id="2-举例1-只让一个资源访问"><a href="#2-举例1-只让一个资源访问" class="headerlink" title="2.举例1(只让一个资源访问)"></a>2.举例1(只让一个资源访问)</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">import threading</div><div class="line">import time</div><div class="line"> </div><div class="line">tmp = 0</div><div class="line"> </div><div class="line">g_sem = threading.Semaphore(1)</div><div class="line"> </div><div class="line">def func():</div><div class="line">        global tmp</div><div class="line">        global g_sem</div><div class="line">        print(&quot;&#123;0&#125; before get sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        g_sem.acquire()</div><div class="line">        print(&quot;&#123;0&#125; geted sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        time.sleep(3)</div><div class="line">        print(&quot;&#123;0&#125; release sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        g_sem.release()</div><div class="line"> </div><div class="line"> </div><div class="line">if __name__ == &quot;__main__&quot;:</div><div class="line">        p = threading.Thread(target=func,args=())</div><div class="line">        p.setDaemon(True)</div><div class="line">        p.start()</div><div class="line">        print(&quot;&#123;0&#125; before get sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        g_sem.acquire()                                                                                    </div><div class="line">        print(&quot;&#123;0&#125; geted sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        time.sleep(5)</div><div class="line">        print(&quot;&#123;0&#125; release sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        g_sem.release()                                                                #主线程释放资源</div><div class="line"> </div><div class="line">        p.join()</div><div class="line"></div><div class="line">-----------------------------------------------------------------------</div><div class="line">#结果</div><div class="line">[root@backup python]# python se.py  </div><div class="line">MainThread before get sem</div><div class="line">MainThread geted sem</div><div class="line">Thread-1 before get sem                                    #主线程拿到了资源，然后子线程会等待主线程释放资源（即同一个时刻只有一个线程访问资源）</div><div class="line">MainThread release sem</div><div class="line">Thread-1 geted sem</div><div class="line">Thread-1 release sem</div><div class="line">[root@backup python]#</div></pre></td></tr></table></figure>
<h1 id="3-举例2-只让两个资源访问"><a href="#3-举例2-只让两个资源访问" class="headerlink" title="3.举例2(只让两个资源访问)"></a>3.举例2(只让两个资源访问)</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">import threading</div><div class="line">import time</div><div class="line"> </div><div class="line">tmp = 0</div><div class="line"> </div><div class="line">g_sem = threading.Semaphore(2)                                    #初始化了两个信号量</div><div class="line"> </div><div class="line">def func():</div><div class="line">        global tmp</div><div class="line">        global g_sem</div><div class="line">        print(&quot;&#123;0&#125; before get sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        g_sem.acquire()</div><div class="line">        print(&quot;&#123;0&#125; geted sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        time.sleep(3)</div><div class="line">        print(&quot;&#123;0&#125; release sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        g_sem.release()</div><div class="line"> </div><div class="line"> </div><div class="line">if __name__ == &quot;__main__&quot;:</div><div class="line">        p = threading.Thread(target=func,args=())</div><div class="line">        p.setDaemon(True)</div><div class="line">        p.start()</div><div class="line">        print(&quot;&#123;0&#125; before get sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        g_sem.acquire()</div><div class="line">        print(&quot;&#123;0&#125; geted sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        time.sleep(5)</div><div class="line">        print(&quot;&#123;0&#125; release sem &quot;.format(threading.currentThread().getName()))</div><div class="line">        g_sem.release()</div><div class="line"> </div><div class="line">        p.join()</div><div class="line">-----------------------------------------------------</div><div class="line">#结果</div><div class="line">[root@backup python]# python se2.py</div><div class="line">MainThread before get sem</div><div class="line">MainThread geted sem                                          #主线程可以获取资源</div><div class="line">Thread-1 before get sem</div><div class="line">Thread-1 geted sem                                            #子线程也是可以获取资源的</div><div class="line">Thread-1 release sem</div><div class="line">MainThread release sem</div><div class="line">[root@backup python]#</div></pre></td></tr></table></figure>
<h1 id="4-release-使信号量加1"><a href="#4-release-使信号量加1" class="headerlink" title="4.release()使信号量加1"></a>4.release()使信号量加1</h1><p>当调用release函数的时候，信号量就会加1，那么此时就会有N+1个线程可以去访问资源，即：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">threading.Semaphore(2)    </div><div class="line">#等价于：</div><div class="line">g_sem = threading.Semaphore(1)</div><div class="line">g_sem.release()</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/python/python线程之同步之Queue队列/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/python/python线程之同步之Queue队列/" itemprop="url">
                  python线程之同步之Queue队列
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h1><p>&emsp;Queue模块中提供了同步的、线程安全的队列类，包括FIFO（先进先出）队列Queue，LIFO（后入先出）队列LifoQueue，和优先级队列PriorityQueue，这些队列都实现了原子操作，能够在多线程中直接使用，可以使用队列来实现线程间的同步，内部实现使用了mutex和condition<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#创建队列： </div><div class="line">number_queue = Queue.Queue()</div><div class="line"></div><div class="line">#访问： </div><div class="line">number_queue.put(N)        </div><div class="line">n = number_queue.get()</div></pre></td></tr></table></figure></p>
<h1 id="2-帮助文档"><a href="#2-帮助文档" class="headerlink" title="2.帮助文档"></a>2.帮助文档</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">In [8]: import Queue                                            #导入模块</div><div class="line"> </div><div class="line">In [9]: qu = Queue.                                    #模块下的所有的函数（各种队列类型）</div><div class="line">Queue.Empty          Queue.LifoQueue      Queue.Queue          Queue.heapq         </div><div class="line">Queue.Full           Queue.PriorityQueue  Queue.deque         </div><div class="line"> </div><div class="line">In [9]: qu = Queue.Queue()                            #返回一个先进先出队列</div><div class="line"> </div><div class="line">In [10]: qu.                                       #先进先出队列的方法</div><div class="line">qu.all_tasks_done    qu.get               qu.maxsize           qu.not_full          qu.qsize             qu.unfinished_tasks</div><div class="line">qu.empty             qu.get_nowait        qu.mutex             qu.put               qu.queue            </div><div class="line">qu.full              qu.join              qu.not_empty         qu.put_nowait        qu.task_done</div></pre></td></tr></table></figure>
<h1 id="3-举例"><a href="#3-举例" class="headerlink" title="3.举例"></a>3.举例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line"> </div><div class="line">import threading, Queue</div><div class="line">import time</div><div class="line"> </div><div class="line"> </div><div class="line">g_que = Queue.Queue()                                #创建先进先出队列</div><div class="line"> </div><div class="line">def thread_func():</div><div class="line">        global g_que                                    #声明使用全局变量</div><div class="line">        while True:</div><div class="line">                msg = g_que.get()                            #子线程取出数据，然后打印</div><div class="line">                print(msg)</div><div class="line"> </div><div class="line"> </div><div class="line">if __name__ == &quot;__main__&quot;:</div><div class="line">        p = threading.Thread(target=thread_func,args=())</div><div class="line">        p.setDaemon(True)</div><div class="line">        p.start()</div><div class="line">        tmp = 0</div><div class="line"> </div><div class="line">        while True:</div><div class="line">                tmp+=1</div><div class="line">                g_que.put(tmp)                        #主线程向队列中放入数据</div><div class="line">                time.sleep(1)</div><div class="line">        p.join()</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/python/python线程之同步之Event事件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/python/python线程之同步之Event事件/" itemprop="url">
                  python线程之同步之Event事件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h1><p>&emsp;一个线程通知事件，其他线程等待事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#创建Event:</div><div class="line">thread_event = threading.Event()</div><div class="line"></div><div class="line">#等待：</div><div class="line">thread_event.wait()</div><div class="line"></div><div class="line">#唤醒：</div><div class="line">thread_event.set()</div></pre></td></tr></table></figure></p>
<h1 id="2-举例"><a href="#2-举例" class="headerlink" title="2.举例"></a>2.举例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">import threading</div><div class="line">import time</div><div class="line"> </div><div class="line"> </div><div class="line">g_event = threading.Event()</div><div class="line"> </div><div class="line">def thread_func():</div><div class="line">        global g_event</div><div class="line"> </div><div class="line">        while True:</div><div class="line">                if g_event.isSet():</div><div class="line">                        g_event.clear()                            </div><div class="line">                print(&quot;Thread_1 start Wait&quot;)</div><div class="line">                g_event.wait()                                        #等待主线程中的set()，将其唤醒</div><div class="line">                print(&quot;Thread_1 end Wait&quot;)</div><div class="line"> </div><div class="line"> </div><div class="line">if __name__ == &quot;__main__&quot;:</div><div class="line">        p = threading.Thread(target=thread_func,args=())</div><div class="line">        p.setDaemon(True)</div><div class="line">        p.start()</div><div class="line"> </div><div class="line">        while True:</div><div class="line">                time.sleep(1)</div><div class="line">                g_event.set()</div><div class="line">        p.join()</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/python/python线程之创建线程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/python/python线程之创建线程/" itemprop="url">
                  python线程之创建线程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-线程模型"><a href="#1-线程模型" class="headerlink" title="1.线程模型"></a>1.线程模型</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">import threading</div><div class="line">def func():   #线程函数</div><div class="line">    print &quot;call thread_func&quot;</div><div class="line">def test():</div><div class="line">    t1 = threading.Thread(target=func, args=())        #创建线程</div><div class="line">    t1.start()    #启动线程</div><div class="line">    return t1</div><div class="line"></div><div class="line">if __name__==&quot;__main__&quot;:</div><div class="line">    p = test()</div><div class="line">    p.join()    #等待线程退出</div></pre></td></tr></table></figure>
<ul>
<li>target 是线程要执行的函数</li>
<li>args是函数的参数（注意是一个元组）</li>
</ul>
<h1 id="2-threading-Thread帮助文档"><a href="#2-threading-Thread帮助文档" class="headerlink" title="2.threading.Thread帮助文档"></a>2.threading.Thread帮助文档</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">In [6]: import threading</div><div class="line">In [10]: help(threading.Thread)</div><div class="line">Help on class Thread in module threading:</div><div class="line"> </div><div class="line">class Thread(_Verbose)</div><div class="line"> |  Method resolution order:</div><div class="line"> |      Thread</div><div class="line"> |      _Verbose</div><div class="line"> |      __builtin__.object</div><div class="line"> | </div><div class="line"> |  Methods defined here:</div><div class="line"> | </div><div class="line"> |  __init__(self, group=None, target=None, name=None, args=(), kwargs=None, verbose=None)                #初始化构造函数</div><div class="line"> | </div><div class="line"> |  __repr__(self)</div><div class="line"> | </div><div class="line"> |  getName(self)</div><div class="line"> | </div><div class="line"> |  isAlive(self)</div><div class="line"> | </div><div class="line"> |  isDaemon(self)</div><div class="line"> | </div><div class="line"> |  is_alive = isAlive(self)</div><div class="line"> | </div><div class="line"> |  join(self, timeout=None)</div><div class="line"> | </div><div class="line"> |  run(self)                                  </div><div class="line"> | </div><div class="line"> |  setDaemon(self, daemonic)                    #设置为守护线程</div><div class="line"> | </div><div class="line"> |  setName(self, name)</div><div class="line"> | </div><div class="line"> |  start(self)                              #启动线程</div></pre></td></tr></table></figure>
<h1 id="3-使用target传参的方式创建线程"><a href="#3-使用target传参的方式创建线程" class="headerlink" title="3.使用target传参的方式创建线程"></a>3.使用target传参的方式创建线程</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">import threading</div><div class="line">import time</div><div class="line"> </div><div class="line">def thread_func():</div><div class="line">        for i in range(10):</div><div class="line">                print(&quot;call thread_func&quot;)</div><div class="line">                time.sleep(1)</div><div class="line"> </div><div class="line">def thread_run():</div><div class="line">        t1 = threading.Thread(target=thread_func,args=())            #使用target的方式来指定线程执行的函数</div><div class="line">        t1.start()</div><div class="line">        return t1 </div><div class="line"> </div><div class="line">if __name__ == &quot;__main__&quot;:</div><div class="line">        p1 = thread_run()</div><div class="line">        for i in range(10):</div><div class="line">                print(&quot;in main_func i=&#123;0&#125;&quot;.format(str(i)))</div><div class="line">                time.sleep(1)</div><div class="line">        p1.join()</div><div class="line"></div><div class="line">------------------------------------------------</div><div class="line">将start方法换成run，run方法将不是多线程了，那么会顺序执行 </div><div class="line">将   t1.start()    换成：</div><div class="line">t1.run()</div></pre></td></tr></table></figure>
<h1 id="4-主线程和子线程共享资源tmp"><a href="#4-主线程和子线程共享资源tmp" class="headerlink" title="4.主线程和子线程共享资源tmp"></a>4.主线程和子线程共享资源tmp</h1><p>在主线程中创建一个tmp，看在子线程中是否共享tmp<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">import threading</div><div class="line">import time</div><div class="line"> </div><div class="line">tmp = 0                                  #子线程和主线程共享的资源tmp</div><div class="line"> </div><div class="line">def thread_func():</div><div class="line">        for i in range(10):</div><div class="line">                print(&quot;call thread_func,tmp=&#123;0&#125;&quot;.format(tmp))                    #使用共享资源</div><div class="line">                time.sleep(1)</div><div class="line"> </div><div class="line">def thread_run():</div><div class="line">        t1 = threading.Thread(target=thread_func,args=())</div><div class="line">        t1.start()</div><div class="line">        return t1</div><div class="line"> </div><div class="line">if __name__ == &quot;__main__&quot;:</div><div class="line">        p1 = thread_run()</div><div class="line">        for i in range(10):</div><div class="line">                tmp = i                            #改变共享资源</div><div class="line">                print(&quot;in main_func i=&#123;0&#125;&quot;.format(str(i)))</div><div class="line">                time.sleep(1)</div><div class="line">        p1.join()</div></pre></td></tr></table></figure></p>
<p> 执行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">call thread_func,tmp=0</div><div class="line">in main_func i=0</div><div class="line">in main_func i=1</div><div class="line">call thread_func,tmp=1</div><div class="line">in main_func i=2</div><div class="line">call thread_func,tmp=2</div><div class="line">call thread_func,tmp=2</div><div class="line">in main_func i=3</div><div class="line">call thread_func,tmp=3</div><div class="line">in main_func i=4</div><div class="line">call thread_func,tmp=4</div><div class="line">call thread_func,tmp=4</div><div class="line">call thread_func,tmp=4</div><div class="line">call thread_func,tmp=4</div><div class="line">call thread_func,tmp=4</div><div class="line">[Finished in 10.2s]</div></pre></td></tr></table></figure></p>
<h1 id="5-守护线程的作用：setDaemon-True"><a href="#5-守护线程的作用：setDaemon-True" class="headerlink" title="5.守护线程的作用：setDaemon(True)"></a>5.守护线程的作用：setDaemon(True)</h1><p>设置守护线程的作用：当主线程退出的时候，会将子线程也结束，不管此时子线程是否执行完成，这就是守护线程的作用</p>
<h1 id="6-join"><a href="#6-join" class="headerlink" title="6.join()"></a>6.join()</h1><p> 将join注释掉之后，主线程将不会等待子线程结束之后，再结束，而是直接退出，那么在主线程退出之后，子线程由于守护线程的存在也会退出</p>
<p>如果没有守护线程，那么子线程将不会退出（在主线程退出时）</p>
<h1 id="7-通过Thread类的方式创建线程"><a href="#7-通过Thread类的方式创建线程" class="headerlink" title="7.通过Thread类的方式创建线程"></a>7.通过Thread类的方式创建线程</h1><h2 id="7-1-threading模块的方法"><a href="#7-1-threading模块的方法" class="headerlink" title="7.1.threading模块的方法"></a>7.1.threading模块的方法</h2><table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>.activeCount()</td>
<td>返回当前活动线程个数</td>
</tr>
<tr>
<td>.currentThread()</td>
<td>返回当前线程对象</td>
</tr>
<tr>
<td>.enumerate()</td>
<td>返回当前活动线程对象组成的列表</td>
</tr>
<tr>
<td>.Thread()</td>
<td>返回线程对象</td>
</tr>
<tr>
<td>.Timer(n,func)</td>
<td>返回一个N秒后自动执行的线程函数</td>
</tr>
<tr>
<td>.settrace(p_callback)</td>
<td>start()前调用该回调函数</td>
</tr>
<tr>
<td>.setprofil(func)</td>
<td>start()后调用该回调函数</td>
</tr>
<tr>
<td>.setDaemon()</td>
<td>设置守护进程</td>
</tr>
<tr>
<td>.join()</td>
<td>等待线程结束</td>
</tr>
</tbody>
</table>
<h2 id="7-2-编程实现"><a href="#7-2-编程实现" class="headerlink" title="7.2.编程实现"></a>7.2.编程实现</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">import threading</div><div class="line">import time</div><div class="line"> </div><div class="line">class my_thread(threading.Thread):                    #使用继承线程类Thread方式</div><div class="line">        def __init__(self,thread_name):</div><div class="line">                threading.Thread.__init__(self,name=thread_name)</div><div class="line">        def run(self):</div><div class="line">                for i in range(10):</div><div class="line">                        time.sleep(1)</div><div class="line">                        print(i)</div><div class="line"> </div><div class="line"> </div><div class="line">if __name__==&quot;__main__&quot;:</div><div class="line">        p1 = my_thread(&quot;thread1&quot;)</div><div class="line">        p1.setDaemon(True)</div><div class="line">        p1.start()</div><div class="line">        time.sleep(3)</div><div class="line">        print(&quot;main thread.........end......&quot;)</div><div class="line">        p1.join()</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/python/python线程之共享资源/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/python/python线程之共享资源/" itemprop="url">
                  python线程之共享资源
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-程序实现"><a href="#1-程序实现" class="headerlink" title="1.程序实现"></a>1.程序实现</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"> </div><div class="line">import threading</div><div class="line">import time</div><div class="line"> </div><div class="line">tmp = 0</div><div class="line"> </div><div class="line">def func():</div><div class="line">        global tmp                #声明使用全局变量</div><div class="line">        for i in range(10,15):</div><div class="line">                tmp = i                            #改变共享的资源</div><div class="line">                print(&quot;before &#123;0&#125;, tmp=&#123;1&#125;&quot;.format(threading.currentThread().getName(),str(tmp)))</div><div class="line">                time.sleep(1)</div><div class="line">                print(&quot;after &#123;0&#125;, tmp=&#123;1&#125;&quot;.format(threading.currentThread().getName(),str(tmp)))</div><div class="line"> </div><div class="line">if __name__ == &quot;__main__&quot;:</div><div class="line">        p = threading.Thread(target=func,args=())</div><div class="line">        p.start()</div><div class="line">        for i in range(0,3):</div><div class="line">                tmp = i</div><div class="line">                print(&quot;before &#123;0&#125;, tmp=&#123;1&#125;&quot;.format(threading.currentThread().getName(),str(tmp)))</div><div class="line">                time.sleep(1)</div><div class="line">                print(&quot;after &#123;0&#125;, tmp=&#123;1&#125;&quot;.format(threading.currentThread().getName(),str(tmp)))</div><div class="line"> </div><div class="line">        p.join()</div></pre></td></tr></table></figure>
<p>打印结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">before Thread-1, tmp=10</div><div class="line">before MainThread, tmp=0</div><div class="line">after Thread-1, tmp=0</div><div class="line">before Thread-1, tmp=11</div><div class="line">after MainThread, tmp=11</div><div class="line">before MainThread, tmp=1</div><div class="line">after Thread-1, tmp=1</div><div class="line">before Thread-1, tmp=12</div><div class="line">after MainThread, tmp=12</div><div class="line">before MainThread, tmp=2</div><div class="line">after Thread-1, tmp=2</div><div class="line">after MainThread, tmp=2</div><div class="line">before Thread-1, tmp=13</div><div class="line">after Thread-1, tmp=13</div><div class="line">before Thread-1, tmp=14</div><div class="line">after Thread-1, tmp=14</div><div class="line">[Finished in 5.3s]</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/56/">56</a><a class="extend next" rel="next" href="/page/11/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/header.jpg"
               alt="Mr. Chen" />
          <p class="site-author-name" itemprop="name">Mr. Chen</p>
           
              <p class="site-description motion-element" itemprop="description">一个技术渣的自说自话</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">555</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">36</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mr. Chen</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  

  

  

  

</body>
</html>
