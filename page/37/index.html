<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Chen&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="一个技术渣的自说自话">
<meta property="og:type" content="website">
<meta property="og:title" content="Chen's Blog">
<meta property="og:url" content="http://yoursite.com/page/37/index.html">
<meta property="og:site_name" content="Chen's Blog">
<meta property="og:description" content="一个技术渣的自说自话">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chen's Blog">
<meta name="twitter:description" content="一个技术渣的自说自话">
  
    <link rel="alternate" href="/atom.xml" title="Chen&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Chen&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">一个技术渣的自说自话</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-bigdata/zookeeper/zookeeper客户端API使用(zk-API)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/bigdata/zookeeper/zookeeper客户端API使用(zk-API)/" class="article-date">
  <time datetime="2017-04-16T04:47:25.340Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/bigdata/zookeeper/zookeeper客户端API使用(zk-API)/">zookeeper客户端API使用(zk-API)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-创建zk实例"><a href="#1-创建zk实例" class="headerlink" title="1.创建zk实例"></a>1.创建zk实例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ZooKeeper(String connectString, int sessionTimeout, Watcher watcher)</div><div class="line">ZooKeeper(String connectString, int sessionTimeout, Watcher watcher, boolean canBeReadOnly)</div><div class="line">ZooKeeper(String connectString, int sessionTimeout, Watcher watcher, long sessionId, byte[] sessionPasswd)</div><div class="line">ZooKeeper(String connectString, int sessionTimeout, Watcher watcher, long sessionId, byte[] sessionPasswd, boolean canBeReadOnly)</div></pre></td></tr></table></figure>
<ul>
<li>客户端与服务器端会话的建立是一个异步的过程</li>
<li>完成客户端的初始化就返回，此时连接并没有真正的建立，所以主线程中使用：connectedSignal.await()去等待</li>
<li>当连接真正建立的时候，客户端会收到一个事件的通知，会触发Watcher的process，所以在process函数中connectedSignal.countDown();//计数器减1，阻塞结束</li>
</ul>
<blockquote>
<p>Zk构造方法参数说明</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>connectString</td>
<td>1.指zk服务器列表，host:port,示例：192.168.0.50:2180,192.168.0.51:2181 ,<br>2.也可以在后面跟上目录，表示此客户端的操作都是在此目录下，如：192.168.0.50:2180/zk-book 表示此客户端操作的节点都是在/zk-book根目录下，比如创建/foo/bar，其实完整的路径是/zk-book/foo/bar</td>
</tr>
<tr>
<td>sessionTimeout</td>
<td>会话超时时间，单位是毫秒，当在这个时间内没有收到心跳检测，会话就会失效</td>
</tr>
<tr>
<td>watcher</td>
<td>注ӆ的watcher，null表示不设置</td>
</tr>
<tr>
<td>canBeReadOnly</td>
<td>用于标识当前会话是否支持”read-only”模式ͺ</td>
</tr>
<tr>
<td>sessionPasswd 和 sessionId</td>
<td>分别代表会话ID和会话密钥，这两个参数一起可以唯一确定一个会话，客户端通过这两个参数实现客户端会话复用</td>
</tr>
</tbody>
</table>
<h1 id="2-创建节点"><a href="#2-创建节点" class="headerlink" title="2.创建节点"></a>2.创建节点</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">String create(String path, byte[] data, List&lt;ACL&gt; acl, CreateMode createMode)        </div><div class="line">	#以同步的方式创建节点</div><div class="line">void create(String path, byte[] data, List&lt;ACL&gt; acl, CreateMode createMode, </div><div class="line">	AsyncCallback.StringCallback cb, Object ctx)      </div><div class="line">	#以异步的方式创建节点</div></pre></td></tr></table></figure>
<ul>
<li>无论是上面的同步或者异步都不支持递归创建节点</li>
<li>当创建的节点存在时，抛出异常NodeExistsException</li>
</ul>
<blockquote>
<p>Zk create api参数说明</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>path</td>
<td>被创建的节点路径，比如：/zk-book/foo</td>
</tr>
<tr>
<td>data[]</td>
<td>节点中的数据</td>
</tr>
<tr>
<td>acl</td>
<td>acl策略</td>
</tr>
<tr>
<td>createMode</td>
<td>节点类型，枚举类型，有四种选择：<br>持久(PERSISTENT)<br>持久顺序（PERSISTENT_SEQUENTIAL）<br>临时（EPHEMERAL）<br>临时顺序（EPHEMERAL_SEQUENTIAL）</td>
</tr>
<tr>
<td>cb</td>
<td>回调函数，需要实现接口StringCallback接口，当服务器端创建完成后，客户端会自动调用这个对象的方法processResult</td>
</tr>
<tr>
<td>ctx</td>
<td>用于传递一个对象，可以在回调方法执行的时候用，通常用于传递业务的上下文信息</td>
</tr>
</tbody>
</table>
<blockquote>
<p>创建节点时的ACL</p>
</blockquote>
<ul>
<li>1.通过接口Ids可以预先定义几种scheme模式<ul>
<li>OPEN_ACL_UNSAFE：相当于world:anyone:cdrwa</li>
<li>CREATOR_ALL_ACL：相当于auth:用户名:密码,但是需要通过ZooKeeper的addAuthInfo添加对应的用户和密码对</li>
<li>READ_ACL_UNSAFE：相当于world:anyone:r，即所有人拥有读权限</li>
</ul>
</li>
<li>2.自己定义,比如:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public List&lt;ACL&gt; getDigestAcl()&#123;</div><div class="line">	List&lt;ACL&gt; acls = new ArrayList&lt;ACL&gt;();</div><div class="line">	Id digestId = new Id(&quot;digest&quot;, &quot;javaclient2:CGf2ydfsfdsjfsldfsdfsdfs=&quot;);</div><div class="line">	acls.add(new ACL(Perms.ALL, digestId));</div><div class="line">	return acls;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="3-删除节点"><a href="#3-删除节点" class="headerlink" title="3.删除节点"></a>3.删除节点</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">void delete(String path, int version)            </div><div class="line">	#以同步的方式删除</div><div class="line"></div><div class="line">void delete(String path, int version, AsyncCallback.VoidCallback cb, Object ctx)    </div><div class="line">	#以异步的方式删除，客户端主线程不能退出，否则可能请求没有发到服务器或者是异步回调不成功</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Path</td>
<td>被删除的节点的路径</td>
</tr>
<tr>
<td>Version</td>
<td>知道节点的数据版本，如果指定的版本不是最新版本，将会报错，它的作用类似于hibernate中的乐观锁,if the given version is -1, it matches any node’s versions(删除指定版本，-1表示删除所有版本)</td>
</tr>
<tr>
<td>cb</td>
<td>异步回调函数</td>
</tr>
<tr>
<td>ctx</td>
<td>传递上下文信息，即操作之前的信息传递到删除之后的异步回调函数里（可以用于保留删除前的状态）</td>
</tr>
</tbody>
</table>
<h1 id="4-获取子节点list"><a href="#4-获取子节点list" class="headerlink" title="4.获取子节点list"></a>4.获取子节点list</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">List&lt;String&gt; getChildren(String path, boolean watch)        </div><div class="line">	#返回path节点的子节点列表</div><div class="line"></div><div class="line">void getChildren(String path, boolean watch, AsyncCallback.Children2Callback cb, Object ctx)   </div><div class="line">	#以异步的方式返回子节点，返回path指定节点的状态信息stat</div><div class="line"></div><div class="line">void getChildren(String path, boolean watch, AsyncCallback.ChildrenCallback cb, Object ctx)   </div><div class="line">	##以异步的方式返回子节点，不返回path指定节点的状态信息ͧstatͨ</div><div class="line"></div><div class="line">List&lt;String&gt; getChildren(String path, boolean watch, Stat stat)        </div><div class="line">	#返回path指定节点的状态信息stat和子节点列表</div><div class="line"></div><div class="line">List&lt;String&gt; getChildren(String path, Watcher watcher)</div><div class="line"></div><div class="line">void getChildren(String path, Watcher watcher, AsyncCallback.Children2Callback  cb, Object ctx)</div><div class="line"></div><div class="line">void getChildren(String path, Watcher watcher, AsyncCallback.ChildrenCallback cb, Object ctx)</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>path</td>
<td>数据节点的路径，比如：/zk-book/foo，获取该路径下的子节点列表</td>
</tr>
<tr>
<td>watcher</td>
<td>设置watcher，如果path对应节点的子节点数量发生变化，将会得到通知，允许为null</td>
</tr>
<tr>
<td>watch</td>
<td>是否使用默认的watcher（就是在创建zk实例的时候指定的watcher）</td>
</tr>
<tr>
<td>stat</td>
<td>指定数据节点的状态信息</td>
</tr>
<tr>
<td>cb</td>
<td>异步回调函数</td>
</tr>
<tr>
<td>ctx</td>
<td>用于传递一个对象，可以在回调方法执行的时候用，通常用于传递业务的上下文信息</td>
</tr>
</tbody>
</table>
<h1 id="5-获取节点数据"><a href="#5-获取节点数据" class="headerlink" title="5.获取节点数据"></a>5.获取节点数据</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">void getData(String path, boolean watch, AsyncCallback.DataCallback cb, Object ctx)</div><div class="line"></div><div class="line">byte[] getData(String path, boolean watch, Stat stat)</div><div class="line"></div><div class="line">void getData(String path, Watcher watcher, AsyncCallback.DataCallback cb, Object ctx)</div><div class="line"></div><div class="line">byte[] getData(String path, Watcher watcher, Stat stat)</div><div class="line"></div><div class="line"></div><div class="line">############ Stat  类的内部（其实是对状态属性的封装）##############</div><div class="line">public class Stat implements Record &#123;</div><div class="line">  private long czxid;</div><div class="line">  private long mzxid;</div><div class="line">  private long ctime;</div><div class="line">  private long mtime;</div><div class="line">  private int version;</div><div class="line">  private int cversion;</div><div class="line">  private int aversion;</div><div class="line">  private long ephemeralOwner;</div><div class="line">  private int dataLength;</div><div class="line">  private int numChildren;</div><div class="line">  private long pzxid;</div><div class="line">  public Stat() &#123;</div><div class="line">  &#125;</div><div class="line">//............</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>path</td>
<td>数据节点的路径，比如：/zk-book/foo，获取该路径的数据</td>
</tr>
<tr>
<td>watcher</td>
<td>设置watcher后，如果path对应节点的数据发生变化，将会得到通知，允许为null</td>
</tr>
<tr>
<td>watch</td>
<td>是否使用默认的watcher（就是在创建zk实例的时候指定的watcher）</td>
</tr>
<tr>
<td>stat</td>
<td>指定数据节点的状态信息</td>
</tr>
<tr>
<td>cb</td>
<td>异步回调函数</td>
</tr>
<tr>
<td>ctx</td>
<td>用于传递一个对象，可以在回调方法执行的时候用，通常用于传递业务的上下文信息</td>
</tr>
</tbody>
</table>
<h1 id="6-修改数据"><a href="#6-修改数据" class="headerlink" title="6.修改数据"></a>6.修改数据</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Stat setData(String path, byte[] data, int version)</div><div class="line"></div><div class="line">void setData(String path, byte[] data, int version, AsyncCallback.StatCallback cb, Object ctx)</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>path</td>
<td>被修改的节点的路径</td>
</tr>
<tr>
<td>data</td>
<td>新的数据</td>
</tr>
<tr>
<td>version</td>
<td>知道节点的数据版本，如果指定的版本不是最新版本，将会报错，它的作用类似于hibernate中的乐观锁,if the given version is -1, it matches any node’s versions</td>
</tr>
<tr>
<td>cb</td>
<td>异步回调函数</td>
</tr>
<tr>
<td>ctx</td>
<td>传递上下文信息，即操作之前的信息传递到操作之后的异步回调函数里</td>
</tr>
</tbody>
</table>
<h1 id="7-检查节点是否存在"><a href="#7-检查节点是否存在" class="headerlink" title="7.检查节点是否存在"></a>7.检查节点是否存在</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Stat exists(String path, boolean watch)        </div><div class="line">	#如果节点不存在就返回为null</div><div class="line"></div><div class="line">void exists(String path, boolean watch, AsyncCallback.StatCallback cb, Object ctx)</div><div class="line"></div><div class="line">Stat exists(String path, Watcher watcher)</div><div class="line"></div><div class="line">void exists(String path, Watcher watcher, AsyncCallback.StatCallback cb, Object ctx)</div><div class="line"></div><div class="line"></div><div class="line">##############################</div><div class="line">    interface StatCallback extends AsyncCallback &#123;</div><div class="line">        public void processResult(int rc, String path, Object ctx, Stat stat);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>path</td>
<td>数据节点的路径，如：/zk-book/foo  即API调用的目的是检测该节点是否存在</td>
</tr>
<tr>
<td>watcher</td>
<td>注册的watcher，用于监听以下三个事件：<br>节点被创建<br>节点被删除<br>节点被更新</td>
</tr>
<tr>
<td>watch</td>
<td>是否使用默认的watcher</td>
</tr>
<tr>
<td>cb</td>
<td>异步回调函数</td>
</tr>
<tr>
<td>ctx</td>
<td>传递上下文信息，即操作之前的信息传递到操作之后的异步回调函数里</td>
</tr>
</tbody>
</table>
<h1 id="8-异步函数的实现"><a href="#8-异步函数的实现" class="headerlink" title="8.异步函数的实现"></a>8.异步函数的实现</h1><p>其实以上所有的异步回调函数都是在AsyncCallback中</p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/zookeeper/crud-api/1.png" alt=""></p>
<h1 id="9-代码实现（重要）"><a href="#9-代码实现（重要）" class="headerlink" title="9.代码实现（重要）"></a>9.代码实现（<em>重要</em>）</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div></pre></td><td class="code"><pre><div class="line">package it.com.zk;</div><div class="line">import java.io.IOException;</div><div class="line">import java.util.List;</div><div class="line">import java.util.concurrent.CountDownLatch;</div><div class="line">import org.apache.zookeeper.AsyncCallback;</div><div class="line">import org.apache.zookeeper.CreateMode;</div><div class="line">import org.apache.zookeeper.KeeperException;</div><div class="line">import org.apache.zookeeper.WatchedEvent;</div><div class="line">import org.apache.zookeeper.Watcher;</div><div class="line">import org.apache.zookeeper.ZooKeeper;</div><div class="line">import org.apache.zookeeper.AsyncCallback.StringCallback;</div><div class="line">import org.apache.zookeeper.AsyncCallback.VoidCallback;</div><div class="line">import org.apache.zookeeper.Watcher.Event.KeeperState;</div><div class="line">import org.apache.zookeeper.ZooDefs.Ids;</div><div class="line">import org.apache.zookeeper.data.Stat;</div><div class="line">public class WatchExample implements Watcher&#123;</div><div class="line">    private static final int SESSION_TIMEOUT=5000;</div><div class="line">    </div><div class="line">    private ZooKeeper zk;</div><div class="line">    private CountDownLatch connectedSignal=new CountDownLatch(1);//初始化计数器为1</div><div class="line">    @Override</div><div class="line">    public void process(WatchedEvent event) &#123;</div><div class="line">        if(event.getState()==KeeperState.SyncConnected)&#123;//KeeperState是枚举类型，存放的是状态</div><div class="line">            connectedSignal.countDown();//计数器减1，阻塞结束</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    private void close() throws InterruptedException &#123;</div><div class="line">        zk.close();</div><div class="line">        System.out.println(&quot;close........&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">/*-------------------- 连接 start---------------------*/ </div><div class="line">    private void connect(String hosts) throws IOException, InterruptedException &#123;</div><div class="line">        zk = new ZooKeeper(hosts, SESSION_TIMEOUT, this);    //因为自身实现了Watcher，所以将自身传过来了</div><div class="line">        connectedSignal.await();//阻塞等待，直到计数器为0结束(主线程阻塞，登台子线程调用process函数，然后唤醒自己)</div><div class="line">        /*</div><div class="line">             客户端与服务端会话的建立是一个异步的过程，即</div><div class="line">                完成ۨ客户端的初始化后就返回，此时连接并没有真正的建立起来</div><div class="line">                当连接真正建立起来后，客户端会收到一个事件通知（即Watcher函数process的调用）</div><div class="line">        */</div><div class="line">    &#125;</div><div class="line">/*---------------------   连接 end -------------------------------*/  </div><div class="line">    </div><div class="line"></div><div class="line">/*---------------------   创建节点 start ----------------------*/  </div><div class="line">    //创建节点</div><div class="line">    private void createSync(String groupName, String dataStr) throws KeeperException, InterruptedException &#123;</div><div class="line">        String path=&quot;/&quot;+groupName;</div><div class="line">        if(zk.exists(path, false)== null)&#123;//判断路径是否存在,不存在就创建</div><div class="line">            String actual_path = zk.create(path, dataStr.getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);</div><div class="line">            /*</div><div class="line">            Ids:提供了几种默认的acl，但是也可以通过new Id()来自己指定，Ids内部就是new的</div><div class="line">            CreateMode:持久节点、持久顺序节点、临时节点、临时顺序节点</div><div class="line">             </div><div class="line">            */</div><div class="line">            System.out.println(actual_path);</div><div class="line">            System.out.println(&quot;Created Sync:&quot;+path);</div><div class="line">        &#125;</div><div class="line">    &#125; </div><div class="line">    //异步创建节点</div><div class="line">    private void createAsync(String groupName, String dataStr) throws KeeperException, InterruptedException &#123;</div><div class="line">        String path=&quot;/&quot;+groupName;</div><div class="line">        if(zk.exists(path, false)== null)&#123;//判断路径是否存在</div><div class="line">            zk.create(path, dataStr.getBytes(), Ids.CREATOR_ALL_ACL, CreateMode.PERSISTENT, new StringCallback()&#123;</div><div class="line">                @Override</div><div class="line">                public void processResult(int rc, String path, Object ctx, String name) &#123;</div><div class="line">                    System.out.println(&quot;rc:&quot;+rc);</div><div class="line">                    System.out.println(&quot;path:&quot;+path);</div><div class="line">                    System.out.println(&quot;ctx:&quot;+ctx);</div><div class="line">                    System.out.println(&quot;name:&quot;+name);</div><div class="line">                &#125;</div><div class="line">                </div><div class="line">            &#125;, &quot;async_&quot;);</div><div class="line">            </div><div class="line">            String actual_path = zk.create(path, dataStr.getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);</div><div class="line">            System.out.println(&quot;Created Async success:&quot;+path);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">/*-------------------------   创建节点 end---------------------------------*/      </div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">/*-----------------------  删除节点 start ---------------------------------*/  </div><div class="line">    //删除</div><div class="line">    public void deleteSync(String path) throws InterruptedException, KeeperException&#123;</div><div class="line">        path=&quot;/&quot;+path;</div><div class="line">        if(zk.exists(path, false)!= null)&#123;//判断路径是否存在</div><div class="line">            //if the given version is -1, it matches any node&apos;s versions</div><div class="line">            zk.delete(path, -1);</div><div class="line">            System.out.println(&quot;delete sync success......&quot;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">  //删除</div><div class="line">    public void deleteAsync(String path) throws InterruptedException, KeeperException&#123;</div><div class="line">        </div><div class="line">        path=&quot;/&quot;+path;</div><div class="line">        if(zk.exists(path, false)!= null)&#123;//判断路径是否存在</div><div class="line">            zk.delete(path, -1, new VoidCallback()&#123;</div><div class="line">                @Override</div><div class="line">                public void processResult(int rc, String path, Object ctx) &#123;</div><div class="line">                    System.out.println(&quot;rc:&quot;+rc);</div><div class="line">                    System.out.println(&quot;path:&quot;+path);</div><div class="line">                    System.out.println(&quot;ctx:&quot;+ctx);</div><div class="line">                &#125;</div><div class="line">                </div><div class="line">            &#125;, &quot;delete_async&quot;);</div><div class="line">            System.out.println(&quot;delete async success......&quot;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">/*------------------  删除节点 end-------------------------------------*/    </div><div class="line"></div><div class="line">  </div><div class="line">/*--------------------  获取子节点 start --------------------------------*/  </div><div class="line">    //获取子节点(同步)</div><div class="line">    public List&lt;String&gt; getChildrenSync(String path) throws KeeperException, InterruptedException&#123;</div><div class="line">        path = &quot;/&quot;+path;</div><div class="line">        if(zk.exists(path, false)!= null)&#123;//判断路径是否存在</div><div class="line">            return zk.getChildren(path, false);</div><div class="line">        &#125;</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">  //获取子节点(同步+stat)</div><div class="line">    public List&lt;String&gt; getChildrenSyncWithStat(String path) throws KeeperException, InterruptedException&#123;</div><div class="line">        path = &quot;/&quot;+path;</div><div class="line">        if(zk.exists(path, false)!= null)&#123;//判断路径是否存在</div><div class="line">            Stat stat = new Stat();</div><div class="line">            List childList = zk.getChildren(path, false, stat);//会将查询到的状态copy到stat中：如DataTree.copyStat(response.getStat(), stat);</div><div class="line">            /*下面是所有的状态信息（stat的封装信息）</div><div class="line">            [zk: localhost:2182(CONNECTED) 65] get /name_async</div><div class="line">            &quot;zshangsna&quot;</div><div class="line">            cZxid = 0x200000070</div><div class="line">            ctime = Mon Nov 07 22:31:48 CST 2016</div><div class="line">            mZxid = 0x200000070</div><div class="line">            mtime = Mon Nov 07 22:31:48 CST 2016</div><div class="line">            pZxid = 0x200000074</div><div class="line">            cversion = 2</div><div class="line">            dataVersion = 0</div><div class="line">            aclVersion = 0</div><div class="line">            ephemeralOwner = 0x0</div><div class="line">            dataLength = 11</div><div class="line">            numChildren = 2</div><div class="line">             */</div><div class="line">            System.out.println(&quot;stat:&quot;+stat.getNumChildren()+&quot;;;;dataLength:&quot;+stat.getDataLength());</div><div class="line">            return childList;</div><div class="line">        &#125;</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    //获取子节点(异步)</div><div class="line">    public void getChildrenASync(String path) throws KeeperException, InterruptedException&#123;</div><div class="line">        path = &quot;/&quot;+path;</div><div class="line">        if(zk.exists(path, false)!= null)&#123;//判断路径是否存在</div><div class="line">            zk.getChildren(path, false, new AsyncCallback.Children2Callback()&#123;</div><div class="line">                @Override</div><div class="line">                public void processResult(int rc, String path, Object ctx,List&lt;String&gt; children, Stat stat) &#123;</div><div class="line">                    if(children != null)&#123;</div><div class="line">                        for(String child : children)&#123;</div><div class="line">                            System.out.println(&quot;child-name:&quot;+child);</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;&#125;, &quot;async_getchildren&quot;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    public void printChildList(String path) throws KeeperException, InterruptedException&#123;</div><div class="line">        </div><div class="line">//        List&lt;String&gt; childList = this.getChildrenSync(path);</div><div class="line">        List&lt;String&gt; childList = this.getChildrenSyncWithStat(path);</div><div class="line">        if(childList != null)&#123;</div><div class="line">            for(String child : childList)&#123;</div><div class="line">                System.out.println(&quot;child-name:&quot;+child);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">/*---------------  获取子节点 end-------------------------*/  </div><div class="line"></div><div class="line">    </div><div class="line"></div><div class="line">/*------------------  获取节点数据 start ----------------*/  </div><div class="line">    //获取节点数据(异步)</div><div class="line">    public void printNodeData(String path) throws KeeperException, InterruptedException&#123;</div><div class="line">        path = &quot;/&quot;+path;</div><div class="line">        if(zk.exists(path, false)!= null)&#123;//判断路径是否存在</div><div class="line">            zk.getData(    path, false, new AsyncCallback.DataCallback()&#123;</div><div class="line">                @Override</div><div class="line">                public void processResult(int rc, String path, Object ctx,byte[] data, Stat stat) &#123;</div><div class="line">                    if(data != null)&#123;</div><div class="line">                        System.out.println(&quot;path:&quot;+path);</div><div class="line">                        System.out.println(&quot;data:&quot;+new String(data));</div><div class="line">                        System.out.println(&quot;stat:&quot;+stat);</div><div class="line">                        System.out.println(&quot;ctx:&quot;+ctx);</div><div class="line">                    &#125;</div><div class="line">                &#125;&#125;,&quot;ctx_data&quot;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">/*------------------  获取节点数据 end--------------------*/  </div><div class="line"></div><div class="line">    </div><div class="line">    public static void main(String[] args) throws IOException, InterruptedException, KeeperException &#123;</div><div class="line">        WatchExample watchExample = new WatchExample();</div><div class="line">        String path = &quot;name_async&quot;;</div><div class="line">        //连接</div><div class="line">        watchExample.connect(&quot;192.168.0.50:2182&quot;);</div><div class="line">        </div><div class="line">        </div><div class="line">        //创建</div><div class="line">//        watchExample.createSync(&quot;name/beijing&quot;,&quot;zhangsan&quot;);</div><div class="line">//        watchExample.createAsync(path,&quot;async&quot;);</div><div class="line">        </div><div class="line">        //删除</div><div class="line">//        watchExample.deleteSync(path);</div><div class="line">//        watchExample.deleteAsync(path);</div><div class="line">        </div><div class="line">        System.out.println(&quot;main..............&quot;); </div><div class="line">        </div><div class="line">        //打印子节点列表</div><div class="line">//        watchExample.printChildList(path);</div><div class="line">//        watchExample.getChildrenASync(path);</div><div class="line">        </div><div class="line">        //打印节点数据</div><div class="line">        watchExample.printNodeData(path);</div><div class="line">        </div><div class="line">        Thread.sleep(8000);//如果是异步的话，那么就要在子线程结束后，主线程才能推出，不然子线程的结果无法返回，所以这里会sleep</div><div class="line">        watchExample.close();</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/bigdata/zookeeper/zookeeper客户端API使用(zk-API)/" data-id="cj290scn801c7ssqqhy12u51w" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zookeeper/">zookeeper</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-bigdata/zookeeper/zookeeper安装配置(单机，伪分布式、集群)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/bigdata/zookeeper/zookeeper安装配置(单机，伪分布式、集群)/" class="article-date">
  <time datetime="2017-04-16T04:47:25.338Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/bigdata/zookeeper/zookeeper安装配置(单机，伪分布式、集群)/">zookeeper安装配置(单机，伪分布式、集群)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-单机模式搭建"><a href="#1-单机模式搭建" class="headerlink" title="1.单机模式搭建"></a>1.单机模式搭建</h1><h2 id="1-1-解压"><a href="#1-1-解压" class="headerlink" title="1.1.解压"></a>1.1.解压</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cd /home/oldboy/tools/                </div><div class="line">tar -zxvf zookeeper-3.4.5.tar.gz </div><div class="line">mv zookeeper-3.4.5 zookeeper</div></pre></td></tr></table></figure>
<h2 id="1-2-修改配置文件"><a href="#1-2-修改配置文件" class="headerlink" title="1.2.修改配置文件"></a>1.2.修改配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">cd zookeeper/conf/ </div><div class="line">cp   zoo_sample.cfg   zoo_sample.cfg.bak          #首先备份配置文件</div><div class="line">mv   zoo_sample.cfg   zoo.cfg               #将配置文件改名</div><div class="line"></div><div class="line"></div><div class="line">&apos;修改下列选项&apos;</div><div class="line">tickTime=2000</div><div class="line">dataDir=/usr/local/zk/data</div><div class="line">dataLogDir=/usr/local/zk/dataLog      </div><div class="line">clientPort=2181</div></pre></td></tr></table></figure>
<h2 id="1-3-配置环境变量"><a href="#1-3-配置环境变量" class="headerlink" title="1.3.配置环境变量"></a>1.3.配置环境变量</h2><p>为了今后操作方便，我们需要对Zookeeper的环境变量进行配置，方法如下在/etc/profile文件中加入如下内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&apos;需要Java的环境，所以如果没有jdk，需要配置jdk&apos;</div><div class="line">ZOOKEEPER=/home/oldboy/tools/zookeeper</div><div class="line">PATH=$ZOOKEEPER/bin:$PATH</div><div class="line">export PATH</div></pre></td></tr></table></figure></p>
<h2 id="1-4-启动-停止服务"><a href="#1-4-启动-停止服务" class="headerlink" title="1.4.启动/停止服务"></a>1.4.启动/停止服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#启动ZooKeeper的Server</div><div class="line">./bin/zkServer.sh start</div><div class="line"></div><div class="line">#关闭ZooKeeper的Server</div><div class="line">./bin/zkServer.sh stop</div></pre></td></tr></table></figure>
<h1 id="2-伪集群模式搭建"><a href="#2-伪集群模式搭建" class="headerlink" title="2.伪集群模式搭建"></a>2.伪集群模式搭建</h1><h2 id="2-1-复制及修改配置文件"><a href="#2-1-复制及修改配置文件" class="headerlink" title="2.1.复制及修改配置文件"></a>2.1.复制及修改配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">[root@data-1-1 ~]# cd /home/oldboy/tools/zookeeper</div><div class="line">[root@data-1-1 zookeeper0]# cp ./conf/zoo.cfg zoo1.cfg</div><div class="line">[root@data-1-1 zookeeper0]# cp ./conf/zoo.cfg zoo2.cfg</div><div class="line">[root@data-1-1 zookeeper0]# cp ./conf/zoo.cfg zoo3.cfg</div><div class="line"></div><div class="line">&apos;##################   zoo1.cfg   ###########################&apos;</div><div class="line"># The number of milliseconds of each tick</div><div class="line">tickTime=2000</div><div class="line"> </div><div class="line"># The number of ticks that the initial</div><div class="line"># synchronization phase can take</div><div class="line">initLimit=10</div><div class="line"> </div><div class="line"># The number of ticks that can pass between</div><div class="line"># sending a request and getting an acknowledgement</div><div class="line">syncLimit=5</div><div class="line"> </div><div class="line"># the directory where the snapshot is stored.</div><div class="line">dataDir=/usr/local/zk/data_1</div><div class="line"> </div><div class="line"># the port at which the clients will connect</div><div class="line">clientPort=2181</div><div class="line"> </div><div class="line">#the location of the log file</div><div class="line">dataLogDir=/usr/local/zk/logs_1</div><div class="line"> </div><div class="line">server.0=localhost:2287:3387</div><div class="line">server.1=localhost:2288:3388</div><div class="line">server.2=localhost:2289:3389</div><div class="line"></div><div class="line">&apos;##################   zoo2.cfg   ###########################&apos;</div><div class="line"># The number of milliseconds of each tick</div><div class="line">tickTime=2000</div><div class="line"> </div><div class="line"># The number of ticks that the initial</div><div class="line"># synchronization phase can take</div><div class="line">initLimit=10</div><div class="line"> </div><div class="line"># The number of ticks that can pass between</div><div class="line"># sending a request and getting an acknowledgement</div><div class="line">syncLimit=5</div><div class="line"> </div><div class="line"># the directory where the snapshot is stored.</div><div class="line">dataDir=/usr/local/zk/data_2</div><div class="line"> </div><div class="line"># the port at which the clients will connect</div><div class="line">clientPort=2182</div><div class="line"> </div><div class="line">#the location of the log file</div><div class="line">dataLogDir=/usr/local/zk/logs_2</div><div class="line"> </div><div class="line">server.0=localhost:2287:3387</div><div class="line">server.1=localhost:2288:3388</div><div class="line">server.2=localhost:2289:3389</div><div class="line"></div><div class="line">&apos;##################   zoo3.cfg   ###########################&apos;</div><div class="line"># The number of milliseconds of each tick</div><div class="line">tickTime=2000</div><div class="line"> </div><div class="line"># The number of ticks that the initial</div><div class="line"># synchronization phase can take</div><div class="line">initLimit=10</div><div class="line"> </div><div class="line"># The number of ticks that can pass between</div><div class="line"># sending a request and getting an acknowledgement</div><div class="line">syncLimit=5</div><div class="line"> </div><div class="line"># the directory where the snapshot is stored.</div><div class="line">dataDir=/usr/local/zk/data_3</div><div class="line"> </div><div class="line"># the port at which the clients will connect</div><div class="line">clientPort=2183</div><div class="line"> </div><div class="line">#the location of the log file</div><div class="line">dataLogDir=/usr/local/zk/logs_3</div><div class="line"> </div><div class="line">server.0=localhost:2287:3387</div><div class="line">server.1=localhost:2288:3388</div><div class="line">server.2=localhost:2289:3389</div><div class="line"></div><div class="line"></div><div class="line">&apos;#其实上述配置文件就是：clientPort、dataDir、dataLogDir、server.x 不同&apos;</div></pre></td></tr></table></figure>
<h2 id="2-2-创建相应的文件"><a href="#2-2-创建相应的文件" class="headerlink" title="2.2.创建相应的文件"></a>2.2.创建相应的文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">//创建dataLogDir</div><div class="line">mkdir /usr/local/zk/logs_1 -p</div><div class="line">mkdir /usr/local/zk/logs_2 -p</div><div class="line">mkdir /usr/local/zk/logs_3 -p</div><div class="line"></div><div class="line">//创建dataDir</div><div class="line">mkdir /usr/local/zk/data_1 -p</div><div class="line">mkdir /usr/local/zk/data_2 -p</div><div class="line">mkdir /usr/local/zk/data_3 -p</div><div class="line"></div><div class="line">//在dataDir下创建myid</div><div class="line">/*</div><div class="line">在/usr/local/zk/data_x目录下创建myid文件，在对应的myid文件中写入数字，</div><div class="line">server.X和myid： server.X 这个数字就是对应，data/myid中的数字。在3个server的myid文件中分别写入了0，1，2</div><div class="line">*/</div><div class="line">echo &quot;0&quot;&gt;/usr/local/zk/data_1/myid</div><div class="line">echo &quot;1&quot;&gt;/usr/local/zk/data_2/myid</div><div class="line">echo &quot;2&quot;&gt;/usr/local/zk/data_3/myid</div><div class="line"></div><div class="line">cat    /usr/local/zk/data_3/myid        #检查一下</div></pre></td></tr></table></figure>
<h2 id="2-3-启动"><a href="#2-3-启动" class="headerlink" title="2.3.启动"></a>2.3.启动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">[root@data-1-1 conf]# zkServer.sh start zoo1.cfg               </div><div class="line">JMX enabled by default</div><div class="line">Using config: /home/oldboy/tools/zookeeper0/bin/../conf/zoo1.cfg        #为什么没有指定路径，因为配置了zk的环境变量，这里就可以看到回去找对应的bin和conf目录</div><div class="line">Starting zookeeper ... STARTED</div><div class="line"></div><div class="line">[root@data-1-1 conf]# zkServer.sh start zoo2.cfg</div><div class="line">JMX enabled by default</div><div class="line">Using config: /home/oldboy/tools/zookeeper0/bin/../conf/zoo2.cfg</div><div class="line">Starting zookeeper ... STARTED</div><div class="line"></div><div class="line">[root@data-1-1 conf]# zkServer.sh start zoo3.cfg</div><div class="line">JMX enabled by default</div><div class="line">Using config: /home/oldboy/tools/zookeeper0/bin/../conf/zoo3.cfg</div><div class="line">Starting zookeeper ... STARTED</div><div class="line"></div><div class="line">//检查，是3个表示启动成功</div><div class="line">[root@data-1-1 conf]# jps</div><div class="line">2566 QuorumPeerMain</div><div class="line">2539 QuorumPeerMain</div><div class="line">2638 Jps</div><div class="line">2607 QuorumPeerMain</div><div class="line">[root@data-1-1 conf]#</div><div class="line"></div><div class="line"></div><div class="line">//检查2：通过命令的方式</div><div class="line">[root@data-1-1 tools]# zkServer.sh status zoo1.cfg</div><div class="line">JMX enabled by default</div><div class="line">Using config: /home/oldboy/tools/zookeeper0/bin/../conf/zoo1.cfg</div><div class="line">Mode: follower</div><div class="line"></div><div class="line">[root@data-1-1 tools]# zkServer.sh status zoo2.cfg</div><div class="line">JMX enabled by default</div><div class="line">Using config: /home/oldboy/tools/zookeeper0/bin/../conf/zoo2.cfg</div><div class="line">Mode: leader</div><div class="line"></div><div class="line">[root@data-1-1 tools]# zkServer.sh status zoo3.cfg</div><div class="line">JMX enabled by default</div><div class="line">Using config: /home/oldboy/tools/zookeeper0/bin/../conf/zoo3.cfg</div><div class="line">Mode: follower</div></pre></td></tr></table></figure>
<h1 id="3-集群模式搭建"><a href="#3-集群模式搭建" class="headerlink" title="3.集群模式搭建"></a>3.集群模式搭建</h1><h2 id="3-1-相同的配置文件"><a href="#3-1-相同的配置文件" class="headerlink" title="3.1.相同的配置文件"></a>3.1.相同的配置文件</h2><p>创建一个配置文件zoo.cfg<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"># The number of milliseconds of each tick</div><div class="line">tickTime=2000</div><div class="line"> </div><div class="line"># The number of ticks that the initial</div><div class="line"># synchronization phase can take</div><div class="line">initLimit=10</div><div class="line"> </div><div class="line"># The number of ticks that can pass between</div><div class="line"># sending a request and getting an acknowledgement</div><div class="line">syncLimit=5</div><div class="line"> </div><div class="line"># the directory where the snapshot is stored.</div><div class="line">dataDir=/usr/local/zk/data</div><div class="line"> </div><div class="line"># the port at which the clients will connect</div><div class="line">clientPort=2183</div><div class="line"> </div><div class="line">#the location of the log file</div><div class="line">dataLogDir=/usr/local/zk/log</div><div class="line"> </div><div class="line">server.0=hadoop:2288:3388</div><div class="line">server.1=hadoop0:2288:3388</div><div class="line">server.2=hadoop1:2288:3388</div><div class="line"></div><div class="line">#此时的server.x就相同，因为配置文件在不同的机器上，所以不必担心端口冲突的问题</div></pre></td></tr></table></figure></p>
<h2 id="3-2-创建myid"><a href="#3-2-创建myid" class="headerlink" title="3.2.创建myid"></a>3.2.创建myid</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">在dataDir(/usr/local/zk/data)目录创建myid文件</div><div class="line"> </div><div class="line">Server0机器的内容为：0</div><div class="line">Server1机器的内容为：1</div><div class="line">Server2机器的内容为：2</div></pre></td></tr></table></figure>
<h2 id="3-3-创建dataDir和dataLogDir"><a href="#3-3-创建dataDir和dataLogDir" class="headerlink" title="3.3.创建dataDir和dataLogDir"></a>3.3.创建dataDir和dataLogDir</h2><p>在3台机器上都执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//创建dataLogDir</div><div class="line">mkdir /usr/local/zk/logs -p</div><div class="line"></div><div class="line"> </div><div class="line">//创建dataDir</div><div class="line">mkdir /usr/local/zk/data -p</div></pre></td></tr></table></figure></p>
<h2 id="3-4-启动"><a href="#3-4-启动" class="headerlink" title="3.4.启动"></a>3.4.启动</h2><p>在3台机器上都执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">zkServer.sh start</div><div class="line"></div><div class="line">//检查</div><div class="line">zkServer.sh status</div></pre></td></tr></table></figure></p>
<h2 id="3-5-客户端连接"><a href="#3-5-客户端连接" class="headerlink" title="3.5.客户端连接"></a>3.5.客户端连接</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">zkCli.sh -server 192.168.0.50:2182                        #带-server连接的是远端</div><div class="line">zkCli.sh                #连接的是本地</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/bigdata/zookeeper/zookeeper安装配置(单机，伪分布式、集群)/" data-id="cj290scnh01cessqqcl3vj7k3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zookeeper/">zookeeper</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-bigdata/zookeeper/zookeeper四字命令" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/bigdata/zookeeper/zookeeper四字命令/" class="article-date">
  <time datetime="2017-04-16T04:47:25.337Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/bigdata/zookeeper/zookeeper四字命令/">zookeeper四字命令</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li><p>定义<br>长度为4个英文字母的管理命令,比如stat就是其中一个</p>
</li>
<li><p>使用方式</p>
<ul>
<li>Telnet<ul>
<li>Telnet ip port</li>
<li>命令执行</li>
</ul>
</li>
<li>nc<ul>
<li>echo 命令|nc ip port</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="conf"><a href="#conf" class="headerlink" title="conf"></a>conf</h1><p>用于输出基本配置信息,也可以查看某些运行时参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">telnet localhost 2181 ,然后执行conf</div><div class="line">#或者</div><div class="line">echo conf|nc localhost 2181</div></pre></td></tr></table></figure></p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/zookeeper/4_command/1.png" alt=""></p>
<h1 id="cons"><a href="#cons" class="headerlink" title="cons"></a>cons</h1><p>用于输出当前客户端所有连接的详细信息,包括客户端ip,会话id等<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">telnet localhost 2181 ,然后执行cons</div><div class="line">#or</div><div class="line">echo cons | nc localhost 2181</div></pre></td></tr></table></figure></p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/zookeeper/4_command/2.png" alt=""></p>
<h1 id="crst"><a href="#crst" class="headerlink" title="crst"></a>crst</h1><p>用于重置客户端连接统计信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">telnet localhost 2181 ,然后执行 crst</div><div class="line">#or</div><div class="line">echo crst | nc localhost 2181</div></pre></td></tr></table></figure></p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/zookeeper/4_command/3.png" alt=""></p>
<h1 id="dump"><a href="#dump" class="headerlink" title="dump"></a>dump</h1><p>用于输出当前集群的所有会话信息,包括会话id以及临时节点等信息<br>如果dump的是leader节点,则还会有会话的超时时间<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">telnet localhost 2181  ,然后执行dump</div><div class="line">#or</div><div class="line">echo dump | nc localhost 2181</div></pre></td></tr></table></figure></p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/zookeeper/4_command/4.png" alt=""></p>
<h1 id="envi"><a href="#envi" class="headerlink" title="envi"></a>envi</h1><p>用于输出运行时的环境信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">telnet localhost 2181 ,然后执行envi</div><div class="line">#or</div><div class="line">echo envi | nc localhost 2181</div></pre></td></tr></table></figure></p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/zookeeper/4_command/5.png" alt=""></p>
<h1 id="ruok"><a href="#ruok" class="headerlink" title="ruok"></a>ruok</h1><p>用于输出当前zk服务器运行时是否正常,仅仅代表2181端口和四字命令流程执行正常,不能完全代表zk运行正常,最有效的命令是stat<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">telnet localhost 2181 ,然后执行ruok</div><div class="line">#or</div><div class="line">echo ruok | nc localhost 2181</div></pre></td></tr></table></figure></p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/zookeeper/4_command/6.png" alt=""></p>
<h1 id="stat"><a href="#stat" class="headerlink" title="stat"></a>stat</h1><p>用于获取服务器端的运行状态:zk版本 打包信息,运行时角色,集群节点等</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">telnet localhost 2181 ,然后执行stat</div><div class="line">#or</div><div class="line">echo stat | nc localhost 2181</div></pre></td></tr></table></figure>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/zookeeper/4_command/7.png" alt=""></p>
<h1 id="srvr"><a href="#srvr" class="headerlink" title="srvr"></a>srvr</h1><p>与stat功能类似,但是不输出连接信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">telnet localhost 2181 ,然后执行srvr</div><div class="line">#or</div><div class="line">echo srvr | nc localhost 2181</div></pre></td></tr></table></figure></p>
<h1 id="srst"><a href="#srst" class="headerlink" title="srst"></a>srst</h1><p>重置服务器的统计信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">telnet localhost 2181 ,然后执行srst</div><div class="line">#or</div><div class="line">echo srst | nc localhost 2181</div></pre></td></tr></table></figure></p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/zookeeper/4_command/8.png" alt=""></p>
<h1 id="wchs"><a href="#wchs" class="headerlink" title="wchs"></a>wchs</h1><p>用于输出当前服务器上管理的watcher的概要信息,通过zk构造器创建的默认watcher不在此统计范围</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">telnet localhost 2181 ,然后执行wchs</div><div class="line">#or</div><div class="line">echo wchs | nc localhost 2181</div></pre></td></tr></table></figure>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/zookeeper/4_command/9.png" alt=""></p>
<h1 id="wchc"><a href="#wchc" class="headerlink" title="wchc"></a>wchc</h1><p>用于输出当前服务器上管理的watcher的详细信息，以会话单位为组，通过zk构造器创建的默认watcher,不在此统计范围</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">telnet localhost 2181 ,然后执行wchc</div><div class="line">#or</div><div class="line">echo wchc | nc localhost 2181</div></pre></td></tr></table></figure>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/zookeeper/4_command/10.png" alt=""></p>
<h1 id="wchp"><a href="#wchp" class="headerlink" title="wchp"></a>wchp</h1><p>与wchc类似，但是以节点路径分组，通过zk构造器创建的默认watcher不在此统计范围</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">telnet localhost 2181 ,然后执行wchp</div><div class="line">#or</div><div class="line">echo wchp | nc localhost 2181</div></pre></td></tr></table></figure>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/zookeeper/4_command/11.png" alt=""></p>
<h1 id="mntr"><a href="#mntr" class="headerlink" title="mntr"></a>mntr</h1><p>与stat类似，但是比stat更详细，包括请求的延迟情况,服务区内存数据库大小,集群同步等情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">telnet localhost 2181 ,然后执行mntr</div><div class="line">#or</div><div class="line">echo mntr | nc localhost 2181</div></pre></td></tr></table></figure>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/zookeeper/4_command/12.png" alt=""></p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/zookeeper/4_command/13.png" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/bigdata/zookeeper/zookeeper四字命令/" data-id="cj290scmz01c0ssqq9n9l1k6e" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zookeeper/">zookeeper</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-bigdata/zookeeper/zookeeper命令行简单的CRUD命令" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/bigdata/zookeeper/zookeeper命令行简单的CRUD命令/" class="article-date">
  <time datetime="2017-04-16T04:47:25.335Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/bigdata/zookeeper/zookeeper命令行简单的CRUD命令/">zookeeper命令行简单的CRUD命令</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-登录客户端"><a href="#1-登录客户端" class="headerlink" title="1.登录客户端"></a>1.登录客户端</h1><p>在启动Zookeeper服务之后，输入以下命令，连接到Zookeeper服务：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">zkCli.sh -server localhost:2181   #连接的是localhost：2181服务</div></pre></td></tr></table></figure></p>
<h1 id="2-查看客户端帮助信息"><a href="#2-查看客户端帮助信息" class="headerlink" title="2.查看客户端帮助信息"></a>2.查看客户端帮助信息</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[zk: localhost:2181(CONNECTED) 0] help</div><div class="line">ZooKeeper -server host:port cmd args</div><div class="line">        stat path [watch]</div><div class="line">        set path data [version]</div><div class="line">        ls path [watch]</div><div class="line">        delquota [-n|-b] path</div><div class="line">        ls2 path [watch]</div><div class="line">        setAcl path acl</div><div class="line">        setquota -n|-b val path</div><div class="line">        history</div><div class="line">        redo cmdno</div><div class="line">        printwatches on|off</div><div class="line">        delete path [version]</div><div class="line">        sync path</div><div class="line">        listquota path</div><div class="line">        rmr path</div><div class="line">        get path [watch]</div><div class="line">        create [-s] [-e] path data acl</div><div class="line">        addauth scheme auth</div><div class="line">        quit</div><div class="line">        getAcl path</div><div class="line">        close</div><div class="line">        connect host:port</div><div class="line">[zk: localhost:2181(CONNECTED) 1]</div></pre></td></tr></table></figure>
<h1 id="3-简单的CRUD客户端操作命令"><a href="#3-简单的CRUD客户端操作命令" class="headerlink" title="3.简单的CRUD客户端操作命令"></a>3.简单的CRUD客户端操作命令</h1><p>在敲客户端命令的时候，可以使用tab键来补全</p>
<h2 id="3-1-查看节点"><a href="#3-1-查看节点" class="headerlink" title="3.1.查看节点"></a>3.1.查看节点</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[zk: localhost:2181(CONNECTED) 1] ls /</div><div class="line">[zookeeper]</div><div class="line">[zk: localhost:2181(CONNECTED) 2]</div></pre></td></tr></table></figure>
<h2 id="3-2-创建节点"><a href="#3-2-创建节点" class="headerlink" title="3.2.创建节点"></a>3.2.创建节点</h2><p>create [-s] [-e] path data acl</p>
<ol>
<li>创建zookeeper节点</li>
<li>-s或者-e表示创建的是顺序或临时节点，不加默认创建的是持久节点</li>
<li>Path为节点的全路径，没有相对节点的表示方式</li>
<li>data位当前创建节点内存储的数据</li>
<li>acl 用来进行权限控制，缺省情况下不做任何权限控制</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[zk: localhost:2181(CONNECTED) 14] create /test &quot;te_data&quot;</div><div class="line">Created /test</div><div class="line"></div><div class="line">//查看</div><div class="line">[zk: localhost:2181(CONNECTED) 8] ls /</div><div class="line">[zookeeper, test]</div><div class="line">[zk: localhost:2181(CONNECTED) 9] </div><div class="line"></div><div class="line">#创建顺序节点：会在节点的名字后面添加一系列数字</div><div class="line">[zk: localhost:2181(CONNECTED) 21] create -s /name &quot;zhangsan&quot;</div><div class="line">Created /name0000000003</div><div class="line">[zk: localhost:2181(CONNECTED) 21] create -s /name &quot;zhangsan2&quot;            #此时可以重复指定节点名字，因为最终要在节点名后添加序号的，所以名字最终还是唯一的</div><div class="line">Created /name0000000004</div><div class="line">[zk: localhost:2181(CONNECTED) 22] ls /</div><div class="line">[zookeeper, name0000000003, name0000000004]</div><div class="line">[zk: localhost:2181(CONNECTED) 23] </div><div class="line"></div><div class="line"></div><div class="line">#创建临时节点，在会话退出后，节点将会被删除</div><div class="line">[zk: localhost:2181(CONNECTED) 1] create -e /age 21</div><div class="line">Created /age</div><div class="line">[zk: localhost:2181(CONNECTED) 2] ls /</div><div class="line">[zookeeper, age, name0000000003]</div><div class="line">#可以退出之后在登录客户端，ls    /    查看</div></pre></td></tr></table></figure>
<h2 id="3-3-查看节点数据"><a href="#3-3-查看节点数据" class="headerlink" title="3.3.查看节点数据"></a>3.3.查看节点数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"> [zk: localhost:2181(CONNECTED) 15] get /test</div><div class="line">&quot;te_data&quot;</div><div class="line">cZxid = 0x10000000b</div><div class="line">ctime = Sun Nov 06 22:53:59 CST 2016</div><div class="line">mZxid = 0x10000000b</div><div class="line">mtime = Sun Nov 06 22:53:59 CST 2016</div><div class="line">pZxid = 0x10000000b</div><div class="line">cversion = 0</div><div class="line">dataVersion = 0</div><div class="line">aclVersion = 0</div><div class="line">ephemeralOwner = 0x0</div><div class="line">dataLength = 9</div><div class="line">numChildren = 0</div></pre></td></tr></table></figure>
<h2 id="3-4-修改节点数据"><a href="#3-4-修改节点数据" class="headerlink" title="3.4.修改节点数据"></a>3.4.修改节点数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">[zk: localhost:2181(CONNECTED) 16] set /test &quot;update_test&quot;</div><div class="line">cZxid = 0x10000000b</div><div class="line">ctime = Sun Nov 06 22:53:59 CST 2016</div><div class="line">mZxid = 0x10000000c</div><div class="line">mtime = Sun Nov 06 22:54:47 CST 2016</div><div class="line">pZxid = 0x10000000b</div><div class="line">cversion = 0</div><div class="line">dataVersion = 1</div><div class="line">aclVersion = 0</div><div class="line">ephemeralOwner = 0x0</div><div class="line">dataLength = 13</div><div class="line">numChildren = 0</div><div class="line"></div><div class="line">//查看</div><div class="line">[zk: localhost:2181(CONNECTED) 17] get /test</div><div class="line">&quot;update_test&quot;                            #修改之后的数据</div><div class="line">cZxid = 0x10000000b</div><div class="line">ctime = Sun Nov 06 22:53:59 CST 2016</div><div class="line">mZxid = 0x10000000c</div><div class="line">mtime = Sun Nov 06 22:54:47 CST 2016</div><div class="line">pZxid = 0x10000000b</div><div class="line">cversion = 0</div><div class="line">dataVersion = 1</div><div class="line">aclVersion = 0</div><div class="line">ephemeralOwner = 0x0</div><div class="line">dataLength = 13</div><div class="line">numChildren = 0</div><div class="line">[zk: localhost:2181(CONNECTED) 18]</div></pre></td></tr></table></figure>
<h2 id="3-5-删除节点"><a href="#3-5-删除节点" class="headerlink" title="3.5.删除节点"></a>3.5.删除节点</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">//删除前查看</div><div class="line">[zk: localhost:2181(CONNECTED) 18] ls /</div><div class="line">[zookeeper, test]</div><div class="line"></div><div class="line">#删除</div><div class="line">[zk: localhost:2181(CONNECTED) 19] delete /test</div><div class="line"></div><div class="line">#删除后查看</div><div class="line">[zk: localhost:2181(CONNECTED) 20] ls /</div><div class="line">[zookeeper]</div><div class="line">[zk: localhost:2181(CONNECTED) 21]</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/bigdata/zookeeper/zookeeper命令行简单的CRUD命令/" data-id="cj290scmt01bwssqqwgx6mvtm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zookeeper/">zookeeper</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-bigdata/zookeeper/zookeeper会话管理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/bigdata/zookeeper/zookeeper会话管理/" class="article-date">
  <time datetime="2017-04-16T04:47:25.334Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/bigdata/zookeeper/zookeeper会话管理/">zookeeper会话管理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="什么是会话"><a href="#什么是会话" class="headerlink" title="什么是会话?"></a>什么是会话?</h1><ul>
<li>代表客户端与服务器端的一个zk连接</li>
<li>底层通信是通过tcp协议进行连接通信</li>
<li>zookeeper会在服务器端创建一个会话对象来维护这个连接属性</li>
<li>当网络出现断网的抖动现象时,并不代表会话一定断开</li>
<li>会话对象的实现是SessionImpl,包括以下四个属性<ul>
<li>sessionID:唯一标识一个会话,具备全局唯一性</li>
<li>Timeout:会话超时时间,创建zookeeper客户端对象时传入,服务器会根据最小会话时间和最大会话时间来明确指定此值具体是什么</li>
<li>TickTime:下次会话超时时间</li>
<li>isClosing:标记一个会话是否已经被关闭,当服务器端检测到右会话失效时,就会把此会话标记为已关闭</li>
</ul>
</li>
</ul>
<h1 id="会话状态"><a href="#会话状态" class="headerlink" title="会话状态"></a>会话状态</h1><ul>
<li>Connecting</li>
<li>connected</li>
<li>reconnecting</li>
<li>reconnected</li>
<li>close<ul>
<li>服务器端判断会话超时后,在进行会话清除之前,会把会话的状态置为close</li>
</ul>
</li>
</ul>
<h1 id="sessionTracker"><a href="#sessionTracker" class="headerlink" title="sessionTracker"></a>sessionTracker</h1><p>服务器端通过此类来管理会话,包括会话的创建,管理和清除</p>
<p>通过三个数据结构从三个维度来管理会话</p>
<ul>
<li>sessionById属性:用于根据sessionID来查找session</li>
<li>sessionWithTimeout:通过sessionID来查找此session的失效时间是什么时候</li>
<li>sessionSets属性:通过某个时间查询都有哪些会话在这个时间点会失效</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public class SessionTrackerImpl extends Thread implements SessionTracker &#123;</div><div class="line"></div><div class="line">    HashMap&lt;Long, SessionImpl&gt; sessionsById = new HashMap&lt;Long, SessionImpl&gt;();</div><div class="line"></div><div class="line">    HashMap&lt;Long, SessionSet&gt; sessionSets = new HashMap&lt;Long, SessionSet&gt;();</div><div class="line"></div><div class="line">    ConcurrentHashMap&lt;Long, Integer&gt; sessionsWithTimeout;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="分桶策略"><a href="#分桶策略" class="headerlink" title="分桶策略"></a>分桶策略</h1><p>把所有的会话按照时间维度来进行分类管理,即同一个时间点失效的会话都在一起管理,即上面的属性ConcurrentHashMap<long, integer=""> sessionsWithTimeout</long,></p>
<p>会话失效时间计算:</p>
<ul>
<li>约定:把所有的时间按照某个单位时间进行等分(默认是服务器的tickTime配置)</li>
<li><p>公式:某次超时时间=((currentTime+sessiontimeout)/ ExpirationInterval +1) x ExpirationInterval</p>
</li>
<li><p>举例说明:</p>
<ul>
<li>由于服务器的tickTime的默认值是2000ms,则ExpirationInterval=2000ms</li>
<li>第一次创建会话时,currenttime=1370907000000</li>
<li>创建会话时,客户端传入的超时时间是15000ms</li>
<li>则,此会话的超时时间为((1370907000000+2000)+1)x2000=1370907016000</li>
</ul>
</li>
</ul>
<p>当某个会话由于有操作而导致超时时间变化,则会把会话从上一个桶移动到下一个桶中</p>
<h1 id="会话激活"><a href="#会话激活" class="headerlink" title="会话激活"></a>会话激活</h1><ul>
<li>当此会话一直有操作,则会话就不会失效</li>
<li>影响会话失效超时时间的因素<ul>
<li>心跳检测,及PING命令<ul>
<li>当客户端发现sessionTimeout/3时间范围内还没有任何操作命令产生,就发送一个ping心跳请求</li>
</ul>
</li>
<li>正常业务操作,比如get或者set</li>
</ul>
</li>
<li>每次业务操作或者心跳检测,都会重新计算超时时间,然后在桶之间转移会话</li>
</ul>
<h1 id="会话超时检测"><a href="#会话超时检测" class="headerlink" title="会话超时检测"></a>会话超时检测</h1><ul>
<li>由于sessionTracker中的一个线程负责检查session是否失效</li>
<li>线程检查周期也是ExpirationInterval的倍数</li>
<li>当某次检查时,如果在此次的分桶(即前面的ExpirationInterval)之前还有会话,就说明这些会话都超时了,因为会话如果有业务操作或者靠心跳,会不断的从小的分桶迁移到大的分桶</li>
</ul>
<p>举例:<br>系统启动时的时间是100001,此时ExpirationInterval=2000ms,则桶的刻度为100001/2000=50,下一次的检查时间为(100001/2000+1)x2000=102000</p>
<h1 id="会话清理流程"><a href="#会话清理流程" class="headerlink" title="会话清理流程"></a>会话清理流程</h1><ul>
<li>修改会话状态为close<ul>
<li>由于清理过程中需要一定时间,为了避免清理期间会话状态发生变化</li>
</ul>
</li>
<li>向所有的集群节点发送会话关闭请求</li>
<li>收集跟被清理的会话相关的临时节点</li>
<li>向集群节点发出删除临时节点的事务请求</li>
<li>集群中的所有节点执行删除临时节点事务</li>
<li>从sessionTracker的列表中移除会话</li>
<li>关闭会话的网络连接,具体类是NIOServerCnxnFactory</li>
</ul>
<h1 id="会话重连"><a href="#会话重连" class="headerlink" title="会话重连"></a>会话重连</h1><p>当客户端与服务器端的网络断开后,客户端会不断的重新连接,当连接上后会话的状态时以下两种状态:</p>
<ul>
<li>connected:服务器端会话依然存在</li>
<li>expired:服务器端的会话已经被关闭清除了</li>
</ul>
<p>注意:网络断开并不代表会话超时</p>
<h1 id="三个会话异常"><a href="#三个会话异常" class="headerlink" title="三个会话异常:"></a>三个会话异常:</h1><ul>
<li>connection_loss</li>
<li>session_expired</li>
<li>session_moved</li>
</ul>
<p>connection_loss</p>
<p>网络闪断导致或者是客户端服务器出现问题导致,出现此问题,客户端会重新找地址进行连接,当某个操作过程(比如setData)中出现connection_loss现象,则客户端会收到NoneDisconnected(设置了默认watcher情况下),同时会抛出异常:org.apache.zookeeper.KeeperException$ConnectionLossException,当重新连接上后,客户端会收到事件通知(None-SyncConnected)//在设置了默认watcher时</p>
<p>session_expired</p>
<p>通常发生在connection_loss期间,因为没有网络连接,就不能有操作和心跳进行,会话就会超时,由于重新连接时间较长,导致服务器端关闭了会话,并清除会话,此时会话相关联的watcher等数据都会丢失,watcher失效,出现这种情况,客户端需要重新创建zookeeper对象,并且恢复数据(比如注册watcher),会收到SessionExpiredException</p>
<p>session_moved</p>
<p>出现CONNECTION_LOSS时，客户端尝试重新连接下个节点(connectstring)<br>例如:客户端刚开始连接的是s1,由于网络中断,客户端尝试连接s2,连接成功之后,s2延续了会话,即会话从s1迁移到了s2<br>当出现以下业务场景时,服务器端回抛出SessionMovedException异常,由于客户端的连接已经发生了变化(从s1–&gt;s2),所以客户端收不到异常<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">有三台服务器:s1 s2 s3</div><div class="line">开始时,客户端连接s1,此时客户端发出一个修改数据的请求r1</div><div class="line">在修改数据的请求到达s1之前,客户端重新连接上了s2服务器,此时出现了会话转译</div><div class="line">连接s2后,客户端又发起一次数据修改请求r2</div><div class="line">r1被s1服务器处理,r2被s2处理(比r1被处理要早)</div><div class="line">这样对于客户端来说,请求被处理两次,并且r2被r1的处理结果覆盖了</div><div class="line">服务器端通过检查会话的所有者来判断此次会话请求是否合法,不合法就抛出moved异常</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/bigdata/zookeeper/zookeeper会话管理/" data-id="cj290scn201c3ssqq79c6uja4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zookeeper/">zookeeper</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-bigdata/zookeeper/zk详细配置说明" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/bigdata/zookeeper/zk详细配置说明/" class="article-date">
  <time datetime="2017-04-16T04:47:25.333Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/bigdata/zookeeper/zk详细配置说明/">zk详细配置说明</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>两种配置形式</p>
<ul>
<li>基于java的系统属性配置:比如:-Djava.library.path</li>
<li>zk自身的zoo.cfg文件</li>
</ul>
<table>
<thead>
<tr>
<th>属性名称</th>
<th>作用</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>dataLogDir</td>
<td>配置事务日志文件存储目录</td>
<td>1.不支持系统属性配置<br>2.默认为属性dataDir的值<br>3.在高并发下,有大量的事务日志和快照，会导致磁盘IO瓶颈，因此在高并发下,不建议使用默认配置，最好把dataDir和此属性配置的目录不同的磁盘下，从而提高IO</td>
</tr>
<tr>
<td>snapCount</td>
<td>两次快照间隔的事务日志条数</td>
<td>1.事务日志条数达到这个数目，就要触发数据快照<br>2.默认值Ѫ 100000<br>3.仅支持系统属性配置方式</td>
</tr>
<tr>
<td>preAllocSize</td>
<td>事务日志文件预分配的磁盘空间大小</td>
<td>1.仅支持系统属性配置， zookeeper.preAllocSize<br>2.默认值Ѫ 65535，即64M<br>3.此参数与snapCount有关， snapCount大，就需要多分配</td>
</tr>
<tr>
<td>minSessionTimeout<br>maxSessionTimeout</td>
<td>会话失效的时间的边界控制(服务器端)</td>
<td>1.不支持系统属性<br>2.默认为ticktime的2倍和20倍<br>3.当客户端传递过来的超时时间不在这两个参数之间，则最小取minSessionTimeout，最大取maxSessionTimeout</td>
</tr>
<tr>
<td>maxClientCnxns</td>
<td>从socket层限制客户端与单台服务器的并发连接数</td>
<td>1.不支持系统属性,默认值为60,0表示不限制<br>2.以IP地址为粒度进行控制<br>3.只能控制单台机器,不能控制总连接</td>
</tr>
<tr>
<td>jute.maxbuffer</td>
<td>配置单个节点最大的数据大小</td>
<td>1.默认是10M，单位是字节，仅支持系统属性方式配置<br>2.Zk上存储的数据不易过多,主要是考虑多节点写入的性能<br>3.需要在服务器端和客户端都配置才能生效</td>
</tr>
<tr>
<td>Autopurge.snapRetainCount</td>
<td>自动清理快照和事务日志时需要保留的文件数</td>
<td>1.不支持系统属性配置,系统默认为3,可以不用配置<br>2.最小值为3,避免磁盘损坏后不能回复数据</td>
</tr>
<tr>
<td>Autopurge.purgeInterval</td>
<td>自动清理快照和事务的周期</td>
<td>1.不支持系统属性,默认为0,表示不开启自动清理<br>2.与Autopurge.snapRetainCount属性一起配合使用<br>3.配置为负数也表示不清理</td>
</tr>
<tr>
<td>fsync.warningthresholdms</td>
<td>事务日志刷新到磁盘的报警阈值</td>
<td>1.支持系统属性,默认值是1000ms<br>2.如果fsync的操作超过此时间就会在日志中打印报警日志</td>
</tr>
<tr>
<td>forceSync</td>
<td>日志提交时是否强磁盘</td>
<td>1.默认为true<br>2.仅支持系统属性配置:zookeeper.forceSync,<br>3.如果设置为true,可以提升写入性能,但是会有数据丢失风险</td>
</tr>
<tr>
<td>cnxTimeout</td>
<td>选举过程中，服务器之间创建tcp连接的超时时间</td>
<td>1.仅支持系统属性配置:zokeeper.cnxTimeout <br>2.默认为5000ms</td>
</tr>
</tbody>
</table>
<p>参见:<br><a href="http://blog.csdn.net/lengzijian/article/details/9226867" target="_blank" rel="external">zookeeper配置文件详解</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/bigdata/zookeeper/zk详细配置说明/" data-id="cj290scmq01btssqqgcbcfb3s" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zookeeper/">zookeeper</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-bigdata/zookeeper/zk的几个基本的概念介绍" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/bigdata/zookeeper/zk的几个基本的概念介绍/" class="article-date">
  <time datetime="2017-04-16T04:47:25.332Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/bigdata/zookeeper/zk的几个基本的概念介绍/">zk的几个基本的概念介绍</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-集群角色（Leader、Follower、Observer）"><a href="#1-集群角色（Leader、Follower、Observer）" class="headerlink" title="1.集群角色（Leader、Follower、Observer）"></a>1.集群角色（Leader、Follower、Observer）</h1><ol>
<li>Leader：为客户端提供读写服务</li>
<li>Follower：仅提供读服务，所有写服务都需要转交给Leader角色，另外参与选举</li>
<li>Observer：仅提供读服务，不参与选举，一般是为了增强zk集群的读请求并发能力</li>
</ol>
<h1 id="2-会话（session）"><a href="#2-会话（session）" class="headerlink" title="2.会话（session）"></a>2.会话（session）</h1><ol>
<li>zk的客户端与zk的服务端之间的连接</li>
<li>通过心跳检测保持客户端连接的存活</li>
<li>接收来自服务端的watch事件通知</li>
<li>可以设置超时时间</li>
</ol>
<h1 id="3-数据节点（znode"><a href="#3-数据节点（znode" class="headerlink" title="3.数据节点（znode)"></a>3.数据节点（znode)</h1><ol>
<li>不是机器节点的意思</li>
<li>zk树形结构中的数据节点，用于存储数据</li>
<li>持久节点：一旦创建，除非主动调用删除，否则一直存储在zk上</li>
<li>临时节点：与客户端的会话绑定，一旦客户端会话失效，这个客户端创建的所有临时节点都会被移除</li>
<li>sequential znode（顺序节点）：创建节点时，如果设置属性sequential，则会自动在节点名后面追加一个整形的数字</li>
</ol>
<h1 id="4-版本"><a href="#4-版本" class="headerlink" title="4.版本"></a>4.版本</h1><ol>
<li>Version：当前znode的版本</li>
<li>Cversion：当前znode的子节点的版本</li>
<li>Aversion：当前znode的ACL（访问控制）版本</li>
</ol>
<h1 id="5-Watcher"><a href="#5-Watcher" class="headerlink" title="5.Watcher"></a>5.Watcher</h1><ol>
<li>作用于znode的节点上</li>
<li>多种事件通知，数据更新、子节点状态等会触发</li>
</ol>
<h1 id="6-ACL（访问控制列表）"><a href="#6-ACL（访问控制列表）" class="headerlink" title="6.ACL（访问控制列表）"></a>6.ACL（访问控制列表）</h1><ol>
<li>Access Control Lists</li>
<li>类似于Linux的权限控制</li>
<li>CREATE：创建子节点的权限</li>
<li>READ：获取子节点的权限</li>
<li>WRITE：更新节点数据的权限</li>
<li>DELETE：删除子节点的权限</li>
<li>ADMIN：设置acl的权限</li>
</ol>
<blockquote>
<p>CREATE和DELETE是针对子节点的权限控制</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/bigdata/zookeeper/zk的几个基本的概念介绍/" data-id="cj290scml01bpssqq5tqag3z1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zookeeper/">zookeeper</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-bigdata/zookeeper/zk分布式锁的类型" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/bigdata/zookeeper/zk分布式锁的类型/" class="article-date">
  <time datetime="2017-04-16T04:47:25.330Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/bigdata/zookeeper/zk分布式锁的类型/">zk分布式锁的类型</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="排他锁"><a href="#排他锁" class="headerlink" title="排他锁"></a>排他锁</h1><ul>
<li>定义:只能允许一个线程获得,其他线程都需要等待已经获取的线程完成才能再次争抢资源</li>
<li><p>zk实现:</p>
<ul>
<li><p>获得锁:通过构建一个目录,当叶子节点能创建成功,则任务获取到锁,因为一旦一个节点被某个会话创建,其他会话再次创建这个节点时,将会抛出异常,比如目录为:<br><img src="http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/zookeeper/lock/1.png" alt=""></p>
</li>
<li><p>释放锁:删除节点或者会话失效</p>
</li>
</ul>
</li>
</ul>
<h1 id="共享锁"><a href="#共享锁" class="headerlink" title="共享锁"></a>共享锁</h1><ul>
<li>定义:<br>读锁:如果前面线程使用的是读锁,则后面的线程还可以获取读锁,从而可以继续进行读操作<br>写锁:如果在线程打算获取锁从而进行操作时,无论前面已经有读锁或者是写锁都必须进入等待</li>
</ul>
<ul>
<li>zk实现:<ul>
<li>获得读锁:利用zk节点的顺序性,对于读操作,节点名称带一个R标识,如果前面存在序列数比自己小,并且都是带R标识,则说明前面加的都是读锁,还可以继续获取读锁,否则,等待锁释放后由机会再抢</li>
<li>获得写锁:只有自己创建的节点序列化最小,才能获得写锁,否则,进入等待,直到有锁资源被释放,然后再判断是否有机会得到锁</li>
<li>释放锁:删除节点或者会话失效<br><img src="http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/zookeeper/lock/2.png" alt=""></li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/bigdata/zookeeper/zk分布式锁的类型/" data-id="cj290scmh01bmssqq1p40leyd" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zookeeper/">zookeeper</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-bigdata/zookeeper/watcher机制" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/bigdata/zookeeper/watcher机制/" class="article-date">
  <time datetime="2017-04-16T04:47:25.329Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/bigdata/zookeeper/watcher机制/">watcher简介及简单示例</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="watcher"><a href="#watcher" class="headerlink" title="watcher"></a>watcher</h1><ul>
<li><p>问题</p>
<ol>
<li>集群中有多个机器,当某个通用的配置发生变化后,怎么让所有服务器的配置都统一生效?</li>
<li>当某个集群节点宕机,其他节点怎么知道?<blockquote>
<p>zk中引入了watcher机制来实现发布/订阅功能,能够让多个订阅者同时监听某一个主题对象,当这个主题对象自身状态变化时,会通知所有的订阅者</p>
</blockquote>
</li>
</ol>
</li>
</ul>
<ul>
<li>watcher组成<br><img src="http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/zookeeper/watcher/1.png" alt=""><ul>
<li>客户端</li>
<li>客户端watcherManager</li>
<li>zk服务器</li>
</ul>
</li>
<li><p>watcher机制</p>
<ol>
<li>客户端向zk服务器注册watcher的同时,会将watcher对象存储在客户端的watcherManager</li>
<li>zk服务器触发watcher事件后,回向客户端发送通知,客户端线程从watcherManager中调取watcher执行 </li>
</ol>
</li>
<li><p>watcher接口</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">public class ZLock implements Watcher</div><div class="line">public void process(WatcherEvent event)</div></pre></td></tr></table></figure>
<ul>
<li>事件类型<ul>
<li>通知状态:org.apache.zookeeper.Watcher.Event.KeeperState</li>
<li>事件类型:org.apache.zookeeper.Watcher.Event.EventType</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>keeperState</th>
<th>EventType</th>
<th>触发条件</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>SyncConnected</td>
<td>None(-1)</td>
<td>客户端与服务器成功建立会话</td>
<td>此时客户端处于连接状态</td>
</tr>
<tr>
<td>SyncConnected</td>
<td>NodeCreated(1)</td>
<td>Watcher监听的对应数据节点被创建</td>
<td>此时客户端处于连接状态</td>
</tr>
<tr>
<td>SyncConnected</td>
<td>NodeDataChanged(3)</td>
<td>数据节点的数据内容发生变更</td>
<td>此时客户端处于连接状态</td>
</tr>
<tr>
<td>SyncConnected</td>
<td>NodeChildrenChanged(4)</td>
<td>被监控的数据节点的子节点列表发生变更</td>
<td>此时客户端处于连接状态</td>
</tr>
<tr>
<td>Disconnected(0)</td>
<td>None(-1)</td>
<td>客户端与zk服务器端口连接</td>
<td>此时客户端与服务器处于断开连接状态</td>
</tr>
<tr>
<td>Expired(-12)</td>
<td>None(-1)</td>
<td>会话超时</td>
<td>此时客户端会话失效,通常会收到SessionExpiredException异常</td>
</tr>
<tr>
<td>AuthFailed(4)</td>
<td>None(-1)</td>
<td>1.使用错误的scheme进行授权检查;2.SALA权限检查失败</td>
<td>通常会受到AuthFailedException异常</td>
</tr>
<tr>
<td>Unknown(-1)</td>
<td></td>
<td></td>
<td>从3.0版本开始已经废弃</td>
</tr>
<tr>
<td>NoSyncConnected</td>
</tr>
</tbody>
</table>
<ul>
<li><p>NodeDataChanged事件</p>
<ul>
<li>无论节点数据发生变化还是数据版本发生变化都会触发</li>
<li>即使被更新数据与新数据一样,数据版本都会发生变化<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[zk: localhost:2181(CONNECTED) 6] get /student</div><div class="line">&quot;zhangsan&quot;</div><div class="line">cZxid = 0x3</div><div class="line">ctime = Thu Feb 23 17:29:37 CST 2017</div><div class="line">mZxid = 0x3</div><div class="line">mtime = Thu Feb 23 17:29:37 CST 2017</div><div class="line">pZxid = 0x3</div><div class="line">cversion = 0</div><div class="line">dataVersion = 0</div><div class="line">aclVersion = 0</div><div class="line">ephemeralOwner = 0x0</div><div class="line">dataLength = 10</div><div class="line">numChildren = 0</div><div class="line"></div><div class="line">#重新以相同的内容设置节点</div><div class="line">[zk: localhost:2181(CONNECTED) 7] set /student &quot;zhangsan&quot;</div><div class="line">cZxid = 0x3</div><div class="line">ctime = Thu Feb 23 17:29:37 CST 2017</div><div class="line">mZxid = 0x4</div><div class="line">mtime = Thu Feb 23 17:31:12 CST 2017</div><div class="line">pZxid = 0x3</div><div class="line">cversion = 0</div><div class="line">dataVersion = 1		#数据版本发生了变化</div><div class="line">aclVersion = 0</div><div class="line">ephemeralOwner = 0x0</div><div class="line">dataLength = 10</div><div class="line">numChildren = 0</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>NodeChildrenChanged</p>
<ul>
<li>新增节点或者删除节点</li>
</ul>
</li>
<li><p>AuthFailed</p>
<ul>
<li>重点不是客户端会话没有权限而是授权失败<blockquote>
<p>客户端只能收到相关事件的通知,但是并不能获取对应数据节点的原始数据内容以及变更之后新数据内容,因此,如果业务需要知道变更前的数据或者是变更收的数据,则需要业务保存变更前的数据和调用接口获取新的数据</p>
</blockquote>
</li>
</ul>
</li>
<li><p>watcher注册</p>
<ul>
<li><p>创建zk客户端对象实例时注册</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public ZooKeeper(String connectString, int sessionTimeout, Watcher watcher)</div><div class="line">public ZooKeeper(String connectString, int sessionTimeout, Watcher watcher, boolean canBeReadOnly)</div><div class="line">public ZooKeeper(String connectString, int sessionTimeout, Watcher watcher, long sessionId, byte[] sessionPasswd)</div><div class="line">public ZooKeeper(String connectString, int sessionTimeout, Watcher watcher, long sessionId, byte[] sessionPasswd, boolean canBeReadOnly)</div><div class="line"></div><div class="line">/*</div><div class="line">通过上述方式注册的watcher将会作为整个zk会话期间的默认watcher,会被一直保存在客户端ZKWatchManager的defaultWatcher中,如果有其他的设置,则这个watcher会被覆盖</div><div class="line">*/</div></pre></td></tr></table></figure>
</li>
<li><p>其他注册API</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">getChildren(String path, Watcher watcher)</div><div class="line"></div><div class="line">getChildren(String path, boolean watch)	</div><div class="line">	#Boolean watch 表示是否使用上下文中默认的watcher,即创建zk实例时设置的watcher</div><div class="line">	#The watch willbe triggered by a successful operation that deletes the node of the given path or creates/delete a child under the node. </div><div class="line"></div><div class="line">getData(String path, bolean watch, Stat stat)</div><div class="line">	#Boolean watch 表示是否使用上下文中默认的watcher,即创建zk实例时设置的watcher</div><div class="line">	#The watch will be triggered by a successful operation that sets data on the node, or deletes the node. </div><div class="line"></div><div class="line">getData(String path, Watcher watcher, AsyncCallback.DataCallback cb, Objcet ctx)</div><div class="line"></div><div class="line">exists(String path, boolean watch)</div><div class="line">	#Boolean watch 表示是否使用上下文中默认的watcher,即创建zk实例时设置的watcher</div><div class="line">	#The watch will be triggered by a successful operation that creates/delete the node or sets the data on the node.</div><div class="line"></div><div class="line">exists(String path, Watcher watcher)</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>watcher设置后,一旦触发一次即会失效,如果需要一直监听,就需要再注册(很重要)</p>
<p>下面用代码来说明:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">#Watcher</div><div class="line"></div><div class="line">public class WatcherExample1 implements Watcher &#123;</div><div class="line">	private ZooKeeper  zk = null;</div><div class="line">	@Override</div><div class="line">	public void process(WatchedEvent event) &#123;#watcher事件触发后的处理动作</div><div class="line">		System.out.println(&quot;watcher=&quot;+this.getClass().getName());</div><div class="line">		System.out.println(&quot;path=&quot;+event.getPath());</div><div class="line">		System.out.println(&quot;eventType=&quot;+event.getType().name());</div><div class="line">	&#125;</div><div class="line">	public ZooKeeper getZk() &#123;</div><div class="line">		return zk;</div><div class="line">	&#125;</div><div class="line">	public void setZk(ZooKeeper zk) &#123;</div><div class="line">		this.zk = zk;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">-----------------------------------</div><div class="line"></div><div class="line">#注册watcher</div><div class="line">public class WatcherRegister &#123;</div><div class="line">	private ZooKeeper  zk = null;</div><div class="line">	public WatcherRegister(String connectString,Watcher watcher) &#123;</div><div class="line">		try &#123;</div><div class="line">			zk = new ZooKeeper(connectString,10000,watcher);</div><div class="line">		&#125; catch (IOException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	public void testWatcherdisabled(String path) throws KeeperException, InterruptedException&#123;</div><div class="line">		WatcherExample1 we1 = new WatcherExample1();</div><div class="line">		we1.setZk(zk);</div><div class="line">		//向getData上注册一个watcher</div><div class="line">		zk.getData(path, we1, null);</div><div class="line">	&#125;</div><div class="line">	public static void main(String[] args) &#123;</div><div class="line">		WatcherExample we = new WatcherExample();</div><div class="line">		//注册watcher</div><div class="line">		WatcherRegister wr = new WatcherRegister(&quot;localhost:2181&quot;,we);</div><div class="line">		try &#123;</div><div class="line">			wr.testWatcherdisabled(&quot;/student&quot;);</div><div class="line">			Thread.sleep(300000);</div><div class="line">		&#125; catch (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>启动执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">watcher=com.zk.example.watcher.WatcherExample</div><div class="line">path=null</div><div class="line">eventType=None</div></pre></td></tr></table></figure></p>
<p>执行: set /student “zhangsan3” 打印下面的结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">watcher=com.zk.example.watcher.WatcherExample1</div><div class="line">path=/student</div><div class="line">eventType=NodeDataChanged</div></pre></td></tr></table></figure></p>
<p>再次执行: set /student “zhangsan3” 没有打印<br>说明:watcher设置后,一旦触发一次即会失效,如果需要一直监听,就需要再注册</p>
<p>下面是触发一次watcher之后,重新注册的例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">#watcher</div><div class="line">public class WatcherExample1 implements Watcher &#123;</div><div class="line">	private ZooKeeper  zk = null;</div><div class="line">	@Override</div><div class="line">	public void process(WatchedEvent event) &#123;</div><div class="line">		System.out.println(&quot;watcher=&quot;+this.getClass().getName());</div><div class="line">		System.out.println(&quot;path=&quot;+event.getPath());</div><div class="line">		System.out.println(&quot;eventType=&quot;+event.getType().name());</div><div class="line">		try &#123;</div><div class="line">			//在一次触发watcher之后,重新设置watcher</div><div class="line">			WatcherExample1 we1 = new WatcherExample1();</div><div class="line">			we1.setZk(zk);</div><div class="line">			zk.getData(event.getPath(), we1, null);</div><div class="line">		&#125; catch (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	public ZooKeeper getZk() &#123;</div><div class="line">		return zk;</div><div class="line">	&#125;</div><div class="line">	public void setZk(ZooKeeper zk) &#123;</div><div class="line">		this.zk = zk;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">---------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line"># 注册watcher</div><div class="line"></div><div class="line">public class WatcherRegister &#123;</div><div class="line">	private ZooKeeper  zk = null;</div><div class="line">	public WatcherRegister(String connectString,Watcher watcher) &#123;</div><div class="line">		try &#123;</div><div class="line">			zk = new ZooKeeper(connectString,10000,watcher);</div><div class="line">		&#125; catch (IOException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	public void testWatcherdisabled(String path) throws KeeperException, InterruptedException&#123;</div><div class="line">		WatcherExample1 we1 = new WatcherExample1();</div><div class="line">		we1.setZk(zk);</div><div class="line">		zk.getData(path, we1, null);</div><div class="line">	&#125;</div><div class="line">	public static void main(String[] args) &#123;</div><div class="line">		WatcherExample we = new WatcherExample();</div><div class="line">		WatcherRegister wr = new WatcherRegister(&quot;localhost:2181&quot;,we);</div><div class="line">		try &#123;</div><div class="line">			wr.testWatcherdisabled(&quot;/student&quot;);</div><div class="line">			Thread.sleep(300000);</div><div class="line">		&#125; catch (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">watcher=com.zk.example.watcher.WatcherExample</div><div class="line">path=null</div><div class="line">eventType=None</div></pre></td></tr></table></figure></p>
<p>修改:  set /student “zhangsan3”<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">watcher=com.zk.example.watcher.WatcherExample1</div><div class="line">path=/student</div><div class="line">eventType=NodeDataChanged</div></pre></td></tr></table></figure></p>
<p>再次修改:  set /student “zhangsan3” (<strong> 这里需要说明的是修改此次修改数据的内容还是”zhangsan3”,但是数据的版本是被改变了,所以数据节点还是被改变了 </strong>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">watcher=com.zk.example.watcher.WatcherExample1</div><div class="line">path=/student</div><div class="line">eventType=NodeDataChanged</div></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/bigdata/zookeeper/watcher机制/" data-id="cj290scmb01bhssqq9lrake0t" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zookeeper/">zookeeper</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-bigdata/zookeeper/watcher处理流程源码解析" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/bigdata/zookeeper/watcher处理流程源码解析/" class="article-date">
  <time datetime="2017-04-16T04:47:25.328Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hadoop/">hadoop</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/bigdata/zookeeper/watcher处理流程源码解析/">watcher处理流程源码解析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="客户端watcher注册流程"><a href="#客户端watcher注册流程" class="headerlink" title="客户端watcher注册流程"></a>客户端watcher注册流程</h1><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/zookeeper/watcher/2.png" alt=""><br><img src="http://ols7leonh.bkt.clouddn.com//assert/img/bigdata/zookeeper/watcher/3.png" alt=""></p>
<h1 id="服务器端处理watcher"><a href="#服务器端处理watcher" class="headerlink" title="服务器端处理watcher"></a>服务器端处理watcher</h1><ul>
<li><p>在服务器端的FinalRequestProcessor类,判断是否需要注册watcher</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">public class FinalRequestProcessor implements RequestProcessor &#123;</div><div class="line">    ZooKeeperServer zks;</div><div class="line"></div><div class="line">    public FinalRequestProcessor(ZooKeeperServer zks) &#123;</div><div class="line">        this.zks = zks;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void processRequest(Request request) &#123;</div><div class="line">        //...</div><div class="line">        ServerCnxn cnxn = request.cnxn;</div><div class="line"></div><div class="line">		//...</div><div class="line">        try &#123;</div><div class="line">            //...</div><div class="line">            switch (request.type) &#123;</div><div class="line">				</div><div class="line">				case OpCode.create: &#123;//创建节点</div><div class="line">					lastOp = &quot;CREA&quot;;</div><div class="line">					rsp = new CreateResponse(rc.path);</div><div class="line">					err = Code.get(rc.err);</div><div class="line">					break;</div><div class="line">				&#125;</div><div class="line">				case OpCode.delete: &#123;//删除节点</div><div class="line">					lastOp = &quot;DELE&quot;;</div><div class="line">					err = Code.get(rc.err);</div><div class="line">					break;</div><div class="line">				&#125;</div><div class="line">				</div><div class="line">				case OpCode.getData: &#123;//getData</div><div class="line">					lastOp = &quot;GETD&quot;;</div><div class="line">					GetDataRequest getDataRequest = new GetDataRequest();</div><div class="line">					ByteBufferInputStream.byteBuffer2Record(request.request,</div><div class="line">							getDataRequest);</div><div class="line">					DataNode n = zks.getZKDatabase().getNode(getDataRequest.getPath());</div><div class="line">					if (n == null) &#123;</div><div class="line">						throw new KeeperException.NoNodeException();</div><div class="line">					&#125;</div><div class="line">					Long aclL;</div><div class="line">					synchronized(n) &#123;</div><div class="line">						aclL = n.acl;</div><div class="line">					&#125;</div><div class="line">					PrepRequestProcessor.checkACL(zks, zks.getZKDatabase().convertLong(aclL),</div><div class="line">							ZooDefs.Perms.READ,</div><div class="line">							request.authInfo);</div><div class="line">					Stat stat = new Stat();</div><div class="line">					byte b[] = zks.getZKDatabase().getData(getDataRequest.getPath(), stat,</div><div class="line">							getDataRequest.getWatch() ? cnxn : null);//请求中watcher对象,则传入cnxn对象</div><div class="line">					rsp = new GetDataResponse(b, stat);</div><div class="line">					break;</div><div class="line">				&#125;</div><div class="line"> </div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>ServerCnxn类及cnxn对象</p>
<ul>
<li>zk客户端与服务器之间的tcp连接</li>
<li>实现了watcher接口</li>
<li>总结:既包含了连接信息,有包含了watcher信息</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">public abstract class ServerCnxn implements Stats, Watcher &#123;</div><div class="line">    // This is just an arbitrary object to represent requests issued by</div><div class="line">    // (aka owned by) this class</div><div class="line">    final public static Object me = new Object();</div><div class="line">    </div><div class="line">    protected ArrayList&lt;Id&gt; authInfo = new ArrayList&lt;Id&gt;();</div><div class="line"></div><div class="line">    boolean isOldClient = true;</div><div class="line"></div><div class="line">    abstract int getSessionTimeout();</div><div class="line"></div><div class="line">    abstract void close();</div><div class="line"></div><div class="line">    public abstract void sendResponse(ReplyHeader h, Record r, String tag)</div><div class="line">        throws IOException;</div><div class="line"></div><div class="line">    abstract void sendCloseSession();</div><div class="line"></div><div class="line">    public abstract void process(WatchedEvent event);	//watcher的回调函数</div><div class="line">	</div><div class="line">	//...</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>watcherManager<ul>
<li>zk服务器Watcher的管理者</li>
<li>从两个维度维护watcher<ul>
<li>watcherTable:从数据节点的粒度来维护</li>
<li>watch2Paths:从watcher的粒度来维护</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public class WatchManager &#123;</div><div class="line">    private static final Logger LOG = LoggerFactory.getLogger(WatchManager.class);</div><div class="line"></div><div class="line">    private final HashMap&lt;String, HashSet&lt;Watcher&gt;&gt; watchTable =</div><div class="line">        new HashMap&lt;String, HashSet&lt;Watcher&gt;&gt;();//通过数据节点的路径找到watcher</div><div class="line"></div><div class="line">    private final HashMap&lt;Watcher, HashSet&lt;String&gt;&gt; watch2Paths =</div><div class="line">        new HashMap&lt;Watcher, HashSet&lt;String&gt;&gt;();//通过watcher找到数据节点</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>watcher触发<ul>
<li>DataTree类<ul>
<li>维护节点目录树的数据结构</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>在DataTree类中有如下方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">public Stat setData(String path, byte data[], int version, long zxid,</div><div class="line">        long time) throws KeeperException.NoNodeException &#123;</div><div class="line">    Stat s = new Stat();</div><div class="line">    DataNode n = nodes.get(path);</div><div class="line">    if (n == null) &#123;</div><div class="line">        throw new KeeperException.NoNodeException();</div><div class="line">    &#125;</div><div class="line">    byte lastdata[] = null;</div><div class="line">    synchronized (n) &#123;//此处是更新数据</div><div class="line">        lastdata = n.data;</div><div class="line">        n.data = data;</div><div class="line">        n.stat.setMtime(time);</div><div class="line">        n.stat.setMzxid(zxid);</div><div class="line">        n.stat.setVersion(version);</div><div class="line">        n.copyStat(s);</div><div class="line">    &#125;</div><div class="line">    // now update if the path is in a quota subtree.</div><div class="line">    String lastPrefix;</div><div class="line">    if((lastPrefix = getMaxPrefixWithQuota(path)) != null) &#123;</div><div class="line">      this.updateBytes(lastPrefix, (data == null ? 0 : data.length)</div><div class="line">          - (lastdata == null ? 0 : lastdata.length));</div><div class="line">    &#125;</div><div class="line">		</div><div class="line">    dataWatches.triggerWatch(path, EventType.NodeDataChanged);//触发事件NodeDataChanged</div><div class="line">    return s;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="客户端回调watcher"><a href="#客户端回调watcher" class="headerlink" title="客户端回调watcher"></a>客户端回调watcher</h1><ul>
<li><p>客户端回调watcher步骤</p>
<ul>
<li>反序列化,将字节流转换成WatcherEvent对象</li>
<li>处理chrootPath</li>
<li>还原watchedEvent,把WatcherEvent对象转换成WatchedEvent</li>
<li>回调Watcher:把WatchedEvent对象交给EventThread线程处理</li>
</ul>
</li>
<li><p>EventThread</p>
<ul>
<li>从客户端的ZKWatchManager去取出Watcher,并放入waitingEvents队列中</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">class SendThread extends Thread &#123;</div><div class="line"></div><div class="line">	void readResponse(ByteBuffer incomingBuffer) throws IOException &#123;</div><div class="line">		ByteBufferInputStream bbis = new ByteBufferInputStream(incomingBuffer);</div><div class="line">		BinaryInputArchive bbia = BinaryInputArchive.getArchive(bbis);</div><div class="line">		ReplyHeader replyHdr = new ReplyHeader();</div><div class="line"></div><div class="line">		replyHdr.deserialize(bbia, &quot;header&quot;);</div><div class="line"></div><div class="line">		if (replyHdr.getXid() == -1) &#123;</div><div class="line">			// -1 means notification</div><div class="line"></div><div class="line">			WatcherEvent event = new WatcherEvent();</div><div class="line">			event.deserialize(bbia, &quot;response&quot;);//反序列化</div><div class="line"></div><div class="line">			// convert from a server path to a client path(转换路径)</div><div class="line">			if (chrootPath != null) &#123;</div><div class="line">				String serverPath = event.getPath();</div><div class="line">				if(serverPath.compareTo(chrootPath)==0)</div><div class="line">					event.setPath(&quot;/&quot;);</div><div class="line">				else if (serverPath.length() &gt; chrootPath.length())</div><div class="line">					event.setPath(serverPath.substring(chrootPath.length()));</div><div class="line">				else &#123;</div><div class="line">					LOG.warn(&quot;Got server path &quot; + event.getPath()</div><div class="line">							+ &quot; which is too short for chroot path &quot;</div><div class="line">							+ chrootPath);</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line"></div><div class="line">			WatchedEvent we = new WatchedEvent(event);//将WatcherEvent封装成WatchedEvent</div><div class="line">			if (LOG.isDebugEnabled()) &#123;</div><div class="line">				LOG.debug(&quot;Got &quot; + we + &quot; for sessionid 0x&quot;</div><div class="line">						+ Long.toHexString(sessionId));</div><div class="line">			&#125;</div><div class="line"></div><div class="line">			eventThread.queueEvent( we );//添加到事件处理线程</div><div class="line">			return;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/bigdata/zookeeper/watcher处理流程源码解析/" data-id="cj290scm601bessqqcnd0y8ja" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zookeeper/">zookeeper</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/36/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/35/">35</a><a class="page-number" href="/page/36/">36</a><span class="page-number current">37</span><a class="page-number" href="/page/38/">38</a><a class="page-number" href="/page/39/">39</a><span class="space">&hellip;</span><a class="page-number" href="/page/58/">58</a><a class="extend next" rel="next" href="/page/38/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/IDEA/">IDEA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/NFS/">NFS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tachyon/">Tachyon</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/azkaban/">azkaban</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/echarts/">echarts</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/flume/">flume</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/">hadoop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hbase/">hbase</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hive/">hive</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/inotify/">inotify</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/kafka/">kafka</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/logstash/">logstash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/markdown/">markdown</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/memcached/">memcached</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/project/">project</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/rsync/">rsync</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/scala/">scala</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/shell/">shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/socket/">socket</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/spark/">spark</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/sqoop/">sqoop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/storm/">storm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据仓库/">数据仓库</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDEA/">IDEA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux基础命令/">Linux基础命令</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux重要配置文件/">Linux重要配置文件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NFS/">NFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NIO/">NIO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azkaban/">azkaban</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/echarts/">echarts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flume/">flume</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hadoop/">hadoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hbase/">hbase</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hive/">hive</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/inotify/">inotify</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/">kafka</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logstash/">logstash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mapreduce/">mapreduce</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/memcached/">memcached</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/netty/">netty</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/project/">project</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rpc/">rpc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rsync/">rsync</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala/">scala</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala函数式编程/">scala函数式编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala编程/">scala编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socket/">socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spark/">spark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqoop/">sqoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/storm/">storm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zookeeper/">zookeeper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据仓库/">数据仓库</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/IDEA/" style="font-size: 10px;">IDEA</a> <a href="/tags/Linux基础命令/" style="font-size: 19.52px;">Linux基础命令</a> <a href="/tags/Linux重要配置文件/" style="font-size: 14.76px;">Linux重要配置文件</a> <a href="/tags/NFS/" style="font-size: 10px;">NFS</a> <a href="/tags/NIO/" style="font-size: 11.43px;">NIO</a> <a href="/tags/azkaban/" style="font-size: 10.48px;">azkaban</a> <a href="/tags/echarts/" style="font-size: 10.95px;">echarts</a> <a href="/tags/flume/" style="font-size: 10.95px;">flume</a> <a href="/tags/hadoop/" style="font-size: 18.57px;">hadoop</a> <a href="/tags/hbase/" style="font-size: 13.33px;">hbase</a> <a href="/tags/hive/" style="font-size: 18.1px;">hive</a> <a href="/tags/inotify/" style="font-size: 10px;">inotify</a> <a href="/tags/java/" style="font-size: 12.38px;">java</a> <a href="/tags/kafka/" style="font-size: 12.86px;">kafka</a> <a href="/tags/linux/" style="font-size: 13.33px;">linux</a> <a href="/tags/logstash/" style="font-size: 10.48px;">logstash</a> <a href="/tags/mapreduce/" style="font-size: 16.67px;">mapreduce</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/memcached/" style="font-size: 13.81px;">memcached</a> <a href="/tags/mongodb/" style="font-size: 14.76px;">mongodb</a> <a href="/tags/mysql/" style="font-size: 17.14px;">mysql</a> <a href="/tags/netty/" style="font-size: 10.95px;">netty</a> <a href="/tags/nginx/" style="font-size: 14.29px;">nginx</a> <a href="/tags/project/" style="font-size: 10.48px;">project</a> <a href="/tags/python/" style="font-size: 19.05px;">python</a> <a href="/tags/redis/" style="font-size: 17.14px;">redis</a> <a href="/tags/rpc/" style="font-size: 10.48px;">rpc</a> <a href="/tags/rsync/" style="font-size: 10px;">rsync</a> <a href="/tags/scala/" style="font-size: 17.62px;">scala</a> <a href="/tags/scala函数式编程/" style="font-size: 11.9px;">scala函数式编程</a> <a href="/tags/scala编程/" style="font-size: 15.71px;">scala编程</a> <a href="/tags/shell/" style="font-size: 17.62px;">shell</a> <a href="/tags/socket/" style="font-size: 11.9px;">socket</a> <a href="/tags/spark/" style="font-size: 20px;">spark</a> <a href="/tags/sqoop/" style="font-size: 10.95px;">sqoop</a> <a href="/tags/storm/" style="font-size: 15.24px;">storm</a> <a href="/tags/zookeeper/" style="font-size: 16.19px;">zookeeper</a> <a href="/tags/数据仓库/" style="font-size: 11.43px;">数据仓库</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/05/02/bigdata/spark从入门到精通_笔记/Tachyon/">Tachyon</a>
          </li>
        
          <li>
            <a href="/2017/04/30/数据仓库/数据仓库2/">数据仓库</a>
          </li>
        
          <li>
            <a href="/2017/04/29/IDEA/IDEA/">IDEA</a>
          </li>
        
          <li>
            <a href="/2017/04/29/数据仓库/ETL/">ETL</a>
          </li>
        
          <li>
            <a href="/2017/04/28/数据仓库/PowderDesigner/">PowderDesigner的使用</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Mr. Chen<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>




  </div>
</body>
</html>