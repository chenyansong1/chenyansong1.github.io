<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="一个技术渣的自说自话">
<meta property="og:type" content="website">
<meta property="og:title" content="Chen's Blog">
<meta property="og:url" content="http://yoursite.com/page/21/index.html">
<meta property="og:site_name" content="Chen's Blog">
<meta property="og:description" content="一个技术渣的自说自话">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chen's Blog">
<meta name="twitter:description" content="一个技术渣的自说自话">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"always","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/21/"/>





  <title> Chen's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Chen's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">一个技术渣的自说自话</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/mysql/mysql多实例配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/mysql/mysql多实例配置/" itemprop="url">
                  mysql多实例配置
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>前提: 在mysql已经安装的完毕,可以参见: &lt;&lt;编译安装MySQL-5.5.32.md&gt;&gt;一文</p>
<h1 id="1-多实例数据文件目录结构"><a href="#1-多实例数据文件目录结构" class="headerlink" title="1.多实例数据文件目录结构"></a>1.多实例数据文件目录结构</h1><p>&emsp;在该文档中，采用的是/data目录作为mysql多实例总的根目录，然后规则不同的数字（即Mysql实例端口号）作为/data下面的二级目录，不同的二级目录对应的数字就作为Mysql实例的端口号，以区别不同的实例，数字对应的二级目录下包含mysql数据文件、配置文件以及启动文件等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mkdir -p /data/&#123;3306,3307&#125;/data</div><div class="line"></div><div class="line">[root@lamp01 /]# tree /data</div><div class="line">/data</div><div class="line">|-- 3306</div><div class="line">|   `-- data</div><div class="line">`-- 3307</div><div class="line">    `-- data</div></pre></td></tr></table></figure>
<h1 id="2-上传配置和启动文件"><a href="#2-上传配置和启动文件" class="headerlink" title="2.上传配置和启动文件"></a>2.上传配置和启动文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">上传配置好的文件（F:\Linux_NOTE\MySQL数据库\data.zip）到 / 目录下</div><div class="line">cd /</div><div class="line">rz -y</div><div class="line">unzip data.zip</div><div class="line"></div><div class="line">#解压后的文件目录如下：</div><div class="line">[root@lamp01 /]# tree /data</div><div class="line">/data</div><div class="line">|-- 3306</div><div class="line">|   |-- data</div><div class="line">|   |-- my.cnf</div><div class="line">|   `-- mysql</div><div class="line">`-- 3307</div><div class="line">    |-- data</div><div class="line">    |-- my.cnf</div><div class="line">    `-- mysql</div></pre></td></tr></table></figure>
<h1 id="3-配置文件-data-3306-my-cnf"><a href="#3-配置文件-data-3306-my-cnf" class="headerlink" title="3.配置文件/data/3306/my.cnf"></a>3.配置文件/data/3306/my.cnf</h1><h1 id="4-配置文件-data-3306-mysql"><a href="#4-配置文件-data-3306-mysql" class="headerlink" title="4.配置文件/data/3306/mysql"></a>4.配置文件/data/3306/mysql</h1><p>使用vim进去看，其实这个启动文件就是一个脚本，其中包含：启动、停止、重启的方法</p>
<h1 id="5-每个实例初始化数据"><a href="#5-每个实例初始化数据" class="headerlink" title="5.每个实例初始化数据"></a>5.每个实例初始化数据</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 /]# cd /application/mysql/scripts/</div><div class="line">#指定数据生成的目录为: /data/3306/data </div><div class="line">[root@lamp01 scripts]# ./mysql_install_db --basedir=/application/mysql/ --datadir=/data/3306/data --user=mysql</div><div class="line">[root@lamp01 scripts]# ./mysql_install_db --basedir=/application/mysql/ --datadir=/data/3307/data --user=mysql</div><div class="line"></div><div class="line"></div><div class="line">[root@lamp01 data]# tree -L 3 /data</div><div class="line">/data</div><div class="line">|-- 3306</div><div class="line">|   |-- data</div><div class="line">|   |   |-- mysql</div><div class="line">|   |   |-- performance_schema</div><div class="line">|   |   `-- test</div><div class="line">|   |-- my.cnf</div><div class="line">|   |-- mysql</div><div class="line">|   `-- mysql_oldboy3306.err</div><div class="line">`-- 3307</div><div class="line">    |-- data</div><div class="line">    |   |-- mysql</div><div class="line">    |   |-- performance_schema</div><div class="line">    |   `-- test</div><div class="line">    |-- my.cnf</div><div class="line">    |-- mysql</div><div class="line">    `-- mysql_oldboy3307.err</div></pre></td></tr></table></figure>
<h1 id="6-授权用户及目录"><a href="#6-授权用户及目录" class="headerlink" title="6.授权用户及目录"></a>6.授权用户及目录</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"> </div><div class="line">#授权用户及/tmp/临时文件目录</div><div class="line">chown -R mysql.mysql /data</div></pre></td></tr></table></figure>
<h1 id="7-给执行脚本执行权限"><a href="#7-给执行脚本执行权限" class="headerlink" title="7.给执行脚本执行权限"></a>7.给执行脚本执行权限</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 3306]# chmod a+x /data/&#123;3306,3307&#125;/mysql</div><div class="line"></div><div class="line">[root@lamp01 3306]# ll</div><div class="line">total 16</div><div class="line">drwxr-xr-x 5 mysql mysql 4096 Feb 16 22:33 data</div><div class="line">-rw-r--r-- 1 mysql mysql 1899 Oct 29  2013 my.cnf</div><div class="line">-rwxr-xr-x 1 mysql mysql 1307 Jul 15  2013 mysql</div><div class="line">-rw-r----- 1 mysql mysql   77 Feb 16 22:31 mysql_oldboy3306.err</div><div class="line">[root@lamp01 3306]#</div></pre></td></tr></table></figure>
<h1 id="5-启动多实例"><a href="#5-启动多实例" class="headerlink" title="5.启动多实例"></a>5.启动多实例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 3306]# /data/3306/mysql start</div><div class="line">Starting MySQL...</div><div class="line">[root@lamp01 3306]# /data/3307/mysql start</div><div class="line">Starting MySQL...</div><div class="line"></div><div class="line">#查看</div><div class="line">[root@lamp01 3306]# netstat -lntup|grep mysql</div><div class="line">tcp        0      0 0.0.0.0:3306                0.0.0.0:*                   LISTEN      2527/mysqld        </div><div class="line">tcp        0      0 0.0.0.0:3307                0.0.0.0:*                   LISTEN      3240/mysqld</div></pre></td></tr></table></figure>
<h1 id="6-初始化登录mysql"><a href="#6-初始化登录mysql" class="headerlink" title="6.初始化登录mysql"></a>6.初始化登录mysql</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#要指定对应实例的sock文件</div><div class="line">[root@lamp01 3306]# mysql -S /data/3306/mysql.sock </div><div class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div class="line">Your MySQL connection id is 1</div><div class="line">Server version: 5.5.51-log Source distribution</div><div class="line"> </div><div class="line">Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.</div><div class="line"> </div><div class="line">Oracle is a registered trademark of Oracle Corporation and/or its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line"> </div><div class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</div><div class="line"> </div><div class="line">mysql&gt;</div></pre></td></tr></table></figure>
<h1 id="7-配置密码和修改密码操作"><a href="#7-配置密码和修改密码操作" class="headerlink" title="7.配置密码和修改密码操作"></a>7.配置密码和修改密码操作</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//配置初始化密码</div><div class="line">[root@MySQL ~]# mysqladmin -uroot password &quot;oldboy123&quot; -S /data/3309/mysql.sock</div><div class="line">//用初始化密码登录</div><div class="line">[root@MySQL ~]# mysql -uroot -poldboy123 -S /data/3309/mysql.sock</div><div class="line"> </div><div class="line">//修改密码</div><div class="line">//非交互式的：直接写出了密码</div><div class="line">mysqladmin -uroot -poldboy123 password &quot;123&quot; -S /data/3309/mysql.sock</div><div class="line">//交互式的</div><div class="line">mysqladmin -uroot -poldboy123 password -S /data/3309/mysql.sock</div></pre></td></tr></table></figure>
<h1 id="8-去掉多余的登录用户和库"><a href="#8-去掉多余的登录用户和库" class="headerlink" title="8.去掉多余的登录用户和库"></a>8.去掉多余的登录用户和库</h1><p>参见: mysql数据库安装之后的优化操作.md  一文</p>
<h1 id="9-快速配置一个多实例"><a href="#9-快速配置一个多实例" class="headerlink" title="9.快速配置一个多实例"></a>9.快速配置一个多实例</h1><p>下面让我们来配置mysql 3308的多实例启动方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">mkdir -p /data/3308/data</div><div class="line">\cp /data/3306/my.cnf  /data/3308/</div><div class="line">\cp /data/3306/mysql  /data/3308/</div><div class="line">sed -i &apos;s/3306/3308/g&apos; /data/3308/my.cnf</div><div class="line">sed -i &apos;s/server-id = 1/server-id = 9/g&apos; /data/3308/my.cnf</div><div class="line">sed -i &apos;s/3306/3308/g&apos; /data/3308/mysql</div><div class="line">chown -R mysql:mysql /data/3308</div><div class="line">chmod 700 /data/3308/mysql</div><div class="line">cd /application/mysql/scripts</div><div class="line">./mysql_install_db --datadir=/data/3308/data --basedir=/application/mysql --user=mysql</div><div class="line">chown -R mysql:mysql /data/3308</div><div class="line">egrep &quot;server-id|log-bin&quot; /data/3308/my.cnf</div><div class="line">/data/3308/mysql start</div><div class="line">sleep 5</div><div class="line">netstat -lnt|grep 3308</div><div class="line">mysqladmin -u root password &apos;lx3308&apos; -S /data/3308/mysql.sock  #初始化3308数据库密码</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#查看mysql 3306 3307 3308各个服务是否开启</div><div class="line">[root@lixiang scripts]# netstat -lntup|grep 3308</div><div class="line">tcp        0      0 0.0.0.0:3308                0.0.0.0:*                   LISTEN      5251/mysqld</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/mysql/MySQL主从复制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/mysql/MySQL主从复制/" itemprop="url">
                  MySQL主从复制
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-目的"><a href="#1-目的" class="headerlink" title="1.目的"></a>1.目的</h1><p>我们为什么要用主从复制？</p>
<ul>
<li>可以做数据库的实时备份，保证数据的完整性；</li>
<li>可做读写分离，主服务器只管写，从服务器只管读，这样可以提升整体性能。</li>
</ul>
<h1 id="2-原理"><a href="#2-原理" class="headerlink" title="2.原理"></a>2.原理</h1><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/mysql/replication_Master_slave/1.jpg" alt=""></p>
<p>　 　Mysql的 Replication 是一个异步的复制过程，从一个 Mysql instace(我们称之为 Master)复制到另一个 Mysql instance(我们称之 Slave)。在 Master 与 Slave 之间的实现整个复制过程主要由三个线程来完成，其中两个线程(Sql线程和IO线程)在 Slave 端，另外一个线程(IO线程)在 Master 端。<br>　　要实现 MySQL 的 Replication ，首先必须打开 Master 端的Binary Log(mysql-bin.xxxxxx)功能，否则无法实现。因为整个复制过程实际上就是Slave从Master端获取该日志然后再在自己身上完全 顺序的执行日志中所记录的各种操作。打开 MySQL 的 Binary Log 可以通过在启动 MySQL Server 的过程中使用 “—log-bin” 参数选项，或者在 my.cnf 配置文件中的 mysqld 参数组([mysqld]标识后的参数部分)增加 “log-bin” 参数项。<br>　　MySQL 复制的基本过程如下：</p>
<ol>
<li>Slave 上面的IO线程连接上 Master，并请求从指定日志文件的指定位置(或者从最开始的日志)之后的日志内容;</li>
<li>Master 接收到来自 Slave 的 IO 线程的请求后，通过负责复制的 IO 线程根据请求信息读取指定日志指定位置之后的日志信息，返回给 Slave 端的 IO 线程。返回信息中除了日志所包含的信息之外，还包括本次返回的信息在 Master 端的 Binary Log 文件的名称以及在 Binary Log 中的位置;</li>
<li>Slave 的 IO 线程接收到信息后，将接收到的日志内容依次写入到 Slave 端的Relay Log文件(mysql-relay-bin.xxxxxx)的最末端，并将读取到的Master端的bin-log的文件名和位置记录到master- info文件中，以便在下一次读取的时候能够清楚的高速Master“我需要从某个bin-log的哪个位置开始往后的日志内容，请发给我”</li>
<li>Slave 的 SQL 线程检测到 Relay Log 中新增加了内容后，会马上解析该 Log 文件中的内容成为在 Master 端真实执行时候的那些可执行的 Query 语句，并在自身执行这些 Query。这样，实际上就是在 Master 端和 Slave 端执行了同样的 Query，所以两端的数据是完全一样的。</li>
</ol>
<h1 id="3-更改配置文件"><a href="#3-更改配置文件" class="headerlink" title="3.更改配置文件"></a>3.更改配置文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"># 3306和3307分别代表2台机器</div><div class="line"># 打开log-bin,并使server-id不一样</div><div class="line">#vim /data/3306/my.cnf</div><div class="line">log-bin = /data/3306/mysql-bin</div><div class="line">server-id = 1</div><div class="line"></div><div class="line">#vim /data/3307/my.cnf</div><div class="line">log-bin = /data/3307/mysql-bin</div><div class="line">server-id = 3</div><div class="line"></div><div class="line">#检查</div><div class="line">#1、</div><div class="line">[root@bogon ~]# egrep &quot;log-bin|server-id&quot; /data/3306/my.cnf</div><div class="line">log-bin = /data/3306/mysql-bin</div><div class="line">server-id = 1</div><div class="line">[root@bogon ~]# egrep &quot;log-bin|server-id&quot; /data/3307/my.cnf</div><div class="line">log-bin = /data/3307/mysql-bin</div><div class="line">server-id = 3</div><div class="line">#2、</div><div class="line">[root@localhost ~]# mysql -uroot -p -S /data/3306/mysql.sock -e &quot;show variables like &apos;log_bin&apos;;&quot;</div><div class="line">Enter password:</div><div class="line">+--------+--------+</div><div class="line">| Variable_name | Value |</div><div class="line">+--------+--------+</div><div class="line">| log_bin       | ON  |    # ON 为开始开启成功</div><div class="line">+--------+--------+</div></pre></td></tr></table></figure>
<h1 id="4-建立用于从库复制的账号rep"><a href="#4-建立用于从库复制的账号rep" class="headerlink" title="4.建立用于从库复制的账号rep"></a>4.建立用于从库复制的账号rep</h1><p>通常会创建一个用于主从复制的专用账户，不要忘记授权。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"># 主库授权，允许从库来连接我取日志</div><div class="line">[root@localhost ~]# mysql -uroot -p -S /data/3306/mysql.sock</div><div class="line">Enter password:</div><div class="line"># 允许从库192.168.200网段连接，账号rep，密码nick。</div><div class="line">mysql&gt; grant replication slave on *.* to &apos;rep&apos;@&apos;192.168.200.%&apos; identified by &apos;nick&apos;;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line">mysql&gt; flush privileges;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"># 检查创建的rep账号：</div><div class="line">mysql&gt; select user,host from mysql.user;</div><div class="line">+-----+-------------+</div><div class="line">| user | host              |</div><div class="line">+-----+--------------+</div><div class="line">| root | 127.0.0.1          |</div><div class="line">| rep  | 192.168.200.%     |</div><div class="line">| root | localhost           |</div><div class="line">| root | localhost.localdomain |</div><div class="line">+-----+------------------+</div><div class="line">7    rows in set (0.00 sec)</div></pre></td></tr></table></figure></p>
<h1 id="5-备份主库，及恢复到从库"><a href="#5-备份主库，及恢复到从库" class="headerlink" title="5.备份主库，及恢复到从库"></a>5.备份主库，及恢复到从库</h1><p>把主库现有数据备份下来，再恢复到从库，此时两个主机的数据一致<br>如果事先有数据的话，这不不能忘。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">#1)在主库上加锁，使只有只读权限。</div><div class="line">mysql&gt; flush table with read lock;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line">#5.1、5.5锁表命令略有不同。</div><div class="line"># 5.1锁表：flush tables with read lock;</div><div class="line"># 5.5锁表：flush table with read lock;</div><div class="line"></div><div class="line"></div><div class="line">#2)记住就是这个点备份的。</div><div class="line">mysql&gt; show master status;</div><div class="line">+-------+------+--------+---------+</div><div class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |</div><div class="line">+-------+------+--------+---------+</div><div class="line">| mysql-bin.000013  |   410 |             |               |</div><div class="line">+-------+------+--------+---------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line"></div><div class="line">#3)克隆窗口，备份数据。</div><div class="line">[root@bogon ~]# mysqldump -uroot -p -S /data/3306/mysql.sock -A -B --events --master-data=2|gzip &gt;/opt/rep.sql.gz</div><div class="line">Enter password:</div><div class="line">参数：    -A：备份所有的</div><div class="line">#看rep.sql.gz参数</div><div class="line">vim /opt/rep.sql.gz</div><div class="line">-- CHANGE MASTER TO MASTER_LOG_FILE=&apos;mysql-bin.000013&apos;, MASTER_LOG_POS=410;</div><div class="line"></div><div class="line"></div><div class="line">#4)查看master status；数值是否正常。</div><div class="line">mysql&gt; show master status;</div><div class="line">+------+------+---------+-------+</div><div class="line">| File            | Position | Binlog_Do_DB | Binlog_Ignore_DB |</div><div class="line">+-------+-----+---------+--------+</div><div class="line">| mysql-bin.000013 |    410 |            |                |</div><div class="line">+--------+----+---------+--------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#5)解锁库</div><div class="line">mysql&gt; unlock tables;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line"></div><div class="line">#6)恢复到从库</div><div class="line">[root@bogon ~]# gunzip &lt; /opt/rep.sql.gz | mysql -uroot -p -S /data/3307/mysql.sock</div><div class="line">Enter password:</div></pre></td></tr></table></figure></p>
<h1 id="6-配置从库及生效"><a href="#6-配置从库及生效" class="headerlink" title="6.配置从库及生效"></a>6.配置从库及生效</h1><p>更改从库和主库的连接参数，配置生效。检查就成功了！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line">#1)进入从库。</div><div class="line">[root@bogon ~]# mysql -uroot -p -S /data/3307/mysql.sock</div><div class="line">Enter password:</div><div class="line"></div><div class="line"></div><div class="line">#2)更改从属服务器用于与主服务器进行连接和通讯的参数。</div><div class="line">mysql&gt; CHANGE MASTER TO</div><div class="line">      MASTER_HOST=&apos;192.168.200.98&apos;,</div><div class="line">      MASTER_PORT=3306,</div><div class="line">      MASTER_USER=&apos;rep&apos;,</div><div class="line">      MASTER_PASSWORD=&apos;nick&apos;,</div><div class="line">      MASTER_LOG_FILE=&apos;mysql-bin.000013&apos;,</div><div class="line">      MASTER_LOG_POS=410;</div><div class="line">Query OK, 0 rows affected (0.01 sec)</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#3)查看更改的参数。</div><div class="line">[root@localhost ~]# cd /data/3307/data/</div><div class="line">[root@localhost data]# cat master.info</div><div class="line">18</div><div class="line">mysql-bin.000013</div><div class="line">410</div><div class="line">192.168.200.98</div><div class="line">REP</div><div class="line">nick</div><div class="line">3306</div><div class="line">60</div><div class="line">0</div><div class="line">0</div><div class="line">1800.000</div><div class="line">0</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#4)生效！</div><div class="line">mysql&gt; start slave;</div><div class="line">Query OK, 0 rows affected (0.01 sec)</div><div class="line"></div><div class="line"></div><div class="line">#5)检查下列参数，符合则正常！</div><div class="line">mysql&gt; show slave status\G</div><div class="line">Relay_Master_Log_File: mysql-bin.000013</div><div class="line">             Slave_IO_Running: Yes        #取logo。</div><div class="line">            Slave_SQL_Running: Yes        #读relay-bin、logo,写数据。</div><div class="line">Seconds_Behind_Master: 0        #落后主库的秒数。</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#6)查看relay-bin.logo(因为同步的过程中会有中继日志,即relay-bin.xxx日志的生成,所以查看是否已经生成)</div><div class="line">[root@localhost 3307]# cd /data/3307</div><div class="line">[root@localhost 3307]# ll</div><div class="line">总用量 48</div><div class="line">drwxr-xr-x. 9 mysql mysql  4096 10月 29 18:52 data</div><div class="line">-rw-r--r--. 1 mysql mysql  1900 10月 29 11:45 my.cnf</div><div class="line">-rwx------. 1 root  root   1307 10月 20 17:06 mysql</div><div class="line">-rw-rw----. 1 mysql mysql     6 10月 29 11:00 mysqld.pid</div><div class="line">-rw-r-----. 1 mysql mysql 15090 10月 29 18:49 mysql_nick3307.err</div><div class="line">srwxrwxrwx. 1 mysql mysql     0 10月 29 11:00 mysql.sock</div><div class="line">-rw-rw----. 1 mysql mysql   150 10月 29 18:49 relay-bin.000001</div><div class="line">-rw-rw----. 1 mysql mysql   340 10月 29 18:52 relay-bin.000002</div><div class="line">-rw-rw----. 1 mysql mysql    56 10月 29 18:49 relay-bin.index</div><div class="line">-rw-rw----. 1 mysql mysql    53 10月 29 18:52 relay-log.info</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#7)查看relay-log.info。</div><div class="line">[root@localhost 3307]# cat relay-log.info</div><div class="line">/data/3307/relay-bin.000002</div><div class="line">340</div><div class="line">mysql-bin.000013</div><div class="line">497</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#8)查看master.info。</div><div class="line">[root@localhost 3307]# cat data/master.info</div><div class="line">18</div><div class="line">mysql-bin.000013</div><div class="line">497</div><div class="line">192.168.200.98</div><div class="line">rep</div><div class="line">nick</div><div class="line">3306</div><div class="line">60</div><div class="line">0</div><div class="line">0</div><div class="line">1800.000</div><div class="line">0</div></pre></td></tr></table></figure></p>
<h1 id="7-测试"><a href="#7-测试" class="headerlink" title="7.测试"></a>7.测试</h1><p>在主库添加数据,在从库看是否同步过来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">#进入3306(Master)</div><div class="line">mysql&gt; use test;</div><div class="line">Database changed</div><div class="line">mysql&gt;</div><div class="line">mysql&gt; show tables;</div><div class="line">Empty set (0.00 sec)</div><div class="line"> </div><div class="line">mysql&gt; create table student(id int, name varchar(30));</div><div class="line">Query OK, 0 rows affected (0.03 sec)</div><div class="line"> </div><div class="line">mysql&gt; show tables;</div><div class="line">+----------------+</div><div class="line">| Tables_in_test |</div><div class="line">+----------------+</div><div class="line">| student        |</div><div class="line">+----------------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"> </div><div class="line">#插入一条记录</div><div class="line">mysql&gt; insert into student values(1,&quot;zhangsan2222222&quot;);</div><div class="line">Query OK, 1 row affected (0.04 sec)</div><div class="line"> </div><div class="line"></div><div class="line"></div><div class="line">#进入3307</div><div class="line">mysql&gt; use test;</div><div class="line">Database changed</div><div class="line">mysql&gt; show tables;</div><div class="line">+----------------+</div><div class="line">| Tables_in_test |</div><div class="line">+----------------+</div><div class="line">| student        |</div><div class="line">+----------------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"> </div><div class="line"></div><div class="line">#查询数据</div><div class="line">mysql&gt; select *from student;</div><div class="line">+------+-----------------+</div><div class="line">| id   | name            |</div><div class="line">+------+-----------------+</div><div class="line">|    1 | zhangsan2222222 |        #同步成功</div><div class="line">+------+-----------------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"> </div><div class="line">mysql&gt;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/mysql/mysqlsla日志分析工具/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/mysql/mysqlsla日志分析工具/" itemprop="url">
                  mysqlsla日志分析工具
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;一款帮助语句分析、过滤、分析和排序MySQL慢日志、查询日志、二进制日志和microslow patched日志的分析工具。整体来说, 功能非常强大. 数据报表,非常有利于分析慢查询的原因, 包括执行频率, 数据量, 查询消耗等。</p>
<h1 id="1-下载mysqlsla"><a href="#1-下载mysqlsla" class="headerlink" title="1.下载mysqlsla"></a>1.下载mysqlsla</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost tmp]# wget http://hackmysql.com/scripts/mysqlsla-2.03.tar.gz</div><div class="line"></div><div class="line">#在目录下已经下载好了，直接上传即可。</div></pre></td></tr></table></figure>
<h1 id="2-解压"><a href="#2-解压" class="headerlink" title="2.解压"></a>2.解压</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost tmp]# tar -zxvf mysqlsla-2.03.tar.gz</div><div class="line">[root@localhost tmp]# cd mysqlsla-2.03</div></pre></td></tr></table></figure>
<h1 id="3-执行Perl脚本检查包依赖关系"><a href="#3-执行Perl脚本检查包依赖关系" class="headerlink" title="3.执行Perl脚本检查包依赖关系"></a>3.执行Perl脚本检查包依赖关系</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@localhost mysqlsla-2.03]# perl Makefile.PL</div><div class="line">Checking if your kit is complete...</div><div class="line">Looks good</div><div class="line">Writing Makefile for mysqlsla</div><div class="line"> </div><div class="line">@如果依赖检查报错：</div><div class="line">[root@localhost mysqlsla-2.03]# perl Makefile.PL</div><div class="line">Can&apos;t locate ExtUtils/MakeMaker.pm in @INC (@INC contains: /usr/local/lib64/perl5 /usr/local/share/perl5 /usr/lib64/perl5/vendor_perl /usr/share/perl5/vendor_perl /usr/lib64/perl5 /usr/share/perl5 .) at Makefile.PL line 2.</div><div class="line">BEGIN failed--compilation aborted at Makefile.PL line 2.</div><div class="line">@错误2</div><div class="line">[root@MySQL mysqlsla-2.03]# mysqlsla -lt slow /data/3309/slow.log</div><div class="line">Can&apos;t locate Time/HiRes.pm in @INC (@INC contains: /usr/local/lib/perl5 /usr/local/share/perl5 /usr/lib/perl5/vendor_perl /usr/share/perl5/vendor_perl /usr/lib/perl5 /usr/share/perl5 .) at /usr/local/bin/mysqlsla line 2095.</div><div class="line">BEGIN failed--compilation aborted at /usr/local/bin/mysqlsla line 2095.</div><div class="line"> </div><div class="line">解决方法如下：</div><div class="line">yum -y install perl-devel</div><div class="line">yum -y install perl-CPAN</div><div class="line">yum install perl-Time-HiRes -y</div></pre></td></tr></table></figure>
<h1 id="4-安装"><a href="#4-安装" class="headerlink" title="4.安装"></a>4.安装</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost mysqlsla-2.03]# make &amp;&amp; make install;</div></pre></td></tr></table></figure>
<h1 id="5-简单使用"><a href="#5-简单使用" class="headerlink" title="5.简单使用"></a>5.简单使用</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">语法：</div><div class="line">Slow log: mysqlsla -lt slow slow.log</div><div class="line">General log: mysqlsla -lt general general.log</div><div class="line">Binary log: mysqlbinlog bin.log | mysqlsla -lt binary -</div><div class="line"> </div><div class="line">这里以slow log为例：</div><div class="line">[root@localhost mysqlsla-2.03]# mysqlsla -lt slow /tmp/127_slow.log | more</div><div class="line">——————————————————————————————————</div><div class="line">Report for slow logs: /tmp/127_slow.log</div><div class="line">24 queries total, 6 unique</div><div class="line">Sorted by &apos;t_sum&apos;</div><div class="line">Grand Totals: Time 16 s, Lock 1 s, Rows sent 18, Rows Examined 2.10M</div><div class="line"> </div><div class="line"> </div><div class="line">______________________________________________________________________ 001 ___</div><div class="line">Count         : 18  (75.00%)</div><div class="line">Time          : 15 s total, 833.333 ms avg, 0 to 8 s max  (93.75%)</div><div class="line">  95% of Time : 7 s total, 411.765 ms avg, 0 to 4 s max</div><div class="line">Lock Time (s) : 0 total, 0 avg, 0 to 0 max  (0.00%)</div><div class="line">  95% of Lock : 0 total, 0 avg, 0 to 0 max</div><div class="line">Rows sent     : 0 avg, 0 to 0 max  (0.00%)</div><div class="line">Rows examined : 116.51k avg, 8 to 1.05M max  (99.99%)</div><div class="line">Database      :</div><div class="line">Users         :</div><div class="line">        root@localhost  : 100.00% (18) of query, 100.00% (24) of all users</div><div class="line"> </div><div class="line">Query abstract:</div><div class="line">INSERT INTO t2 SELECT * FROM t2;</div><div class="line"> </div><div class="line">Query sample:</div><div class="line">insert into t2 select * from t2;</div><div class="line">........</div></pre></td></tr></table></figure>
<p>各个字段说明<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">总查询次数 (queries total)， 去重后的sql数量 (unique)</div><div class="line">输出报表的内容排序(sorted by)</div><div class="line">最重大的慢sql统计信息, 包括 平均执行时间, 等待锁时间, 结果行的总数, 扫描的行总数.</div><div class="line">Count, sql的执行次数及占总的slow log数量的百分比.</div><div class="line">Time, 执行时间, 包括总时间, 平均时间, 最小, 最大时间, 时间占到总慢sql时间的百分比.</div><div class="line">95% of Time, 去除最快和最慢的sql, 覆盖率占95%的sql的执行时间.</div><div class="line">Lock Time, 等待锁的时间.</div><div class="line">95% of Lock , 95%的慢sql等待锁时间.</div><div class="line">Rows sent, 结果行统计数量, 包括平均, 最小, 最大数量.</div><div class="line">Rows examined, 扫描的行数量.</div><div class="line">Database, 属于哪个数据库</div><div class="line">Users, 哪个用户,IP, 占到所有用户执行的sql百分比</div><div class="line">Query abstract, 抽象后的sql语句</div><div class="line">Query sample, sql语句</div></pre></td></tr></table></figure></p>
<h1 id="6-sla常用参数"><a href="#6-sla常用参数" class="headerlink" title="6.sla常用参数"></a>6.sla常用参数</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">mysqlsla常用参数说明：</div><div class="line">1) -log-type (-lt) type logs:</div><div class="line">通过这个参数来制定log的类型，主要有slow, general, binary, msl, udl,分析slow log时通过制定为slow.</div><div class="line"> </div><div class="line">2) -sort:</div><div class="line">制定使用什么参数来对分析结果进行排序，默认是按照t_sum来进行排序。</div><div class="line">t_sum:按总时间排序</div><div class="line">c_sum:按总次数排序</div><div class="line">c_sum_p: sql语句执行次数占总执行次数的百分比。</div><div class="line"> </div><div class="line">3) -top:</div><div class="line">显示sql的数量，默认是10,表示按规则取排序的前多少条</div><div class="line"> </div><div class="line">4) –statement-filter (-sf) [+-][TYPE]:</div><div class="line">过滤sql语句的类型，比如select、update、drop.</div><div class="line">[TYPE]有SELECT, CREATE, DROP, UPDATE, INSERT，例如&quot;+SELECT,INSERT&quot;，不出现的默认是-，即不包括。</div><div class="line"> </div><div class="line">5) db：要处理哪个库的日志：</div><div class="line"> </div><div class="line">例如，只取backup库的select语句、按c_sum_p排序的前2条记录</div><div class="line"> </div><div class="line">[root@localhost mysqlsla-2.03]# mysqlsla -lt slow -sort c_sum_p  -sf  &quot;+select&quot; -db backup -top 2  /tmp/127_slow.log</div><div class="line">Report for slow logs: /tmp/127_slow.log</div><div class="line">4 queries total, 3 unique</div><div class="line">Sorted by &apos;c_sum_p&apos;</div><div class="line">Grand Totals: Time 1 s, Lock 1 s, Rows sent 18, Rows Examined 195</div><div class="line">______________________________________________________________________ 001 ___</div><div class="line">Count         : 2  (50.00%)</div><div class="line">Time          : 0 total, 0 avg, 0 to 0 max  (0.00%)</div><div class="line">Lock Time (s) : 0 total, 0 avg, 0 to 0 max  (0.00%)</div><div class="line">Rows sent     : 1 avg, 1 to 1 max  (11.11%)</div><div class="line">Rows examined : 86 avg, 77 to 94 max  (87.69%)</div><div class="line">Database      :</div><div class="line">Users         :</div><div class="line">        root@localhost  : 100.00% (2) of query, 100.00% (4) of all users</div><div class="line"> </div><div class="line">Query abstract:</div><div class="line">SELECT SUM(format(duration,N)) AS duration FROM information_schema.profiling WHERE query_id=N;</div><div class="line"> </div><div class="line">Query sample:</div><div class="line">select sum(format(duration,6)) as duration from information_schema.profiling where query_id=7;</div><div class="line">______________________________________________________________________ 002 ___</div><div class="line">Count         : 1  (25.00%)</div><div class="line">Time          : 1 s total, 1 s avg, 1 s to 1 s max  (100.00%)</div><div class="line">Lock Time (s) : 1 s total, 1 s avg, 1 s to 1 s max  (100.00%)</div><div class="line">Rows sent     : 4 avg, 4 to 4 max  (22.22%)</div><div class="line">Rows examined : 12 avg, 12 to 12 max  (6.15%)</div><div class="line">Database      :</div><div class="line">Users         :</div><div class="line">        root@localhost  : 100.00% (1) of query, 100.00% (4) of all users</div><div class="line">//。。。。。。。。。。。。。。。</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/mysql/mysqldump备份工具详解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/mysql/mysqldump备份工具详解/" itemprop="url">
                  mysqldump备份工具详解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-逻辑备份和物理备份"><a href="#1-逻辑备份和物理备份" class="headerlink" title="1.逻辑备份和物理备份"></a>1.逻辑备份和物理备份</h1><ul>
<li>逻辑备份: 小于50G的数据量<br>&emsp;&emsp;原理: 将数据库的数据以逻辑的SQL语句的方式导出</li>
<li>物理备份:<br>&emsp;&emsp;1.scp /application/mysql/data/   拷贝到独立数据库上就可以<br>&emsp;&emsp;2.xtrabackup开源的物理备份工具</li>
</ul>
<h1 id="2-三种方式来调用mysqldump"><a href="#2-三种方式来调用mysqldump" class="headerlink" title="2.三种方式来调用mysqldump"></a>2.三种方式来调用mysqldump</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">#Usage: </div><div class="line">mysqldump [OPTIONS] database [tables]</div><div class="line">#OR     </div><div class="line">mysqldump [OPTIONS] --databases [OPTIONS] DB1 [DB2 DB3...]</div><div class="line">#OR     </div><div class="line">mysqldump [OPTIONS] --all-databases [OPTIONS]</div><div class="line"> </div><div class="line">#如果没有指定任何表或使用了--database或--all--database选项，则转储整个数据库。</div><div class="line">#要想获得你的版本的mysqldump支持的选项，执行mysqldump --help</div></pre></td></tr></table></figure>
<h1 id="3-mysqldump参数详解"><a href="#3-mysqldump参数详解" class="headerlink" title="3.mysqldump参数详解"></a>3.mysqldump参数详解</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line">--help，-？</div><div class="line">   #显示帮助消息并退出</div><div class="line">    </div><div class="line">--add-drop--database</div><div class="line">   #在每个CREATE DATABASE语句前添加DROP DATABASE语句</div><div class="line">     </div><div class="line">--add-drop-tables</div><div class="line">   #在每个CREATE TABLE语句前添加DROP TABLE语句</div><div class="line">     </div><div class="line">--add-locking</div><div class="line">   #用LOCK TABLES和UNLOCK TABLES语句引用每个表转储。重载转储文件时插入得更快</div><div class="line">   </div><div class="line"></div><div class="line">--all--database，-A</div><div class="line">   #转储所有数据库中的所有表。与使用---database选项相同，在命令行中命名所有数据库</div><div class="line"></div><div class="line">--allow-keywords</div><div class="line">   #允许创建关键字列名。应在每个列名前面加上表名前缀</div><div class="line"></div><div class="line">--comments[=&#123;0|1&#125;]</div><div class="line">   #如果设置为 0，禁止转储文件中的其它信息，例如程序版本、服务器版本和主机。--skip—comments与---comments=0的结果相同。 默认值为1，即包括额外信息</div><div class="line"></div><div class="line">--compact</div><div class="line">   #产生少量输出。该选项禁用注释并启用--skip-add-drop-tables、--no-set-names、--skip-disable-keys和--skip-add-locking选项。适合调试输出，生产不适用</div><div class="line"></div><div class="line">--compatible=name</div><div class="line">   #产生与其它数据库系统或旧的MySQL服务器更兼容的输出。值可以为ansi、mysql323、mysql40、postgresql、oracle、mssql、db2、maxdb、no_key_options、no_tables_options或者no_field_options。要使用几个值，用逗号将它们隔开。这些值与设置服务器SQL模式的相应选项有相同的含义</div><div class="line"></div><div class="line">--compress，-C</div><div class="line">   #压缩在客户端和服务器之间发送的所有信息（如果二者均支持压缩）</div><div class="line"></div><div class="line">--database，-B</div><div class="line">   #转储几个数据库。通常情况，mysqldump将命令行中的第1个名字参量看作数据库名，后面的名看作表名。使用该选项，它将所有名字参量看作数据库名。CREATE DATABASE IF NOT EXISTS db_name和USE db_name语句包含在每个新数据库前的输出中</div><div class="line"></div><div class="line">--default-character-set=charset</div><div class="line">   #使用charsetas默认字符集。如果没有指定，mysqldump使用utf8</div><div class="line">    mysqldump -uroot -p&apos;chenyansong&apos;    --default-character-set=utf8 student &gt;/opt/mysql_bak.sql</div><div class="line">--flush-logs，-F</div><div class="line">   #开始转储前刷新MySQL服务器日志文件。该选项要求RELOAD权限。请注意如果结合--all--database(或-A)选项使用该选项，根据每个转储的数据库刷新日志。例外情况是当使用--lock-all-tables或--master-data的时候：在这种情况下，日志只刷新一次，在所有 表被锁定后刷新。如果你想要同时转储和刷新日志，应使用--flush-logs连同--lock-all-tables或--master-data</div><div class="line"></div><div class="line">--host=host_name，-h host_name</div><div class="line">   #从给定主机的MySQL服务器转储数据。默认主机是localhost</div><div class="line"></div><div class="line">--lock-all-tables，-x</div><div class="line">   #所有数据库中的所有表加锁。在整体转储过程中通过全局读锁定来实现。该选项自动关闭--single-transaction和--lock-tables</div><div class="line"></div><div class="line">--master-data[=value]</div><div class="line">   #该选项将二进制日志的位置和文件名写入到输出中。该选项要求有RELOAD权限，并且必须启用二进制日志。如果该选项值等于1，位置和文件名被写入CHANGE MASTER语句形式的转储输出，如果你使用该SQL转储主服务器以设置从服务器，从服务器从主服务器二进制日志的正确位置开始。如果选项值等于2，CHANGE MASTER语句被写成SQL注释。如果value被省略，这是默认动作</div><div class="line">    #--master-data选项启用--lock-all-tables，除非还指定--single-transaction(在这种情况下，只在刚开始转储时短时间获得全局读锁定。又见--single-transaction。在任何一种情况下，日志相关动作发生在转储时。该选项自动关闭--lock-tables</div><div class="line"></div><div class="line"></div><div class="line">--no-create-info，-t</div><div class="line">   #只分表数据-t,不写重新创建每个转储表的CREATE TABLE语句</div><div class="line"></div><div class="line">--no-data，-d</div><div class="line">   #备份表结构-d,不写表的任何行信息。如果你只想转储表的结构这很有用</div><div class="line"></div><div class="line">--password[=password]，-p[password]</div><div class="line">   #连接服务器时使用的密码。如果你使用短选项形式(-p)，不能在选项和密码之间有一个空格。如果在命令行中，忽略了--password或-p选项后面的 密码值，将提示你输入一个</div><div class="line"></div><div class="line"></div><div class="line">--port=port_num，-P port_num</div><div class="line">   #用于连接的TCP/IP端口号</div><div class="line"></div><div class="line">--quick，-q</div><div class="line">   #该选项用于转储大的表。它强制mysqldump从服务器一次一行地检索表中的行而不是检索所有行并在输出前将它缓存到内存中</div><div class="line"></div><div class="line">--where=&apos;where-condition&apos;, -w &apos;where-condition&apos;</div><div class="line">   #只转储给定的WHERE条件选择的记录。请注意如果条件包含命令解释符专用空格或字符，一定要将条件引用起来。</div><div class="line">   #例如：</div><div class="line">&quot;--where=user=&apos;jimf&apos;&quot; &quot;-w userid&gt;1&quot; &quot;-wuserid&lt;1&quot;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/mysql/explain优化慢查询语句/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/mysql/explain优化慢查询语句/" itemprop="url">
                  explain优化慢查询语句
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-执行计划-—-EXPLAIN命令"><a href="#1-执行计划-—-EXPLAIN命令" class="headerlink" title="1.执行计划 — EXPLAIN命令"></a>1.执行计划 — EXPLAIN命令</h1><p>&emsp;执行计划是语句优化的主要切入点，通过执行计划的判读了解语句的执行过程。在执行计划生成方面，MySQL与Oracle明显不同，它不会缓存执行计划，每次都执行“硬解析”。查看执行计划的方法，就是使用EXPLAIN命令。</p>
<h2 id="1-1-基本语法"><a href="#1-1-基本语法" class="headerlink" title="1.1.基本语法"></a>1.1.基本语法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">EXPLAIN QUERY</div><div class="line">#当在一个Select语句前使用关键字EXPLAIN时，MySQL会解释了即将如何运行该Select语句，它显示了表如何连接、连接的顺序等信息</div><div class="line"></div><div class="line"></div><div class="line">EXPLAIN EXTENDED QUERY</div><div class="line">#当使用EXTENDED关键字时，EXPLAIN产生附加信息，可以用SHOW WARNINGS浏览。该信息显示优化器限定SELECT语句中的表和列名，重写并且执行优化规则后SELECT语句是什么样子，并且还可能包括优化过程的其它注解。在MySQL5.0及更新的版本里都可以使用，在MySQL5.1里它有额外增加了一个过滤列(filtered)。</div><div class="line"></div><div class="line"></div><div class="line">EXPLAIN PARTITIONS QUERY</div><div class="line">#显示的是查询要访问的数据分片——如果有分片的话。它只能在MySQL5.1及更新的版本里使用</div><div class="line"></div><div class="line"></div><div class="line">EXPLAIN FORMAT=JSON (5.6新特性)</div><div class="line">#另一个格式显示执行计划。可以看到诸如表间关联方式等信息。</div></pre></td></tr></table></figure>
<h2 id="1-2-EXPLAIN输出字段"><a href="#1-2-EXPLAIN输出字段" class="headerlink" title="1.2.EXPLAIN输出字段"></a>1.2.EXPLAIN输出字段</h2><blockquote>
<p>id</p>
</blockquote>
<p>&emsp;MySQL选定的执行计划中查询的序列号。如果语句里没有子查询等情况，那么整个输出里就只有一个SELECT，这样一来每一行在这个列上都会显示一个1。如果语句中使用了子查询、集合操作、临时表等情况，会给ID列带来很大的复杂性。如上例中，WHERE部分使用了子查询，其id=2的行表示一个关联子查询。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; explain select * from (select * from student) as a;</div><div class="line">+----+-------------+------------+--------+---------------+------+---------+------+------+-------+</div><div class="line">| id | select_type | table      | type   | possible_keys | key  | key_len | ref  | rows | Extra |</div><div class="line">+----+-------------+------------+--------+---------------+------+---------+------+------+-------+</div><div class="line">|  1 | PRIMARY     | &lt;derived2&gt; | system | NULL          | NULL | NULL    | NULL |    1 |       |</div><div class="line">|  2 | DERIVED     | student    | ALL    | NULL          | NULL | NULL    | NULL |    1 |       |</div><div class="line">+----+-------------+------------+--------+---------------+------+---------+------+------+-------+</div></pre></td></tr></table></figure></p>
<blockquote>
<p>select_type</p>
</blockquote>
<p>&emsp;语句所使用的查询类型。是简单SELECT还是复杂SELECT(如果是后者，显示它属于哪一种复杂类型)。常用有以下几种标记类型。</p>
<ul>
<li>DEPENDENT SUBQUERY<br>子查询内层的第一个SELECT，依赖于外部查询的结果集</li>
<li>DEPENDENT UNION<br>子查询中的UNION，且为UNION中从第二个SELECT开始的后面所有SELECT，同样依赖于外部查询的结果集</li>
<li>PRIMARY<br>子查询中的最外层查询，注意并不是主键查询</li>
<li>SIMPLE<br>除子查询或UNION之外的其他查询</li>
<li>SUBQUERY<br>子查询内层查询的第一个SELECT，结果不依赖于外部查询结果集</li>
<li>UNCACHEABLE SUBQUERY<br>结果集无法缓存的子查询</li>
<li>UNION<br>UNION语句中的第二个SELECT开始后面的所有SELECT，第一个SELECT为PRIMARY</li>
<li>UNION RESULT<br>UNION中的合并结果。从UNION临时表获取结果的SELECT</li>
<li>DERIVED<br>衍生表查询(FROM子句中的子查询)。MySQL会递归执行这些子查询，把结果放在临时表里。在内部，服务器就把当做一个”衍生表”那样来引用，因为临时表就是源自子查询</li>
</ul>
<blockquote>
<p>table</p>
</blockquote>
<p>&emsp;这一步所访问的数据库中表的名称或者SQL语句指定的一个别名表。这个值可能是表名、表的别名或者一个为查询产生的临时表的标识符，如派生表、子查询或集合。</p>
<blockquote>
<p>type</p>
</blockquote>
<p>表的访问方式。以下列出了各种不同类型的表连接，依次是从最好的到最差的</p>
<ul>
<li>system<br> 系统表，表只有一行记录。这是const表连接类型的一个特例</li>
<li>const<br>  读常量，最多只有一行匹配的记录。由于只有一行记录，优化程序里该行记录的字段值可以被当作是一个恒定值。const用于在和PRIMARY KEY或UNIQUE索引中有固定值比较的情形</li>
<li>eq_ref<br> 最多只会有一条匹配结果，一般是通过主键或唯一键索引来访问。从该表中会有一行记录被读取出来以和从前一个表中读取出来的记录做联合。与const类型不同的是，这是最好的连接类型。它用在索引所有部分都用于做连接并且这个索引是一个PRIMARY KEY或UNIQUE类型。eq_ref可以用于在进行”=”做比较时检索字段。比较的值可以是固定值或者是表达式，表达示中可以使用表里的字段，它们在读表之前已经准备好了。</li>
<li>ref<br>  JOIN语句中驱动表索引引用的查询。该表中所有符合检索值的记录都会被取出来和从上一个表中取出来的记录作联合。ref用于连接程序使用键的最左前缀或者是该键不是PRIMARY KEY或UNIQUE索引(换句话说，就是连接程序无法根据键值只取得一条记录)的情况。当根据键值只查询到少数几条匹配的记录时，这就是一个不错的连接类型。ref还可以用于检索字段使用”=”操作符来比较的时候。</li>
</ul>
<ul>
<li>ref_or_null<br> 与ref的唯一区别就是在使用索引引用的查询之外再增加一个空值的查询。这种连接类型类似ref，不同的是MySQL会在检索的时候额外的搜索包含NULL值的记录。这种连接类型的优化是从MySQL 4.1.1开始的，它经常用于子查询。</li>
<li>index_merge<br> 查询中同时使用两个(或更多)索引，然后对索引结果进行合并(merge)，再读取表数据。这种连接类型意味着使用了Index Merge优化方法。</li>
<li>unique_subquery<br> 子查询中的返回结果字段组合是主键或唯一约束。</li>
<li>index_subquery<br> 子查询中的返回结果字段组合是一个索引(或索引组合)，但不是一个主键或唯一索引。这种连接类型类似unique_subquery。它用子查询来代替IN，不过它用于在子查询中没有唯一索引的情况下。</li>
<li>range<br> 索引范围扫描。只有在给定范围的记录才会被取出来，利用索引来取得一条记录。</li>
<li>index<br> 全索引扫描。连接类型跟ALL一样，不同的是它只扫描索引树。它通常会比ALL快点，因为索引文件通常比数据文件小。MySQL在查询的字段知识单独的索引的一部分的情况下使用这种连接类型。</li>
<li>fulltext<br> 全文索引扫描。</li>
<li>all<br> 全表扫描。</li>
</ul>
<blockquote>
<p>possible_keys</p>
</blockquote>
<p>该字段是指MySQL在搜索表记录时可能使用哪个索引。如果没有任何索引可以使用，就会显示为null。</p>
<blockquote>
<p>key</p>
</blockquote>
<p>查询优化器从possible_keys中所选择使用的索引。key字段显示了MySQL实际上要用的索引。当没有任何索引被用到的时候，这个字段的值就是NULL</p>
<blockquote>
<p>key_len</p>
</blockquote>
<p>被选中使用索引的索引键长度。key_len字段显示了MySQL使用索引的长度。当key字段的值为NULL时，索引的长度就是NULL。</p>
<blockquote>
<p>ref</p>
</blockquote>
<p>列出是通过常量，还是某个表的某个字段来过滤的。ref字段显示了哪些字段或者常量被用来和key配合从表中查询记录出来。</p>
<blockquote>
<p>rows</p>
</blockquote>
<p>该字段显示了查询优化器通过系统收集的统计信息估算出来的结果集记录条数</p>
<blockquote>
<p>Extra</p>
</blockquote>
<p>该字段显示了查询中MySQL的附加信息</p>
<blockquote>
<p>filtered</p>
</blockquote>
<p>这个列式在MySQL5.1里新加进去的，当使用EXPLAIN EXTENDED时才会出现。它显示的是针对表里符合某个条件(WHERE子句或联接条件)的记录数的百分比所作的一个悲观估算</p>
<h1 id="2-sql优化"><a href="#2-sql优化" class="headerlink" title="2.sql优化"></a>2.sql优化</h1><blockquote>
<p>Where子句中使用独立的列</p>
</blockquote>
<p>查询中列如果不是独立的，则不会使用索引</p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/mysql/sql/1.jpg" alt=""></p>
<blockquote>
<p>关联查询优化</p>
</blockquote>
<ul>
<li><p>确保ON或者USING子句的列上有索引。一般只需要在关联顺序中的第二个表的相应列上创建索引。</p>
</li>
<li><p>关联字段类型保持一致。 </p>
</li>
</ul>
<blockquote>
<p>LIKE匹配优化</p>
</blockquote>
<p>如果 LIKE 的参数是非通配字符开始的固定字符串，MySQL在做LIKE比较时也可能用到索引<br><img src="http://ols7leonh.bkt.clouddn.com//assert/img/mysql/sql/2.png" alt=""></p>
<p>Extra信息中显示使用了索引。<br>like后面使用通配符开始的字符串则不会使用索引</p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/mysql/sql/3.png" alt=""></p>
<p>rows列显示599行，也就是customer表的总行数，因此没利用到索引。</p>
<blockquote>
<p>避免SQL中出现不必要的类型转换</p>
</blockquote>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/mysql/sql/4.jpg" alt=""><br><img src="http://ols7leonh.bkt.clouddn.com//assert/img/mysql/sql/5.jpg" alt=""></p>
<blockquote>
<p>Select指定列来代替select *</p>
</blockquote>
<ul>
<li>在某些情况下 select *  要比select 指定列 需要浪费更多的资源</li>
<li>如果某些列中含有text等类型，select 指定列可以减少网络传输缓冲区的使用</li>
<li>如果SQL中含有order by ,并且排序不能利用上已用的索引那么，额外的字段会占用更多的sort_buffer_size .</li>
<li>Select指定列可以方便使用覆盖索引。</li>
</ul>
<p>比如下面这个例子，使用到了覆盖索引。</p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/mysql/sql/6.jpg" alt=""></p>
<blockquote>
<p>子查询优化</p>
</blockquote>
<ul>
<li><p>MySQL5.6前，子查询大多时候会先遍历outer table，对于其返回的每一条记录都执行一次subquery，而且子查询没有任何索引，导致子查询相较于关联查询要慢很多（解决方案：表连接代替子查询）；</p>
</li>
<li><p>MySQL5.6 后，对子查询进行了大幅度的优化，将子查询结果存入临时表，使得子查询只执行一次，而且优化器还会给子查询产生的派生表添加索引，使得子查询性能得到了强劲的优化。</p>
</li>
</ul>
<p>曾经的“绝对真理”：子查询比关联查询慢很多。——不再成立。</p>
<p>通过子查询优化可以减少多个查询多次对数据进行访问。</p>
<p>但也有时候，子查询可能比关联查询还要快。</p>
<blockquote>
<p>GROUP BY优化</p>
</blockquote>
<p>表的标识列分组比其他列分组的效率高。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT actor.first_name, actor.last_name, count(*) FROM film_actor INNER JOIN actor USING (actor_id) GROUP BY actor.first_name, actor.last_name;</div></pre></td></tr></table></figure></p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/mysql/sql/7.jpg" alt=""></p>
<p> 优化后：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT actor.first_name, actor.last_name,count(*) FROM film_actor  INNER JOIN actor USING (actor_id) GROUP BY actor.actor_id ;</div></pre></td></tr></table></figure></p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/mysql/sql/8.jpg" alt=""></p>
<p>因为actor.actor_id是主键，分组效率会提升。</p>
<p>使用GROUP BY子句时，结果集会自动按照分组的字段进行排序，GROUP BY子句中可以直接使用DESC或者ASC关键字，使得分组的结果集按需要的方向排序。</p>
<p>So：如果没有排序需求，可以加ORDER BY NULL,让MySQL不再进行文件排序，从而提高查询效率。</p>
<blockquote>
<p>UNION优化</p>
</blockquote>
<p>除非需要消除重复的行，否则一定要使用union all，因为没有ALL关键字，MySQL会给临时表加上DISTINCT选项，使得对整个临时表做代价很高的唯一性检查。</p>
<p>由于union产生的临时表无法使用优化器的优化策略，所以可以直接将WHERE, ORDER BY, LIMIT等子句冗余的写一份到各个子查询中。</p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/mysql/sql/9.jpg" alt=""></p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/mysql/sql/10.png" alt=""></p>
<p> 如果把ORDER BY, LIMIT等子句冗余写一份到各个子查询中。</p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/mysql/sql/11.png" alt=""></p>
<p>则排序的基数会有效的得到降低，从而提高效率。</p>
<h1 id="3-抓慢查询"><a href="#3-抓慢查询" class="headerlink" title="3.抓慢查询"></a>3.抓慢查询</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">#a.show full processlist; </div><div class="line">  或者   </div><div class="line"> [root@MySQL 3309]# mysql -uroot -poldboy123 -S /data/3309/mysql.sock -e &quot;show full processlist;&quot;  </div><div class="line">用grep 去抓取特定的语句</div><div class="line">[root@MySQL 3309]# mysql -uroot -poldboy123 -S /data/3309/mysql.sock -e &quot;show full processlist;&quot;|grep select -i</div><div class="line"></div><div class="line"></div><div class="line">#b.分析慢查询日志（下面三行在my.cnf中添加）</div><div class="line">  long_query_time =1    //查询超过1s</div><div class="line">  log-slow-queries = /data/3306/slow.log  //慢查询日志</div><div class="line">  log_queries_not_using_indexes  //没有索引的</div></pre></td></tr></table></figure>
<h1 id="4-explain语句检查索引执行情况"><a href="#4-explain语句检查索引执行情况" class="headerlink" title="4.explain语句检查索引执行情况"></a>4.explain语句检查索引执行情况</h1><h1 id="5-对需要建立索引的列建立索引"><a href="#5-对需要建立索引的列建立索引" class="headerlink" title="5.对需要建立索引的列建立索引"></a>5.对需要建立索引的列建立索引</h1><h1 id="6-使用慢查询工具（每天早晨发邮件，自动化的）"><a href="#6-使用慢查询工具（每天早晨发邮件，自动化的）" class="headerlink" title="6.使用慢查询工具（每天早晨发邮件，自动化的）"></a>6.使用慢查询工具（每天早晨发邮件，自动化的）</h1><h1 id="查看语句的详细执行时间"><a href="#查看语句的详细执行时间" class="headerlink" title="查看语句的详细执行时间"></a>查看语句的详细执行时间</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">Examples:</div><div class="line">mysql&gt; SELECT @@profiling;    //查看是否开启</div><div class="line">+-------------+</div><div class="line">| @@profiling |</div><div class="line">+-------------+</div><div class="line">|           0 |</div><div class="line">+-------------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"> </div><div class="line">mysql&gt; SET profiling = 1;    //设置开启</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"> </div><div class="line">mysql&gt; DROP TABLE IF EXISTS t1;</div><div class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</div><div class="line"> </div><div class="line">mysql&gt; CREATE TABLE T1 (id INT);</div><div class="line">Query OK, 0 rows affected (0.01 sec)</div><div class="line"> </div><div class="line">mysql&gt; SHOW PROFILES;      //显示所有查询记录的时间</div><div class="line">+----------+----------+--------------------------+</div><div class="line">| Query_ID | Duration | Query                    |</div><div class="line">+----------+----------+--------------------------+</div><div class="line">|        0 | 0.000088 | SET PROFILING = 1        |</div><div class="line">|        1 | 0.000136 | DROP TABLE IF EXISTS t1  |</div><div class="line">|        2 | 0.011947 | CREATE TABLE t1 (id INT) |</div><div class="line">+----------+----------+--------------------------+</div><div class="line">3 rows in set (0.00 sec)</div><div class="line">//查询某一条记录的各项消耗时间</div><div class="line">mysql&gt; SHOW PROFILE FOR QUERY 1;</div><div class="line">+--------------------+----------+</div><div class="line">| Status             | Duration |</div><div class="line">+--------------------+----------+</div><div class="line">| query end          | 0.000107 |</div><div class="line">| freeing items      | 0.000008 |</div><div class="line">| logging slow query | 0.000015 |</div><div class="line">| cleaning up        | 0.000006 |</div><div class="line">+--------------------+----------+</div><div class="line">4 rows in set (0.00 sec)</div><div class="line"> </div><div class="line">mysql&gt; SHOW PROFILE CPU FOR QUERY 2;</div><div class="line">+----------------------+----------+----------+------------+</div><div class="line">| Status               | Duration | CPU_user | CPU_system |</div><div class="line">+----------------------+----------+----------+------------+</div><div class="line">| checking permissions | 0.000040 | 0.000038 |   0.000002 |</div><div class="line">| creating table       | 0.000056 | 0.000028 |   0.000028 |</div><div class="line">| After create         | 0.011363 | 0.000217 |   0.001571 |</div><div class="line">| query end            | 0.000375 | 0.000013 |   0.000028 |</div><div class="line">| freeing items        | 0.000089 | 0.000010 |   0.000014 |</div><div class="line">| logging slow query   | 0.000019 | 0.000009 |   0.000010 |</div><div class="line">| cleaning up          | 0.000005 | 0.000003 |   0.000002 |</div><div class="line">+----------------------+----------+----------+------------+</div></pre></td></tr></table></figure>
<p>参考:<br><a href="http://dbaplus.cn/news-11-606-1.html" target="_blank" rel="external">解开发者之痛：中国移动MySQL数据库优化最佳实践</a><br><a href="http://dbaplus.cn/news-11-687-1.html" target="_blank" rel="external">如何用一款小工具大大加速MySQL SQL语句优化</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/mysql/Amoeba实现mysql读写分离(转)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/mysql/Amoeba实现mysql读写分离(转)/" itemprop="url">
                  Amoeba实现mysql读写分离(转)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://lx.wxqrcode.com/index.php/post/86.html" target="_blank" rel="external">转载自</a></p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/mysql/amoeba/1.png" alt=""></p>
<h1 id="机器配置说明"><a href="#机器配置说明" class="headerlink" title="机器配置说明"></a>机器配置说明</h1><table>
<thead>
<tr>
<th>机器</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>172.16.1.51</td>
<td>Amoeba</td>
</tr>
<tr>
<td>172.16.1.52</td>
<td>mysql多实例</td>
</tr>
<tr>
<td>172.16.1.10</td>
<td>测试机</td>
</tr>
</tbody>
</table>
<h1 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h1><p>首先在172.16.1.52服务器完成mysql主从复制，启用3306，3307多实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># 1.在主库创建一个用户</div><div class="line">        grant select,insert,update,delete on *.* to amoeba@&apos;172.16.1.%&apos; identifieentified by &apos;lx&apos;;</div><div class="line"># 2.在从库回收权限</div><div class="line">        REVOKE insert,update,delete on *.* FROM &apos;amoeba&apos;@&apos;172.16.1.%&apos;;</div><div class="line">        flush privileges;</div></pre></td></tr></table></figure></p>
<h1 id="环境支持"><a href="#环境支持" class="headerlink" title="环境支持"></a>环境支持</h1><p>Amoeba框架是基于Java SE1.5开发的，建议使用java  SE1.5以上的版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">#下载安装jdk</div><div class="line">wet  http://download.oracle.com/otn-pub/java/jdk/7u80-b15/jdk-7u80-linux-x64.rpm</div><div class="line">cd /server/toolsrpm -ivh jdk-7u80-linux-x64.rpm</div><div class="line">ln -s /usr/java/jdk1.7.0_80/ /usr/java/r/java/jdk1.7</div><div class="line"></div><div class="line">#加入环境变量</div><div class="line">vim /etc/profile</div><div class="line">export JAVA_HOME=/usr/java/jdk1.7</div><div class="line">export PATH=$PATH_HOME/bin:$PATH_HOME/jre/bin:$PATH. /etc/profile</div></pre></td></tr></table></figure>
<h1 id="amoeba安装"><a href="#amoeba安装" class="headerlink" title="amoeba安装"></a>amoeba安装</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line">#下载amoeba-mysql-binary-2.2.0.tar.gz </div><div class="line">wget http://sourceforge.net/projects/amoeba/files/Amoeba%20for%20mysql/2.2.x/amoeba-mysql-binary-2.2.0.tar.gz/downloadtar xf amoeba-mysql-binary-2.2.0.tar.gz</div><div class="line"></div><div class="line">#解压安装</div><div class="line">mkdir /application/amoeba</div><div class="line">tar -zxvf amoeba-mysql-binary-2.2.0.tar.gz -C /application/amoeba</div><div class="line"></div><div class="line">cd /application/amoeba</div><div class="line">[root@lamp01 amoeba]# ll</div><div class="line">总用量 60</div><div class="line">drwxr-xr-x 2 root root  4096 2月  18 09:59 benchmark</div><div class="line">drwxr-xr-x 2 root root  4096 2月  29 2012 bin</div><div class="line">-rw-r--r-- 1 root root  3976 8月  29 2012 changelogs.txt</div><div class="line">drwxr-xr-x 2 root root  4096 2月  18 09:59 conf</div><div class="line">drwxr-xr-x 3 root root  4096 2月  18 09:59 lib</div><div class="line">-rw-r--r-- 1 root root 34520 8月  29 2012 LICENSE.txt</div><div class="line">-rw-r--r-- 1 root root  2031 8月  29 2012 README.html</div></pre></td></tr></table></figure>
<h1 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h1><p>amoeba的配置是基于XML的配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#cd /application/amoeba/conf/</div><div class="line">#vim amoeba.xml </div><div class="line"></div><div class="line"> &lt;service name=&quot;Amoeba for Mysql&quot; class=&quot;com.meidusa.amoeba.net.ServerableConnectionManager&quot;&gt;</div><div class="line">         &lt;!-- port --&gt;</div><div class="line">         &lt;property name=&quot;port&quot;&gt;3306&lt;/property&gt;        #修改amoeba启动端口</div><div class="line">         &lt;!-- bind ipAddress --&gt;</div><div class="line">         &lt;property name=&quot;ipAddress&quot;&gt;172.16.1.51&lt;/property&gt;    #修改为amoeba服务器ip地址</div><div class="line">         &lt;property name=&quot;manager&quot;&gt;$&#123;clientConnectioneManager&#125;&lt;/property&gt;</div><div class="line">         &lt;property name=&quot;connectionFactory&quot;&gt;</div><div class="line">                 &lt;bean class=&quot;com.meidusa.amoeba.mysql.net.MysqlClientConnectionFactory&quot;&gt;</div><div class="line">                         &lt;property name=&quot;sendBufferSize&quot;&gt;128&lt;/property&gt;</div><div class="line">                         &lt;property name=&quot;receiveBufferSize&quot;&gt;64&lt;/property&gt;</div><div class="line">                 &lt;/bean&gt;</div><div class="line">         &lt;/property&gt;</div><div class="line">         &lt;property name=&quot;authenticator&quot;&gt;</div><div class="line">                 &lt;bean class=&quot;com.meidusa.amoeba.mysql.server.MysqlClientAuthenticator&quot;&gt;</div><div class="line">                         &lt;property name=&quot;user&quot;&gt;amoeba&lt;/property&gt;    #定义用户</div><div class="line">                         &lt;property name=&quot;password&quot;&gt;lx&lt;/property&gt;    #定义密码</div><div class="line">                         &lt;property name=&quot;filter&quot;&gt;</div><div class="line">                                 &lt;bean class=&quot;com.meidusa.amoeba.server.IPAccessController&quot;&gt;</div><div class="line">                                         &lt;property name=&quot;ipFile&quot;&gt;$&#123;amoeba.home&#125;/conf/access_list.conf&lt;/property&gt;</div><div class="line">                                 &lt;/bean&gt;</div><div class="line">                         &lt;/property&gt;</div><div class="line">                 &lt;/bean&gt;</div><div class="line">         &lt;/property&gt;</div><div class="line">&lt;/service&gt;</div><div class="line"> </div><div class="line"> &lt;property name=&quot;defaultPool&quot;&gt;master&lt;/property&gt;            #修改amoeba指向后端节点主数据库</div><div class="line">&lt;property name=&quot;writePool&quot;&gt;master&lt;/property&gt;</div><div class="line">&lt;property name=&quot;readPool&quot;&gt;slave&lt;/property&gt;</div></pre></td></tr></table></figure></p>
<p>编辑dbServers.xml文件,添加3306,3307多实例<br>vim dbServers.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">&lt;dbServer name=&quot;abstractServer1&quot; abstractive=&quot;true&quot;&gt;     将 abstractServer 修改为 abstractServer1</div><div class="line">  &lt;factoryConfig class=&quot;com.meidusa.amoeba.mysql.net.MysqlServerConnectionFactory&quot;&gt;</div><div class="line">    &lt;property name=&quot;manager&quot;&gt;$&#123;defaultManager&#125;&lt;/property&gt;</div><div class="line">    &lt;property name=&quot;sendBufferSize&quot;&gt;64&lt;/property&gt;</div><div class="line">    &lt;property name=&quot;receiveBufferSize&quot;&gt;128&lt;/property&gt;</div><div class="line">    &lt;!-- mysql port --&gt;</div><div class="line">    &lt;property name=&quot;port&quot;&gt;3306&lt;/property&gt;        #3306端口</div><div class="line">    &lt;!-- mysql schema --&gt;</div><div class="line">    &lt;property name=&quot;schema&quot;&gt;test&lt;/property&gt;            #注意查看主从数据库是否存在test数据库</div><div class="line">    &lt;!-- mysql user --&gt;</div><div class="line">    &lt;property name=&quot;user&quot;&gt;amoeba&lt;/property&gt;        #用户名</div><div class="line">    &lt;!--  mysql password --&gt;</div><div class="line">    &lt;property name=&quot;password&quot;&gt;lx&lt;/property&gt;        #密码</div><div class="line">  &lt;/factoryConfig&gt;</div><div class="line">  &lt;poolConfig class=&quot;com.meidusa.amoeba.net.poolable.PoolableObjectPool&quot;&gt;</div><div class="line">    &lt;property name=&quot;maxActive&quot;&gt;500&lt;/property&gt;</div><div class="line">    &lt;property name=&quot;maxIdle&quot;&gt;500&lt;/property&gt;</div><div class="line">    &lt;property name=&quot;minIdle&quot;&gt;10&lt;/property&gt;</div><div class="line">    &lt;property name=&quot;minEvictableIdleTimeMillis&quot;&gt;600000&lt;/property&gt;</div><div class="line">    &lt;property name=&quot;timeBetweenEvictionRunsMillis&quot;&gt;600000&lt;/property&gt;</div><div class="line">    &lt;property name=&quot;testOnBorrow&quot;&gt;true&lt;/property&gt;</div><div class="line">    &lt;property name=&quot;testOnReturn&quot;&gt;true&lt;/property&gt;</div><div class="line">    &lt;property name=&quot;testWhileIdle&quot;&gt;true&lt;/property&gt;</div><div class="line">  &lt;/poolConfig&gt;</div><div class="line">&lt;/dbServer&gt;</div><div class="line"></div><div class="line"></div><div class="line">&lt;dbServer name=&quot;abstractServer2&quot; abstractive=&quot;true&quot;&gt;       将 abstractServer 修改为 abstractServer2</div><div class="line">  &lt;factoryConfig class=&quot;com.meidusa.amoeba.mysql.net.MysqlServerConnectionFactory&quot;&gt;</div><div class="line">    &lt;property name=&quot;manager&quot;&gt;$&#123;defaultManager&#125;&lt;/property&gt;</div><div class="line">    &lt;property name=&quot;sendBufferSize&quot;&gt;64&lt;/property&gt;</div><div class="line">    &lt;property name=&quot;receiveBufferSize&quot;&gt;128&lt;/property&gt;</div><div class="line">    &lt;!-- mysql port --&gt;</div><div class="line">    &lt;property name=&quot;port&quot;&gt;3307&lt;/property&gt;        #数据库3307端口号</div><div class="line">    &lt;!-- mysql schema --&gt;</div><div class="line">    &lt;property name=&quot;schema&quot;&gt;test&lt;/property&gt;    #注意查看主从数据库是否存在test数据库</div><div class="line">    &lt;!-- mysql user --&gt;</div><div class="line">    &lt;property name=&quot;user&quot;&gt;amoeba&lt;/property&gt;      #用户帐号</div><div class="line">    &lt;!--  mysql password --&gt;</div><div class="line">    &lt;property name=&quot;password&quot;&gt;lx&lt;/property&gt;        #用户密码</div><div class="line">  &lt;/factoryConfig&gt;</div><div class="line">  &lt;poolConfig class=&quot;com.meidusa.amoeba.net.poolable.PoolableObjectPool&quot;&gt;</div><div class="line">    &lt;property name=&quot;maxActive&quot;&gt;500&lt;/property&gt;</div><div class="line">    &lt;property name=&quot;maxIdle&quot;&gt;500&lt;/property&gt;</div><div class="line">    &lt;property name=&quot;minIdle&quot;&gt;10&lt;/property&gt;</div><div class="line">    &lt;property name=&quot;minEvictableIdleTimeMillis&quot;&gt;600000&lt;/property&gt;</div><div class="line">    &lt;property name=&quot;timeBetweenEvictionRunsMillis&quot;&gt;600000&lt;/property&gt;</div><div class="line">    &lt;property name=&quot;testOnBorrow&quot;&gt;true&lt;/property&gt;</div><div class="line">    &lt;property name=&quot;testOnReturn&quot;&gt;true&lt;/property&gt;</div><div class="line">    &lt;property name=&quot;testWhileIdle&quot;&gt;true&lt;/property&gt;</div><div class="line">  &lt;/poolConfig&gt;</div><div class="line">&lt;/dbServer&gt;</div></pre></td></tr></table></figure>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/mysql/amoeba/2.png" alt=""></p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/mysql/amoeba/3.png" alt=""></p>
<p>修改bin目录的权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chmod -R 700 /Application/amoeba/bin/</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#vim /application/amoeba/bin/amoeba</div><div class="line">#添加</div><div class="line">DEFAULT_OPTS=&quot;-server -Xms256m -Xmx256m -Xss256k&quot;</div></pre></td></tr></table></figure>
<h1 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">/application/amoeba/bin/amoeba   start</div><div class="line"></div><div class="line">#查看端口</div><div class="line">[root@MySQL-master-01 conf]# lsof -i:3306</div><div class="line">COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</div><div class="line">java    19474 root   41u  IPv6 238156      0t0  TCP MySQL-master-01:39277-&gt;MySQL-master-02:mysql (ESTABLISHED)</div><div class="line">java    19474 root   53u  IPv6 238162      0t0  TCP MySQL-master-01:mysql (LISTEN)</div></pre></td></tr></table></figure>
<h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div></pre></td><td class="code"><pre><div class="line">#在web服务端172.16.1.10连接amoeba服务器测试</div><div class="line">[root@web01 ~]# mysql -uamoeba -plx -h 172.16.1.51</div><div class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div class="line">Your MySQL connection id is 126729963</div><div class="line">Server version: 5.1.45-mysql-amoeba-proxy-2.2.0 Source distribution</div><div class="line">Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.</div><div class="line">Oracle is a registered trademark of Oracle Corporation and/or its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</div><div class="line"></div><div class="line"></div><div class="line">#测试在172.16.1.52主库上面创建一个表</div><div class="line">mysql&gt; use database ruby;</div><div class="line">mysql&gt; use ruby;</div><div class="line">Database changed</div><div class="line">mysql&gt; create table lx (id int(10),name varchar(10),address varchar(20));</div><div class="line">Query OK, 0 rows affected (0.08 sec)</div><div class="line"></div><div class="line"></div><div class="line">#停止从库</div><div class="line">mysql&gt; stop slave;</div><div class="line">Query OK, 0 rows affected (0.03 sec)</div><div class="line"></div><div class="line"></div><div class="line">#分别在主库和从库插入一条数据</div><div class="line">#主库插入：</div><div class="line">mysql&gt; insert into lx values(1,&apos;lx&apos;,&apos;master&apos;);</div><div class="line">Query OK, 1 row affected (0.01 sec)</div><div class="line">mysql&gt; select * from lx;</div><div class="line">+------+------+---------+</div><div class="line">| id   | name | address |</div><div class="line">+------+------+---------+</div><div class="line">|    1 | lx   | master  |</div><div class="line">+------+------+---------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line"></div><div class="line">#从库插入：</div><div class="line">mysql&gt; insert into ruby.lx values(1,&apos;lx&apos;,&apos;slave&apos;); </div><div class="line">Query OK, 1 row affected (0.00 sec</div><div class="line">mysql&gt; select * from ruby.lx;</div><div class="line">+------+------+---------+</div><div class="line">| id   | name | address |</div><div class="line">+------+------+---------+</div><div class="line">|    1 | lx   | slave   |</div><div class="line">+------+------+---------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line"></div><div class="line">#在测试服务器172.16.1.10</div><div class="line">mysql&gt; show databases;</div><div class="line">+--------------------+</div><div class="line">| Database           |</div><div class="line">+--------------------+</div><div class="line">| information_schema |</div><div class="line">| bbs                |</div><div class="line">| dedecms            |</div><div class="line">| lixiang            |</div><div class="line">| mysql              |</div><div class="line">| performance_schema |</div><div class="line">| ruby               |</div><div class="line">| test               |</div><div class="line">| wordpress          |</div><div class="line">+--------------------+</div><div class="line">9 rows in set (0.00 sec)</div><div class="line">mysql&gt; use ruby;</div><div class="line">Reading table information for completion of table and column names</div><div class="line">You can turn off this feature to get a quicker startup with -A</div><div class="line">Database changed</div><div class="line">mysql&gt; show tables;</div><div class="line">+----------------+</div><div class="line">| Tables_in_ruby |</div><div class="line">+----------------+</div><div class="line">| lx             |</div><div class="line">+----------------+</div><div class="line">1 row in set (0.01 sec)</div><div class="line">这个时候我们查询到的数据是从库创建的数据</div><div class="line">mysql&gt; select * from lx;</div><div class="line">+------+------+---------+</div><div class="line">| id   | name | address |</div><div class="line">+------+------+---------+</div><div class="line">|    1 | lx   | slave   |</div><div class="line">+------+------+---------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line">此时我们在插入一条数据</div><div class="line">mysql&gt; insert into ruby.lx values(33,&apos;test33&apos;,&apos;test33&apos;);</div><div class="line">Query OK, 1 row affected (0.01 sec)</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#返回172.16.1.52服务器，在主库中查看是否有该条数据</div><div class="line">mysql&gt; select * from lx;                  </div><div class="line">+------+--------+---------+</div><div class="line">| id   | name   | address |</div><div class="line">+------+--------+---------+</div><div class="line">|    1 | lx     | master  |</div><div class="line">|   33 | test33 | test33  |</div><div class="line">+------+--------+---------+</div><div class="line">2 rows in set (0.00 sec)</div><div class="line">回到172.16.1.52服务器，在从库中查看是否有该条数据</div><div class="line">mysql&gt; select * from ruby.lx;             </div><div class="line">+------+------+---------+</div><div class="line">| id   | name | address |</div><div class="line">+------+------+---------+</div><div class="line">|    1 | lx   | slave   |</div><div class="line">+------+------+---------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line">mysql&gt; start slave;                                                #从库开启主从同步</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#再次回到测试服务器172.16.1.10，查看数据情况</div><div class="line">mysql&gt; select * from ruby.lx;</div><div class="line">+------+--------+---------+</div><div class="line">| id   | name   | address |</div><div class="line">+------+--------+---------+</div><div class="line">|    1 | lx     | slave   |</div><div class="line">|    1 | lx     | master  |</div><div class="line">|   33 | test33 | test33  |</div><div class="line">+------+--------+---------+</div><div class="line">3 rows in set (0.01 sec)</div></pre></td></tr></table></figure>
<p>至此，如果得到上面的结果则说明mysql数据读写分离完成，此时在回到从数据库开启主从同步 start slave</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/Linux/磁盘/磁盘分区,格式化,挂载/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/Linux/磁盘/磁盘分区,格式化,挂载/" itemprop="url">
                  磁盘分区,格式化,挂载
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-磁盘分区工具"><a href="#1-磁盘分区工具" class="headerlink" title="1.磁盘分区工具"></a>1.磁盘分区工具</h1><h2 id="1-1-fdisk"><a href="#1-1-fdisk" class="headerlink" title="1.1.fdisk"></a>1.1.fdisk</h2><h3 id="1-1-1-查看所有分区"><a href="#1-1-1-查看所有分区" class="headerlink" title="1.1.1.查看所有分区"></a>1.1.1.查看所有分区</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 ~]# fdisk -l</div><div class="line">#第一块磁盘</div><div class="line">Disk /dev/sda: 8589 MB, 8589934592 bytes</div><div class="line">255 heads, 63 sectors/track, 1044 cylinders</div><div class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 512 bytes</div><div class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</div><div class="line">Disk identifier: 0x000e7a75    </div><div class="line"></div><div class="line">   Device Boot      Start         End      Blocks   Id  System</div><div class="line">/dev/sda1   *           1          26      204800   83  Linux</div><div class="line">Partition 1 does not end on cylinder boundary.</div><div class="line">/dev/sda2              26          91      524288   82  Linux swap / Solaris</div><div class="line">Partition 2 does not end on cylinder boundary.</div><div class="line">/dev/sda3              91        1045     7658496   83  Linux</div><div class="line"> </div><div class="line">#第二块磁盘</div><div class="line">Disk /dev/sdb: 1073 MB, 1073741824 bytes</div><div class="line">255 heads, 63 sectors/track, 130 cylinders</div><div class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 512 bytes</div><div class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</div><div class="line">Disk identifier: 0x000315a8    </div><div class="line"> </div><div class="line">   Device Boot      Start         End      Blocks   Id  System</div><div class="line">/dev/sdb1               1          13      102400   83  Linux</div><div class="line">Partition 1 does not end on cylinder boundary.</div><div class="line">/dev/sdb2              13          77      512000    5  Extended</div><div class="line">Partition 2 does not end on cylinder boundary.</div><div class="line">/dev/sdb5              14          39      204800   83  Linux</div><div class="line">/dev/sdb6              39          77      305152   83  Linux</div></pre></td></tr></table></figure>
<h3 id="1-1-2-给-dev-sdb分区"><a href="#1-1-2-给-dev-sdb分区" class="headerlink" title="1.1.2.给/dev/sdb分区"></a>1.1.2.给/dev/sdb分区</h3><h4 id="1-1-2-1-参数简绍"><a href="#1-1-2-1-参数简绍" class="headerlink" title="1.1.2.1.参数简绍"></a>1.1.2.1.参数简绍</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 ~]# fdisk /dev/sdb</div><div class="line"> </div><div class="line">WARNING: DOS-compatible mode is deprecated. It&apos;s strongly recommended to</div><div class="line">         switch off the mode (command &apos;c&apos;) and change display units to</div><div class="line">         sectors (command &apos;u&apos;).</div><div class="line">#警告的含义:DOS命令行已经过时,采用-c切换命令行,原来默认的磁盘最小单元为柱面,使用-u切换成扇区</div><div class="line"> </div><div class="line">Command (m for help): </div><div class="line"></div><div class="line"></div><div class="line">-m    # 帮助命令</div><div class="line">-p    #打印分区表</div><div class="line">-d    #删除分区</div><div class="line">-n    #添加分区</div><div class="line">-t    #改版分区类型</div><div class="line">-l    #查看分区类型</div><div class="line">-q    #不保存退出</div><div class="line">-w    #保存退出</div></pre></td></tr></table></figure>
<h4 id="1-1-2-2-新建一个扩展分区"><a href="#1-1-2-2-新建一个扩展分区" class="headerlink" title="1.1.2.2.新建一个扩展分区"></a>1.1.2.2.新建一个扩展分区</h4><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/8.png" alt="新建一个扩展分区" title="新建一个扩展分区"></p>
<h4 id="1-1-2-3-新建一个逻辑分区"><a href="#1-1-2-3-新建一个逻辑分区" class="headerlink" title="1.1.2.3.新建一个逻辑分区"></a>1.1.2.3.新建一个逻辑分区</h4><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/9.png" alt="新建一个逻辑分区" title="新建一个逻辑分区"></p>
<h4 id="1-1-2-4-改版分区类型"><a href="#1-1-2-4-改版分区类型" class="headerlink" title="1.1.2.4.改版分区类型"></a>1.1.2.4.改版分区类型</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Command (m for help): L  #查看所有的分区类型号</div><div class="line"> </div><div class="line"> 0  Empty           24  NEC DOS         81  Minix / old Lin bf  Solaris       </div><div class="line"> 1  FAT12           39  Plan 9          82  Linux swap / So c1  DRDOS/sec (FAT-</div><div class="line"> 2  XENIX root      3c  PartitionMagic  83  Linux           c4  DRDOS/sec (FAT-</div><div class="line"> 3  XENIX usr       40  Venix 80286     84  OS/2 hidden C:  c6  DRDOS/sec (FAT-</div><div class="line"> 4  FAT16 &lt;32M      41  PPC PReP Boot   85  Linux extended  c7  Syrinx        </div><div class="line"> 5  Extended        42  SFS             86  NTFS volume set da  Non-FS data   </div><div class="line"> 6  FAT16           4d  QNX4.x          87  NTFS volume set db  CP/M / CTOS / .</div><div class="line"> 7  HPFS/NTFS       4e  QNX4.x 2nd part 88  Linux plaintext de  Dell Utility  </div><div class="line"> 8  AIX             4f  QNX4.x 3rd part 8e  Linux LVM       df  BootIt        </div><div class="line"> 9  AIX bootable    50  OnTrack DM      93  Amoeba          e1  DOS access</div></pre></td></tr></table></figure>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/10.png" alt="改变分区类型" title="改变分区类型"></p>
<h4 id="1-1-2-5-保存上面的分区操作"><a href="#1-1-2-5-保存上面的分区操作" class="headerlink" title="1.1.2.5.保存上面的分区操作"></a>1.1.2.5.保存上面的分区操作</h4><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/11.png" alt="改变分区类型" title="改变分区类型"></p>
<h4 id="1-1-2-6-使分区-dev-sdb生效-重读分区表"><a href="#1-1-2-6-使分区-dev-sdb生效-重读分区表" class="headerlink" title="1.1.2.6.使分区/dev/sdb生效(重读分区表)"></a>1.1.2.6.使分区/dev/sdb生效(重读分区表)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">partprobe /dev/sdb</div></pre></td></tr></table></figure>
<h3 id="1-1-3-非交互式-一次执行上面的操作"><a href="#1-1-3-非交互式-一次执行上面的操作" class="headerlink" title="1.1.3.非交互式,一次执行上面的操作"></a>1.1.3.非交互式,一次执行上面的操作</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">echo -e “n\np\n1\n\n+10G\nn\np\n2\n\n+20G\nw” |fdisk /dev/sdb</div></pre></td></tr></table></figure>
<h2 id="1-2-parted"><a href="#1-2-parted" class="headerlink" title="1.2.parted"></a>1.2.parted</h2><p>&emsp;简述：parted是一个磁盘分区的管理工具，他比fdisk更加的灵活，功能也更加的丰富，同时还支持GUID分区表,这在IA64平台上管理磁盘时非常有用，他同时支持交互模式和非交互模式，他除了能够进行分区的添加，删除等<br>常见操作外，还可以移动分区，制作文件系统，调整文件系统的大小。<br>&emsp;GPT分区全名：Globally Unique Identitier Partition Table Format ,指全局唯一标示磁盘分区表格式。由于MBR分区标的最大可寻址的存储空间只有2Tb(232*512字节)，因此在大硬盘出现的现在，MBR分区方式逐渐被GUID分区表取代。</p>
<p>parted 与fdisk区别:</p>
<ol>
<li>支持gpt分区表,可以对大于2T的磁盘分区</li>
<li>分区直接生效,不需要使用命令写入磁盘,最好partprobe /dev/sdb</li>
<li>格式化挂载等和fdisk无区别</li>
</ol>
<h3 id="1-2-1交互式"><a href="#1-2-1交互式" class="headerlink" title="1.2.1交互式"></a>1.2.1交互式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 ~]# parted /dev/sdb    #对/dev/sdb进行分区</div><div class="line">GNU Parted 2.1</div><div class="line">使用 /dev/sdb</div><div class="line">Welcome to GNU Parted! Type &apos;help&apos; to view a list of commands.</div><div class="line">(parted) p             #打印                                                   </div><div class="line">Model: VMware, VMware Virtual S (scsi)</div><div class="line">Disk /dev/sdb: 1074MB</div><div class="line">Sector size (logical/physical): 512B/512B</div><div class="line">Partition Table: msdos</div><div class="line"> </div><div class="line">Number  Start   End    Size   Type      File system  标志</div><div class="line"> 1      1049kB  106MB  105MB  primary   ext4</div><div class="line"> 2      106MB   630MB  524MB  extended</div><div class="line"> 5      107MB   317MB  210MB  logical</div><div class="line"> 6      318MB   630MB  312MB  logical</div><div class="line"> </div><div class="line">(parted)</div></pre></td></tr></table></figure>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/12.png" alt="改变分区类型" title="改变分区类型"></p>
<h3 id="1-2-2添加分区-非交互式"><a href="#1-2-2添加分区-非交互式" class="headerlink" title="1.2.2添加分区:非交互式"></a>1.2.2添加分区:非交互式</h3><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/13.png" alt="非交互式" title="非交互式"></p>
<p> 其中mkfs是格式化,创建文件系统, mount是挂载</p>
<h3 id="1-2-3非交互式-忽略提示"><a href="#1-2-3非交互式-忽略提示" class="headerlink" title="1.2.3非交互式:忽略提示"></a>1.2.3非交互式:忽略提示</h3><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/14.png" alt="非交互式" title="非交互式"></p>
<h3 id="1-2-4-删除一个分区"><a href="#1-2-4-删除一个分区" class="headerlink" title="1.2.4.删除一个分区"></a>1.2.4.删除一个分区</h3><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/15.png" alt="删除一个分区" title="删除一个分区"></p>
<h3 id="1-2-5-退出"><a href="#1-2-5-退出" class="headerlink" title="1.2.5.退出"></a>1.2.5.退出</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">quit</div></pre></td></tr></table></figure>
<h3 id="1-2-6-注意-gpt到msdos的转化"><a href="#1-2-6-注意-gpt到msdos的转化" class="headerlink" title="1.2.6.注意:gpt到msdos的转化"></a>1.2.6.注意:gpt到msdos的转化</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">parted   /dev/sdb mklabel   msdos</div></pre></td></tr></table></figure>
<h1 id="2-格式化"><a href="#2-格式化" class="headerlink" title="2.格式化"></a>2.格式化</h1><p>&emsp;实质：就是创建文件系统<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">帮助：</div><div class="line">[root@data-1-2 ~]# mkfs.ext4 -help</div><div class="line">mkfs.ext4: invalid option -- &apos;h&apos;</div><div class="line">Usage: mkfs.ext4 [-c|-l filename] [-b block-size] [-f fragment-size]</div><div class="line">        [-i bytes-per-inode] [-I inode-size] [-J journal-options]</div><div class="line">        [-G meta group size] [-N number-of-inodes]</div><div class="line">        [-m reserved-blocks-percentage] [-o creator-os]</div><div class="line">        [-g blocks-per-group] [-L volume-label] [-M last-mounted-directory]</div><div class="line">        [-O feature[,...]] [-r fs-revision] [-E extended-option[,...]]</div><div class="line">        [-T fs-type] [-U UUID] [-jnqvFKSV] device [blocks-count]</div><div class="line"> </div><div class="line">-L 是指定卷标，相当于给分区取的名字，那么挂载的时候直接用卷标名来挂载</div><div class="line"></div><div class="line">[root@data-1-2 ~]# mkfs.ext4 -L MYDATA /dev/sdb3</div><div class="line">mke2fs 1.41.12 (17-May-2010)</div><div class="line">Filesystem label=MYDATA</div><div class="line">    ......</div></pre></td></tr></table></figure></p>
<blockquote>
<p>方式一</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@linux-study ~]# mkfs.ext4 /dev/sdb1</div></pre></td></tr></table></figure>
<blockquote>
<p>方式二</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mkfs -t ext4 /dev/sdb1</div><div class="line"></div><div class="line">#可以指定iNode和block的大小,但是一般我们不指定</div><div class="line">mkfs -t ext4 -I 1024 -b 8192 /dev/sdb1</div></pre></td></tr></table></figure>
<p>格式化之后出现的提示：</p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/16.png" alt="格式化之后出现的提示" title="格式化之后出现的提示"></p>
<p>2次挂载或者180天之后会自动检查，我们可以取消他，如上图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[root@data-1-2 ~]# mkfs.ext4 /dev/sdb1</div><div class="line">mke2fs 1.41.12 (17-May-2010)</div><div class="line">Filesystem label=</div><div class="line">OS type: Linux</div><div class="line">Block size=1024 (log=0)</div><div class="line">Fragment size=1024 (log=0)</div><div class="line">Stride=0 blocks, Stripe width=0 blocks</div><div class="line">130560 inodes, 522080 blocks</div><div class="line">26104 blocks (5.00%) reserved for the super user  #默认留5%的空间大小给超级管理员，-m指定</div><div class="line">First data block=1</div><div class="line">Maximum filesystem blocks=67633152</div><div class="line">64 block groups   #创建了64个块组</div><div class="line">8192 blocks per group, 8192 fragments per group  #每个块组8192个block</div><div class="line">2040 inodes per group</div><div class="line">Superblock backups stored on blocks:   #超级块备份在下面的组中</div><div class="line">        8193, 24577, 40961, 57345, 73729, 204801, 221185, 401409</div><div class="line"> </div><div class="line">Writing inode tables: done                           </div><div class="line">Creating journal (8192 blocks): done   #写日志完成</div><div class="line">Writing superblocks and filesystem accounting information: done</div><div class="line"> </div><div class="line">This filesystem will be automatically checked every 27 mounts or</div><div class="line">180 days, whichever comes first.  Use tune2fs -c or -i to override.</div></pre></td></tr></table></figure>
<blockquote>
<p>格式化交换分区</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#在格式化之前的分区，要指定分区类型t=82</div><div class="line">[root@data-1-2 tdir]# mkswap /dev/sdb4</div></pre></td></tr></table></figure>
<h1 id="3-挂载分区"><a href="#3-挂载分区" class="headerlink" title="3.挂载分区"></a>3.挂载分区</h1><p>实质：为文件系统指定访问入口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">[root@linux-study /]# mount /dev/sdb1 /mnt </div><div class="line">mount -a     #表示挂载/etc/fstab文件中所有的文件系统</div><div class="line">mount -n    #默认情况下，mount命令每挂载一个设备，都会将挂载的设备信息保存至 /etc/mtab</div><div class="line">而使用-n表示不将信息写入到/etc/mtab文件中</div><div class="line">mount -t 指定正在挂载的设备的文件系统类型，不指定默认是调用blkid /dev/sdb1来获取文件系统的类型</div><div class="line">mount -r 只读挂载</div><div class="line">mount -w 读写挂载</div><div class="line">mount -o 指定额外的挂载选项</div><div class="line">   async ：异步写入</div><div class="line">   atime：跟新inode的访问时间</div><div class="line">   auto：使用的是-a选项</div><div class="line">   default：包含：rw/suid/dev/exec/auto/nouser/async</div><div class="line"></div><div class="line">#检查挂载情况</div><div class="line">df -h 查看block大小</div><div class="line">df -i 查看inode</div><div class="line"></div><div class="line"></div><div class="line">#挂载交换分区</div><div class="line">[root@data-1-2 tdir]# swapon /dev/sdb4</div><div class="line">[root@data-1-2 tdir]# swapoff /dev/sdb4</div><div class="line"></div><div class="line"></div><div class="line">#挂载ISO镜像文件</div><div class="line">mount -o loop /root/tes.iso /media</div><div class="line">ll /media/</div><div class="line"></div><div class="line">#卸载：</div><div class="line">umount 设备/挂载点</div></pre></td></tr></table></figure>
<h1 id="4-设置开机自动挂载"><a href="#4-设置开机自动挂载" class="headerlink" title="4.设置开机自动挂载"></a>4.设置开机自动挂载</h1><p>开机时将自动挂载/etc/fstab下的挂载项<br>如果没有这一项，再次重启的时候，将不会自动挂载分区，那么将不能写入文件到该分区<br>vim /etc/fatab 添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/dev/sdb1 /mnt ext4 defaults 0 0</div></pre></td></tr></table></figure>
<h1 id="5-加载-etc-fstab进行挂载测试（很重要）"><a href="#5-加载-etc-fstab进行挂载测试（很重要）" class="headerlink" title="5.加载/etc/fstab进行挂载测试（很重要）"></a>5.加载/etc/fstab进行挂载测试（很重要）</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mount -a</div><div class="line">   Mount all filesystems (of the given types) mentioned in fstab.</div><div class="line"></div><div class="line">#如果这里不进行测试，那么重启的时候，加载fatab可能机器起不来了，所以很重要</div></pre></td></tr></table></figure>
<h1 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h1><p>&emsp;如果我要将我的一块大硬盘暂时分成四个分区,同时,还希望有其他的空间可以让我在未来需要的时候再进行分区,那么该如何分区?<br>3p+1e(1L) 剩下的空间保留<br>2p+1e(2L) 剩下的空间保留<br>1p+1e(3L) 剩下的空间保留</p>
<p><a href="http://oldboy.blog.51cto.com/" target="_blank" rel="external">整理自老男孩</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/Linux/磁盘/磁盘介绍/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/Linux/磁盘/磁盘介绍/" itemprop="url">
                  磁盘介绍
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-磁盘相关的名词"><a href="#1-磁盘相关的名词" class="headerlink" title="1.磁盘相关的名词"></a>1.磁盘相关的名词</h1><table>
<thead>
<tr>
<th>英文</th>
<th>汉语</th>
</tr>
</thead>
<tbody>
<tr>
<td>Disk</td>
<td>磁盘</td>
</tr>
<tr>
<td>Head</td>
<td>磁头</td>
</tr>
<tr>
<td>sector</td>
<td>扇区</td>
</tr>
<tr>
<td>Track</td>
<td>磁道</td>
</tr>
<tr>
<td>Cylinder</td>
<td>柱面</td>
</tr>
<tr>
<td>Units</td>
<td>单元快(一个柱面的大小</td>
</tr>
<tr>
<td>Block</td>
<td>数据块</td>
</tr>
<tr>
<td>INode</td>
<td>索引节点</td>
</tr>
</tbody>
</table>
<h1 id="2-磁盘实体图"><a href="#2-磁盘实体图" class="headerlink" title="2.磁盘实体图"></a>2.磁盘实体图</h1><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/1.png" alt="磁头,主轴" title="磁头,主轴"><br><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/2.png" alt="柱面,磁柱" title="柱面,磁柱"><br><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/3.png" alt="扇区,磁道" title="扇区,磁道"></p>
<p> &emsp;扇区:盘面由圆心向四周画直线,不同的磁道被直线分成许多的扇形(弧形)的区域,每个弧形的区域叫做扇区,每个扇区大小一般为512字节,扇区看起来就是圆弧或扇形<br>柱面:磁盘中不同的盘片(或盘面)相同半径的磁道轨迹从上到下所组成的圆柱型区域就称为柱面,柱面看起来是一个圆柱形<br>&emsp;扇区的第一个主要部分是标识符,标识符就是扇区头标,包括组成扇区三维地址的三个数字,扇区所在的磁头(或盘面)/磁道(或柱面号)以及扇区在磁道上的位置即扇区号,头标中还包括一个字段,其中有显示扇区是否能可靠存储数据,或者是是否已发现某个故障因而不宜使用的标记,有些磁盘控制器在扇区头标中还记录有指示字,可在原扇区出错时指引磁盘转到替换扇区或磁道,最后,扇区头标以循环冗余校验(CRC)值作为结果以供控制器检验扇区头标的读出情况,确保准确无误<br>&emsp;扇区的第二个主要部分是存储数据的数据段,可分为数据和保护数据的交错码(ECC),在初始化准备期间,计算机用512个虚拟信息字节(实际数据的存放地)和这些虚拟信息字节相应的ECC数字填入这个部分</p>
<p>&emsp;磁道,柱面,扇区总结<br>&emsp;磁盘最基本的组成部分是由坚硬的金属材料制成的涂以磁性介质的盘片(有很多层)不同容量磁盘的盘片数不等</p>
<ol>
<li>一块磁盘有2-14个盘片,每个盘片有两个面,每个面对应一个读写磁头,用磁头号来区分盘面,即盘面就是磁头数,盘片数*2=磁头数(盘面数)</li>
<li>不同盘面的磁道被划分为多个扇形区域,每个扇形区域就是一个扇区</li>
<li>同一个盘面,以盘片中心为圆心,每个不同半径的圆形轨迹就是一个磁道(Track)</li>
<li>不同盘面相同半径的磁道组成一个圆柱面就是柱面(Cylinder)</li>
<li>一个柱面包含多个磁道(这些磁道半径相同),一个磁道包含多个扇区</li>
<li>数据信息记录可表示为:某磁头,某磁道(柱面),某扇区</li>
</ol>
<h1 id="3-磁盘容量计算"><a href="#3-磁盘容量计算" class="headerlink" title="3.磁盘容量计算"></a>3.磁盘容量计算</h1><p>磁盘容量=柱面数(磁道数)<em>柱面大小(磁道大小</em>磁头数)=512B<em>扇区数</em>磁道数*磁头数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 ~]# fdisk -l /dev/sdb</div><div class="line"> </div><div class="line">Disk /dev/sdb: 1073 MB, 1073741824 bytes</div><div class="line">255 heads, 63 sectors/track, 130 cylinders</div><div class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 512 bytes</div><div class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</div><div class="line">Disk identifier: 0x000315a8</div><div class="line"> </div><div class="line">   Device Boot      Start         End      Blocks   Id  System</div><div class="line">/dev/sdb1               1          13      102400   83  Linux</div><div class="line">Partition 1 does not end on cylinder boundary.</div><div class="line">/dev/sdb2              13          77      512000    5  Extended</div><div class="line">Partition 2 does not end on cylinder boundary.</div><div class="line">/dev/sdb5              14          39      204800   83  Linux</div><div class="line">/dev/sdb6              39          77      305152   83  Linux</div></pre></td></tr></table></figure>
<h1 id="4-机械磁盘读写数据的原理"><a href="#4-机械磁盘读写数据的原理" class="headerlink" title="4.机械磁盘读写数据的原理"></a>4.机械磁盘读写数据的原理</h1><ol>
<li>磁盘是按照柱面为单位读写数据的，即先读取同一个盘面的某一个磁道，读完之后，如果数据没有读完，磁头也不会切换到其他的磁道，而是选择切换磁头，读取下一个盘面的相同半径的磁道，知道所有盘面的相同半径的磁道读取完成之后，如果数据还没有读写完成，才会切换其他不同半径的磁道，这个切换磁道的过程为寻道。</li>
<li>不同磁头间的切换是电子切换，而不同磁道间的切换需要磁头做径向运动，这个径向运动需要步进电机调节，这个动作是机械的切 换。<br>寻道：是机械的，所以很浪费时间</li>
</ol>
<p>&emsp;为什么按照柱面的方式读写数据？<br>因为同一个柱面上我只要让磁头做电子的切换（即一个磁头读完一个柱面上的一个磁道就电子让下一次磁头读取同一个柱面上的下一个磁道），就能够读取数据（显然电子的切换相比较机械的切换要快很多）</p>
<h1 id="5-磁盘分区的介绍"><a href="#5-磁盘分区的介绍" class="headerlink" title="5.磁盘分区的介绍"></a>5.磁盘分区的介绍</h1><h2 id="5-1-磁盘存储逻辑结构图"><a href="#5-1-磁盘存储逻辑结构图" class="headerlink" title="5.1.磁盘存储逻辑结构图"></a>5.1.磁盘存储逻辑结构图</h2><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/4.png" alt="磁盘存储逻辑结构图" title="磁盘存储逻辑结构图"></p>
<p> MBR:主引导记录，0磁头，0磁道，1扇区，446字节</p>
<h2 id="5-2-分区表示意图"><a href="#5-2-分区表示意图" class="headerlink" title="5.2.分区表示意图"></a>5.2.分区表示意图</h2><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/5.png" alt="分区表示意图"></p>
<h2 id="5-3-16字节分区表含义"><a href="#5-3-16字节分区表含义" class="headerlink" title="5.3.16字节分区表含义"></a>5.3.16字节分区表含义</h2><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/6.png" alt="16字节分区表含义"></p>
<h2 id="5-4-备份主引导记录"><a href="#5-4-备份主引导记录" class="headerlink" title="5.4.备份主引导记录"></a>5.4.备份主引导记录</h2><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/7.png" alt="备份主引导记录"></p>
<h2 id="5-5-磁盘分区小结"><a href="#5-5-磁盘分区小结" class="headerlink" title="5.5.磁盘分区小结"></a>5.5.磁盘分区小结</h2><ol>
<li>磁盘分区的实质就是针对上述0磁头0磁道1扇区的前446字节后面接下来的64byte的分区表进行设置，<br>即主要划分起始以及结束磁头号，及扇区号和柱面号</li>
<li>一块磁盘的分区表仅有64byte大小，每个分区表要占用16字节，因此一块磁盘仅支持4个分区表信息，<br>即：主分区+扩展分区的总量不超过4个</li>
<li>扩展分区是不能直接使用的，还需要在扩展分区的基础上划分逻辑分区才行。</li>
<li>扩展分区有自己的分区表，因此扩展分区下面的逻辑分区可以有多个。</li>
</ol>
<h2 id="5-6-主分区primary"><a href="#5-6-主分区primary" class="headerlink" title="5.6.主分区primary"></a>5.6.主分区primary</h2><p>一般来说，主分区是磁盘上必须存在的分区，一般我们在主分区上安装操作系统</p>
<h2 id="5-7-扩展分区"><a href="#5-7-扩展分区" class="headerlink" title="5.7.扩展分区"></a>5.7.扩展分区</h2><p>&esmp;严格来说,扩展分区不能算一个正常的分区,而是一个链接,起到一个指向的作用,我们可以在扩展分区内建立逻辑分区,从上面逻辑结构图中我们可以看到,扩展分区就像一个虚拟出来的一个小硬盘一样,但是不同的是,没有MBR,而只有扩展分区表,而且这个扩展分区表是没有64bytes的限制的,所以可以在扩展分区划分多个逻辑分区<br>&esmp;一块硬盘只能存在一个扩展分区,并且扩展分区不能直接存放数据,扩展分区受限于操作系统</p>
<h2 id="5-8-逻辑分区logical"><a href="#5-8-逻辑分区logical" class="headerlink" title="5.8.逻辑分区logical"></a>5.8.逻辑分区logical</h2><p>&esmp;不能在磁盘中单独直接划分逻辑分区(fdisk),逻辑分区必须存在于扩展分区内,在扩展分区内可以划分多个逻辑分区,逻辑分区的编号从数字5开始,在这个扩展分区内可以划分多个逻辑分区(IDE磁盘大概编号可以是5-63), SATA(编号是5-15)<br>&esmp;实际应用:主分区和逻辑分区,都可以用,一般系统安装在主分区中,存放数据都可以</p>
<h2 id="5-9-分区的注意事项"><a href="#5-9-分区的注意事项" class="headerlink" title="5.9.分区的注意事项"></a>5.9.分区的注意事项</h2><p>&emsp;一块硬盘的分区方式只能为如下组合之一：<br>P + P + P + P<br>P + P + P + E<br>P + P + E<br>P + E<br>P<br>其中的P为primary，E为Extended</p>
<ol>
<li>扩展分区不是一个真正可用的分区，建立扩展分区之后，还需要在扩展分区上面建立逻辑分区才可以使用。</li>
<li>对于主分区和逻辑分区在一般的数据存储使用上是没有区别的（对于大多数的数据存储），在安装操作系统时<br>第一个分区要选主分区</li>
<li>分区号1-4留给主分区或扩展分区使用，逻辑分区只能从5开始，即使1-4分区号有剩余，也不会分配给逻辑分区。</li>
<li>对硬盘分区，实际上就是在修改硬盘的分区表，也就是说我们通过fdisk分区实际上就是在改64字节的分区表，分区和对应的数据没有关系，因此理论上调整分区大小，不会删除分区内的数据。<br>特殊说明:磁盘也可以不分区,直接格式化使用,但是不推荐这样做, 主分区最少有一个，而扩展分区最多一个</li>
</ol>
<h2 id="5-10-磁盘分区方案"><a href="#5-10-磁盘分区方案" class="headerlink" title="5.10.磁盘分区方案"></a>5.10.磁盘分区方案</h2><blockquote>
<p>方案1:集群架构中的某个节点,数据有多份或者不重要</p>
</blockquote>
<p>/boot 100MB linux引导程序<br>swap 物理内存的1.5倍,当内存大于等于8GB时,给8GB即可<br>/ 剩余硬盘大小(相当于Windows只分C盘)</p>
<blockquote>
<p>方案2:数据库即存储,有大量重要的数据</p>
</blockquote>
<p>/boot 100MB<br>/ 50-200GB<br>swap 物理内存的1.5倍,当内存大于等于8GB时,给8GB即可<br>/data 剩余硬盘大小,放数据库及存储数据的</p>
<blockquote>
<p>方案3:门户级别或大网站</p>
</blockquote>
<p>/boot 100MB<br>swap 物理内存的1.5倍,当内存大于等于8GB时,给8GB即可<br>/ 50-200GB<br>剩余空间保留,不再进行分区,将来分给哪个部分,拿到服务器的部分,就自己根据需求再分,此种方式更灵活</p>
<p>参见：<a href="http://oldboy.blog.51cto.com/2561410/634725" target="_blank" rel="external">http://oldboy.blog.51cto.com/2561410/634725</a></p>
<h2 id="5-11-磁盘分区设备名"><a href="#5-11-磁盘分区设备名" class="headerlink" title="5.11.磁盘分区设备名"></a>5.11.磁盘分区设备名</h2><p>&emsp;以硬盘为目标来说明设备命名规则。linux将硬盘分为两类：第一类是传统的IDE硬盘，使用hd标示；第 二种是SATA、SCSI、USB硬盘、U盘（严格的说U盘不算硬盘）等，均用sd标示；对于SATA，SCSI，USB硬盘，U盘等，只要把hd改成sd就可以了。命名规则是相同的。<br>&emsp;对应于：第一块硬盘：sda   //我们使用a，b，c表示第几块盘<br>&emsp;如果第一块盘有1个主分区和1个扩展分区，2个逻辑分区<br>对应于：sda1   //主分区<br>        sda2   //扩展分区<br>        sda5   //逻辑分区<br>        sda6   //逻辑分区<br>注意：我们使用1,2,3.。。来表示不同的分区号<br>&emsp;每个硬盘只能有四个主分区和扩展分区（三个主分区+一个扩展分区，或者四个主分区），这个是由硬盘本身决定的（64字节，每个分区表16字节），<br>跟操作系统没关系。每个硬盘最多只能有一个扩展分区，这个是由操作系统限制的。我的理解，扩展分区只是标志该分区处被再次分成多个逻辑分区了，因此扩展分区相当于逻辑分区的容器而已，没有必要多个，因此OS限制了扩展分区最多只能有一个。</p>
<p><a href="http://oldboy.blog.51cto.com/" target="_blank" rel="external">整理自老男孩</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/Linux/磁盘/磁盘inode图/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/Linux/磁盘/磁盘inode图/" itemprop="url">
                  磁盘inode原理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-低级格式化"><a href="#1-低级格式化" class="headerlink" title="1.低级格式化"></a>1.低级格式化</h1><p>&emsp;&emsp;低级格式化（磁盘厂商来做的），用来划分磁道、扇区，但是并没有任何的分区，需要我们自己来分区</p>
<h1 id="2-磁盘分区-partition"><a href="#2-磁盘分区-partition" class="headerlink" title="2.磁盘分区(partition)"></a>2.磁盘分区(partition)</h1><p>&emsp;&emsp;将磁盘划分成多个逻辑的组成结构，可以在分区的基础上创建独立的文件系统</p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/inode.png" alt="分区表示意图"></p>
<h1 id="3-MBR引导程序"><a href="#3-MBR引导程序" class="headerlink" title="3.MBR引导程序"></a>3.MBR引导程序</h1><ol>
<li>Main Boot Record 主引导记录</li>
<li>位置：0盘面0磁道1扇区，512bytes</li>
<li>组成：<br>446bytes：BootLoader 引导加载器（一段引导程序）<br>64bytes：每16byte：标识一个分区，所以之后4个主分区<br>2bytes：Magic Number  标记MBR是否有效</li>
</ol>
<h1 id="4-inode"><a href="#4-inode" class="headerlink" title="4.inode"></a>4.inode</h1><blockquote>
<p>磁盘分区之后，要进行文件系统的选择，为了方便我们寻找到数据，文件系统将一个分区划分为两块：<br>一个是存储元数据存储区，用来标示数据存储在哪里<br>另一个就是数据存储区</p>
</blockquote>
<p>根的inode是自引用的，已知的<br>目录也是以块来存储的，块中有目录下的文件名和文件名对应的inode号</p>
<h2 id="4-1-inode逻辑结构示意图"><a href="#4-1-inode逻辑结构示意图" class="headerlink" title="4.1.inode逻辑结构示意图"></a>4.1.inode逻辑结构示意图</h2><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/inode_2.bmp" alt="分区表示意图"></p>
<h2 id="4-2-创建文件的过程"><a href="#4-2-创建文件的过程" class="headerlink" title="4.2.创建文件的过程"></a>4.2.创建文件的过程</h2><p>创建一个文件的过程：touch   /backup/test.txt   大小10k (而每个block是2k)</p>
<ol>
<li>首先在inode 的bitmap上找一个空闲的inode，然后将该inode号(112)占用</li>
<li>找到：/backup目录对应的块，在目录对应的块上写文件名(test.txt)和对应的inode号(112)</li>
<li>找到块位图，找空闲的块，将其分配给inode，更新inode中块的位置</li>
</ol>
<p>存储连续块的好处：这样磁头可以不用跳跃，直接访问，所以当我们删除文件的时候，会有磁盘碎片的产生，这样访问的时候，会有磁头的跳跃，然后会很慢</p>
<h2 id="4-3-文件查找的过程"><a href="#4-3-文件查找的过程" class="headerlink" title="4.3.文件查找的过程"></a>4.3.文件查找的过程</h2><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/inode_3.bmp" alt="分区表示意图"></p>
<h2 id="4-4-文件删除的过程"><a href="#4-4-文件删除的过程" class="headerlink" title="4.4.文件删除的过程"></a>4.4.文件删除的过程</h2><p>删除一个文件的过程：mv /backup/test.txt</p>
<ol>
<li>将：/back中的 文件名和inode号（112）删除</li>
<li>将inode的位图中该inode（112）标记为0</li>
<li>block的位图中对应的块标记为0（未使用）</li>
</ol>
<p>以上删除并没有删除block中的数据，只是标记了数据被删除，那么只有在下一次进行写满对应的block的时候，原来的数据才会<br>被彻底覆盖</p>
<h2 id="4-5-文件复制的过程"><a href="#4-5-文件复制的过程" class="headerlink" title="4.5.文件复制的过程"></a>4.5.文件复制的过程</h2><p>复制文件的过程：<br>就是在创建了一个文件的时候，然后将需要复制的文件填充到新创建的文件中</p>
<h2 id="4-6-文件剪切"><a href="#4-6-文件剪切" class="headerlink" title="4.6.文件剪切"></a>4.6.文件剪切</h2><p>剪切的过程（如果是在同一个文件系统下）<br>那么只是改变的目录中文件的路径，</p>
<blockquote>
<p>对于经常访问的文件，我们可以将其放入到缓存中，如：/var/log/messages  —&gt;对应的inode号，这样下次将可以直接来访问了</p>
</blockquote>
<h1 id="5-超级块和块组"><a href="#5-超级块和块组" class="headerlink" title="5.超级块和块组"></a>5.超级块和块组</h1><p>最上面的是超级块，然后就是块组，每一个块组中包含（inode，inode 的位图，block位图）</p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/磁盘/inode_4.png" alt="分区表示意图"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/16/Linux/用户和用户组管理/用户和用户组管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr. Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/Linux/用户和用户组管理/用户和用户组管理/" itemprop="url">
                  用户和用户组管理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T12:47:25+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-用户配置文件"><a href="#1-用户配置文件" class="headerlink" title="1.用户配置文件"></a>1.用户配置文件</h1><h2 id="1-1-用户信息文件-etc-passwd"><a href="#1-1-用户信息文件-etc-passwd" class="headerlink" title="1.1.用户信息文件/etc/passwd"></a>1.1.用户信息文件/etc/passwd</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 ~]# cat /etc/passwd</div><div class="line">root:x:0:0:root:/root:/bin/bash</div><div class="line">chenyansong:x:500:500::/home/chenyansong:/bin/bash</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>root</th>
<th>:x</th>
<th>:0</th>
<th>:0</th>
<th>:root</th>
<th>:/root</th>
<th>:/bin/bash</th>
</tr>
</thead>
<tbody>
<tr>
<td>账号名称</td>
<td>:账号密码</td>
<td>:账号UID</td>
<td>:账号组GID</td>
<td>:用户说明</td>
<td>:用户家目录</td>
<td>:shell解释</td>
</tr>
</tbody>
</table>
<h3 id="1-1-1-各个字段说明"><a href="#1-1-1-各个字段说明" class="headerlink" title="1.1.1.各个字段说明"></a>1.1.1.各个字段说明</h3><ul>
<li><p>UID(相当于身份证),GID（相当于家庭或者学校）：<br>超级用户：0 ，超级用户的用户名不一定就是root，但是只要UId的是0的用户就一定是超级用户。<br>系统用户（伪用户）：0-499  ，作用：<font color="red">满足文件或程序运行的需要</font>，而创建的，不能登录，不能使用<br>普通用户：500-65535<br>注意：安装系统后可以删除用不到的伪用户，但是<font color="red">最好不删而是注释掉</font>，我们在自己部属服务的时候，也会创建伪用户，<br>满足服务的需求，例如：apache,nginx,mysql,nfs,rsync,nagios.zabbix,redis.</p>
</li>
<li><p>用户家目录：当我们创建一个用户的时候，会默认在home（root除外）下创建一个以用户名命名的家目录</p>
</li>
<li>shell解释器：<font color="red">伪用户之所以不能登录，就是因为结尾以nologin结束</font>，如下:<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="1-1-2初始组和附加组"><a href="#1-1-2初始组和附加组" class="headerlink" title="1.1.2初始组和附加组"></a>1.1.2初始组和附加组</h3><ul>
<li>初始组：指用户一登录立刻拥有这个用户组 的相关权限，每个用户的初始组只能有一个，一般就是和这个用户的用户名相同的组名作为这个用户的初始组。</li>
<li>附加组：指用户可以加入多个其他的用户组，并拥有这些组的权限，附加组可以有多个。</li>
</ul>
<h2 id="1-2-影子文件-etc-shadow"><a href="#1-2-影子文件-etc-shadow" class="headerlink" title="1.2 影子文件/etc/shadow"></a>1.2 影子文件/etc/shadow</h2><p>&emsp;加密密码：如果密码是“!!”或“*”代表没有秘密，不能登录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">root:$6$z88R0.1iC2cYCAxW$PBtFGnl.via1K548GD.7maVCCiPAhCps.1TqI1furgoEM9da9FLfhMPCt2/iq.rv2qv/6M0qMaPjVRlfjdKfu/:16985:0:99999:7:::</div><div class="line">tcpdump:!!:16985::::::</div><div class="line">chenyansong:$6$hcQOHdN.$TUZ.b5ttQvpX1dhkWClz6FxStVLPX6gnHpDGzuyDHvUOuxcEWL0kQi5cP7JQX.UHv4KxgORBBTfk9.QjIUyna1:17001:0:99999:7:::</div></pre></td></tr></table></figure>
<p>&emsp;shadow文件中一行的各个字段详细说明</p>
<table>
<thead>
<tr>
<th>字段名称</th>
<th>注释说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>账号名称</td>
<td>用户的账号名称</td>
</tr>
<tr>
<td>账号密码</td>
<td>用户密码,这是加密过的口令</td>
</tr>
<tr>
<td>最近更改密码的时间</td>
<td>从1970年1月1日起,到用户最近一次更改口令的天数</td>
</tr>
<tr>
<td>禁止修改密码的天数</td>
<td>从1970年1月1日起,到用户可以更改可以更改密码的天数</td>
</tr>
<tr>
<td>用户必须更改口令 的天数</td>
<td>从1970年1月1日起,到用户必须更改密码的天数</td>
</tr>
<tr>
<td>不活动时间</td>
<td>在用户密码过期之后到禁用账户的天数</td>
</tr>
<tr>
<td>失效天数</td>
<td>从1970年1月1日起,到用户被禁用的天数</td>
</tr>
<tr>
<td>标志</td>
<td>保留</td>
</tr>
</tbody>
</table>
<h2 id="1-3组信息文件-etc-group-和密码组文件-etc-gshadow"><a href="#1-3组信息文件-etc-group-和密码组文件-etc-gshadow" class="headerlink" title="1.3组信息文件/etc/group 和密码组文件/etc/gshadow"></a>1.3组信息文件/etc/group 和密码组文件/etc/gshadow</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">student_team:x:502:chenyansong,zhangsan</div><div class="line">组名:组密码标志:GID:组中附加用户</div></pre></td></tr></table></figure>
<p>&emsp;group文件中一行的各个字段详细说明</p>
<table>
<thead>
<tr>
<th>字段名称</th>
<th>注释说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>用户组名</td>
<td>该组的名称</td>
</tr>
<tr>
<td>用户组密码</td>
<td>通常不需要设置该密码,由于安全原因,该密码被记录在/etc/gshadow中,因此,显示为”x”,这类似/etc/shadow</td>
</tr>
<tr>
<td>GID</td>
<td>就是用户组的ID</td>
</tr>
<tr>
<td>用户组成员</td>
<td>加入这个组的所有用户账号</td>
</tr>
</tbody>
</table>
<p>&emsp;gshadow文件中一行的各个字段详细说明</p>
<table>
<thead>
<tr>
<th>字段名称</th>
<th>注释说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>用户组名</td>
<td>该组的名称</td>
</tr>
<tr>
<td>用户组密码</td>
<td>用户组密码,这个字段可以是空的或!,如果是空的或!,表示没有密码</td>
</tr>
<tr>
<td>用户组管理员账号</td>
<td>用户组管理者,这个字段也可以为空,如果有多个用户组管理者,用逗号分隔</td>
</tr>
<tr>
<td>用户组成员</td>
<td>加入这个组的所有用户账号,列表中多个用户通过逗号分隔</td>
</tr>
</tbody>
</table>
<h1 id="2-用户管理命令"><a href="#2-用户管理命令" class="headerlink" title="2.用户管理命令"></a>2.用户管理命令</h1><h2 id="2-1-用户添加命令useradd"><a href="#2-1-用户添加命令useradd" class="headerlink" title="2.1.用户添加命令useradd"></a>2.1.用户添加命令useradd</h2><h3 id="2-1-1-useradd-c-添加说明"><a href="#2-1-1-useradd-c-添加说明" class="headerlink" title="2.1.1 useradd -c 添加说明"></a>2.1.1 useradd -c 添加说明</h3><p>–comment<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 ~]# useradd -c shoumingWenzi test_comment</div><div class="line">[root@lamp01 ~]# cat /etc/passwd|grep test_comm</div><div class="line">test_comment:x:510:511:shoumingWenzi:/home/test_comment:/bin/bash</div></pre></td></tr></table></figure></p>
<h3 id="2-1-2-useradd-d-指定家目录"><a href="#2-1-2-useradd-d-指定家目录" class="headerlink" title="2.1.2 useradd -d 指定家目录"></a>2.1.2 useradd -d 指定家目录</h3><p>–home_dir 如果不存在,就帮你创建家目录,默认是在/home下创建与用户名同名的家目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 ~]# useradd test_home_dir -d /tmp/chenyansong</div><div class="line"></div><div class="line">[root@lamp01 ~]# grep test_home_dir /etc/passwd</div><div class="line">test_home_dir:x:511:512::/tmp/chenyansong:/bin/bash</div><div class="line"></div><div class="line">[root@lamp01 ~]# su - test_home_dir</div><div class="line">[test_home_dir@lamp01 ~]$ pwd    </div><div class="line">/tmp/chenyansong        #用户登录时,默认是进入到该用户的家目录下</div></pre></td></tr></table></figure></p>
<h3 id="2-1-3-useradd-e-账号过期日期"><a href="#2-1-3-useradd-e-账号过期日期" class="headerlink" title="2.1.3 useradd -e 账号过期日期"></a>2.1.3 useradd -e 账号过期日期</h3><table>
<thead>
<tr>
<th>-e expire_date</th>
<th>账号终止日期,日期的格式为MM/DD/YY</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">useradd -e &apos;2016/07/21&apos; chenyansong</div></pre></td></tr></table></figure>
<h3 id="2-1-4-useradd-g-useradd-G"><a href="#2-1-4-useradd-g-useradd-G" class="headerlink" title="2.1.4.useradd -g / useradd -G"></a>2.1.4.useradd -g / useradd -G</h3><ul>
<li>-g 添加初始组，只有一个</li>
<li>-G 添加附加组，可以有多个</li>
</ul>
<h3 id="2-1-5-useradd-M-不创建家目录"><a href="#2-1-5-useradd-M-不创建家目录" class="headerlink" title="2.1.5.useradd -M 不创建家目录"></a>2.1.5.useradd -M 不创建家目录</h3><p>&emsp;不创建家目录，优先于/etc/login.defs 文件的设定，一般创建虚拟用户时不建立家目录，部属服务时需要创建虚拟用户</p>
<h3 id="2-1-6-useradd-s-shell"><a href="#2-1-6-useradd-s-shell" class="headerlink" title="2.1.6.useradd -s shell"></a>2.1.6.useradd -s shell</h3><p>&emsp;用户登录后使用的shell名称，默认值为不填写，这样系统会帮你指定预设的登入shell，（根据/etc/default/useradd 预设值）</p>
<h3 id="2-1-7-useradd-u-uid"><a href="#2-1-7-useradd-u-uid" class="headerlink" title="2.1.7 useradd -u  uid"></a>2.1.7 useradd -u  uid</h3><p>&emsp;指定用户的uid 值，这个值必须要唯一，除非用-o选项，数字不可为负值</p>
<h2 id="2-2-添加用户组-groupadd"><a href="#2-2-添加用户组-groupadd" class="headerlink" title="2.2.添加用户组 groupadd"></a>2.2.添加用户组 groupadd</h2><h3 id="2-2-1-和groupadd-命令有关的文件"><a href="#2-2-1-和groupadd-命令有关的文件" class="headerlink" title="2.2.1 和groupadd 命令有关的文件"></a>2.2.1 和groupadd 命令有关的文件</h3><ul>
<li>/etc/group  -用户组相关文件</li>
<li>/etc/gshadow  -用户组密码相关文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@lamp01 ~]# grep test_g /etc/group</div><div class="line">test_g:x:514:</div><div class="line">[root@lamp01 ~]# grep test_g /etc/gshadow</div><div class="line">test_g:!::</div></pre></td></tr></table></figure>
<h3 id="2-2-2-groupadd-语法"><a href="#2-2-2-groupadd-语法" class="headerlink" title="2.2.2 groupadd 语法"></a>2.2.2 groupadd 语法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">groupadd groupname -g GID</div><div class="line">groupadd incahome -g 506</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>-g gid</th>
<th>指定用户组GID值,除非接-o参数,否则ID值必须是唯一的数字(不能为负数),如果不指定会从500开始</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<h2 id="2-3-修改用户密码passwd"><a href="#2-3-修改用户密码passwd" class="headerlink" title="2.3.修改用户密码passwd"></a>2.3.修改用户密码passwd</h2><p>&emsp;通用户和超级用户都可以运行passwd命令，但是普通用户只能更改自身的用户密码，root用户则可以修改或设置所有用户的密码。当直接执行passwd命令侯曼不接任何参数或用户名时，则表示修改当前登录用户。普通用户修改密码必须遵守密码的复杂性原则.</p>
<h3 id="2-3-1-passwd一些常用参数"><a href="#2-3-1-passwd一些常用参数" class="headerlink" title="2.3.1.passwd一些常用参数"></a>2.3.1.passwd一些常用参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">passwd -x ：--maximun=days(maximun passwd lifetime(root only))两次密码修改的最大天数，后面接数字；仅root权限操作</div><div class="line">passwd -n ：--minimun=days 两次修改密码的最小天数，后面接数字，仅限root权限</div><div class="line">passwd -w ：-warning=days 在距离多少天提醒用户修改密码，仅限root权限</div><div class="line">passwd -i ：--inactive=days 在密码过期后多少天，用户被禁掉，仅限root权限</div><div class="line">passwd -l ：--lock 锁住用户，使其无法登陆，仅限root权限（其实就是在shadow中的密码字符串前加入！！，那么用户就不能登录）</div><div class="line">passwd -u ：--unclock解除锁定</div><div class="line">passwd -k ：--keep-tokens 保留即将过期的用户在期满或仍能使用</div><div class="line">passwd -d ：--delete 删除用户密码</div><div class="line">passwd -stdin ：--stdin （read new tokens from stdin (root only)）从stdin 读入密码</div><div class="line"></div><div class="line">passwd -S 查看密码状态</div><div class="line"></div><div class="line">[root@linux-study ~]# passwd -S chenyansong4</div><div class="line">chenyansong4 PS 2016-07-20 0 99999 7 -1 (密码已设置，使用 SHA512 加密。)</div><div class="line">##密码设定时间（2016-07-20） 密码修改间隔时间（0） 密码有效期（99999）警告时间（7）密码不失效（-1）</div><div class="line"></div><div class="line">- - stdin 是接受前面echo的输入</div><div class="line">[root@lamp01 ~]# echo 123|passwd --stdin test_home_dir</div><div class="line">更改用户 test_home_dir 的密码 。</div><div class="line">passwd： 所有的身份验证令牌已经成功更新</div><div class="line"></div><div class="line">#或者密码来自一个文件</div><div class="line">passwd --stdin oldboy &lt;p.log</div></pre></td></tr></table></figure>
<h3 id="2-3-2-举例"><a href="#2-3-2-举例" class="headerlink" title="2.3.2.举例"></a>2.3.2.举例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"># 要求:oldboy用户7天内不能更改密码,60天以后必须修改密码,过期前10天提醒用户,过期30天后禁止用户登录</div><div class="line">[root@lamp01 ~]# passwd -n 7 -x 60 -w 10 -i 30 oldboy</div><div class="line">调整用户密码老化数据oldboy。</div><div class="line">passwd: 操作成功</div><div class="line"></div><div class="line">#查看用户的过期时间</div><div class="line">[root@lamp01 ~]# chage -l oldboy</div><div class="line">Last password change                                    : Feb 11, 2017</div><div class="line">Password expires                                        : Apr 12, 2017</div><div class="line">Password inactive                                       : May 12, 2017</div><div class="line">Account expires                                         : never</div><div class="line">Minimum number of days between password change          : 7</div><div class="line">Maximum number of days between password change          : 60</div><div class="line">Number of days of warning before password expires       : 10</div><div class="line"></div><div class="line"></div><div class="line">#注意：普通用户可以修改自己的密码，而管理员可以更改任何用户的密码，但是普通用户的密码命名规则必须是8位以上含有数字字母和其他字符的，但是管理员可以不必。</div><div class="line"> </div><div class="line">#在普通用户下，修改自己的密码：</div><div class="line">[lingzhiling@localhost ~]$ passwd</div><div class="line">更改用户 lingzhiling 的密码 。</div><div class="line">为 lingzhiling 更改 STRESS 密码。</div><div class="line">（当前）UNIX 密码：</div><div class="line">新的 密码：</div><div class="line">无效的密码： 过短</div><div class="line">新的 密码：</div><div class="line">重新输入新的 密码：</div><div class="line">passwd： 所有的身份验证令牌已经成功更新。</div></pre></td></tr></table></figure>
<h2 id="2-4-修改用户信息usermod"><a href="#2-4-修改用户信息usermod" class="headerlink" title="2.4.修改用户信息usermod"></a>2.4.修改用户信息usermod</h2><h3 id="2-4-1-参数列表"><a href="#2-4-1-参数列表" class="headerlink" title="2.4.1.参数列表"></a>2.4.1.参数列表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">usermod 的大多数参数和useradd相同</div><div class="line">-c comment;</div><div class="line">-d home_dir;</div><div class="line">-e expire_date;</div><div class="line">-f inactive_days ; 账号过期几日后永久过期停权</div><div class="line">-G 附加组</div><div class="line">-g 初始组</div><div class="line">-s 指定新登入的shell</div><div class="line">-u 指定uid（唯一，非负数）</div><div class="line">-L 冻结账户的密码，使之无法登录</div><div class="line">-U 解冻</div><div class="line">-l log_name;变更用户登录时的名称为log_name</div><div class="line"></div><div class="line">#例子</div><div class="line">usermod -c OOldBoy -u 1806 -G root -s /bin/tcsh -d /tmp/oldboy7 oldboy</div></pre></td></tr></table></figure>
<h2 id="2-5-查看、更改用户密码信息（chage）"><a href="#2-5-查看、更改用户密码信息（chage）" class="headerlink" title="2.5.查看、更改用户密码信息（chage）"></a>2.5.查看、更改用户密码信息（chage）</h2><h3 id="2-5-1-chage-l-zhangsan-列表"><a href="#2-5-1-chage-l-zhangsan-列表" class="headerlink" title="2.5.1.chage -l zhangsan 列表"></a>2.5.1.chage -l zhangsan 列表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">[root@lamp01 ~]# chage -l oldboy</div><div class="line">Last password change                                    : Feb 11, 2017    #上次密码修改时间</div><div class="line">Password expires                                        : Apr 12, 2017    #密码过期时间</div><div class="line">Password inactive                                       : May 12, 2017    #密码过期后到禁用账户的天数</div><div class="line">Account expires                                         : never    #账户过期时间</div><div class="line">Minimum number of days between password change          : 7        #禁止修改密码的天数</div><div class="line">Maximum number of days between password change          : 60    #必须修改密码的天数</div><div class="line">Number of days of warning before password expires       : 10    #在密码过期多少天之前提醒</div></pre></td></tr></table></figure>
<h3 id="2-5-2-参数含义"><a href="#2-5-2-参数含义" class="headerlink" title="2.5.2.参数含义"></a>2.5.2.参数含义</h3><table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-l</td>
<td>列出用户的详细密码状态</td>
</tr>
<tr>
<td>-d  日期</td>
<td>修改密码最后一次更改日期</td>
</tr>
<tr>
<td>-m 天数</td>
<td>两次密码修改时间</td>
</tr>
<tr>
<td>-M 天数</td>
<td>密码有效期</td>
</tr>
<tr>
<td>-W 天数</td>
<td>密码过期前警告天数</td>
</tr>
<tr>
<td>-I 天数</td>
<td>密码过后宽限天数</td>
</tr>
<tr>
<td>-E 日期</td>
<td>账号失效时间</td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chage -d 0 lamp</div><div class="line">#这个命令其实是把密码修改日期归0了,这样用户一登录就要修改密码</div></pre></td></tr></table></figure>
<blockquote>
<p>案例</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># 要求oldboy用户7天内不能更改密码,60天以后必须修改密码,过期前10天提醒用户,过期30天后禁止用户登录</div><div class="line">chage -m7 -M60 -W10 -I30 oldboy</div><div class="line">chage -m 7 -M 60 -W 10 -I 30 oldboy</div></pre></td></tr></table></figure>
<h2 id="2-6-删除用户userdel"><a href="#2-6-删除用户userdel" class="headerlink" title="2.6.删除用户userdel"></a>2.6.删除用户userdel</h2><h3 id="2-6-1-语法"><a href="#2-6-1-语法" class="headerlink" title="2.6.1.语法"></a>2.6.1.语法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">useradd [-r] 用户名        # -r删除用户的同时删除用户家目录</div></pre></td></tr></table></figure>
<p>&emsp;另外一个手工删除用户<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">vim /etc/passwd</div><div class="line">vim /etc/shadow</div><div class="line">vim /etc/group</div><div class="line">vim /etc/gshadow</div><div class="line">rm -rf /var/spool/mail/lamp</div><div class="line">rm -rf /home/lamp    #家目录</div><div class="line"></div><div class="line">#总结：在生产场景中，请不要轻易用-r参数，这会在删除用户的同时删除用户家目录下的所有文件和目录，如果非要删除家目录，当家目录下有重要的文件时，那么删除之前请先备份文件。另外一种方式：将passwd中相关用户的行注释，或者锁定密码，或者让账号过期等方式</div></pre></td></tr></table></figure></p>
<h2 id="2-7-groupdel-删除用户"><a href="#2-7-groupdel-删除用户" class="headerlink" title="2.7.groupdel 删除用户"></a>2.7.groupdel 删除用户</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">groupdel chenyansong</div></pre></td></tr></table></figure>
<h2 id="2-8-groupmod-修改用户组"><a href="#2-8-groupmod-修改用户组" class="headerlink" title="2.8.groupmod 修改用户组"></a>2.8.groupmod 修改用户组</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">groupmod [选项] 组名</div><div class="line">选项:</div><div class="line">    -g GID          修改组ID</div><div class="line">    -n 新组名    修改组名</div><div class="line"></div><div class="line">groupmod -n testgrp group1</div><div class="line">#把组名group1修改为testgrp</div></pre></td></tr></table></figure>
<h2 id="2-9-向组中添加用户，删除组中用户"><a href="#2-9-向组中添加用户，删除组中用户" class="headerlink" title="2.9.向组中添加用户，删除组中用户"></a>2.9.向组中添加用户，删除组中用户</h2><p>&emsp;如果删除的组中有初始用户，那么该组就不能删除，而如果组中只是附加用户，这个组是可以删除的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">gpasswd 选项 组名</div><div class="line">选项:</div><div class="line">    -a 用户名 : 把用户加入组</div><div class="line">    -d 用户名  : 把用户从组中删除</div></pre></td></tr></table></figure></p>
<h1 id="3-用户组示意图"><a href="#3-用户组示意图" class="headerlink" title="3.用户组示意图"></a>3.用户组示意图</h1><p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/linux/usermanager/1.png" alt="用户组示意图" title="用户组示意图"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/20/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><span class="page-number current">21</span><a class="page-number" href="/page/22/">22</a><span class="space">&hellip;</span><a class="page-number" href="/page/58/">58</a><a class="extend next" rel="next" href="/page/22/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/header.jpg"
               alt="Mr. Chen" />
          <p class="site-author-name" itemprop="name">Mr. Chen</p>
           
              <p class="site-description motion-element" itemprop="description">一个技术渣的自说自话</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">576</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">30</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">37</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mr. Chen</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>





  

  

  

  

  

</body>
</html>
