<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Chen&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="一个技术渣的自说自话">
<meta property="og:type" content="website">
<meta property="og:title" content="Chen's Blog">
<meta property="og:url" content="http://yoursite.com/page/19/index.html">
<meta property="og:site_name" content="Chen's Blog">
<meta property="og:description" content="一个技术渣的自说自话">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chen's Blog">
<meta name="twitter:description" content="一个技术渣的自说自话">
  
    <link rel="alternate" href="/atom.xml" title="Chen&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Chen&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">一个技术渣的自说自话</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-nosql/memcached/Memcached雪崩和穿透" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/nosql/memcached/Memcached雪崩和穿透/" class="article-date">
  <time datetime="2017-04-16T04:47:25.750Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/memcached/">memcached</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/nosql/memcached/Memcached雪崩和穿透/">Memcached雪崩和穿透</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-缓存穿透"><a href="#1-缓存穿透" class="headerlink" title="1.缓存穿透"></a>1.缓存穿透</h1><h2 id="1-1-什么是缓存穿透？"><a href="#1-1-什么是缓存穿透？" class="headerlink" title="1.1.什么是缓存穿透？"></a>1.1.什么是缓存穿透？</h2><p>&emsp;一般的缓存系统，都是按照key去缓存查询，如果不存在对应的value，就应该去后端系统查找（比如DB）。如果key对应的value是一定不存在的，并且对该key并发请求量很大，就会对后端系统造成很大的压力。这就叫做缓存穿透。</p>
<h2 id="1-2-如何避免？"><a href="#1-2-如何避免？" class="headerlink" title="1.2.如何避免？"></a>1.2.如何避免？</h2><ol>
<li><p>对查询结果为空的情况也进行缓存，缓存时间设置短一点，或者该key对应的数据insert了之后清理缓存。</p>
</li>
<li><p>对一定不存在的key进行过滤。可以把所有的可能存在的key放到一个大的Bitmap中，查询时通过该bitmap过滤。【感觉应该用的不多吧】</p>
</li>
</ol>
<h1 id="2-缓存雪崩"><a href="#2-缓存雪崩" class="headerlink" title="2.缓存雪崩"></a>2.缓存雪崩</h1><h2 id="2-1-什么是缓存雪崩？"><a href="#2-1-什么是缓存雪崩？" class="headerlink" title="2.1.什么是缓存雪崩？"></a>2.1.什么是缓存雪崩？</h2><p>&emsp;当缓存服务器重启或者大量缓存集中在某一个时间段失效，这样在失效的时候，也会给后端系统(比如DB)带来很大压力。</p>
<h2 id="2-2-如何避免？"><a href="#2-2-如何避免？" class="headerlink" title="2.2.如何避免？"></a>2.2.如何避免？</h2><ol>
<li><p>在缓存失效后，通过加锁或者队列来控制读数据库写缓存的线程数量。比如对某个key只允许一个线程查询数据和写缓存，其他线程等待。</p>
</li>
<li><p>不同的key，设置不同的过期时间，让缓存失效的时间点尽量均匀。</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/nosql/memcached/Memcached雪崩和穿透/" data-id="cj290scr401f6ssqqz1qr10i9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/memcached/">memcached</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-nosql/memcached/memcached缓存的无底洞现象" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/nosql/memcached/memcached缓存的无底洞现象/" class="article-date">
  <time datetime="2017-04-16T04:47:25.749Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/memcached/">memcached</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/nosql/memcached/memcached缓存的无底洞现象/">memcached缓存的无底洞现象</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-Memcached-缓存无底洞现象"><a href="#1-Memcached-缓存无底洞现象" class="headerlink" title="1.Memcached 缓存无底洞现象"></a>1.Memcached 缓存无底洞现象</h1><p>&emsp;facebook的工作人员反应的，facebook在2010年左右,memcached节点就已经达到了3000个,存储的数据进千G的数据存储。<br>&emsp;他们发现一个问题，memecached连接频率，效率都下降了，于是加了memcached节点.添加节点后发现因为连接频率导致的问题并没有好转。称之为“无底洞现象”。</p>
<h1 id="2-问题分析："><a href="#2-问题分析：" class="headerlink" title="2.问题分析："></a>2.问题分析：</h1><p>以用户为例：user-133-age, usr-133-name, usr-133-height ….共有N个KEY。<br>&emsp;当服务器增多，133号的信息也被散落在更多的节点上。所以同样访问个人主页，要得到的个人主页信息,则节点越多，要连接的节点也越多。对于memcached的连接数，并没有随着节点的增多，而降低。导致问题出现…。<br>&emsp;事实上：<br>NoSQL和传统的RDBMS，并不是水火不容，而两者在某些设计上,是可以互相参考的,对于memcached,redis这种key value存储，key的设计可以参考MySql中表/列的设计，比如user表下，有age列，name列,身高列,对应的key,可以用user:1333:age=23,user:133:name=’lisi’,suer:133:height=’168’</p>
<h1 id="3-问题的解决方案："><a href="#3-问题的解决方案：" class="headerlink" title="3.问题的解决方案："></a>3.问题的解决方案：</h1><p>&emsp;把某一组key，按照公同的前缀,来分布，比如 user-133-age,user-133-name,user-133-height这个3个key，在<font color="red">用分布式算法求其节点时,应该可以用user-133来计算而不是以 user-133-nage来计算</font>,这样3个关于个人的信息的key都落到了同一个节点上，点击的访问个人主页的时,值需要连接1个节点。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/nosql/memcached/memcached缓存的无底洞现象/" data-id="cj290scrr01fpssqqxlbzjvat" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/memcached/">memcached</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-nosql/memcached/memcached的内存分配机制与惰性失效机制" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/nosql/memcached/memcached的内存分配机制与惰性失效机制/" class="article-date">
  <time datetime="2017-04-16T04:47:25.747Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/memcached/">memcached</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/nosql/memcached/memcached的内存分配机制与惰性失效机制/">memcached的内存分配机制与惰性失效机制</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-内存的碎片化"><a href="#1-内存的碎片化" class="headerlink" title="1.内存的碎片化"></a>1.内存的碎片化</h1><p>如果用C语言直接 malloc free来向操作系统申请和释放内存时，在不断的申请和释放过程中，形成了一些很小的内存片段，无法再利用，这就是内存碎片</p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/nosql/memcached/LRU/1.png" alt=""></p>
<h1 id="2-memcached的内存分配机制"><a href="#2-memcached的内存分配机制" class="headerlink" title="2.memcached的内存分配机制"></a>2.memcached的内存分配机制</h1><h2 id="2-1-Slab-Allocator分配机制"><a href="#2-1-Slab-Allocator分配机制" class="headerlink" title="2.1.Slab Allocator分配机制"></a>2.1.Slab Allocator分配机制</h2><p>memcached用slab allocator来管理内存的，<font color="red"> 其基本原理：把内存划分成数个slab仓库，各个仓库切分不同的尺寸的小块（chunk)，需要存储内容时，判断内存的大小，为其选取合理的仓库 </font>，但是如果有100byte的内容要存储，但距离100byte最近的122大小的仓库中你的chunk满了，此时并不会寻找更大的chunk，而是将122中不常用的数据踢掉</p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/nosql/memcached/LRU/2.jpg" alt=""></p>
<h2 id="2-2-Slab-Allocator缓存原理"><a href="#2-2-Slab-Allocator缓存原理" class="headerlink" title="2.2.Slab Allocator缓存原理"></a>2.2.Slab Allocator缓存原理</h2><p> memcached根据收到的数据的大小， 选择最适合数据大小的slab。memcached中保存着slab内空闲chunk的列表， 根据该列表选择chunk， 然后将数据缓存于其中。</p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/nosql/memcached/LRU/3.jpg" alt=""></p>
<h2 id="2-3-lab-Allocator的缺点"><a href="#2-3-lab-Allocator的缺点" class="headerlink" title="2.3.lab Allocator的缺点"></a>2.3.lab Allocator的缺点</h2><p>chunks为固定大小,造成浪费. 这个问题 不能克服,只能缓解</p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/nosql/memcached/LRU/4.jpg" alt=""></p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/nosql/memcached/LRU/5.png" alt=""></p>
<h2 id="2-4-grow-factor-增长因子"><a href="#2-4-grow-factor-增长因子" class="headerlink" title="2.4.grow factor(增长因子)"></a>2.4.grow factor(增长因子)</h2><p>memcached在启动时指定Growth Factor因子（通过­f选项）， 就可以在某种程度上控制slab之间的差异。默认值为1.25。 但是，在该选项出现之前，这个因子曾经固定为2，称为“powers of 2”策略<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#如下图：112/88=1.25 也就是增长因子，一般而言，观察缓存数据大小的变化规律，设置合理的生长因子，可以根据自己网站的缓存数据的大小来调整增长因子</div></pre></td></tr></table></figure></p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/nosql/memcached/LRU/6.png" alt=""><img src="http://ols7leonh.bkt.clouddn.com//assert/img/nosql/memcached/LRU/7.png" alt=""><br><br></p>
<h1 id="3-惰性失效机制（Lazy-Expiration）"><a href="#3-惰性失效机制（Lazy-Expiration）" class="headerlink" title="3.惰性失效机制（Lazy Expiration）"></a>3.惰性失效机制（Lazy Expiration）</h1><p>memcached内部不会监视记录是否过期，而是在get时会查看记录的时间戳（和设定的时间比较），检查记录是否过期。这种技术被称为lazy（惰性）expiration。 因此，<font color="red">memcached不会在过期监视上耗费CPU时间</font></p>
<ol>
<li>当某个值过期后，并没有从内存删除，因此stats统计的时候，curr_item有其信息</li>
<li>当某个新值去占用他的位置的时候，当成空chunk来占用</li>
<li>当get值时，判断是否过期，如果过期返回空，并且清空，此时在stats，curr_item就减少了</li>
<li>即：这个过期只是让用户看不到这个数据而已并没有真正删除数据</li>
</ol>
<p>为什么说节省了CPU？<br>实际上设置5s之后失效，如果是主动的使数据失效的话，就会在5s的时候去主动的触发数据失效，这样系统本身还要去检查，5s到了吗，哦，没到，那等一下再去检查，系统会一直这样检查，这样就会消耗CPU的时间，但是惰性机制就是，在get的时候，直接取检查，当前时间是否和数据建立的时间之间的时间差，然后，超过了我设定的过期时间间隔，此时才正式的将数据删除，新增数据的时候也是这样去检查，</p>
<h1 id="4-memcached的删除机制"><a href="#4-memcached的删除机制" class="headerlink" title="4.memcached的删除机制"></a>4.memcached的删除机制</h1><p>Least Recently Used（LRU）——最近最少使用，memcached会优先使用已超时的记录的空间，但即使如此，也会发生追加新记录时空间不 足的情况，此时就要使用名为 Least Recently Used（LRU）机制来分配空间<br>如果chunk满了，又有新的加入，旧数据会被踢掉。踢掉可以设置两种FIFO（先进先出）、LRU(最近最少使用)。下面是一个LRU的demo:</p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/nosql/memcached/LRU/8.png" alt=""></p>
<font color="green">注意：get、inrc、decr等可以使数据变成最近使用</font>














      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/nosql/memcached/memcached的内存分配机制与惰性失效机制/" data-id="cj290scrm01fmssqqd21ojyq7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/memcached/">memcached</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-nosql/memcached/Memcached参数含义及CRUD、自增、stats、flush_all等语句" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/nosql/memcached/Memcached参数含义及CRUD、自增、stats、flush_all等语句/" class="article-date">
  <time datetime="2017-04-16T04:47:25.745Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/memcached/">memcached</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/nosql/memcached/Memcached参数含义及CRUD、自增、stats、flush_all等语句/">Memcached参数含义及CRUD、自增、stats、flush_all等语句</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-参数含义"><a href="#1-参数含义" class="headerlink" title="1.参数含义"></a>1.参数含义</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">add   &lt;key&gt;        &lt;flag&gt;         &lt;expires&gt;        &lt;byte&gt;</div></pre></td></tr></table></figure>
<ul>
<li>key 每个缓存有一个独特的名字和存储空间. <font color="red">key是操作数据的唯一标识</font>，key可以250个字节以内,(不能有空格和控制字符) 注:在新版开发计划中提到key可能会扩充到65535个字节</li>
<li>flag 用来表示存入的是字符串、数组、还是对象等</li>
<li>expires 缓存的有效期，一种方式是秒数，另一种是使用Unix时间戳，0为有效期无限</li>
<li>byte 保留值的字节数</li>
</ul>
<h1 id="2-参数expires-举例"><a href="#2-参数expires-举例" class="headerlink" title="2.参数expires 举例"></a>2.参数expires 举例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">#设置秒数，从设定开始数第N秒后失效</div><div class="line">set web 0 10 5                #设置key=web，然后10s之后数据失效，存储数据的大小为5个字节</div><div class="line">zixue</div><div class="line"></div><div class="line">#时间戳，到指定的时间戳后失效，比如在团购网站缓存的某团到中午12:00失效</div><div class="line">set web2 0 1379209940 5                        #1379209940 就是一个时间戳（就是某一个时间点）</div><div class="line">abcde</div><div class="line"></div><div class="line"></div><div class="line">#设置为0，表示不自动失效</div><div class="line">set web3 0 0 5</div><div class="line">abcde</div><div class="line"></div><div class="line">##有种误会，设为0，永久有效，是错误的</div><div class="line">#1.编译memcached时，指定一个最长的有效期，默认是30天，所以即使设置为0,30天后也会失效</div><div class="line">#2.可能等不到30天，就会被新数据挤出去</div><div class="line">#3.memcached重启）</div></pre></td></tr></table></figure>
<h1 id="3-增删改查语句"><a href="#3-增删改查语句" class="headerlink" title="3.增删改查语句"></a>3.增删改查语句</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line">#增加（add)</div><div class="line">add class 00 0 4</div><div class="line">erqi</div><div class="line">STORED</div><div class="line"></div><div class="line">add class 0 0 4</div><div class="line">eri9</div><div class="line">NOT_STORED                     #为何会添加失败？因为在add只能是新增一个内存中没有的key，如果想要重复的对一个key进行操作，只能用replace</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#删除（delete）</div><div class="line">add class 00 0 4</div><div class="line">erqi</div><div class="line">STORED</div><div class="line"></div><div class="line">delete class</div><div class="line">DELETED</div><div class="line"></div><div class="line">#delete key [time seconds]      #加秒之后，是指被删除的key，N秒内不能再用，目的是让网站上的页面缓存也代谢完毕</div><div class="line"></div><div class="line">#替换（replace改）</div><div class="line">get class</div><div class="line">VALUE class 0 4</div><div class="line">eqi3</div><div class="line">END</div><div class="line"></div><div class="line">replace class 0 0 4                        #重新设置</div><div class="line">eri8</div><div class="line">STORED</div><div class="line"></div><div class="line">get class</div><div class="line">VALUE class 0 4</div><div class="line">eri8</div><div class="line">END</div><div class="line"></div><div class="line"></div><div class="line">#replace只能修改存在的key</div><div class="line">get abd</div><div class="line">END</div><div class="line"></div><div class="line">replace abd 0 0 4                                #因为abd是不存在的，所以用replace是不能修改的</div><div class="line">eqi9</div><div class="line">NOT_STORED</div><div class="line"></div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">#查找（get）</div><div class="line">get class</div><div class="line">VALUE class 0 4</div><div class="line">eri8</div><div class="line">END</div><div class="line"></div><div class="line">#set</div><div class="line">#其实set是add和replace的结合，如果有对应的key就修改，如果没有对应的key就添加</div><div class="line">set aa 0 0 4                                        #第一次set</div><div class="line">eqi5</div><div class="line">STORED</div><div class="line"></div><div class="line">get aa</div><div class="line">VALUE aa 0 4</div><div class="line">eqi5</div><div class="line">END</div><div class="line"></div><div class="line">set aa 0 0 4                                #对同样的key，第二次set</div><div class="line">eqi0</div><div class="line">STORED</div><div class="line"></div><div class="line">get aa</div><div class="line">VALUE aa 0 4</div><div class="line">eqi0</div><div class="line">END</div></pre></td></tr></table></figure>
<h1 id="4-自增、自减操作"><a href="#4-自增、自减操作" class="headerlink" title="4.自增、自减操作"></a>4.自增、自减操作</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">incr/decr     key      num</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">set age 00 0 2</div><div class="line">24</div><div class="line">STORED</div><div class="line"></div><div class="line">incr age 1                        #增加1</div><div class="line">25</div><div class="line"></div><div class="line">get age</div><div class="line">VALUE age 0 2</div><div class="line">25</div><div class="line">END</div><div class="line"></div><div class="line">decr age 1                    #减少1</div><div class="line">24</div><div class="line"></div><div class="line">get age</div><div class="line">VALUE age 0 2</div><div class="line">24</div><div class="line">END</div><div class="line"></div><div class="line">#注意：incre/decr操作是将值当做32位无符号来操作的，值的范围：【0 - 2的32次-1】</div><div class="line">set num 0 0 1</div><div class="line">2</div><div class="line">STORED</div><div class="line"></div><div class="line">decr num 1</div><div class="line">1</div><div class="line"></div><div class="line">decr num 1                                #因为是无符号的，所以一直减下去，还会是0</div><div class="line">0</div><div class="line">decr num 1</div><div class="line">0</div><div class="line">decr num 1</div><div class="line">0</div><div class="line"></div><div class="line">get num</div><div class="line">VALUE num 0 1</div><div class="line">0</div><div class="line">END</div><div class="line"></div><div class="line"></div><div class="line">/**</div><div class="line">应用场景：秒杀功能</div><div class="line">每个人的抢单主要在内存中操作，速度非常的快，这里的秒杀只是每人发一个订单号，标明你能够购买了，下面就是自己去购买页面下单即可，而秒杀只是负责前面的抢单部分</div><div class="line">*/</div></pre></td></tr></table></figure>
<h1 id="5-统计命令"><a href="#5-统计命令" class="headerlink" title="5.统计命令"></a>5.统计命令</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">stats</div><div class="line">STAT pid 8816                                                 #进程号                               </div><div class="line">STAT uptime 3054547022                       #服务器自运行以来的秒数</div><div class="line">STAT time 234797177                            #当前服务器上的UNIX时间</div><div class="line">STAT version 1.4.4-14-g9c660c0               #服务器的版本字符串</div><div class="line">STAT pointer_size 64</div><div class="line">STAT curr_connections 10                            #当前存在的连接数</div><div class="line">STAT total_connections 11                            #历史上的总的连接数</div><div class="line">STAT connection_structures 11</div><div class="line">STAT cmd_get 21                            #get了多少次</div><div class="line">STAT cmd_set 14</div><div class="line">STAT cmd_flush 0</div><div class="line">STAT get_hits 12                            #get成功返回(关键字获取命中的次数)</div><div class="line">STAT get_misses 9                         #get没有取到值    ，这里可以计算出缓存命中率</div><div class="line">STAT delete_misses 0</div><div class="line">STAT delete_hits 1</div><div class="line">STAT incr_misses 0</div><div class="line">STAT incr_hits 1</div><div class="line">STAT decr_misses 1</div><div class="line">STAT decr_hits 5</div><div class="line">STAT cas_misses 0</div><div class="line">STAT cas_hits 0</div><div class="line">STAT cas_badval 0</div><div class="line">STAT auth_cmds 0</div><div class="line">STAT auth_errors 0</div><div class="line">STAT bytes_read 702</div><div class="line">STAT bytes_written 669</div><div class="line">STAT limit_maxbytes 20971520</div><div class="line">STAT accepting_conns 1</div><div class="line">STAT listen_disabled_num 0</div><div class="line">STAT threads 4</div><div class="line">STAT conn_yields 0</div><div class="line">STAT bytes 437</div><div class="line">STAT curr_items 6                                                            #当前存在的key的数量</div><div class="line">STAT total_items 9                                                            #历史上存在的总的数量</div><div class="line">STAT evictions 0</div><div class="line">END</div></pre></td></tr></table></figure>
<h1 id="6-flush-all"><a href="#6-flush-all" class="headerlink" title="6.flush_all"></a>6.flush_all</h1><blockquote>
<p>将删除所有的数据，但是这里是惰性删除的<br>全删: flush_all [time] time参数是指是所有缓存失效,并在time秒内限制使用删除的key</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/nosql/memcached/Memcached参数含义及CRUD、自增、stats、flush_all等语句/" data-id="cj290scr701f9ssqqzs8dy8py" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/memcached/">memcached</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-nosql/memcached/memcached内存实现原理（转）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/nosql/memcached/memcached内存实现原理（转）/" class="article-date">
  <time datetime="2017-04-16T04:47:25.743Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/memcached/">memcached</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/nosql/memcached/memcached内存实现原理（转）/">memcached内存实现原理（转）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>首先要说明一点，MemCache的数据存放在内存中，存放在内存中个人认为意味着几点：</p>
<ol>
<li><p>访问数据的速度比传统的关系型数据库要快，因为Oracle、MySQL这些传统的关系型数据库为了保持数据的持久性，数据存放在硬盘中，IO操作速度慢</p>
</li>
<li><p>MemCache的数据存放在内存中同时意味着只要MemCache重启了，数据就会消失</p>
</li>
<li><p>既然MemCache的数据存放在内存中，那么势必受到机器位数的限制，这个之前的文章写过很多次了，32位机器最多只能使用2GB的内存空间，64位机器可以认为没有上限, 然后我们来看一下MemCache的原理，MemCache最重要的莫不是内存分配的内容了，MemCache采用的内存分配方式是固定空间分配，还是自己画一张图说明：</p>
</li>
</ol>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/nosql/memcached/memory/1.png" alt=""></p>
<p>这张图片里面涉及了slab_class、slab、page、chunk四个概念，它们之间的关系是：</p>
<ol>
<li><p>MemCache将内存空间分为一组slab</p>
</li>
<li><p>每个slab下又有若干个page，每个page默认是1M，如果一个slab占用100M内存的话，那么这个slab下应该有100个page</p>
</li>
<li><p>每个page里面包含一组chunk，chunk是真正存放数据的地方，同一个slab里面的chunk的大小是固定的</p>
</li>
<li><p>有相同大小chunk的slab被组织在一起，称为slab_class</p>
</li>
</ol>
<p>&emsp;MemCache内存分配的方式称为allocator，slab的数量是有限的，几个、十几个或者几十个，这个和启动参数的配置相关。</p>
<p>&emsp;MemCache中的value过来存放的地方是由value的大小决定的，value总是会被存放到与chunk大小最接近的一个slab中，比如slab[1]的chunk大小为80字节、slab[2]的chunk大小为100字节、slab[3]的chunk大小为128字节（相邻slab内的chunk基本以1.25为比例进行增长，MemCache启动时可以用-f指定这个比例），那么过来一个88字节的value，这个value将被放到2号slab中。</p>
<p>&emsp;放slab的时候，首先slab要申请内存，申请内存是以page为单位的，所以在放入第一个数据的时候，无论大小为多少，都会有1M大小的page被分配给该slab。申请到page后，slab会将这个page的内存按chunk的大小进行切分，这样就变成了一个chunk数组，最后从这个chunk数组中选择一个用于存储数据。</p>
<p>&emsp;如果这个slab中没有chunk可以分配了怎么办，如果MemCache启动没有追加-M（禁止LRU，这种情况下内存不够会报Out Of Memory错误），那么MemCache会把这个slab中最近最少使用的chunk中的数据清理掉，然后放上最新的数据。针对MemCache的内存分配及回收算法，总结三点：</p>
<ol>
<li>MemCache的内存分配chunk里面会有内存浪费，88字节的value分配在128字节（紧接着大的用）的chunk中，就损失了30字节，但是这也避免了管理内存碎片的问题</li>
<li>MemCache的LRU算法不是针对全局的，是针对slab的</li>
<li>应该可以理解为什么MemCache存放的value大小是限制的，因为一个新数据过来，slab会先以page为单位申请一块内存，申请的内存最多就只有1M，所以value大小自然不能大于1M了</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/nosql/memcached/memcached内存实现原理（转）/" data-id="cj290scrg01fhssqq6wi21s7v" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/memcached/">memcached</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-nosql/memcached/Memcached中一些参数的限制" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/nosql/memcached/Memcached中一些参数的限制/" class="article-date">
  <time datetime="2017-04-16T04:47:25.741Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/memcached/">memcached</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/nosql/memcached/Memcached中一些参数的限制/">Memcached中一些参数的限制</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-Key的长度"><a href="#1-Key的长度" class="headerlink" title="1.Key的长度"></a>1.Key的长度</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#语法: </div><div class="line">add key flag expire length</div><div class="line"></div><div class="line">#key 250个字节</div></pre></td></tr></table></figure>
<h1 id="2-Value的限制1M"><a href="#2-Value的限制1M" class="headerlink" title="2.Value的限制1M"></a>2.Value的限制1M</h1><p>一般都是存储一些文本，1M够了</p>
<h1 id="3-内存限制"><a href="#3-内存限制" class="headerlink" title="3.内存限制"></a>3.内存限制</h1><p>如果有30G的数据要缓存，一般也不会单实例装30G（不要把鸡蛋放在一个篮子里），一般建议，开启多个实例（可以在不同的机器或同一台机器上的不同端口中启多个memcached）</p>
<h1 id="4-启动多个实例"><a href="#4-启动多个实例" class="headerlink" title="4.启动多个实例"></a>4.启动多个实例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">#可以启动多个实例（指定不同的端口即可）</div><div class="line">[root@originalOS memcached]# ./bin/memcached -p 11212 -u nobody -d</div><div class="line">[root@originalOS memcached]# ./bin/memcached -p 11213 -u nobody -d</div><div class="line"></div><div class="line">#查看启动的实例</div><div class="line">[root@originalOS memcached]# ps -ef|grep memcached               </div><div class="line">nobody     8695      1  0 19:19 ?        00:00:00 ./bin/memcached -m 64 -p 11211 -u nobody -d</div><div class="line">nobody     8711      1  1 19:29 ?        00:00:00 ./bin/memcached -p 11212 -u nobody -d</div><div class="line">nobody     8721      1  1 19:29 ?        00:00:00 ./bin/memcached -p 11213 -u nobody -d</div><div class="line">root       8729   1022  3 19:29 pts/0    00:00:00 grep memcached</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/nosql/memcached/Memcached中一些参数的限制/" data-id="cj290scqu01eyssqqahrb8tzc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/memcached/">memcached</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-nosql/memcached/Linux下编译安装memcached" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/nosql/memcached/Linux下编译安装memcached/" class="article-date">
  <time datetime="2017-04-16T04:47:25.740Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/memcached/">memcached</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/nosql/memcached/Linux下编译安装memcached/">Linux下编译安装memcached</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-准备编译环境"><a href="#1-准备编译环境" class="headerlink" title="1.准备编译环境"></a>1.准备编译环境</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install gcc make cmake autoconf libtool                        #gcc make 都是编译器</div></pre></td></tr></table></figure>
<h1 id="2-安装依赖：libevent"><a href="#2-安装依赖：libevent" class="headerlink" title="2.安装依赖：libevent"></a>2.安装依赖：libevent</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">去http://libevent.org/   下载稳定版本</div><div class="line"></div><div class="line">tar zxvf libevent-2.0.21-stable.tar.gz</div><div class="line">cd libevent-2.0.21-stable</div><div class="line">./configure --prefix=/usr/local/libevent                        #指定libevent的安装位置</div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure>
<h1 id="3-编译memcached"><a href="#3-编译memcached" class="headerlink" title="3.编译memcached"></a>3.编译memcached</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cd memcached-1.4.5</div><div class="line">./configure--prefix=/usr/local/memcached --with-libevent=/usr/local/libevent      #指定上面安装libevent的安装位置，因为memcached依赖libevent</div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure>
<h1 id="4-启动，测试"><a href="#4-启动，测试" class="headerlink" title="4.启动，测试"></a>4.启动，测试</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">#查看帮助</div><div class="line">./bin/memcached -h</div><div class="line"></div><div class="line"></div><div class="line">#启动（不指定用户）</div><div class="line">不允许使用root去启动，因为一般不用root，安全问题</div><div class="line">[root@originalOS memcached]# ./bin/memcached -m 64 -p 11211 -vv</div><div class="line">can\&apos;t run as root without the -u switch</div><div class="line">[root@originalOS memcached]#</div><div class="line"></div><div class="line"></div><div class="line">#启动（指定用户：nobody用户）</div><div class="line">[root@originalOS memcached]# ./bin/memcached -m 64 -u nobody -p 11211 -vv       #-vv表示前台直接启动，会打印详细信息</div><div class="line"></div><div class="line"></div><div class="line">#以守护进程的方式运行(-d)</div><div class="line">[root@originalOS memcached]# ./bin/memcached -m 64 -p 11211 -u nobody -d</div><div class="line">[root@originalOS memcached]# ps -ef|grep memcached</div><div class="line">nobody     8695      1  3 19:19 ?        00:00:00 ./bin/memcached -m 64 -p 11211 -u nobody -d</div></pre></td></tr></table></figure>
<h1 id="5-编译出现问题，解决"><a href="#5-编译出现问题，解决" class="headerlink" title="5.编译出现问题，解决"></a>5.编译出现问题，解决</h1><p>注意: 在虚拟机下练习编译,一个容易碰到的问题—虚拟机的时间不对,导致的 gcc 编译过程中,检测时间通不过,一直处于编译过程，错误的原因在于系统时间比文件修改时间早（可能是虚拟机长时间没有用了，没有设置时间同步）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># date -s &apos;yyyy-mm-dd hh:mm:ss&apos;</div><div class="line"># clock -w # 把时间写入 cmos</div></pre></td></tr></table></figure></p>
<h1 id="6-启动多个实例"><a href="#6-启动多个实例" class="headerlink" title="6.启动多个实例"></a>6.启动多个实例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">#可以启动多个实例（指定不同的端口即可）</div><div class="line">[root@originalOS memcached]# ./bin/memcached -p 11212 -u nobody -d</div><div class="line">[root@originalOS memcached]# ./bin/memcached -p 11213 -u nobody -d</div><div class="line"> </div><div class="line">#查看启动的实例</div><div class="line">[root@originalOS memcached]# ps -ef|grep memcached              </div><div class="line">nobody     8695      1  0 19:19 ?        00:00:00 ./bin/memcached -m 64 -p 11211 -u nobody -d</div><div class="line">nobody     8711      1  1 19:29 ?        00:00:00 ./bin/memcached -p 11212 -u nobody -d</div><div class="line">nobody     8721      1  1 19:29 ?        00:00:00 ./bin/memcached -p 11213 -u nobody -d</div><div class="line">root       8729   1022  3 19:29 pts/0    00:00:00 grep memcached</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/nosql/memcached/Linux下编译安装memcached/" data-id="cj290scqo01eussqq2an7936d" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/memcached/">memcached</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mysql/配置mysql从库级联复制和主主复制(转)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/mysql/配置mysql从库级联复制和主主复制(转)/" class="article-date">
  <time datetime="2017-04-16T04:47:25.734Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/mysql/">mysql</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/mysql/配置mysql从库级联复制和主主复制(转)/">配置mysql从库级联复制和主主复制(转)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-配置mysql从库级联复制"><a href="#1-配置mysql从库级联复制" class="headerlink" title="1.配置mysql从库级联复制"></a>1.配置mysql从库级联复制</h1><p>环境是：3306主库 3307从库 3308从库<br>由于已经做了主库3306到从库3307，所以现在我们要实现的需求是，当主库3306产生bin_log，发给从库，从库3307产生的bin_log文件发送给其他从库3308。相当于下图中第三个图</p>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/mysql/mmm/1.png" alt=""></p>
<blockquote>
<p>开启从库3307的log-bin日志文件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sed -i &apos;s@#log-bin = /data/3307/mysql-bin@log-bin = /data/3307/mysql-bin@g&apos; /data/3307/my.cnf</div></pre></td></tr></table></figure>
<blockquote>
<p>在3307从库配置文件my.cnf，[mysqld]模块添加 如下内容</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">log-bin = /data/3307/mysql-bin</div><div class="line">log-slave-updates = 1</div><div class="line">expire_logs_days = 7</div></pre></td></tr></table></figure>
<p>重启数据库3307<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@lixiang data]# /data/3307/mysql stop                        </div><div class="line">Stoping MySQL...</div><div class="line">[root@lixiang data]# /data/3307/mysql start</div><div class="line">Starting MySQL...</div></pre></td></tr></table></figure></p>
<p>如果现下面的错误的时候<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@lixiang data]# /data/3307/mysql stop</div><div class="line">Stoping MySQL...</div><div class="line">/application/mysql/bin/mysqladmin: connect to server at &apos;localhost&apos; failed</div><div class="line">error: &apos;Access denied for user &apos;root&apos;@&apos;localhost&apos; (using password: YES)&apos;</div></pre></td></tr></table></figure></p>
<p>那是因为我们在做单台主从复制的时候，是将主服务器整个包导入到从库3307的，所以修改从库3307的启动文件mysqld<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sed -i &apos;s/lx3307/lx3306/g&apos; /data/3307/mysql</div></pre></td></tr></table></figure></p>
<blockquote>
<p>查看log_slave_updates状态是否开启</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show variables like &quot;log_slave_updates&quot;;</div><div class="line">+-------------------+-------+</div><div class="line">| Variable_name     | Value |</div><div class="line">+-------------------+-------+</div><div class="line">| log_slave_updates | ON    |</div><div class="line">+-------------------+-------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure>
<blockquote>
<p>通过mysqldump导出从库3307数据文件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mysqldump -uroot -plx3306 -S /data/3307/mysql.sock -A --events -B -F -x --master-data=1|gzip &gt; /opt/lx.sql.gz  </div><div class="line">#--master-data=1,表示在lx.sql文件中将取消注释“CHANGE MASTER TO MASTER_LOG_FILE=&apos;mysql-bin.000003&apos;, MASTER_LOG_POS=107;”</div><div class="line">[root@lixiang opt]# cat lx.sql |grep &quot;mysql-bin.000003&quot;</div><div class="line">CHANGE MASTER TO MASTER_LOG_FILE=&apos;mysql-bin.000003&apos;, MASTER_LOG_POS=107;</div></pre></td></tr></table></figure>
<blockquote>
<p>解压数据库，并导入从库3308</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cd /opt/3308</div><div class="line">gzip -d lx.sql.gz</div><div class="line">mysql -uroot -plx3308 -S /data/3308/mysql.sock &lt;lx.sql</div></pre></td></tr></table></figure>
<blockquote>
<p>登录从数据库3308</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">mysql -uroot -plx3308 -S /data/3308/mysql.sock</div><div class="line">mysql&gt; CHANGE MASTER TO  MASTER_HOST=&apos;192.168.10.102&apos;,  MASTER_PORT=3307, MASTER_USER=&apos;rep&apos;,  MASTER_PASSWORD=&apos;lx123&apos;;</div><div class="line">#此时就不用指定binlog的日志文件和pos,因为在mysqldump的时候,指定了--master-data=1</div><div class="line"></div><div class="line">mysql&gt; start slave;                                                #开启从库3307到从库3308同步开关</div><div class="line">mysql&gt; show slave status\G;                               #查看从库3308状态</div><div class="line">*************************** 1. row ***************************</div><div class="line">               Slave_IO_State: Waiting for master to send event</div><div class="line">                  Master_Host: 192.168.10.102</div><div class="line">                  Master_User: rep</div><div class="line">                  Master_Port: 3307</div><div class="line">                Connect_Retry: 60</div><div class="line">              Master_Log_File: mysql-bin.000003</div><div class="line">          Read_Master_Log_Pos: 107</div><div class="line">               Relay_Log_File: relay-bin.000005</div><div class="line">                Relay_Log_Pos: 253</div><div class="line">        Relay_Master_Log_File: mysql-bin.000003</div><div class="line">             Slave_IO_Running: Yes</div><div class="line">            Slave_SQL_Running: Yes</div><div class="line">              Replicate_Do_DB:</div><div class="line">          Replicate_Ignore_DB: mysql</div><div class="line">           Replicate_Do_Table:</div><div class="line">       Replicate_Ignore_Table:</div><div class="line">      Replicate_Wild_Do_Table:</div><div class="line">  Replicate_Wild_Ignore_Table:</div><div class="line">                   Last_Errno: 0</div><div class="line">                   Last_Error:</div><div class="line">                 Skip_Counter: 0</div><div class="line">          Exec_Master_Log_Pos: 107</div><div class="line">              Relay_Log_Space: 446</div><div class="line">              Until_Condition: None</div><div class="line">               Until_Log_File:</div><div class="line">                Until_Log_Pos: 0</div><div class="line">           Master_SSL_Allowed: No</div><div class="line">           Master_SSL_CA_File:</div><div class="line">           Master_SSL_CA_Path:</div><div class="line">              Master_SSL_Cert:</div><div class="line">            Master_SSL_Cipher:</div><div class="line">               Master_SSL_Key:</div><div class="line">        Seconds_Behind_Master: 0</div><div class="line">Master_SSL_Verify_Server_Cert: No</div><div class="line">                Last_IO_Errno: 0</div><div class="line">                Last_IO_Error:</div><div class="line">               Last_SQL_Errno: 0</div><div class="line">               Last_SQL_Error:</div><div class="line">  Replicate_Ignore_Server_Ids:</div><div class="line">             Master_Server_Id: 3</div><div class="line">1 row in set (0.00 sec)</div><div class="line">ERROR:</div><div class="line">No query specified</div><div class="line"></div><div class="line"></div><div class="line">mysql&gt; show databases;</div><div class="line">+--------------------+</div><div class="line">| Database           |</div><div class="line">+--------------------+</div><div class="line">| information_schema |</div><div class="line">| lx                 |</div><div class="line">| mysql              |</div><div class="line">| performance_schema |</div><div class="line">| test               |</div><div class="line">+--------------------+</div><div class="line">5 rows in set (0.00 sec)</div><div class="line"> </div><div class="line">#使用此种方法也能快速查看从库mysql的状态</div><div class="line">[root@lixiang data]# mysql -uroot -p&apos;lx3306&apos; -S /data/3307/mysql.sock -e &quot;show slave status\G;&quot;|egrep -i &quot;_running|_Behind&quot;        </div><div class="line">             Slave_IO_Running: Yes</div><div class="line">            Slave_SQL_Running: Yes</div><div class="line">        Seconds_Behind_Master: 0</div></pre></td></tr></table></figure>
<p>这个时候我们看见从库3308已经多了一个数据库名为 “lx”的数据库，出现了这个则表示创建成功</p>
<blockquote>
<p>登录主库3306，删除测试数据库</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@lixiang opt]# mysql -uroot -plx3306 -S /data/3306/mysql.sock</div><div class="line">mysql&gt; drop database test;                                    #删除主库名称为 &quot;test&quot;数据库</div><div class="line">Query OK, 0 rows affected (0.13 sec)</div><div class="line">mysql&gt; show databases;                                        #查看数据库</div><div class="line">+--------------------+</div><div class="line">| Database           |</div><div class="line">+--------------------+</div><div class="line">| information_schema |</div><div class="line">| lx                 |</div><div class="line">| mysql              |</div><div class="line">| performance_schema |</div><div class="line">+--------------------+</div><div class="line">4 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<blockquote>
<p>分别登录从库3306和从库3307查看</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">[root@lixiang opt]# mysql -uroot -plx3307 -S /data/3307/mysql.sock</div><div class="line">mysql&gt; show databases;                                        #查看数据库</div><div class="line">+--------------------+</div><div class="line">| Database           |</div><div class="line">+--------------------+</div><div class="line">| information_schema |</div><div class="line">| lx                 |</div><div class="line">| mysql              |</div><div class="line">| performance_schema |</div><div class="line">+--------------------+</div><div class="line">4 rows in set (0.00 sec)</div><div class="line">[root@lixiang opt]# mysql -uroot -plx3308 -S /data/3308/mysql.sock</div><div class="line">mysql&gt; show databases;                                        #查看数据库</div><div class="line">+--------------------+</div><div class="line">| Database           |</div><div class="line">+--------------------+</div><div class="line">| information_schema |</div><div class="line">| lx                 |</div><div class="line">| mysql              |</div><div class="line">| performance_schema |</div><div class="line">+--------------------+</div><div class="line">4 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<p>发现test数据库都被删除了，至此mysql级联复制配置完毕</p>
<h1 id="2-mysql主主复制"><a href="#2-mysql主主复制" class="headerlink" title="2.mysql主主复制"></a>2.mysql主主复制</h1><ul>
<li>应用场景：高并发场景，使用双主双写，慎用！</li>
<li>注意： ID会冲突</li>
<li>解决 ID 冲突问题<br>方法一： 表的id自增，让主A 写1，3，5；主B 写2，4，6；<br>方法二：表的id不自增，通过web端程序去seq取id，写入双主</li>
</ul>
<p>环境：主库3306 ，从库 3307<br>由于我们已经做了主库3306到从库3307，现在我们需要将从库3307变为主库，将3306作为从库</p>
<blockquote>
<p>编辑数据库配置文件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">##3306</div><div class="line">[root@lixiang 3306]# cd /data/3306</div><div class="line">[root@lixiang 3306]# vim my.cnf           </div><div class="line">#……省略……</div><div class="line">[mysqld]                # 以下内容加在[mysqld]下面</div><div class="line">#________m-m m1 start________</div><div class="line">auto_increment_increment    = 2        #自增ID的间隔</div><div class="line">auto_increment_offset           = 1        #ID的初始位置</div><div class="line">log-slave-updates   = 1</div><div class="line">log-bin = /data/3306/mysql-bin</div><div class="line">expire_logs_days = 7</div><div class="line">#________m-m m1 end________</div><div class="line">……省略……</div><div class="line"></div><div class="line"></div><div class="line">#重启mysql</div><div class="line">[root@lixiang 3306]# ./mysql stop</div><div class="line">Stoping MySQL...</div><div class="line">[root@lixiang 3306]# ./mysql start</div><div class="line">Starting MySQL...</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">##3307</div><div class="line">[root@lixiang 3306]# cd /data/3307</div><div class="line">[root@lixiang 3307]# vim my.cnf    </div><div class="line">……省略……</div><div class="line">[mysqld]                # 以下内容加在[mysqld]下面</div><div class="line">#________m-m m1 start________</div><div class="line">auto_increment_increment    = 2        #自增ID的间隔</div><div class="line">auto_increment_offset           = 2        #ID的初始位置</div><div class="line">log-slave-updates   = 1</div><div class="line">log-bin = /data/3307/mysql-bin</div><div class="line">expire_logs_days = 7</div><div class="line">#________m-m m1 end________</div><div class="line">……省略……</div><div class="line"> </div><div class="line">#重启mysql</div><div class="line">[root@lixiang 3307]# ./mysql stop</div><div class="line">Stoping MySQL...</div><div class="line">[root@lixiang 3307]# ./mysql start</div><div class="line">Starting MySQL...</div></pre></td></tr></table></figure>
<blockquote>
<p>导出3307数据库数据</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysqldump -uroot -plx3306 -S /data/3307/mysql.sock -A --events -B -F -x --master-data=1|gzip &gt; /opt/$(date +%F).sql.gz</div></pre></td></tr></table></figure>
<blockquote>
<p>解压并将数据导入到3306</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">gzip -d 2015-07-27.sql.gz</div><div class="line">mysql -uroot -plx3306 -S /data/3306/mysql.sock &lt; 2015-07-27.sql</div></pre></td></tr></table></figure>
<blockquote>
<p>登录主数据库3306</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">mysql -uroot -plx3306 -S /data/3306/mysql.sock</div><div class="line">mysql&gt; CHANGE MASTER TO  MASTER_HOST=&apos;192.168.10.102&apos;, MASTER_USER=&apos;rep&apos;, MASTER_PORT=3307, MASTER_PASSWORD=&apos;lx123&apos;;</div><div class="line">mysql&gt; start slave;</div><div class="line">查看从库3306状态</div><div class="line">mysql&gt; show slave status\G;</div><div class="line">*************************** 1. row ***************************</div><div class="line">               Slave_IO_State: Waiting for master to send event</div><div class="line">                  Master_Host: 192.168.10.102</div><div class="line">                  Master_User: rep</div><div class="line">                  Master_Port: 3307</div><div class="line">                Connect_Retry: 60</div><div class="line">              Master_Log_File: mysql-bin.000008</div><div class="line">          Read_Master_Log_Pos: 1561</div><div class="line">               Relay_Log_File: relay-bin.000011</div><div class="line">                Relay_Log_Pos: 253</div><div class="line">        Relay_Master_Log_File: mysql-bin.000008</div><div class="line">             Slave_IO_Running: Yes</div><div class="line">            Slave_SQL_Running: Yes</div><div class="line">              Replicate_Do_DB:</div><div class="line">          Replicate_Ignore_DB: mysql</div><div class="line">           Replicate_Do_Table:</div><div class="line">       Replicate_Ignore_Table:</div><div class="line">      Replicate_Wild_Do_Table:</div><div class="line">  Replicate_Wild_Ignore_Table:</div><div class="line">                   Last_Errno: 0</div><div class="line">                   Last_Error:</div><div class="line">                 Skip_Counter: 0</div><div class="line">          Exec_Master_Log_Pos: 1561</div><div class="line">              Relay_Log_Space: 446</div><div class="line">              Until_Condition: None</div><div class="line">               Until_Log_File:</div><div class="line">                Until_Log_Pos: 0</div><div class="line">           Master_SSL_Allowed: No</div><div class="line">           Master_SSL_CA_File:</div><div class="line">           Master_SSL_CA_Path:</div><div class="line">              Master_SSL_Cert:</div><div class="line">            Master_SSL_Cipher:</div><div class="line">               Master_SSL_Key:</div><div class="line">        Seconds_Behind_Master: 0</div><div class="line">Master_SSL_Verify_Server_Cert: No</div><div class="line">                Last_IO_Errno: 0</div><div class="line">                Last_IO_Error:</div><div class="line">               Last_SQL_Errno: 0</div><div class="line">               Last_SQL_Error:</div><div class="line">  Replicate_Ignore_Server_Ids:</div><div class="line">             Master_Server_Id: 3</div><div class="line">1 row in set (0.00 sec)</div><div class="line">ERROR:</div><div class="line">No query specified</div></pre></td></tr></table></figure>
<blockquote>
<p>在数据库3306创建数据库students</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">mysql -uroot -plx3306 -S /data/3306/mysql.sock</div><div class="line">mysql&gt; create database students;</div><div class="line">mysql&gt; use students;</div><div class="line">创建表t1，并插入内容</div><div class="line">mysql&gt; CREATE TABLE `t1` (   `id` bigint(12) NOT NULL auto_increment,   `name` varchar(12) NOT NULL,   PRIMARY KEY  (`id`) );</div><div class="line">mysql&gt; insert into t1(name) values(&quot;oldgirl&quot;);</div><div class="line">mysql&gt; insert into t1(name) values(&quot;oldboy&quot;);</div><div class="line">mysql&gt; select * from t1;                     </div><div class="line">+----+---------+</div><div class="line">| id | name    |</div><div class="line">+----+---------+</div><div class="line">|  1 | oldgirl |</div><div class="line">|  3 | oldboy  |</div><div class="line">+----+---------+</div><div class="line">#结果查看到内容是按照ID号，1 3 ……进行增长</div></pre></td></tr></table></figure>
<blockquote>
<p>登录到3307数据库</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[root@lixiang opt]# mysql -uroot -plx3306 -S /data/3307/mysql.sock</div><div class="line">mysql&gt; use students;</div><div class="line">mysql&gt; select * from t1;</div><div class="line">+----+---------+</div><div class="line">| id | name    |</div><div class="line">+----+---------+</div><div class="line">|  1 | oldgirl |</div><div class="line">|  3 | oldboy  |</div><div class="line">+----+---------+</div><div class="line">mysql&gt; insert into t1(name) values(&quot;lx&quot;);</div><div class="line">mysql&gt; insert into t1(name) values(&quot;swj&quot;);</div><div class="line">mysql&gt; select * from t1;                  </div><div class="line">+----+---------+</div><div class="line">| id | name    |</div><div class="line">+----+---------+</div><div class="line">|  1 | oldgirl |</div><div class="line">|  3 | oldboy  |</div><div class="line">|  4 | lx      |</div><div class="line">|  6 | swj     |</div><div class="line">+----+---------+</div><div class="line">4 rows in set (0.00 sec)</div><div class="line"></div><div class="line">#查看到数据库3307的ID是按照偶数进行递增的</div></pre></td></tr></table></figure>
<h1 id="主从复制的故障处理"><a href="#主从复制的故障处理" class="headerlink" title="主从复制的故障处理"></a>主从复制的故障处理</h1><p>&emsp;当从库复制遇到错误时，比如报错“要创建的数据库已存在”</p>
<p>解决方案： 让从库跳过这一步操作，继续执行其它的操作</p>
<ul>
<li><p>方法一： 命令行实现，跳过这一步；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mysql&gt; stop slave;</div><div class="line">mysql&gt; set global sql_slave_skip_counter =1;</div><div class="line">mysql&gt; start slave;</div></pre></td></tr></table></figure>
</li>
<li><p>方法二： 配置文件中，指定忽略的错误；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@MySQL opt]# grep slave-skip /data/3308/my.cnf</div><div class="line">slave-skip-errors = 1032,1062</div></pre></td></tr></table></figure>
</li>
</ul>
<p><a href="http://lx.wxqrcode.com/index.php/post/68.html" target="_blank" rel="external">整理自</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/mysql/配置mysql从库级联复制和主主复制(转)/" data-id="cj290sb57002kssqqi15wby8v" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mysql/编译安装MySQL-5.5.32" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/mysql/编译安装MySQL-5.5.32/" class="article-date">
  <time datetime="2017-04-16T04:47:25.732Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/mysql/">mysql</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/mysql/编译安装MySQL-5.5.32/">编译安装MySQL-5.5.32</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="卸载掉原有mysql"><a href="#卸载掉原有mysql" class="headerlink" title="卸载掉原有mysql"></a>卸载掉原有mysql</h1><p>因为mysql数据库在Linux上实在是太流行了，所以目前下载的主流Linux系统版本基本上都集成了mysql数据库在里面，我们可以通过如下命令来查看我们的操作系统上是否已经安装了mysql数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@xiaoluo ~]# rpm -qa | grep mysql　　// 这个命令就会查看该操作系统上是否已经安装了mysql数据库</div><div class="line"> </div><div class="line">[root@xiaoluo ~]# rpm -e mysql　　// 普通删除模式</div><div class="line">[root@xiaoluo ~]# rpm -e --nodeps mysql　　// 强力删除模式，如果使用上面命令删除时，提示有依赖的其它文件，则用该命令可以对其进行强力删除</div></pre></td></tr></table></figure>
<h1 id="1-依赖包"><a href="#1-依赖包" class="headerlink" title="1.依赖包"></a>1.依赖包</h1><h2 id="1-1-ncurses-devel-libaio-devel"><a href="#1-1-ncurses-devel-libaio-devel" class="headerlink" title="1.1.ncurses-devel libaio-devel"></a>1.1.ncurses-devel libaio-devel</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">yum install ncurses-devel libaio-devel -y</div><div class="line">//检查</div><div class="line">[root@MySQL data]# rpm -qa ncurses-devel libaio-devel</div><div class="line">ncurses-devel-5.7-4.20090207.el6.i686</div><div class="line">libaio-devel-0.3.107-10.el6.i686</div><div class="line">[root@MySQL data]#</div></pre></td></tr></table></figure>
<h2 id="1-2-安装cmake"><a href="#1-2-安装cmake" class="headerlink" title="1.2.安装cmake"></a>1.2.安装cmake</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">cd /home/oldboy/tools/</div><div class="line">tar zxf cmake-2.8.8.tar.gz</div><div class="line">cd cmake-2.8.8</div><div class="line">./configure</div><div class="line">gmake</div><div class="line">gmake install</div><div class="line">//检查</div><div class="line">[root@MySQL data]# which cmake</div><div class="line">/usr/local/bin/cmake</div></pre></td></tr></table></figure>
<h1 id="2-创建用户和组"><a href="#2-创建用户和组" class="headerlink" title="2.创建用户和组"></a>2.创建用户和组</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"> useradd mysql -s /sbin/nologin -M</div><div class="line">id mysql</div></pre></td></tr></table></figure>
<h1 id="3-解压编译mysql"><a href="#3-解压编译mysql" class="headerlink" title="3.解压编译mysql"></a>3.解压编译mysql</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">cd /home/oldboy/tools/</div><div class="line">tar zxf mysql-5.5.32.tar.gz</div><div class="line">cd mysql-5.5.32</div><div class="line">cmake . -DCMAKE_INSTALL_PREFIX=/application/mysql-5.5.32 \</div><div class="line">-DMYSQL_DATADIR=/application/mysql-5.5.32/data \</div><div class="line">-DMYSQL_UNIX_ADDR=/application/mysql-5.5.32/tmp/mysql.sock \</div><div class="line">-DDEFAULT_CHARSET=utf8 \</div><div class="line">-DDEFAULT_COLLATION=utf8_general_ci \</div><div class="line">-DEXTRA_CHARSETS=gbk,gb2312,utf8,ascii \</div><div class="line">-DENABLED_LOCAL_INFILE=ON \</div><div class="line">-DWITH_INNOBASE_STORAGE_ENGINE=1 \</div><div class="line">-DWITH_FEDERATED_STORAGE_ENGINE=1 \</div><div class="line">-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \</div><div class="line">-DWITHOUT_EXAMPLE_STORAGE_ENGINE=1 \</div><div class="line">-DWITHOUT_PARTITION_STORAGE_ENGINE=1 \</div><div class="line">-DWITH_FAST_MUTEXES=1 \</div><div class="line">-DWITH_ZLIB=bundled \</div><div class="line">-DENABLED_LOCAL_INFILE=1 \</div><div class="line">-DWITH_READLINE=1 \</div><div class="line">-DWITH_EMBEDDED_SERVER=1 \</div><div class="line">-DWITH_DEBUG=0</div><div class="line"></div><div class="line">#-- Build files have been written to: /home/oldboy/tools/mysql-5.5.32</div><div class="line">提示，编译时可配置的选项很多，具体可参考结尾附录或官方文档：</div><div class="line"></div><div class="line">make &amp;&amp; make install</div><div class="line"></div><div class="line">#[100%] Built target my_safe_process</div></pre></td></tr></table></figure>
<h1 id="4-创建软链接"><a href="#4-创建软链接" class="headerlink" title="4.创建软链接"></a>4.创建软链接</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ln -s /application/mysql-5.5.32/ /application/mysql</div><div class="line">#如果上述操作未出现错误，则MySQL5.5.32软件cmake方式的安装就算成功了。</div></pre></td></tr></table></figure>
<h1 id="5-加入环境变量"><a href="#5-加入环境变量" class="headerlink" title="5.加入环境变量"></a>5.加入环境变量</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> </div><div class="line">echo  “export PATH=/application/mysql/bin/:$PATH”&gt;&gt;/etc/profile</div><div class="line">[root@MySQL 3306]# source /etc/profile</div><div class="line"> </div><div class="line"> </div><div class="line">[root@MySQL 3306]# which mysql</div><div class="line">/application/mysql/bin/mysql</div></pre></td></tr></table></figure>
<h1 id="6-初始化数据库"><a href="#6-初始化数据库" class="headerlink" title="6.初始化数据库"></a>6.初始化数据库</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#初始化数据库,初始化系统表</div><div class="line">cd /application/mysql/scripts/</div><div class="line">./mysql_install_db --basedir=/application/mysql/ --datadir=/application/mysql/data/ --user=mysql</div><div class="line">cd ../</div></pre></td></tr></table></figure>
<h1 id="7-授权用户及目录"><a href="#7-授权用户及目录" class="headerlink" title="7.授权用户及目录"></a>7.授权用户及目录</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"> </div><div class="line">#授权用户及/tmp/临时文件目录</div><div class="line">chown -R mysql.mysql /application/mysql/data/</div><div class="line">chmod -R 1777 /tmp/</div></pre></td></tr></table></figure>
<h1 id="8-拷贝配置文件"><a href="#8-拷贝配置文件" class="headerlink" title="8.拷贝配置文件"></a>8.拷贝配置文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#拷贝配置文件,在support-files下有默认的配置文件</div><div class="line">cp mysql-5.5.32/support-files/my-small.cnf /etc/my.cnf</div></pre></td></tr></table></figure>
<h1 id="9-启动数据库及测试"><a href="#9-启动数据库及测试" class="headerlink" title="9.启动数据库及测试"></a>9.启动数据库及测试</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">cp support-files/mysql.server /etc/init.d/mysqld</div><div class="line">#添加执行权限</div><div class="line">chmod +x /etc/init.d/mysqld</div><div class="line">/etc/init.d/mysqld  start</div><div class="line"> </div><div class="line">#检查端口</div><div class="line">netstat -lntup|grep 3306</div><div class="line"></div><div class="line"></div><div class="line"># 客户端登录</div><div class="line">[root@lamp01 mysql]# mysql        #因为是刚刚安装,所以不需要密码</div><div class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div class="line">Your MySQL connection id is 1</div><div class="line">Server version: 5.5.51 Source distribution</div><div class="line"> </div><div class="line">Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.</div><div class="line"> </div><div class="line">Oracle is a registered trademark of Oracle Corporation and/or its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line"> </div><div class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</div><div class="line"> </div><div class="line">mysql&gt;</div><div class="line"> </div><div class="line"></div><div class="line">#关闭mysql</div><div class="line">[root@lamp01 mysql]# /etc/init.d/mysqld stop</div><div class="line">Shutting down MySQL. SUCCESS!</div><div class="line">[root@lamp01 mysql]# lsof -i:3306   </div><div class="line">[root@lamp01 mysql]#</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/mysql/编译安装MySQL-5.5.32/" data-id="cj290sb53002gssqqci29e94b" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mysql/查询性能优化" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/16/mysql/查询性能优化/" class="article-date">
  <time datetime="2017-04-16T04:47:25.730Z" itemprop="datePublished">2017-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/mysql/">mysql</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/mysql/查询性能优化/">查询性能优化</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-查询执行基础知识"><a href="#1-查询执行基础知识" class="headerlink" title="1.查询执行基础知识"></a>1.查询执行基础知识</h1><h2 id="1-1-mysql执行查询过程"><a href="#1-1-mysql执行查询过程" class="headerlink" title="1.1.mysql执行查询过程"></a>1.1.mysql执行查询过程</h2><ol>
<li>客户端将查询发送到服务器</li>
<li>服务器检查查询缓存 如果找到了就从缓存返回结果 否则进行下一步</li>
<li>服务器解析，预处理和优化查询，生成执行计划</li>
<li>执行引擎调用存储引擎api执行查询</li>
<li>服务器将结果发送回客户端</li>
</ol>
<p><img src="http://ols7leonh.bkt.clouddn.com//assert/img/mysql/youhua/1.jpg" alt=""></p>
<blockquote>
<p>mysql客户端/服务器协议</p>
</blockquote>
<p>该协议是半双工通信，可以发送或接收数据，但是不能同时发送和接收决定了mysql的沟通简单又快捷；</p>
<p>缺点：无法进行流程控制，一旦一方发送消息，另一方在发送回复之前必须提取完整的消息，就像抛球游戏，任意时间，只有某一方有球，而且有球在手上，否则就不能把球抛出去(发送消息)</p>
<blockquote>
<p>mysql客户端发送/服务器响应</p>
</blockquote>
<p>可以设定max_packet_size这个参数控制客户端发送的数据包(一旦发送数据包，唯一做的就是等待结果)</p>
<p>服务器发送的响应由多个数据包组成， 客户端必须完整接收结果，即使只需要几行数据，也得等到全部接收 然后丢掉，或者强制断开连接。(这两个方法好挫，所以我们使用limit子句呀！！) </p>
<p>也可以理解，客户端从服务器 “拉” 数据 ，实际是服务器产生数据 “推”到客户端， 客户端不能说不要 是必须全部装着！</p>
<p>常用的Mysql类库 其实是从客户端提取数据 缓存到array(内存)中，然后进行 foreach 处理。</p>
<p>但是对于庞大的结果集装载在内存中需要很长时间，如果不缓存，使用较少的内存并且可以尽快工作，但是应用程序和类库交互时候，服务器端的锁和资源都是被锁定的。</p>
<blockquote>
<p>查询状态</p>
</blockquote>
<p>每个mysql连接都是mysql服务器的一个线程 任意一个给定的时间都有一个状态来标识正在发生的事情。</p>
<p>使用 show full processlist 命令查看 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show full processlist;</div><div class="line">+----+------+-------------------+------+-------------+-------+-----------------------------------------------------------------------+-----------------------+</div><div class="line">| Id | User | Host              | db   | Command     | Time  | State                                                                 | Info                  |</div><div class="line">+----+------+-------------------+------+-------------+-------+-----------------------------------------------------------------------+-----------------------+</div><div class="line">| 13 | root | localhost         | test | Query       |     0 | NULL                                                                  | show full processlist |</div><div class="line">+----+------+-------------------+------+-------------+-------+-----------------------------------------------------------------------+-----------------------+</div><div class="line"></div><div class="line">#mysql中一共有12个状态：休眠、查询、锁定、分析和统计、拷贝到磁盘上的临时表、排序结果、发送数据，通过这些状态 知道 &quot;球在谁手上&quot;</div></pre></td></tr></table></figure>
<blockquote>
<p>查询缓存</p>
</blockquote>
<p>解析一个查询，如果开启了缓存，mysql会检查查询缓存，发现缓存匹配，返回缓存之前，检查查询的权限</p>
<h1 id="2-优化数据访问"><a href="#2-优化数据访问" class="headerlink" title="2.优化数据访问"></a>2.优化数据访问</h1><p>查询性能低下最基本的原因是访问了太多的数据，分析两方面：</p>
<ul>
<li>查明应用程序是否获取超过需要的数据 通常意味着访问了过多的行或列 </li>
<li>查明mysql服务器是否分析了超过需要的行</li>
</ul>
<blockquote>
<p>向服务器请求了不需要的数据</p>
</blockquote>
<p>一般请求不需要的数据，再丢掉他们，造成服务器额外的负担，增加网络开销，消耗了内存和cpu。</p>
<p>典型的错误：</p>
<ul>
<li>提取超过需要的行 =&gt; 添加 limit 10 控制获取行数</li>
<li>多表联接提取所有列 =&gt; select fruit.* from fruit left join fruit_juice where</li>
<li>提取所有的列 =&gt; select id，name… from fruit … (有时提取超过需要的数据便于复用)</li>
</ul>
<blockquote>
<p>mysql检查了太多数据</p>
</blockquote>
<p>简单的开销指标：执行时间、检查的行数、返回的行数</p>
<p>以上三个指标写入了慢查询日志 可以使用 mysqlsla工具进行日志分析：</p>
<ul>
<li>执行时间：执行时间只是参考 不可一概而论 因为执行时间 和服务器当时负载有关</li>
<li>检查和返回的行：理想情况下返回的行和检查的行一样，但是显示基本不可能 比如联接查询 </li>
<li>检查的行和访问类型： 使用explain sq语句，观察typ列</li>
</ul>
<blockquote>
<p>typ列：(访问速度依次递增)</p>
</blockquote>
<ul>
<li>全表扫描(full table scan)</li>
<li>索引扫描(index scan)</li>
<li>范围扫描(range scan)</li>
<li>唯一索引查找(unique index lookup)</li>
<li>常量(constant)</li>
</ul>
<blockquote>
<p>mysql会在3种情况下使用where子句，从最好到最坏依次是：</p>
</blockquote>
<ul>
<li>对索引查找应用where子句来消除不匹配的行 这发生在存储层</li>
<li>使用覆盖索引(extra 列 “using index”) 避免访问行 从索引取得数据过滤不匹配的行 这发生在服务层不需要从表中读取行</li>
<li>从表中检索出数据 过滤不匹配的行(extra:using where)</li>
</ul>
<blockquote>
<p>如果发现访问数据行数很大，尝试以下措施</p>
</blockquote>
<ul>
<li>使用覆盖索引 ，存储了数据 存储引擎不会读取完整的行</li>
<li>更改架构使用汇总表</li>
<li>重写复杂的查询 让mysql优化器优化执行它</li>
</ul>
<h1 id="3-重构查询的方式"><a href="#3-重构查询的方式" class="headerlink" title="3.重构查询的方式"></a>3.重构查询的方式</h1><p>优化有问题的查询，其实也可以找到替代方案，提供更高的效率。</p>
<blockquote>
<p>复杂查询和多个查询</p>
</blockquote>
<p>mysql一般服务器可以每秒50000个查询，常规情况下，使用尽可能少的查询 有时候分解查询得到更高的效率。</p>
<blockquote>
<p>缩短查询</p>
</blockquote>
<p>分治法，查询本质上不变，每次执行一小部分，以减少受影响的行数。比如清理陈旧的数据，每次清理1000条：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">delete from message where create &lt; date_sub(now()，inteval 3 month)  limit 1000</div></pre></td></tr></table></figure></p>
<p>防止长时间锁住很多行的数据。</p>
<blockquote>
<p>分解联接</p>
</blockquote>
<p>把一个多表联接分解成多个单个查询 然后在应用程序实现联接操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">select * from teacher </div><div class="line">join school on teacher.id = school.id</div><div class="line">join course on teacher.id = course.id</div><div class="line">where course.name = &quot;english&quot;</div><div class="line"></div><div class="line">#使用以下语句代替</div><div class="line">select * from course where name = &quot;english&quot;</div><div class="line">select * from teacher where course_id =1024</div><div class="line">select * from school where teacher_id in (111,222,333)</div></pre></td></tr></table></figure></p>
<p>第一眼看上去比较浪费，因为增加了查询数量，但是有重大的性能优势：</p>
<ul>
<li>缓存效率高，应用程序直接缓存了表 类似第一个查询直接跳过</li>
<li>对于myisam表来说 每个表一个查询有效利用表锁 查询锁住表的时间缩短</li>
<li>应用程端进行联接更方便扩展数据库</li>
<li>使用in() 避免联表查询id排序的耗费 </li>
<li>减少多余行的访问 ， 意味着每行数据只访问一次 避免联接查询的非正则化的架构带来的反复访问同一行的弊端</li>
</ul>
<p>分解联接应用场景：</p>
<p>① 可以缓存早期查询的大量的数据<br>② 使用了多个myisam表(mysiam表锁 并发时候 一条sql锁住多个表 所以要分解)<br>③ 数据分布在不同的服务器上<br>④ 对于大表使用in() 替换联接<br>④    一个联接引用了同一个表很多次</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/16/mysql/查询性能优化/" data-id="cj290sb4v002cssqqq2kq4cq9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/18/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="page-number" href="/page/18/">18</a><span class="page-number current">19</span><a class="page-number" href="/page/20/">20</a><a class="page-number" href="/page/21/">21</a><span class="space">&hellip;</span><a class="page-number" href="/page/58/">58</a><a class="extend next" rel="next" href="/page/20/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/IDEA/">IDEA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/NFS/">NFS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tachyon/">Tachyon</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/azkaban/">azkaban</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/echarts/">echarts</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/flume/">flume</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/">hadoop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hbase/">hbase</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hive/">hive</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/inotify/">inotify</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/kafka/">kafka</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/logstash/">logstash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/markdown/">markdown</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/memcached/">memcached</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/project/">project</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/rsync/">rsync</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/scala/">scala</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/shell/">shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/socket/">socket</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/spark/">spark</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/sqoop/">sqoop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/storm/">storm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据仓库/">数据仓库</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDEA/">IDEA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux基础命令/">Linux基础命令</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux重要配置文件/">Linux重要配置文件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NFS/">NFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NIO/">NIO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azkaban/">azkaban</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/echarts/">echarts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flume/">flume</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hadoop/">hadoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hbase/">hbase</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hive/">hive</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/inotify/">inotify</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/">kafka</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logstash/">logstash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mapreduce/">mapreduce</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/memcached/">memcached</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/netty/">netty</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/project/">project</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rpc/">rpc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rsync/">rsync</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala/">scala</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala函数式编程/">scala函数式编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala编程/">scala编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socket/">socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spark/">spark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqoop/">sqoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/storm/">storm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zookeeper/">zookeeper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据仓库/">数据仓库</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/IDEA/" style="font-size: 10px;">IDEA</a> <a href="/tags/Linux基础命令/" style="font-size: 19.52px;">Linux基础命令</a> <a href="/tags/Linux重要配置文件/" style="font-size: 14.76px;">Linux重要配置文件</a> <a href="/tags/NFS/" style="font-size: 10px;">NFS</a> <a href="/tags/NIO/" style="font-size: 11.43px;">NIO</a> <a href="/tags/azkaban/" style="font-size: 10.48px;">azkaban</a> <a href="/tags/echarts/" style="font-size: 10.95px;">echarts</a> <a href="/tags/flume/" style="font-size: 10.95px;">flume</a> <a href="/tags/hadoop/" style="font-size: 18.57px;">hadoop</a> <a href="/tags/hbase/" style="font-size: 13.33px;">hbase</a> <a href="/tags/hive/" style="font-size: 18.1px;">hive</a> <a href="/tags/inotify/" style="font-size: 10px;">inotify</a> <a href="/tags/java/" style="font-size: 12.38px;">java</a> <a href="/tags/kafka/" style="font-size: 12.86px;">kafka</a> <a href="/tags/linux/" style="font-size: 13.33px;">linux</a> <a href="/tags/logstash/" style="font-size: 10.48px;">logstash</a> <a href="/tags/mapreduce/" style="font-size: 16.67px;">mapreduce</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/memcached/" style="font-size: 13.81px;">memcached</a> <a href="/tags/mongodb/" style="font-size: 14.76px;">mongodb</a> <a href="/tags/mysql/" style="font-size: 17.14px;">mysql</a> <a href="/tags/netty/" style="font-size: 10.95px;">netty</a> <a href="/tags/nginx/" style="font-size: 14.29px;">nginx</a> <a href="/tags/project/" style="font-size: 10.48px;">project</a> <a href="/tags/python/" style="font-size: 19.05px;">python</a> <a href="/tags/redis/" style="font-size: 17.14px;">redis</a> <a href="/tags/rpc/" style="font-size: 10.48px;">rpc</a> <a href="/tags/rsync/" style="font-size: 10px;">rsync</a> <a href="/tags/scala/" style="font-size: 17.62px;">scala</a> <a href="/tags/scala函数式编程/" style="font-size: 11.9px;">scala函数式编程</a> <a href="/tags/scala编程/" style="font-size: 15.71px;">scala编程</a> <a href="/tags/shell/" style="font-size: 17.62px;">shell</a> <a href="/tags/socket/" style="font-size: 11.9px;">socket</a> <a href="/tags/spark/" style="font-size: 20px;">spark</a> <a href="/tags/sqoop/" style="font-size: 10.95px;">sqoop</a> <a href="/tags/storm/" style="font-size: 15.24px;">storm</a> <a href="/tags/zookeeper/" style="font-size: 16.19px;">zookeeper</a> <a href="/tags/数据仓库/" style="font-size: 11.43px;">数据仓库</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/05/02/bigdata/spark从入门到精通_笔记/Tachyon/">Tachyon</a>
          </li>
        
          <li>
            <a href="/2017/04/30/数据仓库/数据仓库2/">数据仓库</a>
          </li>
        
          <li>
            <a href="/2017/04/29/IDEA/IDEA/">IDEA</a>
          </li>
        
          <li>
            <a href="/2017/04/29/数据仓库/ETL/">ETL</a>
          </li>
        
          <li>
            <a href="/2017/04/28/数据仓库/PowderDesigner/">PowderDesigner的使用</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Mr. Chen<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>




  </div>
</body>
</html>