<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Chen&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="一个技术渣的自说自话">
<meta property="og:type" content="website">
<meta property="og:title" content="Chen's Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Chen's Blog">
<meta property="og:description" content="一个技术渣的自说自话">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chen's Blog">
<meta name="twitter:description" content="一个技术渣的自说自话">
  
    <link rel="alternate" href="/atom.xml" title="Chen&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Chen&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">一个技术渣的自说自话</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-bigdata/spark从入门到精通_笔记/Tachyon" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/02/bigdata/spark从入门到精通_笔记/Tachyon/" class="article-date">
  <time datetime="2017-05-02T08:25:41.834Z" itemprop="datePublished">2017-05-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tachyon/">Tachyon</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/02/bigdata/spark从入门到精通_笔记/Tachyon/">Tachyon</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>不同的Application之间共享数据</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/05/02/bigdata/spark从入门到精通_笔记/Tachyon/" data-id="cj290scag0120ssqqw12rnzuf" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spark/">spark</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-数据仓库/数据仓库2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/30/数据仓库/数据仓库2/" class="article-date">
  <time datetime="2017-04-30T01:16:03.044Z" itemprop="datePublished">2017-04-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/数据仓库/">数据仓库</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/30/数据仓库/数据仓库2/">数据仓库</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>数据库:是一种逻辑概念,通过数据库软件来实现,数据库由很多表组成,</p>
<p>数据仓库:是一种逻辑的概念,从数据量来说,数据仓库要比数据库更庞大的多,数据仓库主要用于数据挖掘和数据分析,辅助领导做决策使用.</p>
<p>数据库和数据仓库的区别就是:OLTP和OLAP的区别:<br>操作型处理(联机事务处理),他是针对具体业务在数据库联机的日常操作,通常对少数记录进行查询,修改,用户关心操作的相应时间数据的安全性,完整性和并发性支持的用户数等问题,传统的数据库作为数据管理的主要手段,主要用于操作型处理(如增删改查),主要面向应用</p>
<p>分析型处理(联机分析处理OLAP)一般针对某些主题的历史数据进行分析,支持管理决策</p>
<p><img src="/assert/img/数据仓库/OLAP_OLTP.png" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/30/数据仓库/数据仓库2/" data-id="cj290sbfh00d4ssqq3zjg4b4b" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据仓库/">数据仓库</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-IDEA/IDEA" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/29/IDEA/IDEA/" class="article-date">
  <time datetime="2017-04-29T11:38:37.546Z" itemprop="datePublished">2017-04-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IDEA/">IDEA</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/29/IDEA/IDEA/">IDEA</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>IntelliJ Idea 常用快捷键列表</p>
<p>Ctrl+Alt+t 选择代码块 try catch</p>
<p>Alt+回车 导入包,自动修正<br>Ctrl+N   查找类<br>Ctrl+Shift+N 查找文件<br>Ctrl+Alt+L  格式化代码<br>Ctrl+Alt+O 优化导入的类和包<br>Alt+Insert 生成代码(如get,set方法,构造函数等) mac系统 fn+alt+回车<br>Ctrl+E或者Alt+Shift+C  最近更改的代码<br>Ctrl+R 替换文本<br>Ctrl+F 查找文本<br>Ctrl+Shift+Space 自动补全代码<br>Ctrl+空格 代码提示<br>Ctrl+Alt+Space 类名或接口名提示<br>Ctrl+P 方法参数提示<br>Ctrl+Shift+Alt+N 查找类中的方法或变量<br>Alt+Shift+C 对比最近修改的代码</p>
<p>Ctrl+Alt+H打开方法调用结构    &gt;&gt;&gt; </p>
<p>Shift+F6  重构-重命名<br>Ctrl+Shift+先上键<br>Ctrl+X 删除行<br>Ctrl+D 复制行<br>Ctrl+/ 或 Ctrl+Shift+/  注释（// 或者/<em>…</em>/ ）<br>Ctrl+J  自动代码<br>Ctrl+E 最近打开的文件<br>Ctrl+H 显示类结构图<br>Ctrl+Q 显示注释文档<br>Alt+F1 查找代码所在位置<br>Alt+1 快速打开或隐藏工程面板<br>Ctrl+Alt+ left/right 返回至上次浏览的位置<br>Alt+ left/right 切换代码视图<br>Alt+ Up/Down 在方法间快速移动定位<br>Ctrl+Shift+Up/Down 代码向上/下移动。<br>F2 或Shift+F2 高亮错误或警告快速定位</p>
<p>代码标签输入完成后，按Tab，生成代码。<br>选中文本，按Ctrl+Shift+F7 ，高亮显示所有该文本，按Esc高亮消失。<br>Ctrl+W 选中代码，连续按会有其他效果<br>选中文本，按Alt+F3 ，逐个往下查找相同文本，并高亮显示。<br>Ctrl+Up/Down 光标跳转到第一行或最后一行下<br>Ctrl+B 快速打开光标处的类或方法 </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/29/IDEA/IDEA/" data-id="cj290sb1r0002ssqq6r7jg2nb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IDEA/">IDEA</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-数据仓库/ETL" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/29/数据仓库/ETL/" class="article-date">
  <time datetime="2017-04-29T04:13:07.272Z" itemprop="datePublished">2017-04-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/数据仓库/">数据仓库</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/29/数据仓库/ETL/">ETL</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>etl的过程:<br>数据的抽取,转换,加载,在设计ETL的时候我们也是从这三部分出发</p>
<p>数据的抽取:从各个不同的数据源抽取到ODS(Operational Data Store操作型数据存储)中,这个过程也可以做一些数据的清洗和转换,在抽取的过程中需要挑选不同的抽取方法,尽可能的提高ETL的运行效率</p>
<p>看数据从哪些业务系统来的(ERP,OA,CRM等)</p>
<p>增量更新的问题:<br>1.时间戳的方式<br>2.自增长id的方式</p>
<p>数据转换:这里涉及到无效数据的过滤,格式的转换</p>
<p>数据的加载:一般在数据清洗完之后直接写入DW(数据仓库)中去</p>
<p>大多数据仓库的数据架构可以概括为：</p>
<p>数据源–&gt;ODS(操作型数据存储)–&gt;DW–&gt;DM(data mart)</p>
<p>ETL贯穿其各个环节。</p>
<p>​一、数据抽取：</p>
<p>可以理解为是把源数据的数据抽取到ODS或者DW中。</p>
<ol>
<li>源数据类型：</li>
</ol>
<p>关系型数据库，如Oracle,Mysql,Sqlserver等;</p>
<p>文本文件，如用户浏览网站产生的日志文件，业务系统以文件形式提供的数据等；</p>
<p>其他外部数据，如手工录入的数据等；</p>
<ol>
<li>抽取的频率：</li>
</ol>
<p>大多是每天抽取一次，​也可以根据业务需求每小时甚至每分钟抽取，当然得考虑源数据库系统能否承受；</p>
<ol>
<li>抽取策略：</li>
</ol>
<p>个人感觉这是数据抽取中最重要的部分，可分为全量抽取和增量抽取。</p>
<p>全量抽取适用于那些数据量比较小，并且不容易判断其数据发生改变的诸如关系表，维度表，配置表等；</p>
<p>增量抽取，一般是由于数据量大，不可能采用全量抽取，或者为了节省抽取时间而采用的抽取策略；</p>
<p>如何判断增量，这是增量抽取中最难的部分，一般包括以下几种情况：</p>
<p>a) 通过时间标识字段抽取增量；源数据表中有明确的可以标识当天数据的字段的流水表，</p>
<p>如createtime，updatetime等；</p>
<p>b) 根据上次抽取结束时候记录的自增长ID来抽取增量；无createtime,但有自增长类型字段的流水表，</p>
<p>如自增长的ID，抽取完之后记录下最大的ID，</p>
<p>下次抽取可根据上次记录的ID来抽取；</p>
<p>c)  通过分析数据库日志获取增量数据，无时间标识字段，无自增长ID的关系型数据库中的表；</p>
<p>d)  通过与前一天数据的Hash比较，比较出发生变化的数据，这种策略比较复杂，在这里描述一下，</p>
<p>比如一张会员表，它的主键是memberID,而会员的状态是有可能每天都更新的，</p>
<p>我们在第一次抽取之后，生成一张备用表A，包含两个字段，第一个是memberID,</p>
<p>第二个是除了memberID之外其他所有字段拼接起来，再做个Hash生成的字段，</p>
<p>在下一次抽取的时候，将源表同样的处理,生成表B,将B和A左关联，Hash字段不相等的</p>
<p>为发生变化的记录，另外还有一部分新增的记录，</p>
<p>根据这两部分记录的memberID去源表中抽取对应的记录；</p>
<p>e) 由源系统主动推送增量数据；例如订单表，交易表，</p>
<p>有些业务系统在设计的时候，当一个订单状态发生变化的时候，是去源表中做update，</p>
<p>而我们在数据仓库中需要把一个订单的所有状态都记录下来，</p>
<p>这时候就需要在源系统上做文章，数据库​触发器一般不可取。我能想到的方法是在业务系统上做些变动，</p>
<p>当订单状态发生变化时候，记一张流水表，可以是写进数据库，也可以是记录日志文件。</p>
<p>当然肯定还有其他抽取策略，至于采取哪种策略，需要考虑源数据系统情况，</p>
<p>抽取过来的数据在数据仓库中的存储和处理逻辑，抽取的时间窗口等等因素。</p>
<p>二、数据清洗：</p>
<p>顾名思义​，就是把不需要的，和不符合规范的数据进行处理。数据清洗最好放在抽取的环节进行，</p>
<p>这样可以节约后续的计算和存储成本；</p>
<p>当源数据为数据库时候，其他抽取数据的SQL中就可以进行很多数据清洗的工作了。</p>
<p>​数据清洗主要包括以下几个方面：</p>
<ol>
<li><p>空值处理；根据业务需要，可以将空值替换为特定的值或者直接过滤掉；</p>
</li>
<li><p>验证数据正确性；主要是把不符合​业务含义的数据做一处理，比如，把一个表示数量的字段中的字符串</p>
</li>
</ol>
<p>替换为0，把一个日期字段的非日期字符串过滤掉等等；</p>
<ol>
<li><p>规范数据格式；比如，把所有的日期都格式化成YYYY-MM-DD的格式等；</p>
</li>
<li><p>​数据转码；把一个源数据中用编码表示的字段，通过关联编码表，转换成代表其真实意义的值等等；</p>
</li>
<li><p>数据标准，统一；比如在源数据中表示男女的方式有很多种，在抽取的时候，直接根据模型中定义的值做转化，</p>
</li>
</ol>
<p>统一表示男女；</p>
<ol>
<li>其他业务规则定义的数据清洗。。。</li>
</ol>
<p>三、数据转换和加载：</p>
<p>很多人理解的ETL是在经过前两个部分之后，加载到数据仓库的数据库中就完事了。</p>
<p>数据转换和加载不仅仅是在源数据–&gt;ODS这一步，ODS–&gt;DW, DW–&gt;DM包含更为重要和复杂的ETL过程。</p>
<ol>
<li>什么是ODS？</li>
</ol>
<p>ODS（Operational Data Store）是数据仓库体系结构中的一个可选部分，</p>
<p>ODS具备数据仓库的部分特征和OLTP系统的部分特征，</p>
<p>它是“面向主题的、集成的、当前或接近当前的、 不断变化的”数据。​—摘自百度百科</p>
<p>其实大多时候，ODS只是充当了一个数据临时存储，数据缓冲的角色。一般来说，</p>
<p>数据由源数据加载到ODS之后，会保留一段时间，当后面的数据处理逻辑有问题，需要重新计算的时候，</p>
<p>可以直接从ODS这一步获取，而不用再从源数据再抽取一次，减少对源系统的压力。</p>
<p>另外，ODS还会直接给DM或者前端报表提供数据，比如一些维表或者不需要经过计算和处理的数据；</p>
<p>还有，ODS会完成一些其他事情，比如，存储一些明细数据以备不时之需等等；</p>
<ol>
<li>数据转换(刷新)：</li>
</ol>
<p>数据转换，更多的人把它叫做数据刷新，就是用ODS中的增量或者全量数据来刷新DW中的表。</p>
<p>DW中的表基本都是按照事先设计好的模型创建的，如事实表，维度表，汇总表等，</p>
<p>每天都需要把新的数据更新到这些表中。</p>
<p>更新这些表的过程(程序)都是刚开始的时候开发好的，每天只需要传一些参数,如日期，来运行这些程序即可。</p>
<ol>
<li>数据加载：</li>
</ol>
<p>个人认为，每insert数据到一张表，都可以称为数据加载，至于是delete+insert、truncate+insert、</p>
<p>还是merge，这个是由业务规则决定的，这些操作也都是嵌入到数据抽取、转换的程序中的。</p>
<p>四、ETL工具：</p>
<p>在传统行业的数据仓库项目中，大多会采用一些现成的ETL工具，如Informatica、Datastage、微软SSIS等。</p>
<p>这三种工具我都使用过，优点有：图形界面，开发简单，数据流向清晰；缺点：局限性，不够灵活，</p>
<p>处理大数据量比较吃力，查错困难，昂贵的费用；</p>
<p>选择ETL工具需要充分考虑源系统和数据仓库的环境，当然还有成本，如果源数据系统和数据仓库都采用</p>
<p>ORACLE，那么我觉得所有的ETL，都可以用存储过程来完成了。。</p>
<p>在大一点的互联网公司，由于数据量大，需求特殊，ETL工具大多为自己开发，</p>
<p>或者在开源工具上再进行一些二次开发，在实际工作中，</p>
<p>一个存储过程，一个shell/perl脚本，一个java程序等等，都可以作为ETL工具。</p>
<p>​</p>
<p>五、ETL过程中的元数据：</p>
<p>试想一下，你作为一个新人接手别人的工作，没有文档，程序没有注释，</p>
<p>数据库中的表和字段也没有任何comment，你是不是会骂娘了？</p>
<p>业务系统发生改变，删除了一个字段，需要数据仓库也做出相应调整的时候，</p>
<p>你如何知道改这个字段会对哪些程序产生影响？</p>
<p>源系统表的字段及其含义，源系统数据库的IP、接口人，数据仓库表的字段及其含义，</p>
<p>源表和目标表的对应关系，一个任务对应的源表和目标表，任务之间的依赖关系，</p>
<p>任务每次执行情况等等等等，这些元数据如果都能严格的管控起来，上面的问题肯定不会是问题了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/29/数据仓库/ETL/" data-id="cj290sbfj00d5ssqq0qvh7mqq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据仓库/">数据仓库</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-数据仓库/PowderDesigner" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/28/数据仓库/PowderDesigner/" class="article-date">
  <time datetime="2017-04-28T08:41:26.804Z" itemprop="datePublished">2017-04-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/数据仓库/">数据仓库</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/28/数据仓库/PowderDesigner/">PowderDesigner的使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>为什么要先有概念数据模型,再通过概念数据模型生成物理数据模型?</p>
<p>以为概念数据模型为实际事务的实体抽象,通过在概念中指定实体与实体之间的关系(一对一,一对多,多对多)),这样使用概念数据模型生成物理数据模型的时候直接在物理数据模型的实体中有实体间的属性关系字段生成,而不用我们指定对应的关系字段</p>
<p>通过生成的物理数据模型可以根据我们指定的数据库的类型生成对应的数据库sql脚本,这样我们那到这些数据库脚本去数据库中执行,就在数据库中生成了对应的表,视图等</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/28/数据仓库/PowderDesigner/" data-id="cj290sbff00d1ssqqqrlah15r" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据仓库/">数据仓库</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-bigdata/hive/hive_new/hive实战" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/26/bigdata/hive/hive_new/hive实战/" class="article-date">
  <time datetime="2017-04-26T01:29:54.618Z" itemprop="datePublished">2017-04-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hive/">hive</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/26/bigdata/hive/hive_new/hive实战/">hive实战</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="hive数据库创建时的编码问题"><a href="#hive数据库创建时的编码问题" class="headerlink" title="hive数据库创建时的编码问题"></a>hive数据库创建时的编码问题</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">javax.jdo.option.connectionURL</div><div class="line">jdbc:mysql://192.168.0.11:3306/metastore_hive_db?createDatabaseIfNotExist=true&amp;amp;characterEncoding=UTF-8</div></pre></td></tr></table></figure>
<p>如果数据库不存在,那么创建的库为utf-8,而hive不支持utf-8的格式,将会出现乱码的情况,此时我们需要手动在mysql库中创建metastore_hive_db,编码为latin1格式,这样就能解决这个问题</p>
<p>1.手动创建元数据库,设置编码为latin1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jdbc:mysql://192.168.0.11:3306/metastore_hive_db?createDatabaseIfNotExist=true&amp;amp;characterEncoding=UTF-8</div></pre></td></tr></table></figure></p>
<p>2.启动hive让其生成元数据库中的表</p>
<p>3.修改表字段注解和表注解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">alter table COLUMNS_V2 modify column comment varchar(256) character set utf8;</div><div class="line"></div><div class="line">alter table TABLE_PARAMS modify column PARAM_VALUE varchar(4000) character set utf8;</div></pre></td></tr></table></figure>
<p>4.修改分区字段注解<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">alter table PARTITION_PARAMS modify column PARAM_VALUE varchar(4000) character set utf8;</div><div class="line"></div><div class="line">alter table PARTITION_KEYS modify column PKEY_COMMENT varchar(4000) character set utf8;</div></pre></td></tr></table></figure></p>
<p>5.修改索引注释<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alter table INDEX_PARAMS modify column PARAM_VALUE varchar(4000) character set utf8;</div></pre></td></tr></table></figure></p>
<p>6.去hive中创建建库,建表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">create database ods;</div><div class="line">create database dw;</div><div class="line">create database dim;</div><div class="line">create database app;</div><div class="line"></div><div class="line"></div><div class="line">#然后去每个库下面建我们需要的表,如:</div><div class="line"></div><div class="line">CREATE TABLE `dim.dim_category` (</div><div class="line">  `tree_id` int COMMENT &apos;分类树ID&apos;,</div><div class="line">  `tree_name` varchar(64) COMMENT &apos;分类树名称&apos;,</div><div class="line">  `category_id` int COMMENT &apos;分类ID&apos;,</div><div class="line">  `category_name` varchar(64) COMMENT &apos;分类名称&apos;,</div><div class="line">  `category_type` int COMMENT &apos;分类类型0后台分类1前台分类&apos;,</div><div class="line">  `parent_id` int COMMENT &apos;上级分类树根的是0&apos;,</div><div class="line">  `parent_name` varchar(64) COMMENT &apos;父分类名称&apos;,</div><div class="line">  `layer` tinyint COMMENT &apos;层级&apos;,</div><div class="line">  `sort` int COMMENT &apos;分类排序&apos;,</div><div class="line">  `path` varchar(255) COMMENT &apos;所有上级分类&apos;,</div><div class="line">  `is_fmcg` tinyint comment &apos;是否快消品1是0否&apos;,</div><div class="line">  `is_open` tinyint COMMENT &apos;是否打开1是0否&apos;,</div><div class="line">  `is_show` tinyint COMMENT &apos;app是否显示1是0否&apos;,</div><div class="line">  `visibility` tinyint COMMENT &apos;商户端是否显示1是0否&apos;)</div><div class="line">  comment &apos;分类表&apos;</div><div class="line">ROW FORMAT DELIMITED</div><div class="line">FIELDS TERMINATED BY &apos;\t&apos;</div><div class="line">STORED AS TEXTFILE;</div></pre></td></tr></table></figure>
<h1 id="远程连接hive元数据库"><a href="#远程连接hive元数据库" class="headerlink" title="远程连接hive元数据库"></a>远程连接hive元数据库</h1><p>启动元数据</p>
<p>#这个服务可以让远程去连接hive的元数据库<br>bin/hive –service metastore &amp;</p>
<p>#如果是jdbc去连接hive的话需要启动这个服务<br>bin/hive –service hiveserver2 &amp;</p>
<p>如果是本地去连接远程,则在本地客户端需要配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;property&gt;</div><div class="line">	&lt;name&gt;hive.metastore.uris&lt;/name&gt;</div><div class="line">	&lt;value&gt;thrift://192.168.0.11:9083&lt;/value&gt;</div><div class="line">	&lt;description&gt;运行hive的主机地址及端口&lt;/description&gt;</div><div class="line">&lt;/property&gt;</div></pre></td></tr></table></figure></p>
<h1 id="hive-env-sh-配置"><a href="#hive-env-sh-配置" class="headerlink" title="hive-env.sh 配置"></a>hive-env.sh 配置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">HADOOP_HOME=</div><div class="line">export HIVE_CONF_DIR=</div></pre></td></tr></table></figure>
<h1 id="hive的日志"><a href="#hive的日志" class="headerlink" title="hive的日志"></a>hive的日志</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">hive -hiveconf hive.root.logger=DEBUG,console</div><div class="line">#将DEBUG以上的所有级别的日志打印到控制台,在调试的时候可以使用</div></pre></td></tr></table></figure>
<h1 id="常用工作语句"><a href="#常用工作语句" class="headerlink" title="常用工作语句"></a>常用工作语句</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line">create database ods;</div><div class="line">create database dw;</div><div class="line">create database app;</div><div class="line">create database dim;</div><div class="line"></div><div class="line">show databases;</div><div class="line"></div><div class="line">use ods;</div><div class="line"></div><div class="line">show tables;</div><div class="line">show tables like &apos;ods_*&apos;;</div><div class="line"></div><div class="line">#查看表的信息</div><div class="line">desc formatted ods.ods_order;</div><div class="line">可以看表的字段, 分区信息, 表所在的location, 表的类型</div><div class="line"></div><div class="line">#可以看文件的数据</div><div class="line">hive&gt;dfs -ls /user/hive/warehourse/ods.db/ods_order</div><div class="line"></div><div class="line">#查看文件的大小</div><div class="line">hive (ods)&gt; dfs -du -h /user/hive/warehouse/ods.db/;</div><div class="line"></div><div class="line"></div><div class="line">#查看执行计划</div><div class="line">explain select * from ods.ods_order ;</div><div class="line"></div><div class="line"></div><div class="line">#查看执行计划中的执行了哪些分区(对于查询语句中,分区没有卡死的情况下,我们可以很容易的知道)</div><div class="line">explain dependency select * from test where dt=&apos;20151010&apos; ;</div><div class="line"></div><div class="line">hive (ods)&gt; explain dependency select * from ods_order where dt=&apos;20151010&apos;;</div><div class="line">OK</div><div class="line">Explain</div><div class="line">&#123;&quot;input_partitions&quot;:[&#123;&quot;partitionName&quot;:&quot;ods@ods_order@dt=20151010&quot;&#125;],&quot;input_tables&quot;:[&#123;&quot;tablename&quot;:&quot;ods@ods_order&quot;,&quot;tabletype&quot;:&quot;MANAGED_TABLE&quot;&#125;]&#125;</div><div class="line">#可以看到输入分区,表,表类型</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#查看表的分区的信息</div><div class="line">show partitions app_order_city_d;</div><div class="line"></div><div class="line">#查看hadoop的任务</div><div class="line">yarn application -list|grep 用户名</div><div class="line">#有时候,知道hive中出错了,不要让他跑了,此时手动杀掉任务</div><div class="line">yarn application -kill application_143432432432423_86621</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#查看hive的函数</div><div class="line">show functions;</div><div class="line"></div><div class="line">#找到某个我们不记得名字的函数</div><div class="line">show functions like &apos;xpath*&apos;;</div><div class="line"></div><div class="line">#查看某个函数的用法,其中有例子</div><div class="line">desc function extended upper ;</div><div class="line"></div><div class="line"></div><div class="line">#hive查看表存储实际路径,找到location</div><div class="line">desc extended dw_order ;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#添加分区</div><div class="line">alter table ods_order add partition (dt=&apos;20151111&apos;);</div><div class="line"></div><div class="line">#删除分区</div><div class="line">alter table ods_order drop if exists partition (dt=&apos;20151111&apos;);</div><div class="line"></div><div class="line"></div><div class="line">#开启mapreduce</div><div class="line">set hive.fetch.task.conversion=minimal,more</div></pre></td></tr></table></figure>
<h1 id="创建分区加载数据"><a href="#创建分区加载数据" class="headerlink" title="创建分区加载数据"></a>创建分区加载数据</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">hive (ods)&gt; alter table ods_customer add partition (dt=&apos;20151210&apos;);</div><div class="line">OK</div><div class="line">Time taken: 0.19 seconds</div><div class="line">hive (ods)&gt; show partitions ods_customer;</div><div class="line">OK</div><div class="line">partition</div><div class="line">dt=20151210</div><div class="line">Time taken: 0.151 seconds, Fetched: 1 row(s)</div><div class="line">hive (ods)&gt; </div><div class="line"></div><div class="line"></div><div class="line">load data local inpath &apos;/home/hadoop/app/hive/script/t_customer.txt&apos; overwrite into table ods_customer partition (dt=&apos;20151210&apos;);</div><div class="line"></div><div class="line">hive (ods)&gt; dfs -du -h /user/hive/warehouse/ods.db/ods_customer/ ;</div><div class="line">7.6 M  /user/hive/warehouse/ods.db/ods_customer/dt=20151210</div><div class="line"></div><div class="line"></div><div class="line">#有的时候采用追加的方式去加载数据</div><div class="line"></div><div class="line">load data local inpath &apos;/home/hadoop/app/hive/script/t_customer.txt&apos; into table ods_customer partition (dt=&apos;20151210&apos;);</div></pre></td></tr></table></figure>
<h1 id="一些业务逻辑"><a href="#一些业务逻辑" class="headerlink" title="一些业务逻辑"></a>一些业务逻辑</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">select </div><div class="line">city_id,</div><div class="line">sum(case when order_status=5 then 1 else 0 end) as cnt_ord_succ_d,</div><div class="line">sum(case when order_status=3 then 1 else 0 end) as cnt_ord_cacel_d,</div><div class="line">sum(1) as cnt_ord_d,  &lt;----每天的每个城市的下单数</div><div class="line">count(distinct CUST_ID) as cnt_ord_user &lt;----- 下单的用户数</div><div class="line">FROM dw.dw_order </div><div class="line">WHERE dt=&apos;$&#123;day_01&#125;&apos; and city_id is not null</div><div class="line">group by city_id ;</div><div class="line"></div><div class="line"></div><div class="line">1.以城市id作为分组</div><div class="line">2.case when 进行转换</div><div class="line">	case when order_status=5 then 1 else 0 end</div><div class="line">3.sum对case when的结果进行求和</div><div class="line">4.统计每天下单的用户数,因为用户存在多次购买,所以使用distinct去重,然后使用count去统计去重之后的个数</div><div class="line">count(distinct CUST_ID)</div></pre></td></tr></table></figure>
<p>求商品的复购率</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">需求列出的商品的7日,15日,30复购率，目的了解这几款商品的周期.</div><div class="line">计算口径:当日购买部分商品的用户数/7日重复购买此商品的用户数。</div><div class="line">每天查看每个城市每个商品当日购买用户数，7日15日30日复购率。</div><div class="line"></div><div class="line">SELECT t3.atdate AS cdate,t3.city_id,t3.goods_id,</div><div class="line">COUNT(DISTINCT CASE WHEN days=0 THEN t3.cust_id END) AS cnt_buy_cust_d,		#取当前的购买人数</div><div class="line">COUNT(DISTINCT CASE WHEN days&gt;0 AND days&lt;=7 THEN t3.cust_id END) AS cnt_buy_cust_7_d, 	#取7天的购买人数,同一个用户多次购买,只取一次</div><div class="line">COUNT(DISTINCT CASE WHEN days&gt;0 AND days&lt;=15 THEN t3.cust_id END) AS cnt_buy_cust_15_d, 	#取15天的购买人数</div><div class="line">COUNT(DISTINCT CASE WHEN days&gt;0 AND days&lt;=30 THEN t3.cust_id END) AS cnt_buy_cust_30_d</div><div class="line">FROM (</div><div class="line">	SELECT t1.atdate,t1.city_id,t1.cust_id,t1.goods_id,</div><div class="line">	DATEDIFF(t2.atdate, t1.atdate) days ###第3步</div><div class="line">	FROM (###第一步</div><div class="line">		SELECT o.order_date AS atdate,o.city_id,</div><div class="line">		o.cust_id,og.goods_id</div><div class="line">		FROM dw.dw_order o INNER JOIN dw.dw_order_goods og</div><div class="line">		ON o.order_id=og.order_id </div><div class="line">		AND o.ORDER_STATUS = 5</div><div class="line">		AND og.source_id=1</div><div class="line">		AND o.dt = &apos;20151010&apos; </div><div class="line">	) t1 INNER JOIN (###第2步</div><div class="line">		SELECT o.order_date AS atdate,o.city_id,</div><div class="line">		o.cust_id,og.goods_id,</div><div class="line">		og.goods_name</div><div class="line">		FROM dw.dw_order o INNER JOIN dw.dw_order_goods og</div><div class="line">		ON o.order_id=og.order_id </div><div class="line">		AND o.ORDER_STATUS = 5</div><div class="line">		AND og.source_id=1</div><div class="line">	) t2 ON t1.cust_id=t2.cust_id AND t1.goods_id=t2.goods_id</div><div class="line">) t3 GROUP BY t3.atdate,t3.city_id,t3.goods_id;</div><div class="line"></div><div class="line"></div><div class="line">#这样在做数据展现的时候,求7日复购率</div><div class="line">select round(cnt_buy_cust_d/cnt_buy_cust_7_d) from t1</div><div class="line"></div><div class="line">其实在O2O中复购率可以看一些像:蔬菜,水果,生鲜等的上架周期</div></pre></td></tr></table></figure>
<p>月平均日客户数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">目前有一个合作资源，北京某度假酒店，价值几百到8000不等的酒店套房，一共100套，可以给到购买200元以上订单用户，用于抽奖奖品，比如设置的获奖条件：凡在9月,10月,11月的用户，下单200元以上的订单，即可获得北京某度假酒店。目的带动销量，刺激用户参与活动，同时给合作方导流。合作方需要知道我们订单金额在200以上的每天平均的用户量是多少.</div><div class="line">#客户id是int类型 需注意用count</div><div class="line">SELECT </div><div class="line">SUM(CASE WHEN t.COMPLETION_DATE&gt;=&apos;20151001&apos; AND t.COMPLETION_DATE&lt;=&apos;20151031&apos; THEN 1 ELSE 0 END) AS cnt_ord_10_m		//返回的是订单数量</div><div class="line">,COUNT(DISTINCT CASE WHEN t.COMPLETION_DATE&gt;=&apos;20151001&apos; AND t.COMPLETION_DATE&lt;=&apos;20151031&apos; THEN CUST_ID END) AS cnt_cust_10_m //返回的是客户数量</div><div class="line">FROM dw.dw_order t </div><div class="line">WHERE t.COMPLETION_DATE&gt;=&apos;20151001&apos; </div><div class="line">AND t.COMPLETION_DATE&lt;=&apos;20151031&apos; </div><div class="line">AND CITY_ID=2</div><div class="line">AND ORDER_TYPE &lt;&gt;6</div><div class="line">AND PAYABLE_AMOUNT&gt;100</div><div class="line">AND t.ORDER_STATUS=5;</div><div class="line"></div><div class="line">#注意这里的sum和count分别的作用</div></pre></td></tr></table></figure>
<p>求每个用户累计订单数，累计应付金额</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">#1.在dw_customer表中有累计的订单数和累计的订单总额,这样就可以避免去全表扫描dw_order表,因为订单表很大的,这样很耗时;</div><div class="line">#2.为什么要用full join?因为dw_customer表中并不是最新的用户表,如果当天有新增的用户,而新增的用户还不存在于dw_customer表中,而此时新增用户还有购买行为,那么如果使用left join就会将新增的用户过滤掉了,所以此处使用的是full join</div><div class="line">select nvl(t1.cust_id,t2.cust_id), </div><div class="line">nvl(t2.order_cnt,0)+nvl(t1.order_cnt,0) as order_cnt,</div><div class="line">nvl(t2.amount_sum,0)+nvl(t1.amount_sum,0) as amount_sum</div><div class="line">from dw.dw_customer t1</div><div class="line">full outer join (</div><div class="line">select cust_id,count(1) as order_cnt,sum(payable_amount) as amount_sum from </div><div class="line">dw.dw_order where dt=&apos;20151011&apos; and order_status=5</div><div class="line">group by cust_id</div><div class="line">) t2 on t1.cust_id=t2.cust_id</div><div class="line">and t1.dt=20151210 limit 100;</div></pre></td></tr></table></figure>
<p>新用户统计信息Hql分析(日粒度)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">#查看所有的时间函数</div><div class="line">show functions like &quot;*time*&quot;;</div><div class="line"></div><div class="line">/*</div><div class="line">这里涉及到两个时间的转换:</div><div class="line">1.将时间字符串转成毫秒数</div><div class="line">2015/5/1 21:46  转成毫秒数</div><div class="line"></div><div class="line">2.将毫秒数转成指定格式的时间字符串</div><div class="line">from_unixtime将毫秒数转成指定格式的字符串</div><div class="line"></div><div class="line">其实一般处理时间会使用我们写的UDF函数去统一处理</div><div class="line"></div><div class="line">*/</div><div class="line"></div><div class="line">select count(1) from dw.dw_customer</div><div class="line">where dt=&apos;20151210&apos; and  </div><div class="line">from_unixtime(unix_timestamp(register_time,&apos;yyyy/MM/dd HH:mm&apos;),&apos;yyyyMMdd&apos;)=&apos;20140610&apos;;</div></pre></td></tr></table></figure></p>
<p>求5,6月各个渠道带来的新用户(注册时间)，以此来考核运营部门的kpi</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">select source_no,count(1) from dw.dw_customer</div><div class="line">where dt=20151211 and</div><div class="line">from_unixtime(unix_timestamp(register_time,&apos;yyyy/MM/dd HH:mm&apos;),&apos;yyyyMMdd&apos;)&gt;=&apos;20141201&apos;</div><div class="line">and from_unixtime(unix_timestamp(register_time,&apos;yyyy/MM/dd HH:mm&apos;),&apos;yyyyMMdd&apos;)&lt;=&apos;20150131&apos; </div><div class="line">and source_no is not null</div><div class="line">group by source_no;</div></pre></td></tr></table></figure>
<p>统计各个渠道带来的用户，top10完成订单数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#求分组中的top10,使用row_number()函数:partition by 表示分组的字段, order by 表示组内排序的字段</div><div class="line"></div><div class="line">select source_no,mobile,order_cnt,rn from (</div><div class="line">select source_no,order_cnt,mobile,</div><div class="line">row_number() over(partition by source_no order by order_cnt desc) as rn </div><div class="line">from dw.dw_customer </div><div class="line">where dt=20151211 and source_no is not null and order_cnt is not null</div><div class="line">) t2 where rn &lt;10;</div></pre></td></tr></table></figure>
<h1 id="etl开发模板"><a href="#etl开发模板" class="headerlink" title="etl开发模板"></a>etl开发模板</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">#这里是需要用到的函数</div><div class="line">. /home/anjianbing/soft/functions/wait4FlagFile.sh</div><div class="line"># ===========================================================================</div><div class="line"># 程序名称:     </div><div class="line"># 功能描述:     城市每日完成订单数</div><div class="line"># 输入参数:     运行日期 20151010</div><div class="line"># 目标表名:     app.app_order_city_d 到哪张表来</div><div class="line"># 数据源表:     dw.dw_order	从哪张表来</div><div class="line">#   创建人:     安坚兵</div><div class="line"># 创建日期:     2015-12-21</div><div class="line"># 版本说明:     v1.0</div><div class="line"># 代码审核:     </div><div class="line"># 修改人名:</div><div class="line"># 修改日期:</div><div class="line"># 修改原因:</div><div class="line"># 修改列表: </div><div class="line"># ===========================================================================</div><div class="line">### 1.参数加载</div><div class="line">exe_hive=&quot;hive&quot;</div><div class="line"># 因为有的时候,可能会运行脚本的时候指定参数:sh test.sh 20151010,此时就是运行指定天的数,否则默认是运行前一天的数据</div><div class="line">if [ $# -eq 1 ]</div><div class="line">then</div><div class="line">    day_01=`date --date=&quot;$&#123;1&#125;&quot; +%Y-%m-%d`</div><div class="line">else</div><div class="line">    day_01=`date -d&apos;-1 day&apos; +%Y-%m-%d`</div><div class="line">fi</div><div class="line"></div><div class="line">#拿到时间的年月日</div><div class="line">syear=`date --date=$day_01 +%Y`</div><div class="line">smonth=`date --date=$day_01 +%m`</div><div class="line">sday=`date --date=$day_01 +%d`</div><div class="line"></div><div class="line">#目标数据库和表</div><div class="line">TARGET_DB=app.db</div><div class="line">TARGET_TABLE=app_order_city_d</div><div class="line"></div><div class="line">### 2.定义执行HQL</div><div class="line">HQL=&quot;insert overwrite table app.app_order_city_d partition (dt=&apos;$&#123;day_01&#125;&apos;)</div><div class="line">SELECT city_id,COUNT(1) FROM dw.dw_order WHERE dt=&apos;$&#123;day_01&#125;&apos; </div><div class="line">AND order_status=5 GROUP BY city_id;</div><div class="line">&quot;</div><div class="line">### 3.检查依赖 (因为只要等ods层的表跑完了,才能跑dw层的表,同样只有等dw层的表跑完了,才能跑app层的表)</div><div class="line">wait4FlagFile HDFS /user/hive/warehouse/dw.db/dw_order/dt=$&#123;day_01&#125; _SUCCESS 15801152142</div><div class="line"></div><div class="line">#### 4.执行HQL</div><div class="line">$exe_hive -e &quot;$HQL&quot;</div><div class="line"></div><div class="line">#### 5. 判断代码是否执行成功，touch控制文件</div><div class="line">result=`hadoop fs -ls /user/hive/warehouse/$&#123;TARGET_DB&#125;/$&#123;TARGET_TABLE&#125;/dt=$&#123;day_01&#125; | wc -l`</div><div class="line">if [[ $result -gt 0 ]]; then</div><div class="line">	#为下面的依赖做准备</div><div class="line">    hadoop fs -touchz /user/hive/warehouse/$&#123;TARGET_DB&#125;/$&#123;TARGET_TABLE&#125;/dt=$&#123;day_01&#125;/_SUCCESS</div><div class="line">else</div><div class="line">    echo &quot;失败发送预警短信和邮件&quot;</div><div class="line">fi</div></pre></td></tr></table></figure>
<h1 id="给已经排好序的表添加序列号的字段"><a href="#给已经排好序的表添加序列号的字段" class="headerlink" title="给已经排好序的表添加序列号的字段"></a>给已经排好序的表添加序列号的字段</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#给已经排好序的表添加序列号的字段</div><div class="line"></div><div class="line">select </div><div class="line">student_nu, score, row_number() over() as num</div><div class="line">from student order by score;</div></pre></td></tr></table></figure>
<h1 id="行转列"><a href="#行转列" class="headerlink" title="行转列"></a>行转列</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">name		class		score</div><div class="line">zhangsan	math		99</div><div class="line">zhangsan	chinese		88</div><div class="line">lisi		math		99</div><div class="line">lisi		chinese		100</div><div class="line"></div><div class="line">#行转列</div><div class="line">select</div><div class="line">name,</div><div class="line">max(case when class=&apos;math&apos; then score) as math_score,</div><div class="line">max(case when class=&apos;chinese&apos; then score) as math_score,</div><div class="line">from student group by name ;</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/26/bigdata/hive/hive_new/hive实战/" data-id="cj290sd4j01n3ssqqjjsptw75" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hive/">hive</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-bigdata/hive/hive_new/hive项目实战之服访问日志处理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/25/bigdata/hive/hive_new/hive项目实战之服访问日志处理/" class="article-date">
  <time datetime="2017-04-25T09:12:51.610Z" itemprop="datePublished">2017-04-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hive/">hive</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/25/bigdata/hive/hive_new/hive项目实战之服访问日志处理/">hive项目实战之服访问日志处理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h1><ul>
<li>创建原表</li>
<li>针对不同的业务创建不同的子表<ul>
<li>数据存储格式:orcfile/parquet</li>
<li>数据压缩:snappy</li>
<li>map output 数据压缩:snappy</li>
<li>外部表</li>
<li>分区表</li>
</ul>
</li>
</ul>
<h1 id="创建原表"><a href="#创建原表" class="headerlink" title="创建原表"></a>创建原表</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">create table if not exists default.log_src</div><div class="line">(</div><div class="line">remote_add string,</div><div class="line">remote_user string,</div><div class="line">request string,</div><div class="line">host string</div><div class="line">//...其他的字段</div><div class="line">)</div><div class="line">comment &apos;access log&apos;</div><div class="line">row format delimited fields terminated by &apos; &apos;</div><div class="line">stored as textfile ;</div></pre></td></tr></table></figure>
<h1 id="加载数据"><a href="#加载数据" class="headerlink" title="加载数据"></a>加载数据</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">load data local inpath &apos;/datas/access.log&apos; into table default.log_src ;</div></pre></td></tr></table></figure>
<p>会发现,我们的数据是不会正确的加载到表中的,因为使用空格的时候会出现错乱</p>
<p>hive的官网对web log推荐使用正则表达式</p>
<p>这里是hive官网的例子:</p>
<p><a href="https://issues.apache.org/jira/browse/HIVE-662" target="_blank" rel="external">https://issues.apache.org/jira/browse/HIVE-662</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE serde_regex(</div><div class="line">  host STRING,</div><div class="line">  identity STRING,</div><div class="line">  user STRING,</div><div class="line">  time STRING,</div><div class="line">  request STRING,</div><div class="line">  status STRING,</div><div class="line">  size STRING,</div><div class="line">  referer STRING,</div><div class="line">  agent STRING)</div><div class="line">ROW FORMAT SERDE &apos;org.apache.hadoop.hive.contrib.serde2.RegexSerDe&apos;</div><div class="line">WITH SERDEPROPERTIES (</div><div class="line">  &quot;input.regex&quot; = &quot;([^ ]*) ([^ ]*) ([^ ]*) (-|\\[[^\\]]*\\]) ([^ \&quot;]*|\&quot;[^\&quot;]*\&quot;) (-|[0-9]*) (-|[0-9]*)(?: ([^ \&quot;]*|\&quot;[^\&quot;]*\&quot;) ([^ \&quot;]*|\&quot;[^\&quot;]*\&quot;))?&quot;,</div><div class="line">  &quot;output.format.string&quot; = &quot;%1$s %2$s %3$s %4$s %5$s %6$s %7$s %8$s %9$s&quot;</div><div class="line">)</div><div class="line">STORED AS TEXTFILE;</div><div class="line"></div><div class="line">LOAD DATA LOCAL INPATH &quot;../data/files/apache.access.log&quot; INTO TABLE serde_regex;</div><div class="line">LOAD DATA LOCAL INPATH &quot;../data/files/apache.access.2.log&quot; INTO TABLE serde_regex;</div><div class="line"></div><div class="line">SELECT * FROM serde_regex ORDER BY time;</div></pre></td></tr></table></figure>
<p>对于不同的日志格式,我们可能需要些不同的正则表达式去匹配,下面的网站是校验你的正则表达式是否正确的网站,需要提供一条日志和你写的正则表达式</p>
<p><a href="http://wpjam.qiniudn.com/tool/regexpal/" target="_blank" rel="external">http://wpjam.qiniudn.com/tool/regexpal/</a></p>
<p>写正则表达式的规律:一个()就是一个字段,每个字段之间使用空格隔开,这样针对每一个字段在括号中写需要匹配的正则表达式</p>
<p>如果没有正则表达式,那么我们要写MapReduce做预处理了</p>
<h1 id="根据不同的业务创建不同的子表"><a href="#根据不同的业务创建不同的子表" class="headerlink" title="根据不同的业务创建不同的子表"></a>根据不同的业务创建不同的子表</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">create table if not exists default.log_comm</div><div class="line">(</div><div class="line">remote_add string,</div><div class="line">remote_user string,</div><div class="line">request string,</div><div class="line">host string</div><div class="line">)</div><div class="line">comment &apos;access log common&apos;</div><div class="line">row format delimited fields terminated by &apos;\t&apos;</div><div class="line">stored as orc tblproperties (&quot;orc.compress&quot;=&quot;SNAPPY&quot;) ;</div><div class="line"></div><div class="line"></div><div class="line">insert into table default.log_comm </div><div class="line">select remote_add, remote_user, request, host from default.log_src ;</div></pre></td></tr></table></figure>
<h1 id="自定义UDF进行数据清洗"><a href="#自定义UDF进行数据清洗" class="headerlink" title="自定义UDF进行数据清洗"></a>自定义UDF进行数据清洗</h1><p>定义UDF对原表数据进行清洗</p>
<h2 id="定义UDF去除引号"><a href="#定义UDF去除引号" class="headerlink" title="定义UDF去除引号"></a>定义UDF去除引号</h2><p>1.UDF编码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#下面是伪代码</div><div class="line"></div><div class="line">class RemoveQuotesUDF extends UDF&#123;</div><div class="line">	</div><div class="line">	public TEXT evaluate(Text str)&#123;</div><div class="line">		if(null==str.toString())&#123;</div><div class="line">			return null;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		//将所有的引号替换为空</div><div class="line">		return new Text(str.toString().replaceAll(&quot;\&quot;&quot;, &quot;&quot;));</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2.将上面的代码打包导出/opt/jars/udf.jar</p>
<p>3.add jar /opt/jars/udf.jar ;</p>
<p>4.create temporary function my_removequotes as “com.study.udf.RemoveQuotesUDF” ;</p>
<p>5.list jars ;</p>
<p>6.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">insert overwrite  table default.log_comm </div><div class="line">select my_removequotes(remote_add), remote_user, request, host from default.log_src ;</div></pre></td></tr></table></figure></p>
<h2 id="定义UDF日期转换"><a href="#定义UDF日期转换" class="headerlink" title="定义UDF日期转换"></a>定义UDF日期转换</h2><p>源数据中的日期的格式为:31/Aug/2015:00:04:37 +0800<br>udf之后的数据为:20150110437</p>
<p>udf代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">SimpleDateFormat inputFormat = new SimpleDateFormat(&quot;dd/MM/yyyy:HH:mm:ss&quot;, Locale.ENGLISH);</div><div class="line">SimpleDateFormat outputFormat = new SimpleDateFormat(&quot;yyyyMMddHHmmss&quot;, Locale.ENGLISH);</div><div class="line"></div><div class="line">public Text evalue(Text input)&#123;</div><div class="line">	</div><div class="line">	Text output = new Text();</div><div class="line">	</div><div class="line"></div><div class="line">	if(null==str||null==str.toString())&#123;</div><div class="line">		return null;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	String inputDate = input.toString().trim();</div><div class="line">	if(null == inputDate)&#123;</div><div class="line">		return null;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	try&#123;</div><div class="line">		//parse</div><div class="line">		Date parseDate = inputFormat.parse(inputDate);</div><div class="line">		//transform</div><div class="line">		String outputDate = outputFormat.format(parseDate);</div><div class="line">		//set</div><div class="line">		output.set(outputDate);</div><div class="line"></div><div class="line">	&#125;catch&#123;Exception e)&#123;</div><div class="line">		e.printStackTrace();</div><div class="line">	&#125;</div><div class="line">	return output;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>2.将上面的代码打包导出/opt/jars/udf2.jar</p>
<p>3.add jar /opt/jars/udf2.jar ;</p>
<p>4.create temporary function my_datetransform as “com.study.udf.DateTransformUDF” ;</p>
<p>5.list jars ;</p>
<p>6.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">insert overwrite  table default.log_comm </div><div class="line">select my_removequotes(remote_add), my_datetransform(time_local), remote_user, request, host from default.log_src ;</div></pre></td></tr></table></figure></p>
<h1 id="根据业务编写hiveQL"><a href="#根据业务编写hiveQL" class="headerlink" title="根据业务编写hiveQL"></a>根据业务编写hiveQL</h1><p>统计每天每小时的访问量,并排序<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">select substring(time_local,9,2) hour from default.log_comm;</div><div class="line"></div><div class="line"></div><div class="line">select t.hour, count(*) cnt from </div><div class="line">(</div><div class="line">select substring(time_local,9,2) hour from default.log_comm</div><div class="line">) t</div><div class="line">group by t.hour order by cnt desc ;</div></pre></td></tr></table></figure></p>
<p>根据访问的ip地址进行地域统计</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">select t.prex_ip, count(*) cnt from </div><div class="line">(</div><div class="line">select substring(ip, 1, 7) prex_ip from log_comm </div><div class="line">) t</div><div class="line">group by t.prex_ip order by cnt desc ;</div></pre></td></tr></table></figure>
<h1 id="使用python脚本进行数据清洗和统计"><a href="#使用python脚本进行数据清洗和统计" class="headerlink" title="使用python脚本进行数据清洗和统计"></a>使用python脚本进行数据清洗和统计</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">#数据的格式</div><div class="line">userid	movieid	rate	time</div><div class="line">196		33		4		881250949</div><div class="line"></div><div class="line"></div><div class="line">#创建表</div><div class="line">create table if not exists u_data</div><div class="line">(</div><div class="line">userid int,</div><div class="line">movieid int,</div><div class="line">rating	int,</div><div class="line">unixtime string</div><div class="line">)</div><div class="line">row format delimited</div><div class="line">fields terminated by &apos;\t&apos;</div><div class="line">stored as textfile</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#导入数据</div><div class="line">load data local inpath &apos;/datas/u.data&apos; overwrite into table u_data ;</div><div class="line"></div><div class="line"></div><div class="line">#创建一个新的表(此时时间变成weekday星期几)</div><div class="line">create table if not exists u_data_new</div><div class="line">(</div><div class="line">userid int,</div><div class="line">movieid int,</div><div class="line">rating	int,</div><div class="line">weekday int</div><div class="line">)</div><div class="line">row format delimited</div><div class="line">fields terminated by &apos;\t&apos;</div><div class="line">stored as textfile</div><div class="line"></div><div class="line"></div><div class="line">#加载python文件</div><div class="line">add file weekday_mapper.py ;</div><div class="line"></div><div class="line">#向新表中插入数据</div><div class="line">insert overwrite table u_data_new </div><div class="line">select </div><div class="line">	transform(userid,movieid, rating, unixtime)</div><div class="line">	using &apos;python weekday_mapper.py&apos;</div><div class="line">	as(user, movieid, rating, weekday)</div><div class="line">from u_data ;</div><div class="line"></div><div class="line">/*</div><div class="line">transform方法中传递过去的是u_data表中的指定的字段</div><div class="line">using 表示使用的是哪个python脚本</div><div class="line">as表示调用脚本传递出来的数据</div><div class="line">*/</div><div class="line"></div><div class="line">#按星期分组统计</div><div class="line">select weekd, count(*) from u_data_new  group by weekday ;</div></pre></td></tr></table></figure>
<p>python脚本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">import sys</div><div class="line">import datetime</div><div class="line"></div><div class="line">for line in sys.stdin:</div><div class="line">	line = line.strip()</div><div class="line">	userid,movieid, rating, unixtime = line.split(&apos;\t&apos;)</div><div class="line">	weekday = datetime.datetime.fromtimestamp(float(unixtime))</div><div class="line">	print &apos;\t&apos;.join([userid,movieid, rating, str(weekday)])</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/25/bigdata/hive/hive_new/hive项目实战之服访问日志处理/" data-id="cj290sd5701nissqqkd7bcrzt" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hive/">hive</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-bigdata/hive/hive_new/hive中的优化" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/25/bigdata/hive/hive_new/hive中的优化/" class="article-date">
  <time datetime="2017-04-25T03:02:57.947Z" itemprop="datePublished">2017-04-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hive/">hive</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/25/bigdata/hive/hive_new/hive中的优化/">hive中的优化</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="hive-fetch-task-conversion"><a href="#hive-fetch-task-conversion" class="headerlink" title="hive.fetch.task.conversion"></a>hive.fetch.task.conversion</h1><p>有些情况不走MapReduce,这样可以更快</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">vim conf/hive-site.xml</div><div class="line"></div><div class="line">  &lt;property&gt;</div><div class="line">    &lt;name&gt;hive.fetch.task.conversion&lt;/name&gt;</div><div class="line">    &lt;value&gt;more&lt;/value&gt;</div><div class="line">    &lt;description&gt;</div><div class="line">	对于当前查询只是单表,没有子查询和聚合以及distinct和join下面的情况不会走mapreduce</div><div class="line">	  Some select queries can be converted to single FETCH task minimizing latency.</div><div class="line">      Currently the query should be single sourced not having any subquery and should not have</div><div class="line">      any aggregations or distincts (which incurs RS), lateral views and joins.</div><div class="line">      0. none : disable hive.fetch.task.conversion</div><div class="line">      1. minimal : SELECT STAR, FILTER on partition columns, LIMIT only</div><div class="line">      2. more    : SELECT, FILTER, LIMIT only (support TABLESAMPLE and virtual columns)</div><div class="line">    &lt;/description&gt;</div><div class="line">  &lt;/property&gt;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">1.minimal 对于select* 和where条件是分区字段以及limit等不会走MapReduce</div><div class="line"></div><div class="line">select * from test;</div><div class="line">select * from test where monday=&apos;201509&apos; ; (此时test表有monday=&apos;201509&apos;这个分区)</div><div class="line">select * from test limit 5;</div><div class="line"></div><div class="line">2.more    : SELECT, FILTER, LIMIT only (support TABLESAMPLE and virtual columns)</div><div class="line">	SELECT,filter,limit不走MapReduce</div><div class="line"></div><div class="line">select job, ename from emp ;</div><div class="line">select job, ename from emp_partition where ename=&apos;SMITH&apos;;</div></pre></td></tr></table></figure>
<h1 id="大表的拆分"><a href="#大表的拆分" class="headerlink" title="大表的拆分"></a>大表的拆分</h1><p>将大表(字段很多的表),我们只需要对其中的某些字段进行操作,那么我们可以创建子表(取我们需要的字段)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">create table if not exists test_sub</div><div class="line">row format delimited fields terminated by &apos;,&apos;</div><div class="line">stored as orc</div><div class="line">as </div><div class="line">select id,name from test</div></pre></td></tr></table></figure>
<h1 id="外部表和分区表"><a href="#外部表和分区表" class="headerlink" title="外部表和分区表"></a>外部表和分区表</h1><p>通常这两个表是结合使用的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">create external table if not exists test_sub</div><div class="line">(</div><div class="line">id int,</div><div class="line">name string</div><div class="line">)</div><div class="line">comment &apos;xx&apos;</div><div class="line">partitioned by (month string, day string)</div><div class="line">row format delimited fields tereminated by &apos;,&apos;</div><div class="line"></div><div class="line">location &apos;xx.txt&apos; ;</div></pre></td></tr></table></figure>
<h1 id="数据的存储格式和数据的压缩"><a href="#数据的存储格式和数据的压缩" class="headerlink" title="数据的存储格式和数据的压缩"></a>数据的存储格式和数据的压缩</h1><ul>
<li>存储格式:orcfitle,parquet</li>
<li>数据压缩:snappy</li>
</ul>
<h1 id="sql优化"><a href="#sql优化" class="headerlink" title="sql优化"></a>sql优化</h1><ul>
<li>优化sql语句</li>
</ul>
<h1 id="join"><a href="#join" class="headerlink" title="join"></a>join</h1><ul>
<li>Reduce join<br>大表对大表:每个表的数据都是从文件中读取的</li>
</ul>
<p><img src="/assert/img/bigdata/hive/hive_new/hive_optimer.png" alt=""></p>
<ul>
<li>Map join</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#如果设置了这个参数,那么程序会识别map join</div><div class="line">set hive.auto.convert.join=true ;</div></pre></td></tr></table></figure>
<p>小表对大表;大表的数据是从文件从读取的,小表的数据放入到内存中<br>DistributedCache 类将小表缓存起来</p>
<ul>
<li>SMB join</li>
</ul>
<p>Sort-Merge-bucket join 是对上面的大表对大表的优化策略</p>
<p><img src="/assert/img/bigdata/hive/hive_new/hive_optimer_bucket.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">set hive.auto.convert.sortmerge.join=true;</div><div class="line">set hive.optimize.bucketmapjoin = true;</div><div class="line">set hive.optimize.bucketmapjoin.sortedmerge=true;</div></pre></td></tr></table></figure>
<p>group by出现数据倾斜的问题:<br>对于group by (col_name) ,如果进行group的col_name字段很多为空,那么会出现数据倾斜的问题,此时最好将该字段变成非空,然后就不会数据倾斜</p>
<p>count(distinct xx)也是会出现数据倾斜的问题</p>
<h1 id="执行计划"><a href="#执行计划" class="headerlink" title="执行计划"></a>执行计划</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">explain select * from emp ;</div><div class="line"></div><div class="line">explain select deptno, avg(sal) avg_sal from emp group by deptno;</div><div class="line"></div><div class="line">explain extended select deptno, avg(sal) avg_sal from emp group by deptno;</div></pre></td></tr></table></figure>
<h1 id="并行执行"><a href="#并行执行" class="headerlink" title="并行执行"></a>并行执行</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">job1 a join b ==&gt; aa</div><div class="line"></div><div class="line">job2 c join d ==&gt; cc</div><div class="line"></div><div class="line">job3 aa join cc</div><div class="line"></div><div class="line">#因为job1和job2没有依赖关系,所以可以并行执行</div></pre></td></tr></table></figure>
<p>可以设置如下的参数进行配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;property&gt;</div><div class="line">  &lt;name&gt;hive.exec.parallel&lt;/name&gt;</div><div class="line">  &lt;value&gt;false&lt;/value&gt;</div><div class="line">  &lt;description&gt;Whether to execute jobs in parallel&lt;/description&gt;</div><div class="line">&lt;/property&gt;</div><div class="line">&lt;property&gt;</div><div class="line">  &lt;name&gt;hive.exec.parallel.thread.number&lt;/name&gt;</div><div class="line">  &lt;value&gt;8&lt;/value&gt;</div><div class="line">  &lt;description&gt;How many jobs at most can be executed in parallel&lt;/description&gt;</div><div class="line">&lt;/property&gt;</div></pre></td></tr></table></figure>
<h1 id="jvm重用"><a href="#jvm重用" class="headerlink" title="jvm重用"></a>jvm重用</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">hive&gt;set mapreduce.job.jvm.numtasks;</div><div class="line"></div><div class="line">#可以设置jvm中跑多少个MapReduce</div></pre></td></tr></table></figure>
<h1 id="reduce数目"><a href="#reduce数目" class="headerlink" title="reduce数目"></a>reduce数目</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">set mapreduce.job.reduces;</div></pre></td></tr></table></figure>
<h1 id="推测执行"><a href="#推测执行" class="headerlink" title="推测执行"></a>推测执行</h1><p>关掉推测执行,不然有的时候,对同一个任务会启动两个MapReduce<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">0: jdbc:hive2://hdp-node-01:10000&gt; set hive.mapred.reduce.tasks.speculative.execution=false;</div><div class="line"></div><div class="line">0: jdbc:hive2://hdp-node-01:10000&gt; set mapreduce.reduce.speculative=false;</div><div class="line">0: jdbc:hive2://hdp-node-01:10000&gt; set mapreduce.map.speculative=false;</div></pre></td></tr></table></figure></p>
<h1 id="动态分区"><a href="#动态分区" class="headerlink" title="动态分区"></a>动态分区</h1><h1 id="Strict-Mode"><a href="#Strict-Mode" class="headerlink" title="Strict Mode"></a>Strict Mode</h1><p>在分区表进行查询,在where子句中没有加分区过滤的话,将禁止提交任务(默认是nostrict)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">0: jdbc:hive2://hdp-node-01:10000&gt; set hive.mapred.mode ;</div><div class="line">+-----------------------------+--+</div><div class="line">|             set             |</div><div class="line">+-----------------------------+--+</div><div class="line">| hive.mapred.mode=nonstrict  |</div><div class="line">+-----------------------------+--+</div><div class="line">1 row selected (0.017 seconds)</div><div class="line">0: jdbc:hive2://hdp-node-01:10000&gt; set hive.mapred.mode=strict;</div><div class="line">No rows affected (0.016 seconds)</div><div class="line">0: jdbc:hive2://hdp-node-01:10000&gt; set hive.mapred.mode ;</div><div class="line">+--------------------------+--+</div><div class="line">|           set            |</div><div class="line">+--------------------------+--+</div><div class="line">| hive.mapred.mode=strict  |</div><div class="line">+--------------------------+--+</div><div class="line">1 row selected (0.01 seconds)</div><div class="line"></div><div class="line">#对分区表执行查询数据</div><div class="line">0: jdbc:hive2://hdp-node-01:10000&gt; select * from emp_partition;</div><div class="line">Error: Error while compiling statement: FAILED: SemanticException [Error 10041]: No partition predicate found for Alias &quot;emp_partition&quot; Table &quot;emp_partition&quot; (state=42000,code=10041)</div><div class="line">0: jdbc:hive2://hdp-node-01:10000&gt; </div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">0: jdbc:hive2://hdp-node-01:10000&gt; show partitions emp_partition;</div><div class="line">+---------------+--+</div><div class="line">|   partition   |</div><div class="line">+---------------+--+</div><div class="line">| month=201509  |</div><div class="line">| month=201510  |</div><div class="line">| month=201511  |</div><div class="line">+---------------+--+</div><div class="line">3 rows selected (0.165 seconds)</div><div class="line">0: jdbc:hive2://hdp-node-01:10000&gt; select * from emp_partition where month=&apos;201509&apos; limit 3;</div><div class="line">+----------------------+----------------------+--------------------+--------------------+-------------------------+--------------------+---------------------+-----------------------+----------------------+--+</div><div class="line">| emp_partition.empno  | emp_partition.ename  | emp_partition.job  | emp_partition.mgr  | emp_partition.hiredate  | emp_partition.sal  | emp_partition.comm  | emp_partition.deptno  | emp_partition.month  |</div><div class="line">+----------------------+----------------------+--------------------+--------------------+-------------------------+--------------------+---------------------+-----------------------+----------------------+--+</div><div class="line">| 7369                 | SMITH                | CLERK              | 7902               | 1980-12-17              | 800.0              | NULL                | 20                    | 201509               |</div><div class="line">| 7499                 | ALLEN                | SALESMAN           | 7698               | 1981-2-20               | 1600.0             | 300.0               | 30                    | 201509               |</div><div class="line">| 7521                 | WARD                 | SALESMAN           | 7698               | 1981-2-22               | 1250.0             | 500.0               | 30                    | 201509               |</div><div class="line">+----------------------+----------------------+--------------------+--------------------+-------------------------+--------------------+---------------------+-----------------------+----------------------+--+</div><div class="line">3 rows selected (0.19 seconds)</div><div class="line">0: jdbc:hive2://hdp-node-01:10000&gt;</div></pre></td></tr></table></figure>
<p>使用严格模式可以禁止3种类型的查询:</p>
<ul>
<li>对于分区表,不加分区字段过滤条件的不能执行</li>
<li>对于order by, 没有使用limit的不能执行</li>
<li>对于笛卡尔积的查询,使用where但是没有使用on的不能进行查询</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/25/bigdata/hive/hive_new/hive中的优化/" data-id="cj290sd4501mussqqzio9h8le" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hive/">hive</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-bigdata/hive/hive_new/hive中使用Snappy压缩" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/25/bigdata/hive/hive_new/hive中使用Snappy压缩/" class="article-date">
  <time datetime="2017-04-25T01:50:12.762Z" itemprop="datePublished">2017-04-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hive/">hive</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/25/bigdata/hive/hive_new/hive中使用Snappy压缩/">hive中数据的存储格式和Snappy压缩</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">hive&gt;set mapreduce.map.output.compress=true;</div><div class="line">hive&gt;set mapreduce.map.output.compress.codec=org.apache.hadoop.io.compress.SnappyCodec ;</div><div class="line"></div><div class="line">//同时需要在hadoop按照的时候支持Snappy</div></pre></td></tr></table></figure>
<p>在hive中一般使用的存储格式为:orc,parquet<br>数据压缩一般使用的是snappy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">create table if not exists test_textfile</div><div class="line">(</div><div class="line"></div><div class="line">...</div><div class="line">)</div><div class="line"></div><div class="line">stored as textfile</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">create table if not exists test_orc_snappy</div><div class="line">(</div><div class="line"></div><div class="line">...</div><div class="line">)</div><div class="line"></div><div class="line">stored as orc tblproperties(&quot;orc.compress&quot;=&quot;SNAPPY&quot;)</div><div class="line"></div><div class="line">#储存使用的是orc</div><div class="line">#压缩使用的是SNAPPY</div><div class="line"></div><div class="line"></div><div class="line">向压缩的表中插入数据:</div><div class="line">insert into tble test_orc_snappy select * from test_textfile</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/25/bigdata/hive/hive_new/hive中使用Snappy压缩/" data-id="cj290sd3m01mjssqqy7c9vw10" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hive/">hive</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-bigdata/hive/hive_new/HiveServer2,Beeline,JDBC的使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/24/bigdata/hive/hive_new/HiveServer2,Beeline,JDBC的使用/" class="article-date">
  <time datetime="2017-04-24T08:22:48.029Z" itemprop="datePublished">2017-04-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hive/">hive</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/24/bigdata/hive/hive_new/HiveServer2,Beeline,JDBC的使用/">HiveServer2, Beeline, JDBC的使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="启动hiveserver2服务"><a href="#启动hiveserver2服务" class="headerlink" title="启动hiveserver2服务"></a>启动hiveserver2服务</h1><p>hiveServer2是将hive作为一个服务启动,这样可以有更多的客户端连接过来,他启动的进程服务叫RunJar</p>
        
          <p class="article-more-link">
            <a href="/2017/04/24/bigdata/hive/hive_new/HiveServer2,Beeline,JDBC的使用/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/24/bigdata/hive/hive_new/HiveServer2,Beeline,JDBC的使用/" data-id="cj290sd3k01missqqgk66n8na" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hive/">hive</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/58/">58</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/IDEA/">IDEA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/NFS/">NFS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tachyon/">Tachyon</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/azkaban/">azkaban</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/echarts/">echarts</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/flume/">flume</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/">hadoop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hbase/">hbase</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hive/">hive</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/inotify/">inotify</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/kafka/">kafka</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/logstash/">logstash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/markdown/">markdown</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/memcached/">memcached</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/project/">project</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/rsync/">rsync</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/scala/">scala</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/shell/">shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/socket/">socket</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/spark/">spark</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/sqoop/">sqoop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/storm/">storm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据仓库/">数据仓库</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDEA/">IDEA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux基础命令/">Linux基础命令</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux重要配置文件/">Linux重要配置文件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NFS/">NFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NIO/">NIO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azkaban/">azkaban</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/echarts/">echarts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flume/">flume</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hadoop/">hadoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hbase/">hbase</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hive/">hive</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/inotify/">inotify</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/">kafka</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logstash/">logstash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mapreduce/">mapreduce</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/memcached/">memcached</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/netty/">netty</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/project/">project</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rpc/">rpc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rsync/">rsync</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala/">scala</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala函数式编程/">scala函数式编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala编程/">scala编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socket/">socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spark/">spark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqoop/">sqoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/storm/">storm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zookeeper/">zookeeper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据仓库/">数据仓库</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/IDEA/" style="font-size: 10px;">IDEA</a> <a href="/tags/Linux基础命令/" style="font-size: 19.52px;">Linux基础命令</a> <a href="/tags/Linux重要配置文件/" style="font-size: 14.76px;">Linux重要配置文件</a> <a href="/tags/NFS/" style="font-size: 10px;">NFS</a> <a href="/tags/NIO/" style="font-size: 11.43px;">NIO</a> <a href="/tags/azkaban/" style="font-size: 10.48px;">azkaban</a> <a href="/tags/echarts/" style="font-size: 10.95px;">echarts</a> <a href="/tags/flume/" style="font-size: 10.95px;">flume</a> <a href="/tags/hadoop/" style="font-size: 18.57px;">hadoop</a> <a href="/tags/hbase/" style="font-size: 13.33px;">hbase</a> <a href="/tags/hive/" style="font-size: 18.1px;">hive</a> <a href="/tags/inotify/" style="font-size: 10px;">inotify</a> <a href="/tags/java/" style="font-size: 12.38px;">java</a> <a href="/tags/kafka/" style="font-size: 12.86px;">kafka</a> <a href="/tags/linux/" style="font-size: 13.33px;">linux</a> <a href="/tags/logstash/" style="font-size: 10.48px;">logstash</a> <a href="/tags/mapreduce/" style="font-size: 16.67px;">mapreduce</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/memcached/" style="font-size: 13.81px;">memcached</a> <a href="/tags/mongodb/" style="font-size: 14.76px;">mongodb</a> <a href="/tags/mysql/" style="font-size: 17.14px;">mysql</a> <a href="/tags/netty/" style="font-size: 10.95px;">netty</a> <a href="/tags/nginx/" style="font-size: 14.29px;">nginx</a> <a href="/tags/project/" style="font-size: 10.48px;">project</a> <a href="/tags/python/" style="font-size: 19.05px;">python</a> <a href="/tags/redis/" style="font-size: 17.14px;">redis</a> <a href="/tags/rpc/" style="font-size: 10.48px;">rpc</a> <a href="/tags/rsync/" style="font-size: 10px;">rsync</a> <a href="/tags/scala/" style="font-size: 17.62px;">scala</a> <a href="/tags/scala函数式编程/" style="font-size: 11.9px;">scala函数式编程</a> <a href="/tags/scala编程/" style="font-size: 15.71px;">scala编程</a> <a href="/tags/shell/" style="font-size: 17.62px;">shell</a> <a href="/tags/socket/" style="font-size: 11.9px;">socket</a> <a href="/tags/spark/" style="font-size: 20px;">spark</a> <a href="/tags/sqoop/" style="font-size: 10.95px;">sqoop</a> <a href="/tags/storm/" style="font-size: 15.24px;">storm</a> <a href="/tags/zookeeper/" style="font-size: 16.19px;">zookeeper</a> <a href="/tags/数据仓库/" style="font-size: 11.43px;">数据仓库</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/05/02/bigdata/spark从入门到精通_笔记/Tachyon/">Tachyon</a>
          </li>
        
          <li>
            <a href="/2017/04/30/数据仓库/数据仓库2/">数据仓库</a>
          </li>
        
          <li>
            <a href="/2017/04/29/IDEA/IDEA/">IDEA</a>
          </li>
        
          <li>
            <a href="/2017/04/29/数据仓库/ETL/">ETL</a>
          </li>
        
          <li>
            <a href="/2017/04/28/数据仓库/PowderDesigner/">PowderDesigner的使用</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Mr. Chen<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>




  </div>
</body>
</html>